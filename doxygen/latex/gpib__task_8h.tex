\hypertarget{gpib__task_8h}{}\doxysection{gpib/gpib\+\_\+task.h File Reference}
\label{gpib__task_8h}\index{gpib/gpib\_task.h@{gpib/gpib\_task.h}}


High level G\+P\+IB command handler for H\+P85 disk emulator project for A\+VR.  


{\ttfamily \#include $<$user\+\_\+config.\+h$>$}\newline
{\ttfamily \#include \char`\"{}drives.\+h\char`\"{}}\newline
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{gpib__task_8h_a5859304d546fa05404d17db34c704906}{gpib\+\_\+file\+\_\+init}} (void)
\begin{DoxyCompactList}\small\item\em Read Configuration File. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{gpib__task_8h_a8351e69574a06b0f9184a877fee560c1}{gpib\+\_\+log}} (char $\ast$str)
\begin{DoxyCompactList}\small\item\em Log G\+P\+IB transactions. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{gpib__task_8h_a727ee8639d6e3f33b9d1c5d00258ae4a}{S\+S80\+\_\+is\+\_\+\+M\+LA}} (int address)
\begin{DoxyCompactList}\small\item\em Check if S\+S80 listening address. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{gpib__task_8h_a6029655f36ebeac8ad4289b50120edda}{S\+S80\+\_\+is\+\_\+\+M\+TA}} (int address)
\begin{DoxyCompactList}\small\item\em Check if S\+S80 talking address. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{gpib__task_8h_a9be4dbb384e5f77dc72ec44ca6f20c2f}{S\+S80\+\_\+is\+\_\+\+M\+SA}} (int address)
\begin{DoxyCompactList}\small\item\em Check if S\+S80 secondary address. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{gpib__task_8h_a5388f9110afe97053ba52575fd404171}{A\+M\+I\+G\+O\+\_\+is\+\_\+\+M\+LA}} (int address)
\item 
int \mbox{\hyperlink{gpib__task_8h_ab5e7311f705af87cb62e74e1493a9b7d}{A\+M\+I\+G\+O\+\_\+is\+\_\+\+M\+TA}} (int address)
\item 
int \mbox{\hyperlink{gpib__task_8h_a66829ca3f977b4f2ccc171275c3b57fa}{A\+M\+I\+G\+O\+\_\+is\+\_\+\+M\+SA}} (int address)
\item 
int \mbox{\hyperlink{gpib__task_8h_a48f72546a97843213351fcbad4d42469}{P\+R\+I\+N\+T\+E\+R\+\_\+is\+\_\+\+M\+LA}} (int address)
\begin{DoxyCompactList}\small\item\em Check if P\+R\+I\+N\+T\+ER listening address. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{gpib__task_8h_ad3df30ddc50951831d3837e99c3624b0}{P\+R\+I\+N\+T\+E\+R\+\_\+is\+\_\+\+M\+TA}} (int address)
\begin{DoxyCompactList}\small\item\em Check if P\+R\+I\+N\+T\+ER talking address. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{gpib__task_8h_a5da52fb36be595498e2ad9c4ced6a2ac}{P\+R\+I\+N\+T\+E\+R\+\_\+is\+\_\+\+M\+SA}} (int address)
\begin{DoxyCompactList}\small\item\em Check if P\+R\+I\+N\+T\+ER secondary address. \end{DoxyCompactList}\item 
uint16\+\_\+t \mbox{\hyperlink{gpib__task_8h_a314fbeb162cf0fb719ece3da4f2a8c52}{gpib\+\_\+trace\+\_\+read\+\_\+byte}} (void)
\item 
void \mbox{\hyperlink{gpib__task_8h_a63ef822f4a1b03c38d87854df9c618be}{gpib\+\_\+trace\+\_\+task}} (char $\ast$name, int detail)
\begin{DoxyCompactList}\small\item\em Trace G\+P\+IB activity passively -\/ saving to a log file. \end{DoxyCompactList}\item 
uint16\+\_\+t \mbox{\hyperlink{gpib__task_8h_a903eb44d83bf8f2db71e6f32a35fec62}{gpib\+\_\+error\+\_\+test}} (uint16\+\_\+t val)
\begin{DoxyCompactList}\small\item\em Check for G\+P\+IB errors and timeouts. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{gpib__task_8h_a2a437a5de39ba349ce90eef38f075712}{gpib\+\_\+init\+\_\+devices}} (void)
\begin{DoxyCompactList}\small\item\em Initialize A\+LL emulated devices S\+S80, A\+M\+I\+GO and printer. \end{DoxyCompactList}\item 
uint16\+\_\+t \mbox{\hyperlink{gpib__task_8h_a986d23075dcf4a3e6fd14995d0e82704}{G\+P\+I\+B\+\_\+\+C\+O\+M\+M\+A\+N\+DS}} (uint16\+\_\+t val, uint8\+\_\+t unread)
\begin{DoxyCompactList}\small\item\em Process all G\+P\+IB Secondary Commands. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{gpib__task_8h_af6b5cba8eb1142502f2ce96fc86a933f}{gpib\+\_\+task}} (void)
\begin{DoxyCompactList}\small\item\em Top most main G\+P\+IB device emulator task. This is \mbox{\hyperlink{main_8c_a840291bc02cba5474a4cb46a9b9566fe}{main()}} for G\+P\+IB state machine loop All tasks are dispatched from here. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{gpib__task_8h_af7ec1aa9752ef65efd1bfd8a582a29c2}{Send\+\_\+\+Identify}} (uint8\+\_\+t ch, uint16\+\_\+t ID)
\begin{DoxyCompactList}\small\item\em Send drive identify-\/ 2 bytes. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{gpib__task_8h_ac63d4e431ab55dddfbf436d87135128e}{G\+P\+IB}} (uint8\+\_\+t ch)
\begin{DoxyCompactList}\small\item\em Main G\+P\+IB command handler Commands 0x00 .. 0x1f. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{gpib__task_8h_ae2bd0f57f529ba47dbc113ac709a35f0}{G\+P\+I\+B\+\_\+\+L\+I\+S\+T\+EN}} (uint8\+\_\+t ch)
\begin{DoxyCompactList}\small\item\em Process all G\+P\+IB Listen commands. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{gpib__task_8h_a9e586941a3629bec1a2c7e7a9113cee3}{G\+P\+I\+B\+\_\+\+T\+A\+LK}} (uint8\+\_\+t ch)
\begin{DoxyCompactList}\small\item\em Process all G\+P\+IB Talk commands. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{gpib__task_8h_ad18e29cb0500dc2226b4bebbf0fcbf0c}{G\+P\+I\+B\+\_\+\+S\+E\+C\+O\+N\+D\+A\+R\+Y\+\_\+\+A\+D\+D\+R\+E\+SS}} (uint8\+\_\+t ch)
\begin{DoxyCompactList}\small\item\em Process all G\+P\+IB Secondary Addresses. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{gpib__task_8h_a61b7b85789f90b1cc0e6cb4f71f6797d}{listen\+\_\+cleanup}} (void)
\begin{DoxyCompactList}\small\item\em Called when the listen address changes. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{gpib__task_8h_a509eb3426def2f282b1a31c411e9cbb7}{talk\+\_\+cleanup}} (void)
\begin{DoxyCompactList}\small\item\em Called when the G\+P\+IB talk address changes. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{gpib__task_8h_ab62b0b328847bfeb43baded10b34d28b}{Dump\+Data}} (unsigned char $\ast$ptr, int length)
\begin{DoxyCompactList}\small\item\em H\+EX and A\+S\+C\+II dump of string in human-\/readable format. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
High level G\+P\+IB command handler for H\+P85 disk emulator project for A\+VR. 

\begin{DoxyParagraph}{Edit History}

\begin{DoxyItemize}
\item \mbox{[}1.\+0\mbox{]} \mbox{[}Mike Gore\mbox{]} Initial revision of file.
\end{DoxyItemize}
\end{DoxyParagraph}
\begin{DoxyParagraph}{Copyright \copyright{} 2014-\/2020 Mike Gore, All rights reserved. G\+PL}

\end{DoxyParagraph}
\begin{DoxySeeAlso}{See also}
\href{http://github.com/magore/hp85disk}{\texttt{ http\+://github.\+com/magore/hp85disk}} 

\href{http://github.com/magore/hp85disk/COPYRIGHT.md}{\texttt{ http\+://github.\+com/magore/hp85disk/\+C\+O\+P\+Y\+R\+I\+G\+H\+T.\+md}} for Copyright details 
\end{DoxySeeAlso}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{gpib__task_8h_a5388f9110afe97053ba52575fd404171}\label{gpib__task_8h_a5388f9110afe97053ba52575fd404171}} 
\index{gpib\_task.h@{gpib\_task.h}!AMIGO\_is\_MLA@{AMIGO\_is\_MLA}}
\index{AMIGO\_is\_MLA@{AMIGO\_is\_MLA}!gpib\_task.h@{gpib\_task.h}}
\doxysubsubsection{\texorpdfstring{AMIGO\_is\_MLA()}{AMIGO\_is\_MLA()}}
{\footnotesize\ttfamily int A\+M\+I\+G\+O\+\_\+is\+\_\+\+M\+LA (\begin{DoxyParamCaption}\item[{int}]{address }\end{DoxyParamCaption})}



Referenced by G\+P\+I\+B(), G\+P\+I\+B\+\_\+\+C\+O\+M\+M\+A\+N\+D\+S(), and G\+P\+I\+B\+\_\+\+L\+I\+S\+T\+E\+N().

\mbox{\Hypertarget{gpib__task_8h_a66829ca3f977b4f2ccc171275c3b57fa}\label{gpib__task_8h_a66829ca3f977b4f2ccc171275c3b57fa}} 
\index{gpib\_task.h@{gpib\_task.h}!AMIGO\_is\_MSA@{AMIGO\_is\_MSA}}
\index{AMIGO\_is\_MSA@{AMIGO\_is\_MSA}!gpib\_task.h@{gpib\_task.h}}
\doxysubsubsection{\texorpdfstring{AMIGO\_is\_MSA()}{AMIGO\_is\_MSA()}}
{\footnotesize\ttfamily int A\+M\+I\+G\+O\+\_\+is\+\_\+\+M\+SA (\begin{DoxyParamCaption}\item[{int}]{address }\end{DoxyParamCaption})}



Referenced by G\+P\+I\+B\+\_\+\+S\+E\+C\+O\+N\+D\+A\+R\+Y\+\_\+\+A\+D\+D\+R\+E\+S\+S().

\mbox{\Hypertarget{gpib__task_8h_ab5e7311f705af87cb62e74e1493a9b7d}\label{gpib__task_8h_ab5e7311f705af87cb62e74e1493a9b7d}} 
\index{gpib\_task.h@{gpib\_task.h}!AMIGO\_is\_MTA@{AMIGO\_is\_MTA}}
\index{AMIGO\_is\_MTA@{AMIGO\_is\_MTA}!gpib\_task.h@{gpib\_task.h}}
\doxysubsubsection{\texorpdfstring{AMIGO\_is\_MTA()}{AMIGO\_is\_MTA()}}
{\footnotesize\ttfamily int A\+M\+I\+G\+O\+\_\+is\+\_\+\+M\+TA (\begin{DoxyParamCaption}\item[{int}]{address }\end{DoxyParamCaption})}



Referenced by G\+P\+I\+B\+\_\+\+C\+O\+M\+M\+A\+N\+D\+S(), and G\+P\+I\+B\+\_\+\+T\+A\+L\+K().

\mbox{\Hypertarget{gpib__task_8h_ab62b0b328847bfeb43baded10b34d28b}\label{gpib__task_8h_ab62b0b328847bfeb43baded10b34d28b}} 
\index{gpib\_task.h@{gpib\_task.h}!DumpData@{DumpData}}
\index{DumpData@{DumpData}!gpib\_task.h@{gpib\_task.h}}
\doxysubsubsection{\texorpdfstring{DumpData()}{DumpData()}}
{\footnotesize\ttfamily void Dump\+Data (\begin{DoxyParamCaption}\item[{unsigned char $\ast$}]{ptr,  }\item[{int}]{length }\end{DoxyParamCaption})}



H\+EX and A\+S\+C\+II dump of string in human-\/readable format. 


\begin{DoxyItemize}
\item Used only for debugging 
\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em ptr} & data \\
\hline
\mbox{\texttt{ in}}  & {\em length} & length of data string\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}

\end{DoxyItemize}

Definition at line 979 of file gpib\+\_\+task.\+c.

\mbox{\Hypertarget{gpib__task_8h_ac63d4e431ab55dddfbf436d87135128e}\label{gpib__task_8h_ac63d4e431ab55dddfbf436d87135128e}} 
\index{gpib\_task.h@{gpib\_task.h}!GPIB@{GPIB}}
\index{GPIB@{GPIB}!gpib\_task.h@{gpib\_task.h}}
\doxysubsubsection{\texorpdfstring{GPIB()}{GPIB()}}
{\footnotesize\ttfamily int G\+P\+IB (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{ch }\end{DoxyParamCaption})}



Main G\+P\+IB command handler Commands 0x00 .. 0x1f. 


\begin{DoxyItemize}
\item We are only ever called with A\+TN=1 commands.
\item ch = G\+P\+IB command and status (ie it has the A\+T\+N\+\_\+\+F\+L\+AG set).
\item Notes\+: We track any device states and call handelers.
\end{DoxyItemize}


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em ch} & 8 bit command\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 on sucess 

G\+P\+IB error flags on fail 
\end{DoxyReturn}
\begin{DoxySeeAlso}{See also}
\mbox{\hyperlink{gpib_8h}{gpib.\+h}} \mbox{\hyperlink{gpib_8h_a10916ab21f8ba06e447e898790ef6a4b}{E\+R\+R\+O\+R\+\_\+\+M\+A\+SK}} defines for a full list. 
\end{DoxySeeAlso}
Parallel Poll Configure T\+O\+DO

Parallel Poll Unconfigure T\+O\+DO

\begin{DoxyRefDesc}{Todo}
\item[\mbox{\hyperlink{todo__todo000004}{Todo}}]F\+I\+X\+ME \end{DoxyRefDesc}


Selected Device Clear

Note\+: Suposed to be unsupported in S\+S80 -\/ pg 4-\/2 C\+S80 3-\/4

\begin{DoxyRefDesc}{Todo}
\item[\mbox{\hyperlink{todo__todo000005}{Todo}}]F\+I\+X\+ME \end{DoxyRefDesc}


(Universal) Device Clear

\begin{DoxyRefDesc}{Todo}
\item[\mbox{\hyperlink{todo__todo000006}{Todo}}]Fixme \end{DoxyRefDesc}


Definition at line 619 of file gpib\+\_\+task.\+c.



Referenced by gpib\+\_\+task().

\mbox{\Hypertarget{gpib__task_8h_a986d23075dcf4a3e6fd14995d0e82704}\label{gpib__task_8h_a986d23075dcf4a3e6fd14995d0e82704}} 
\index{gpib\_task.h@{gpib\_task.h}!GPIB\_COMMANDS@{GPIB\_COMMANDS}}
\index{GPIB\_COMMANDS@{GPIB\_COMMANDS}!gpib\_task.h@{gpib\_task.h}}
\doxysubsubsection{\texorpdfstring{GPIB\_COMMANDS()}{GPIB\_COMMANDS()}}
{\footnotesize\ttfamily uint16\+\_\+t G\+P\+I\+B\+\_\+\+C\+O\+M\+M\+A\+N\+DS (\begin{DoxyParamCaption}\item[{uint16\+\_\+t}]{val,  }\item[{uint8\+\_\+t}]{unread }\end{DoxyParamCaption})}



Process all G\+P\+IB Secondary Commands. 


\begin{DoxyItemize}
\item Dispatch emulator handler based on address
\item if unread is true we \char`\"{}unread\char`\"{} val so the corresponding device emulator can process it.
\item Unread allow us to write each emulator as a pure function.
\end{DoxyItemize}


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em val} & G\+P\+IB secondary command and control flags. \\
\hline
\mbox{\texttt{ in}}  & {\em unread} & if 1 unread val prior to emulator call.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
G\+P\+IB status from emulator command. 

0 if no emulator command processed. 
\end{DoxyReturn}
talking ?

listening ?

Definition at line 371 of file gpib\+\_\+task.\+c.



Referenced by gpib\+\_\+task().

\mbox{\Hypertarget{gpib__task_8h_a903eb44d83bf8f2db71e6f32a35fec62}\label{gpib__task_8h_a903eb44d83bf8f2db71e6f32a35fec62}} 
\index{gpib\_task.h@{gpib\_task.h}!gpib\_error\_test@{gpib\_error\_test}}
\index{gpib\_error\_test@{gpib\_error\_test}!gpib\_task.h@{gpib\_task.h}}
\doxysubsubsection{\texorpdfstring{gpib\_error\_test()}{gpib\_error\_test()}}
{\footnotesize\ttfamily uint16\+\_\+t gpib\+\_\+error\+\_\+test (\begin{DoxyParamCaption}\item[{uint16\+\_\+t}]{val }\end{DoxyParamCaption})}



Check for G\+P\+IB errors and timeouts. 


\begin{DoxyItemize}
\item Reset G\+P\+IB bus on I\+FC or user keypress
\item Display debug messages if debuglevel permits.
\item Check media insert state
\end{DoxyItemize}


\begin{DoxyParams}{Parameters}
{\em val} & command or data byte and control or error flags.
\begin{DoxyItemize}
\item Lower 8 bits\+: Data or Command.
\begin{DoxyItemize}
\item If A\+TN is L\+OW then we strip parity from the byte.
\end{DoxyItemize}
\item Upper 8 bits\+: Status and Errors.
\begin{DoxyItemize}
\item 
\end{DoxyItemize}
\end{DoxyItemize}\\
\hline
\end{DoxyParams}
\begin{DoxySeeAlso}{See also}
\mbox{\hyperlink{gpib_8h}{gpib.\+h}} \+\_\+\+F\+L\+A\+GS defines for a full list.
\begin{DoxyItemize}
\item An error implies the data byte can\textquotesingle{}t be trusted
\item Control Line Flags.
\begin{DoxyItemize}
\item \mbox{\hyperlink{gpib_8h_ab6e601afadf8d274d9d341323a5c6a3e}{E\+O\+I\+\_\+\+F\+L\+AG}}
\item \mbox{\hyperlink{gpib_8h_aadec0e361e7d2ed6a82ef28bee7231f6}{S\+R\+Q\+\_\+\+F\+L\+AG}}
\item \mbox{\hyperlink{gpib_8h_abbe287946c2beaa1f76fe5be364c07ad}{A\+T\+N\+\_\+\+F\+L\+AG}}
\item \mbox{\hyperlink{gpib_8h_ac5ae85572f7432aaab806c29177eec8d}{R\+E\+N\+\_\+\+F\+L\+AG}}
\item \mbox{\hyperlink{gpib_8h_a660f399a9ffcc5c666bcc726073338cb}{P\+P\+\_\+\+F\+L\+AG}}
\end{DoxyItemize}
\item Error Flags\+:
\begin{DoxyItemize}
\item \mbox{\hyperlink{gpib_8h_a0202c6cc39130a2c251235ef2336cd13}{I\+F\+C\+\_\+\+F\+L\+AG}}
\end{DoxyItemize}
\end{DoxyItemize}
\end{DoxySeeAlso}

\begin{DoxyItemize}
\item E\+O\+I\+\_\+\+F\+L\+AG
\item A\+T\+N\+\_\+\+F\+L\+AG \begin{DoxySeeAlso}{See also}
\mbox{\hyperlink{gpib_8h}{gpib.\+h}} \+\_\+\+F\+L\+A\+GS defines for a full list.
\end{DoxySeeAlso}
\begin{DoxyReturn}{Returns}
val 

A\+B\+O\+RT flag on user keypress 
\end{DoxyReturn}

\end{DoxyItemize}I\+FC is and important state so display it for most messages

Bus Clear, reseat all states, etc

\begin{DoxyRefDesc}{Todo}
\item[\mbox{\hyperlink{todo__todo000003}{Todo}}]do we want to always exit here ? low level G\+P\+IB functions are still useful even without a D\+I\+SK \end{DoxyRefDesc}


Definition at line 277 of file gpib\+\_\+task.\+c.



Referenced by gpib\+\_\+task().

\mbox{\Hypertarget{gpib__task_8h_a5859304d546fa05404d17db34c704906}\label{gpib__task_8h_a5859304d546fa05404d17db34c704906}} 
\index{gpib\_task.h@{gpib\_task.h}!gpib\_file\_init@{gpib\_file\_init}}
\index{gpib\_file\_init@{gpib\_file\_init}!gpib\_task.h@{gpib\_task.h}}
\doxysubsubsection{\texorpdfstring{gpib\_file\_init()}{gpib\_file\_init()}}
{\footnotesize\ttfamily void gpib\+\_\+file\+\_\+init (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Read Configuration File. 

set any compile time defaults -\/ but only those N\+OT already set by the config file

Definition at line 39 of file gpib\+\_\+task.\+c.



Referenced by main().

\mbox{\Hypertarget{gpib__task_8h_a2a437a5de39ba349ce90eef38f075712}\label{gpib__task_8h_a2a437a5de39ba349ce90eef38f075712}} 
\index{gpib\_task.h@{gpib\_task.h}!gpib\_init\_devices@{gpib\_init\_devices}}
\index{gpib\_init\_devices@{gpib\_init\_devices}!gpib\_task.h@{gpib\_task.h}}
\doxysubsubsection{\texorpdfstring{gpib\_init\_devices()}{gpib\_init\_devices()}}
{\footnotesize\ttfamily void gpib\+\_\+init\+\_\+devices (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Initialize A\+LL emulated devices S\+S80, A\+M\+I\+GO and printer. 


\begin{DoxyItemize}
\item Used at power up, Bus I\+FC or user aborts \begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}

\end{DoxyItemize}

Definition at line 340 of file gpib\+\_\+task.\+c.



Referenced by gpib\+\_\+error\+\_\+test(), gpib\+\_\+task(), gpib\+\_\+trace\+\_\+task(), and user\+\_\+task().

\mbox{\Hypertarget{gpib__task_8h_ae2bd0f57f529ba47dbc113ac709a35f0}\label{gpib__task_8h_ae2bd0f57f529ba47dbc113ac709a35f0}} 
\index{gpib\_task.h@{gpib\_task.h}!GPIB\_LISTEN@{GPIB\_LISTEN}}
\index{GPIB\_LISTEN@{GPIB\_LISTEN}!gpib\_task.h@{gpib\_task.h}}
\doxysubsubsection{\texorpdfstring{GPIB\_LISTEN()}{GPIB\_LISTEN()}}
{\footnotesize\ttfamily int G\+P\+I\+B\+\_\+\+L\+I\+S\+T\+EN (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{ch }\end{DoxyParamCaption})}



Process all G\+P\+IB Listen commands. 


\begin{DoxyItemize}
\item We only ever called with A\+TN=1 commands.
\end{DoxyItemize}


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em ch} & 8 bit listen command\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 
\end{DoxyReturn}
N\+O\+TE\+: we must track the \char`\"{}addressed state\char`\"{} of each device so we can determine its state -\/ ie\+: command vs Secondary states Universal Unlisten

N\+U\+LL creates a file named based on date and time

Definition at line 734 of file gpib\+\_\+task.\+c.



Referenced by gpib\+\_\+task().

\mbox{\Hypertarget{gpib__task_8h_a8351e69574a06b0f9184a877fee560c1}\label{gpib__task_8h_a8351e69574a06b0f9184a877fee560c1}} 
\index{gpib\_task.h@{gpib\_task.h}!gpib\_log@{gpib\_log}}
\index{gpib\_log@{gpib\_log}!gpib\_task.h@{gpib\_task.h}}
\doxysubsubsection{\texorpdfstring{gpib\_log()}{gpib\_log()}}
{\footnotesize\ttfamily void gpib\+\_\+log (\begin{DoxyParamCaption}\item[{char $\ast$}]{str }\end{DoxyParamCaption})}



Log G\+P\+IB transactions. 


\begin{DoxyParams}{Parameters}
{\em str} & message to log \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}


Definition at line 63 of file gpib\+\_\+task.\+c.

\mbox{\Hypertarget{gpib__task_8h_ad18e29cb0500dc2226b4bebbf0fcbf0c}\label{gpib__task_8h_ad18e29cb0500dc2226b4bebbf0fcbf0c}} 
\index{gpib\_task.h@{gpib\_task.h}!GPIB\_SECONDARY\_ADDRESS@{GPIB\_SECONDARY\_ADDRESS}}
\index{GPIB\_SECONDARY\_ADDRESS@{GPIB\_SECONDARY\_ADDRESS}!gpib\_task.h@{gpib\_task.h}}
\doxysubsubsection{\texorpdfstring{GPIB\_SECONDARY\_ADDRESS()}{GPIB\_SECONDARY\_ADDRESS()}}
{\footnotesize\ttfamily int G\+P\+I\+B\+\_\+\+S\+E\+C\+O\+N\+D\+A\+R\+Y\+\_\+\+A\+D\+D\+R\+E\+SS (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{ch }\end{DoxyParamCaption})}



Process all G\+P\+IB Secondary Addresses. 


\begin{DoxyItemize}
\item We only ever called with A\+TN=1 commands. Secondary Address, talking == U\+NT
\end{DoxyItemize}


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em ch} & 8 bit secondary address.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 
\end{DoxyReturn}
N\+O\+TE\+: We now know that ch $>$= 0x60 \&\& ch $<$= 0x7f Previous tests ensure this fact is true and because C\+M\+D\+\_\+\+M\+A\+SK == 0x7f

note\+: any errors will reset lastcmd Universal Talk mode Treat this as a Secondary Address ? S\+S80 Ident 4-\/31 If we have our secondary address then send I\+D\+E\+NT

ch = secondary address

Definition at line 888 of file gpib\+\_\+task.\+c.



Referenced by gpib\+\_\+task().

\mbox{\Hypertarget{gpib__task_8h_a9e586941a3629bec1a2c7e7a9113cee3}\label{gpib__task_8h_a9e586941a3629bec1a2c7e7a9113cee3}} 
\index{gpib\_task.h@{gpib\_task.h}!GPIB\_TALK@{GPIB\_TALK}}
\index{GPIB\_TALK@{GPIB\_TALK}!gpib\_task.h@{gpib\_task.h}}
\doxysubsubsection{\texorpdfstring{GPIB\_TALK()}{GPIB\_TALK()}}
{\footnotesize\ttfamily int G\+P\+I\+B\+\_\+\+T\+A\+LK (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{ch }\end{DoxyParamCaption})}



Process all G\+P\+IB Talk commands. 


\begin{DoxyItemize}
\item We only ever called with A\+TN=1 commands.
\end{DoxyItemize}


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em ch} & 8 bit talk command\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 
\end{DoxyReturn}
N\+O\+TE\+: we must track the \char`\"{}addressed state\char`\"{} of each device so we can determine its state -\/ ie\+: command vs Secondary states save talking state

Universal Untalk

Definition at line 809 of file gpib\+\_\+task.\+c.



Referenced by gpib\+\_\+task().

\mbox{\Hypertarget{gpib__task_8h_af6b5cba8eb1142502f2ce96fc86a933f}\label{gpib__task_8h_af6b5cba8eb1142502f2ce96fc86a933f}} 
\index{gpib\_task.h@{gpib\_task.h}!gpib\_task@{gpib\_task}}
\index{gpib\_task@{gpib\_task}!gpib\_task.h@{gpib\_task.h}}
\doxysubsubsection{\texorpdfstring{gpib\_task()}{gpib\_task()}}
{\footnotesize\ttfamily void gpib\+\_\+task (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Top most main G\+P\+IB device emulator task. This is \mbox{\hyperlink{main_8c_a840291bc02cba5474a4cb46a9b9566fe}{main()}} for G\+P\+IB state machine loop All tasks are dispatched from here. 


\begin{DoxyItemize}
\item Initializes B\+US, Devices, State.
\item Reads and processes G\+P\+IB control or data bytes and calls emulator task. \begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}

\end{DoxyItemize}G\+P\+IB commands with A\+TN set (C\+O\+M\+M\+A\+N\+DS)

G\+P\+IB listen

G\+P\+IB talk

G\+P\+IB secondary Note\+: We know ch $>$= 0x60 \&\& ch $<$= 0x7f because of previous tests

We have to keep track of secondary address that may happen out of order with older A\+M\+I\+GO protocol this method works for S\+S80 as well

G\+P\+I\+B\+\_\+\+C\+O\+M\+M\+A\+N\+DS does most of the work

G\+P\+IB commands without A\+TN set (D\+A\+TA)

G\+P\+I\+B\+\_\+\+C\+O\+M\+M\+A\+N\+DS does most of the work

Definition at line 456 of file gpib\+\_\+task.\+c.



Referenced by gpib\+\_\+tests(), and user\+\_\+task().

\mbox{\Hypertarget{gpib__task_8h_a314fbeb162cf0fb719ece3da4f2a8c52}\label{gpib__task_8h_a314fbeb162cf0fb719ece3da4f2a8c52}} 
\index{gpib\_task.h@{gpib\_task.h}!gpib\_trace\_read\_byte@{gpib\_trace\_read\_byte}}
\index{gpib\_trace\_read\_byte@{gpib\_trace\_read\_byte}!gpib\_task.h@{gpib\_task.h}}
\doxysubsubsection{\texorpdfstring{gpib\_trace\_read\_byte()}{gpib\_trace\_read\_byte()}}
{\footnotesize\ttfamily uint16\+\_\+t gpib\+\_\+trace\+\_\+read\+\_\+byte (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}

\mbox{\Hypertarget{gpib__task_8h_a63ef822f4a1b03c38d87854df9c618be}\label{gpib__task_8h_a63ef822f4a1b03c38d87854df9c618be}} 
\index{gpib\_task.h@{gpib\_task.h}!gpib\_trace\_task@{gpib\_trace\_task}}
\index{gpib\_trace\_task@{gpib\_trace\_task}!gpib\_task.h@{gpib\_task.h}}
\doxysubsubsection{\texorpdfstring{gpib\_trace\_task()}{gpib\_trace\_task()}}
{\footnotesize\ttfamily void gpib\+\_\+trace\+\_\+task (\begin{DoxyParamCaption}\item[{char $\ast$}]{name,  }\item[{int}]{detail }\end{DoxyParamCaption})}



Trace G\+P\+IB activity passively -\/ saving to a log file. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em name} & file name to save to \\
\hline
\mbox{\texttt{ in}}  & {\em detail} & if non-\/zero do full handshake trace\\
\hline
\end{DoxyParams}

\begin{DoxyItemize}
\item We use the natural G\+P\+IB handshaking to slow G\+P\+IB talker/listeners so we can keep up
\item A keypress will exit the trace and close the file
\end{DoxyItemize}


\begin{DoxyParams}{Parameters}
{\em name} & File name to save log file to. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void Exit on Key Press 
\end{DoxyReturn}


Definition at line 200 of file gpib\+\_\+task.\+c.



Referenced by gpib\+\_\+tests().

\mbox{\Hypertarget{gpib__task_8h_a61b7b85789f90b1cc0e6cb4f71f6797d}\label{gpib__task_8h_a61b7b85789f90b1cc0e6cb4f71f6797d}} 
\index{gpib\_task.h@{gpib\_task.h}!listen\_cleanup@{listen\_cleanup}}
\index{listen\_cleanup@{listen\_cleanup}!gpib\_task.h@{gpib\_task.h}}
\doxysubsubsection{\texorpdfstring{listen\_cleanup()}{listen\_cleanup()}}
{\footnotesize\ttfamily void listen\+\_\+cleanup (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Called when the listen address changes. 


\begin{DoxyItemize}
\item Used to cleanup or close at the end of any listen address transition.
\item Also called when G\+P\+IB bus reset or unlisten. For now we just use this to close printer capture \begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}

\end{DoxyItemize}

Definition at line 940 of file gpib\+\_\+task.\+c.



Referenced by G\+P\+I\+B\+\_\+\+L\+I\+S\+T\+E\+N(), and gpib\+\_\+state\+\_\+init().

\mbox{\Hypertarget{gpib__task_8h_a48f72546a97843213351fcbad4d42469}\label{gpib__task_8h_a48f72546a97843213351fcbad4d42469}} 
\index{gpib\_task.h@{gpib\_task.h}!PRINTER\_is\_MLA@{PRINTER\_is\_MLA}}
\index{PRINTER\_is\_MLA@{PRINTER\_is\_MLA}!gpib\_task.h@{gpib\_task.h}}
\doxysubsubsection{\texorpdfstring{PRINTER\_is\_MLA()}{PRINTER\_is\_MLA()}}
{\footnotesize\ttfamily int P\+R\+I\+N\+T\+E\+R\+\_\+is\+\_\+\+M\+LA (\begin{DoxyParamCaption}\item[{int}]{address }\end{DoxyParamCaption})}



Check if P\+R\+I\+N\+T\+ER listening address. 


\begin{DoxyItemize}
\item Used at power up, Bus I\+FC or user aborts \begin{DoxyReturn}{Returns}
1 if true or 0 
\end{DoxyReturn}

\end{DoxyItemize}

Definition at line 153 of file gpib\+\_\+task.\+c.



Referenced by G\+P\+I\+B\+\_\+\+C\+O\+M\+M\+A\+N\+D\+S(), G\+P\+I\+B\+\_\+\+L\+I\+S\+T\+E\+N(), G\+P\+I\+B\+\_\+\+T\+A\+L\+K(), gpib\+\_\+task(), and P\+R\+I\+N\+T\+E\+R\+\_\+\+C\+O\+M\+M\+A\+N\+D\+S().

\mbox{\Hypertarget{gpib__task_8h_a5da52fb36be595498e2ad9c4ced6a2ac}\label{gpib__task_8h_a5da52fb36be595498e2ad9c4ced6a2ac}} 
\index{gpib\_task.h@{gpib\_task.h}!PRINTER\_is\_MSA@{PRINTER\_is\_MSA}}
\index{PRINTER\_is\_MSA@{PRINTER\_is\_MSA}!gpib\_task.h@{gpib\_task.h}}
\doxysubsubsection{\texorpdfstring{PRINTER\_is\_MSA()}{PRINTER\_is\_MSA()}}
{\footnotesize\ttfamily int P\+R\+I\+N\+T\+E\+R\+\_\+is\+\_\+\+M\+SA (\begin{DoxyParamCaption}\item[{int}]{address }\end{DoxyParamCaption})}



Check if P\+R\+I\+N\+T\+ER secondary address. 


\begin{DoxyItemize}
\item Used at power up, Bus I\+FC or user aborts \begin{DoxyReturn}{Returns}
1 if true or 0 
\end{DoxyReturn}

\end{DoxyItemize}

Definition at line 179 of file gpib\+\_\+task.\+c.

\mbox{\Hypertarget{gpib__task_8h_ad3df30ddc50951831d3837e99c3624b0}\label{gpib__task_8h_ad3df30ddc50951831d3837e99c3624b0}} 
\index{gpib\_task.h@{gpib\_task.h}!PRINTER\_is\_MTA@{PRINTER\_is\_MTA}}
\index{PRINTER\_is\_MTA@{PRINTER\_is\_MTA}!gpib\_task.h@{gpib\_task.h}}
\doxysubsubsection{\texorpdfstring{PRINTER\_is\_MTA()}{PRINTER\_is\_MTA()}}
{\footnotesize\ttfamily int P\+R\+I\+N\+T\+E\+R\+\_\+is\+\_\+\+M\+TA (\begin{DoxyParamCaption}\item[{int}]{address }\end{DoxyParamCaption})}



Check if P\+R\+I\+N\+T\+ER talking address. 


\begin{DoxyItemize}
\item Used at power up, Bus I\+FC or user aborts \begin{DoxyReturn}{Returns}
1 if true or 0 
\end{DoxyReturn}

\end{DoxyItemize}

Definition at line 166 of file gpib\+\_\+task.\+c.



Referenced by G\+P\+I\+B\+\_\+\+C\+O\+M\+M\+A\+N\+D\+S(), G\+P\+I\+B\+\_\+\+T\+A\+L\+K(), and P\+R\+I\+N\+T\+E\+R\+\_\+\+C\+O\+M\+M\+A\+N\+D\+S().

\mbox{\Hypertarget{gpib__task_8h_af7ec1aa9752ef65efd1bfd8a582a29c2}\label{gpib__task_8h_af7ec1aa9752ef65efd1bfd8a582a29c2}} 
\index{gpib\_task.h@{gpib\_task.h}!Send\_Identify@{Send\_Identify}}
\index{Send\_Identify@{Send\_Identify}!gpib\_task.h@{gpib\_task.h}}
\doxysubsubsection{\texorpdfstring{Send\_Identify()}{Send\_Identify()}}
{\footnotesize\ttfamily int Send\+\_\+\+Identify (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{ch,  }\item[{uint16\+\_\+t}]{ID }\end{DoxyParamCaption})}



Send drive identify-\/ 2 bytes. 


\begin{DoxyItemize}
\item References
\begin{DoxyItemize}
\item Transparent Command I\+D\+E\+NT
\item S\+S80 4-\/31
\item C\+S80 pg 4-\/27, 3-\/10
\item A11
\end{DoxyItemize}
\end{DoxyItemize}


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em ch} & channel\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 on G\+P\+IB error returns error flags 
\end{DoxyReturn}
\begin{DoxySeeAlso}{See also}
\mbox{\hyperlink{gpib_8h}{gpib.\+h}} \mbox{\hyperlink{gpib_8h_a10916ab21f8ba06e447e898790ef6a4b}{E\+R\+R\+O\+R\+\_\+\+M\+A\+SK}} for a full list. 
\end{DoxySeeAlso}


Definition at line 586 of file gpib\+\_\+task.\+c.



Referenced by G\+P\+I\+B\+\_\+\+S\+E\+C\+O\+N\+D\+A\+R\+Y\+\_\+\+A\+D\+D\+R\+E\+S\+S().

\mbox{\Hypertarget{gpib__task_8h_a727ee8639d6e3f33b9d1c5d00258ae4a}\label{gpib__task_8h_a727ee8639d6e3f33b9d1c5d00258ae4a}} 
\index{gpib\_task.h@{gpib\_task.h}!SS80\_is\_MLA@{SS80\_is\_MLA}}
\index{SS80\_is\_MLA@{SS80\_is\_MLA}!gpib\_task.h@{gpib\_task.h}}
\doxysubsubsection{\texorpdfstring{SS80\_is\_MLA()}{SS80\_is\_MLA()}}
{\footnotesize\ttfamily int S\+S80\+\_\+is\+\_\+\+M\+LA (\begin{DoxyParamCaption}\item[{int}]{address }\end{DoxyParamCaption})}



Check if S\+S80 listening address. 


\begin{DoxyItemize}
\item Used at power up, Bus I\+FC or user aborts \begin{DoxyReturn}{Returns}
1 if true or 0 
\end{DoxyReturn}

\end{DoxyItemize}

Definition at line 74 of file gpib\+\_\+task.\+c.



Referenced by G\+P\+I\+B(), G\+P\+I\+B\+\_\+\+C\+O\+M\+M\+A\+N\+D\+S(), G\+P\+I\+B\+\_\+\+L\+I\+S\+T\+E\+N(), and S\+S80\+\_\+\+C\+O\+M\+M\+A\+N\+D\+S().

\mbox{\Hypertarget{gpib__task_8h_a9be4dbb384e5f77dc72ec44ca6f20c2f}\label{gpib__task_8h_a9be4dbb384e5f77dc72ec44ca6f20c2f}} 
\index{gpib\_task.h@{gpib\_task.h}!SS80\_is\_MSA@{SS80\_is\_MSA}}
\index{SS80\_is\_MSA@{SS80\_is\_MSA}!gpib\_task.h@{gpib\_task.h}}
\doxysubsubsection{\texorpdfstring{SS80\_is\_MSA()}{SS80\_is\_MSA()}}
{\footnotesize\ttfamily int S\+S80\+\_\+is\+\_\+\+M\+SA (\begin{DoxyParamCaption}\item[{int}]{address }\end{DoxyParamCaption})}



Check if S\+S80 secondary address. 


\begin{DoxyItemize}
\item Used at power up, Bus I\+FC or user aborts \begin{DoxyReturn}{Returns}
1 if true or 0 
\end{DoxyReturn}

\end{DoxyItemize}

Definition at line 100 of file gpib\+\_\+task.\+c.



Referenced by G\+P\+I\+B\+\_\+\+S\+E\+C\+O\+N\+D\+A\+R\+Y\+\_\+\+A\+D\+D\+R\+E\+S\+S().

\mbox{\Hypertarget{gpib__task_8h_a6029655f36ebeac8ad4289b50120edda}\label{gpib__task_8h_a6029655f36ebeac8ad4289b50120edda}} 
\index{gpib\_task.h@{gpib\_task.h}!SS80\_is\_MTA@{SS80\_is\_MTA}}
\index{SS80\_is\_MTA@{SS80\_is\_MTA}!gpib\_task.h@{gpib\_task.h}}
\doxysubsubsection{\texorpdfstring{SS80\_is\_MTA()}{SS80\_is\_MTA()}}
{\footnotesize\ttfamily int S\+S80\+\_\+is\+\_\+\+M\+TA (\begin{DoxyParamCaption}\item[{int}]{address }\end{DoxyParamCaption})}



Check if S\+S80 talking address. 


\begin{DoxyItemize}
\item Used at power up, Bus I\+FC or user aborts \begin{DoxyReturn}{Returns}
1 if true or 0 
\end{DoxyReturn}

\end{DoxyItemize}

Definition at line 87 of file gpib\+\_\+task.\+c.



Referenced by G\+P\+I\+B(), G\+P\+I\+B\+\_\+\+C\+O\+M\+M\+A\+N\+D\+S(), G\+P\+I\+B\+\_\+\+T\+A\+L\+K(), and S\+S80\+\_\+\+C\+O\+M\+M\+A\+N\+D\+S().

\mbox{\Hypertarget{gpib__task_8h_a509eb3426def2f282b1a31c411e9cbb7}\label{gpib__task_8h_a509eb3426def2f282b1a31c411e9cbb7}} 
\index{gpib\_task.h@{gpib\_task.h}!talk\_cleanup@{talk\_cleanup}}
\index{talk\_cleanup@{talk\_cleanup}!gpib\_task.h@{gpib\_task.h}}
\doxysubsubsection{\texorpdfstring{talk\_cleanup()}{talk\_cleanup()}}
{\footnotesize\ttfamily void talk\+\_\+cleanup (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Called when the G\+P\+IB talk address changes. 


\begin{DoxyItemize}
\item Used to cleanup or close at the end of a talk transation.
\item Also called when G\+P\+IB bus reset or untalk.
\item Not used in this emulator.
\end{DoxyItemize}

\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}


Definition at line 965 of file gpib\+\_\+task.\+c.



Referenced by gpib\+\_\+state\+\_\+init(), and G\+P\+I\+B\+\_\+\+T\+A\+L\+K().

