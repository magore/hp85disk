define(["require","exports","tslib","react","comments2/components/rich_facepile/context","spectrum/avatar","spectrum/facepile","spectrum/util/uuid_generator","comments2/components/rich_facepile/leave_active_mode_wrapper"],(function(e,t,o,i,n,a,r,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=o.__importStar(i),t.OVERFLOW="overflow",t.MAX_FACES=5;var s;(s=t.DisplayMode||(t.DisplayMode={}))[s.Auto=1]="Auto",s[s.ForceShow=2]="ForceShow",s[s.ForceHide=3]="ForceHide",s[s.Hover=4]="Hover";var d=(function(e){function n(){var o=e.apply(this,arguments)||this;return o.state={},o.tooltipContentWrapperClassName=l.generateUUID("sc-rich-facepile-tooltip-content"),o.documentClickListener=function(e){var t=e.target;void 0===o.state.activeTooltipIndex||o.closest(t,o.tooltipContentWrapperClassName)||o.closest(t,"mc-facepile-container")||o.setActiveTooltipIndex(void 0)},o.leaveActiveMode=function(){o.setActiveTooltipIndex(void 0)},o.bindN=function(e){for(var o=[],i=function(t){o.push((function(){return e(t)}))},n=0;n<t.MAX_FACES;n++)i(n);return o},o.onTooltipShownForIndex=function(e){if(!o.activeMode){var t=o.props.onTooltipChange,i=o.infoFromIndex(e);if(t&&null!==i){var n=o.avatarRectForIndex(e,i);t({activeMode:o.activeMode,displayInfo:null},{activeMode:o.activeMode,displayInfo:i,avatarRect:n})}}},o.onTooltipHiddenForIndex=function(e){if(!o.activeMode){var t=o.props.onTooltipChange,i=o.infoFromIndex(e);t&&null!==i&&t({activeMode:o.activeMode,displayInfo:i},{activeMode:o.activeMode,displayInfo:null})}},o.onAvatarClickForIndex=function(e){var i=o.props,n=i.becomePassiveOnOverflowAvatarClick,a=i.onAvatarClick,r=o.infoFromIndex(e),l=n&&r===t.OVERFLOW;l||o.activeMode||o.setActiveTooltipIndex(e),l&&o.activeMode&&o.setActiveTooltipIndex(void 0),r&&a&&a(r)},o.onAvatarMouseOverForIndex=function(e){o.activeMode&&o.setActiveTooltipIndex(e)},o.onTooltipShown=o.bindN(o.onTooltipShownForIndex),o.onTooltipHidden=o.bindN(o.onTooltipHiddenForIndex),o.onAvatarClick=o.bindN(o.onAvatarClickForIndex),o.onAvatarMouseOver=o.bindN(o.onAvatarMouseOverForIndex),o.avatarDivRefs=Array(t.MAX_FACES).fill(0).map((function(e){return i.createRef()})),o}return o.__extends(n,e),n.prototype.componentDidMount=function(){document.addEventListener("click",this.documentClickListener,!0),window.addEventListener("resize",this.leaveActiveMode,!0)},n.prototype.componentWillUnmount=function(){document.removeEventListener("click",this.documentClickListener,!0),window.removeEventListener("resize",this.leaveActiveMode,!0)},n.prototype.closest=function(e,t){for(;e;e=e.parentElement)if(e.classList.contains(t))return e;return null},Object.defineProperty(n.prototype,"activeMode",{get:function(){return void 0!==this.state.activeTooltipIndex},enumerable:!0,configurable:!0}),n.prototype.setActiveTooltipIndex=function(e){var t=this.state.activeTooltipIndex,o=this.props.onTooltipChange;if(o&&t!==e){var i=this.activeMode,n=void 0!==e,a=n?this.infoFromIndex(e):null;o({activeMode:i,displayInfo:i?this.infoFromIndex(t):a},{activeMode:n,displayInfo:a,avatarRect:n?this.avatarRectForIndex(e,a):void 0})}this.setState({activeTooltipIndex:e})},n.prototype.displayModeForIndex=function(e){var o=this.state.activeTooltipIndex;return void 0===o?t.DisplayMode.Auto:o===e?t.DisplayMode.ForceShow:t.DisplayMode.ForceHide},n.prototype.infoFromIndex=function(e){var o=this.props,i=o.avatarInfoList,n=o.avatarInfoList.length;return o.overflowRemainderCount&&e===n?t.OVERFLOW:e>=n?null:i[e]},n.prototype.getBoundingClientRectForRef=function(e){var t=e.current;return t?t.getBoundingClientRect():{left:-1,top:-1,width:0,height:0,right:-1,bottom:-1}},n.prototype.avatarRectForIndex=function(e,t){if(void 0===t&&(t=this.infoFromIndex(e)),t){var o=this.getBoundingClientRectForRef(this.avatarDivRefs[e]);return{origin:{x:o.left,y:o.top},size:{width:o.width,height:o.height}}}},Object.defineProperty(n.prototype,"intl",{get:function(){return this.context.intl},enumerable:!0,configurable:!0}),n.prototype.render=function(){var e=this,o=this.props,n=o.avatarSize,l=o.avatarInfoList,s=o.overflowRemainderCount,d=o.tooltipComponent,p=o.renderFacepile,v=l.map((function(t,o){var l,s=t.present,p=t.activeTooltipContent,v=t.avatarColorSeed,u=t.displayName,f=t.initials,h=t.memberKey,m=t.passiveTooltipContent,C=t.photoUrl,M=v||u,F=i.createElement("div",{onFocusCapture:e.onAvatarMouseOver[o],ref:e.avatarDivRefs[o]},i.createElement(r.FacepileMembersAvatar,{active:s,"aria-label":u,avatarColorSeed:M,avatarSize:n,initials:f,onClick:e.onAvatarClick[o],onMouseOver:e.onAvatarMouseOver[o],photoUrl:C}));return e.activeMode?null!==(l=void 0!==p?p:m)&&(l=i.createElement(c.LeaveActiveModeWrapperContext.Provider,{value:{signalClick:e.leaveActiveMode}},l)):l=m,i.createElement(d,{avatar:F,displayMode:e.displayModeForIndex(o),tooltipContent:l,avatarColor:a.avatarColorForUserIdentifier(M),onTooltipShown:e.onTooltipShown[o],onTooltipHidden:e.onTooltipHidden[o],tooltipContentWrapperClassName:e.tooltipContentWrapperClassName,key:h})})),u=this.context.localization,f=this.intl;if(s){var h=void 0;h=f?f.formatMessage({id:"2vfyO",defaultMessage:"99+"}):u?u.ninetyNinePlus:"";var m=s>=99?h:""+s,C=l.length,M=i.createElement("div",{onFocusCapture:this.onAvatarMouseOver[C],ref:this.avatarDivRefs[C]},i.createElement(r.FacepileMembersOverflowCircle,{avatarSize:n,backgroundColor:"#627283",textColor:"white",onClick:this.onAvatarClick[C],onMouseOver:this.onAvatarMouseOver[C],remainderCount:m})),F=void 0;F=f?f.formatMessage({id:"2jr6K",defaultMessage:"{count, plural, one {# other} other {# others}}"},{count:s}):u?u.nOthers(s,m):"",v.push(i.createElement(d,{avatar:M,displayMode:this.displayModeForIndex(C),tooltipContent:i.createElement("div",{className:"sc-rich-facepile-overflow-tooltip-content"},F),avatarColor:"#627283",onTooltipShown:this.onTooltipShown[C],onTooltipHidden:this.onTooltipHidden[C],tooltipContentWrapperClassName:this.tooltipContentWrapperClassName,key:t.OVERFLOW}))}return p(v)},n})(i.Component);t.Avatars=d,d.contextType=n.RichFacepileContext}));
//# sourceMappingURL=avatars.min.js-vflnHXhjU.map