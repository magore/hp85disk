define("comments2/transforms",["require","exports","comments2/transforms/comments","comments2/transforms/threads","comments2/transforms/users","comments2/transforms/revisions","comments2/transforms/annotations","comments2/transforms/third_party_source"],(function(e,t,r,n,i,o,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.iCommentContentToUserSubmittedComment=r.iCommentContentToUserSubmittedComment,t.threadsToIThreadMap=n.threadsToIThreadMap,t.threadToIThread=n.threadToIThread,t.usersToIUserMap=i.usersToIUserMap,t.userToIUser=i.userToIUser,t.streamToRevision=o.streamToRevision,t.numberedAnnotationToIInteractionAnnotation=a.numberedAnnotationToIInteractionAnnotation,t.iInteractionAnnotationToNumberedAnnotation=a.iInteractionAnnotationToNumberedAnnotation,t.thirdPartySourceToIThirdPartySource=s.thirdPartySourceToIThirdPartySource})),define("comments2/transforms/annotations",["require","exports","tslib"],(function(e,t,r){"use strict";function n(e,t){return e[".tag"]===t}Object.defineProperty(t,"__esModule",{value:!0}),t.annotationToIAnnotation=function(e){if(n(e,"video"))return{type:"video",time:e.time};if(n(e,"audio"))return{type:"audio",time:e.time};if(n(e,"document"))return{type:"document",regionType:e.region_type[".tag"],label:e.label,regions:e.regions};if(n(e,"image"))return{type:"image",region:e.region,label:e.label};throw new Error("Attempted to convert an annotation type that does not yet exist.")},t.iAnnotationToAnnotation=function(e){return"video"===e.type?{".tag":"video",time:e.time}:"audio"===e.type?{".tag":"audio",time:e.time}:"document"===e.type?{".tag":"document",regions:e.regions,region_type:{".tag":e.regionType}}:{".tag":"image",region:r.__assign({},e.region,{page:1})}},t.numberedAnnotationToIInteractionAnnotation=function(e){return"image"===e.type?{type:"rnd",regions:[e.region]}:"highlight"===e.regionType?{type:"highlight",regions:e.regions}:{type:"rnd",regions:e.regions}},t.iInteractionAnnotationToNumberedAnnotation=function(e,t){var n=e.type,i=e.regions;return void 0===t?{type:"image",region:i[0]}:{type:"document",regionType:"rnd"===n?"rectangle":"highlight",regions:i.map((function(e){return(function(e,t){return r.__assign({},e,{page:t})})(e,t)}))}}})),define("comments2/transforms/comments",["require","exports","comments2/transforms/annotations","comments2/transforms/metadata","comments2/transforms/revisions"],(function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.commentToIComment=function(e,t,r,o){return{author:r[e.author_id],content:{metadata:n.metadataToIMetadata(e.metadata),text:e.content},deleted:e.deleted,id:e.id,threadId:t,timestamp:new Date(e.timestamp),revisionInfo:o&&e.revision?i.revisionInfoToIRevisionInfo(o,e.revision):{isCurrent:!0},userPermissions:{canDelete:e.permissions.can_delete,canEdit:e.permissions.can_edit}}},t.iCommentContentToUserSubmittedComment=function(e){var t=e.annotation,o=e.content,a=e.stream;return{annotation_data:t?r.iAnnotationToAnnotation(t):void 0,content:o.text,metadata:n.iCommentMetadataToUserSubmittedMetadata(o.metadata),revision:i.streamToRevision(a)}}})),define("comments2/transforms/metadata",["require","exports"],(function(e,t){"use strict";function r(e,t){return e.type===t}function n(e){return r(e,"mention")}function i(e){return r(e,"style")}function o(e){return r(e,"sticker")}function a(e){var t=e.format[".tag"];if("other"===t)throw new Error('"other" is not a valid format block');return{location:e.location,style:t,type:"style"}}function s(e){var t=e.user.type[".tag"];if("other"===t)throw new Error('"other" is not a valid user type');var r={identifier:e.user.identifier,type:t};return{location:e.location,type:"mention",user:r}}Object.defineProperty(t,"__esModule",{value:!0}),t.isMentionMetadata=n,t.isStyleMetadata=i,t.isStickerMetadata=o,t.metadataToIMetadata=function(e){var t=e.formatting.map(a).concat(e.mentions.map(s));if(e.sticker){var r=(function(e){if(e.url&&e.name&&e.description)return{type:"sticker",id:e.id,url:e.url,name:e.name,description:e.description}})(e.sticker);r&&t.push(r)}return t},t.iCommentMetadataToUserSubmittedMetadata=function(e){var t=e.filter(i).map((function(e){return{format:{".tag":e.style},location:e.location}})),r=e.filter(n).map((function(e){return{user:{type:{".tag":e.user.type},identifier:e.user.identifier},location:e.location}})),a=e.find(o);return{formatting:t,mentions:r,sticker:a?{id:a.id}:void 0}}})),define("comments2/transforms/revisions",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.revisionInfoToIRevisionInfo=function(e,t){var r=t.timestamp?new Date(t.timestamp):void 0;return{isCurrent:e.ns_id===t.ns_id&&e.sjid===t.sjid,revision:{nsId:t.ns_id,sjId:t.sjid},timestamp:r}},t.streamToRevision=function(e){return e&&"file"===e.type?{ns_id:e.ns_id,sjid:e.sjid}:void 0}})),define("comments2/transforms/third_party_source",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.thirdPartySourceToIThirdPartySource=function(e){return e[".tag"]}})),define("comments2/transforms/threads",["require","exports","tslib","external/lodash","comments2/transforms/annotations","comments2/transforms/comments"],(function(e,t,r,n,i,o){"use strict";function a(e,t){if("resolved_no_details"===e[".tag"])return{type:"no_details"};if((function(e){return"resolved_with_details"===e[".tag"]})(e))return{type:"with_details",resolver:t[e.resolver_id],resolvedTimestamp:new Date(e.resolved_timestamp)};throw new Error("Not a valid type for ResolvedInfo.")}function s(e,t,n){var s=e.comments.map((function(r){return o.commentToIComment(r,e.id,t,n)})),l=e.resolved_info?{resolved:!0,resolvedInfo:a(e.resolved_info,t)}:{resolved:!1};return r.__assign({annotation:e.annotation_data?i.annotationToIAnnotation(e.annotation_data):void 0,comments:s,id:e.id,read:e.read,readonly:e.readonly,isShownInBrowseSurface:!!e.is_shown_in_browse_surface,isThirdParty:e.is_third_party},l,{timestamp:s[0].timestamp})}Object.defineProperty(t,"__esModule",{value:!0}),t.resolvedInfoToIResolvedInfo=a,t.threadToIThread=s,t.threadsToIThreadMap=function(e,t,r){var i=e.map((function(e){return s(e,t,r)}));return n.keyBy(i,"id")}})),define("comments2/transforms/users",["require","exports","external/lodash"],(function(e,t,r){"use strict";function n(e){return{id:e.id,name:{display:e.display_name,initials:e.initials,public:e.public_name},photoUrl:e.photo_url}}Object.defineProperty(t,"__esModule",{value:!0}),t.userToIUser=n,t.usersToIUserMap=function(e){var t=e.map(n);return r.keyBy(t,"id")}})),define("modules/clean/average_counter",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(){this.average=0,this.count=0}return e.prototype.getAverage=function(){return this.average},e.prototype.add=function(e){this.average=(this.average*this.count+e)/(this.count+1),this.count++},e.prototype.addArray=function(e){var t=e.reduce((function(e,t){return e+t})),r=this.count+e.length;this.average=(this.average*this.count+t)/r,this.count=r},e})();t.AverageCounter=r}));var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};define("modules/clean/abuse/async_report_flag",["require","exports","modules/clean/react/async/loadable"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncReportFlag=r.Loadable({loader:function(){return new Promise((function(t,r){e(["modules/clean/abuse/report_flag"],t,r)})).then(__importStar).then((function(e){return e.ReportFlag}))}})})),define("modules/clean/cloud_docs/shared_components/routing",["require","exports","tslib","modules/clean/cloud_docs/constants","modules/clean/previews/util","modules/clean/previews/util","modules/clean/cloud_docs/shared_components/dynamic_routing_modal","modules/clean/cloud_docs/cloud_doc_api_client","modules/clean/file_store/utils","modules/core/browser","modules/clean/cloud_docs/types"],(function(e,t,r,n,i,o,a,s,l,c,u){"use strict";var d,p,m,f,_;Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),c=r.__importStar(c);var v,h=((d={})[n.MicrosoftEditors.WORD]=!0,d[n.MicrosoftEditors.EXCEL]=!0,d[n.MicrosoftEditors.POWERPOINT]=!1,d[n.GoogleFileTypes.GOOGLE_DSS_SLIDES]=!1,d[n.GoogleFileTypes.GOOGLE_DSS_DOC]=!1,d[n.GoogleFileTypes.GOOGLE_DSS_SHEET]=!1,d.preview=!1,d);(function(e){e.pptx="pptx",e.docx="docx",e.xlsx="xlsx"})(v||(v={}));var g=((p={})[3503728]=((m={})[v.pptx]=n.GoogleFileTypes.GOOGLE_DSS_SLIDES,m[v.docx]=n.GoogleFileTypes.GOOGLE_DSS_DOC,m[v.xlsx]=n.GoogleFileTypes.GOOGLE_DSS_SHEET,m),p[661085]=((f={})[v.pptx]=n.MicrosoftEditors.POWERPOINT,f[v.docx]=n.MicrosoftEditors.WORD,f[v.xlsx]=n.MicrosoftEditors.EXCEL,f),p),w=((_={})[3503728]=u.CloudDocProviderIntegration.GDD_INTEGRATION,_);function y(e,t){if(e)switch(e.toLowerCase()){case"google_docs":case"gdoc":return n.GoogleFileTypes.GOOGLE_DSS_DOC;case"google_slides":case"gslides":return n.GoogleFileTypes.GOOGLE_DSS_SLIDES;case"google_sheets":case"gsheet":return n.GoogleFileTypes.GOOGLE_DSS_SHEET;case"wopi":return i.isPptExtension(t)?n.MicrosoftEditors.POWERPOINT:o.isWordDocExtension(t)?n.MicrosoftEditors.WORD:n.MicrosoftEditors.EXCEL;default:return}}t.maybeShowDynamicRoutingModal=function(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){var i;return r.__generator(this,(function(r){return i=n,s.getLockProviderAsync(e.id,t.file_id).then((function(r){var o=r.app_id;if(o&&g[o][i]&&(l.isBrowseFile(t)||l.isSharedFile(t))){var d=c.get_uri().getQuery().web_open_id,p=y(c.get_uri().getQuery().from_editor,n)||"preview",m={editorWithLock:g[o][i],currentEditor:p,file:t,user:e,showViewOnlyMode:h[p],openId:d,isLockEditorEnabled:!0};e.is_team?s.getTeamSettings(e.id).then((function(e){var t=e.settings;if(w.hasOwnProperty(o)){var r=w[o];m.isLockEditorEnabled=t[r][".tag"]===u.IntegrationCreateAndEdit[".tag"]}("preview"!==m.currentEditor||m.isLockEditorEnabled)&&a.showDynamicRoutingModal(m)})):a.showDynamicRoutingModal(m)}})),[2]}))}))},t.getCloudEditorString=y})),define("modules/clean/cloud_docs/shared_components/dynamic_routing_modal",["require","exports","tslib","modules/clean/react/modal","modules/clean/cloud_docs/open_with_utils","modules/clean/static_urls","modules/clean/react/css","react","modules/core/i18n","spectrum/button","modules/clean/cloud_docs/event_logging","modules/clean/cloud_docs/types"],(function(e,t,r,n,i,o,a,s,l,c,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=(function(e){function t(t){var r=e.call(this,t)||this;return r.editorToString={preview:"preview",word:"Microsoft Word Online",excel:"Microsoft Excel Online",powerpoint:"Microsoft Powerpoint Online",gdoc:"Google Docs",gsheet:"Google Sheets",gslides:"Google Slides"},r.state={set_routing_dest:!1},r}return r.__extends(t,e),t.prototype.componentDidMount=function(){u.logUserAction({actionEvent:d.UserActionEventType.DYNAMIC_ROUTING_MODAL_IMPRESSION,userId:this.props.user.id,docPathOrId:this.props.file.file_id,data:{webOpenId:this.props.openId,origDest:this.editorToString[this.props.currentEditor]}})},t.prototype.componentWillUnmount=function(){if(!this.state.set_routing_dest){u.logUserAction({actionEvent:d.UserActionEventType.DYNAMIC_ROUTING_MODAL_IMPRESSION,userId:this.props.user.id,docPathOrId:this.props.file.file_id,data:{webOpenId:this.props.openId,origDest:this.editorToString[this.props.currentEditor],routingDest:"Dismissed"}}),this.setState({set_routing_dest:!1})}},t.prototype.render=function(){var e,t,r,a,p,m=this,f=this.editorToString[this.props.editorWithLock],_=this.editorToString[this.props.currentEditor],v=l._("Want to see the latest version and edit?");"preview"===this.props.currentEditor?(a="active-editor-discovered-on-preview",r="/static/images/cloud_docs/dynamic_routing/active-editor-discovered-on-preview-vflgDu-Pd.png",t=l._("Open in %(editor_with_lock_string)s").format({editor_with_lock_string:f}),e=l._("Right now people are working on this file in %(editor_with_lock_string)s. You can see updates and edit there.").format({editor_with_lock_string:f})):(a="active-editor-discovered-on-edit",r="/static/images/cloud_docs/dynamic_routing/active-editor-discovered-on-edit-vflJsv-0D.png",this.props.isLockEditorEnabled?(t=l._("Edit in %(editor_with_lock_string)s").format({editor_with_lock_string:f}),e=l._("Because this file is already open in %(editor_with_lock_string)s, you can only see updates and edit there.").format({editor_with_lock_string:f})):(v=l._("You can’t edit this file right now"),e=l._("Someone is working on this file in %(editor_with_lock_string)s. However, your admin has disabled access to %(editor_with_lock_string)s in your organization.").format({editor_with_lock_string:f})));var h,g=function(e,t){u.logUserAction({actionEvent:d.UserActionEventType.DYNAMIC_ROUTING_MODAL_IMPRESSION,userId:m.props.user.id,docPathOrId:m.props.file.file_id,data:{webOpenId:m.props.openId,origDest:_,routingDest:m.editorToString[e]}}),m.setState({set_routing_dest:!0});var r=window.self;i.getCloudEditorUrl(m.props.user.id,m.props.file.file_id).then((function(n){i.openCloudEditorUrl(n,r,m.props.file,m.props.user,e,t)})).catch((function(e){i.handleError(e)}))};if(this.props.showViewOnlyMode){var w=l._("View-Only in %(current_editor)s").format({current_editor:_});p=s.createElement("div",{className:"link-text"},s.createElement("span",{role:"link",className:"link-span",tabIndex:0,onClick:function(){g(m.props.currentEditor,!0)}},w))}else if(!this.props.isLockEditorEnabled){w=l._("View-Only in Preview");p=s.createElement("div",{className:"link-text"},s.createElement("span",{role:"link",className:"link-span",tabIndex:0,onClick:function(){return n.Modal.close()}},w))}return h=this.props.isLockEditorEnabled?s.createElement("div",{className:"edit-buttons"},s.createElement(c.Button,{className:"main-button",onClick:function(){g(m.props.editorWithLock,!1)}},t),p):s.createElement("div",{className:"edit-buttons"},p),s.createElement(n.Modal,{id:"dynamic-routing",className:"dynamic-routing-modal",buttonComponent:h,displayCloseButton:!0,style:"clean"},s.createElement("div",{className:"default-dyn-routing-modal"},s.createElement("img",{className:a,alt:"",src:o.static_url(r)}),s.createElement("div",{className:"main-text"},v),s.createElement("div",{className:"sub-text"},e)))},t})((s=r.__importStar(s)).Component);t.DynamicRoutingModal=a.requireCssWithComponent(p,["/static/css/cloud_docs/dynamic_routing-vfl7wC_mz.css"]),t.showDynamicRoutingModal=function(e){n.Modal.showInstance(s.createElement(t.DynamicRoutingModal,r.__assign({},e)))}})),define("modules/clean/callback_chain/callback_chain",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e){this.callbacks=e}return e.prototype.run=function(e){for(var t=(function(e){return void 0!==e.abortCallbackChain})(e)?e:(function(e){var t=e,r=!1;return t.abortCallbackChain=function(){r=!0},Object.defineProperty(t,"callbackChainAborted",{get:function(){return r}}),t})(e),r=0,n=this.callbacks;r<n.length;r++){var i=n[r];if(t.callbackChainAborted)break;i(t)}},e})();t.CallbackChain=r})),define("modules/clean/react/file_action_button_group",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),(function(e){e.COMMENTS="COMMENTS",e.WATERMARKING="WATERMARKING"})(t.FileActionButtonGroup||(t.FileActionButtonGroup={}))})),define("modules/clean/react/file_action_button_type",["require","exports","modules/core/i18n"],(function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.FileActionButtonType={COMMENT:"COMMENT",COPY:"COPY",DELETE:"DELETE",DOWNLOAD:"DOWNLOAD",MOVE:"MOVE",OPEN:"OPEN",PREVIOUS_VERSIONS:"PREVIOUS_VERSIONS",REMOVE_LINK:"REMOVE_LINK",RENAME:"RENAME",SHARE:"SHARE",ENABLE_COMMENTS:"ENABLE_COMMENTS",DISABLE_COMMENTS:"DISABLE_COMMENTS",SHOW_RESOLVED_COMMENTS:"SHOW_RESOLVED_COMMENTS",HIDE_RESOLVED_COMMENTS:"HIDE_RESOLVED_COMMENTS",SUBSCRIBE:"SUBSCRIBE",SUBSCRIBE_TO_NOTIFICATIONS:"SUBSCRIBE_TO_NOTIFICATIONS",UNSUBSCRIBE:"UNSUBSCRIBE",UNSUBSCRIBE_FROM_NOTIFICATIONS:"UNSUBSCRIBE_FROM_NOTIFICATIONS",ENABLE_WATERMARKING:"ENABLE_WATERMARKING",REMOVE_WATERMARKING:"REMOVE_WATERMARKING"};var i=((n={})[t.FileActionButtonType.COMMENT]=r._("Comment",{comment:"BUTTON"}),n[t.FileActionButtonType.COPY]=r._("Copy…",{comment:"BUTTON"}),n[t.FileActionButtonType.DELETE]=r._("Delete…",{comment:"BUTTON"}),n[t.FileActionButtonType.DOWNLOAD]=r._("Download",{comment:"BUTTON"}),n[t.FileActionButtonType.MOVE]=r._("Move…",{comment:"BUTTON"}),n[t.FileActionButtonType.OPEN]=r._("Open",{comment:"BUTTON"}),n[t.FileActionButtonType.PREVIOUS_VERSIONS]=r._("Version history",{comment:"BUTTON"}),n[t.FileActionButtonType.REMOVE_LINK]=r._("Remove link",{comment:"BUTTON"}),n[t.FileActionButtonType.RENAME]=r._("Rename",{comment:"BUTTON"}),n[t.FileActionButtonType.SHARE]=r._("Share",{comment:"BUTTON"}),n[t.FileActionButtonType.ENABLE_COMMENTS]=r._("Enable comments",{comment:"BUTTON"}),n[t.FileActionButtonType.DISABLE_COMMENTS]=r._("Disable comments",{comment:"BUTTON"}),n[t.FileActionButtonType.SHOW_RESOLVED_COMMENTS]=r._("Show resolved comments",{comment:"BUTTON"}),n[t.FileActionButtonType.HIDE_RESOLVED_COMMENTS]=r._("Hide resolved comments",{comment:"BUTTON"}),n[t.FileActionButtonType.SUBSCRIBE]=r._("Subscribe",{comment:"BUTTON"}),n[t.FileActionButtonType.SUBSCRIBE_TO_NOTIFICATIONS]=r._("Subscribe to notifications",{comment:"BUTTON"}),n[t.FileActionButtonType.UNSUBSCRIBE]=r._("Unsubscribe",{comment:"BUTTON"}),n[t.FileActionButtonType.UNSUBSCRIBE_FROM_NOTIFICATIONS]=r._("Unsubscribe from notifications",{comment:"BUTTON"}),n[t.FileActionButtonType.ENABLE_WATERMARKING]=r._("Enable watermarking",{comment:"BUTTON"}),n[t.FileActionButtonType.REMOVE_WATERMARKING]=r._("Remove watermarking",{comment:"BUTTON"}),n);t.getFileActionButtonText=function(e){return e&&i[e]?i[e]:null}})),define("modules/clean/react/file_viewer/mode_manager",["require","exports","tslib","react","react-redux","modules/clean/react/file_viewer/data/selectors","modules/clean/react/file_viewer/data/actions","file-viewer/core"],(function(e,t,r,n,i,o,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.componentDidUpdate=function(){this.unavailableModes()[this.props.mode]&&this.props.mode!==s.FileViewerMode.Default&&this.props.changeMode(s.FileViewerMode.Default)},t.prototype.unavailableModes=function(){var e=r.__assign({},this.props.disabledModes);return this.props.isViewingFileSubpath&&(e[s.FileViewerMode.Commenting]=!0),e},t.prototype.render=function(){return null},t})((n=r.__importDefault(n)).default.PureComponent);t.UnconnectedModeManager=l,t.ModeManager=i.connect((function(e){return{mode:o.getMode(e),disabledModes:o.getDisabledModes(e)}}),{changeMode:a.changeMode})(l)})),define("modules/clean/react/file_viewer/more_dropdown/models",["require","exports","tslib","external/lodash"],(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n);var i=(function(){function e(){}return e.prototype.equals=function(e){return n.isEqual(this,e)},e})(),o=(function(e){function t(t){void 0===t&&(t={});var r=e.call(this)||this;return r.className=t.className||null,r.fileActionButtonType=t.fileActionButtonType||null,r.handler=t.handler||n.noop,r.component=t.component||null,r.sortWeight=t.sortWeight||0,r}return r.__extends(t,e),t})(i);t.MoreOption=o;var a=(function(e){function t(t){var r=e.call(this)||this;return r.fileActionButtonGroup=t.fileActionButtonGroup,r.options=t.options||[],r.sortWeight=t.sortWeight||0,r}return r.__extends(t,e),t})(i);t.MoreOptionGroup=a})),define("modules/clean/react/file_viewer/more_dropdown/more_option_registry",["require","exports","tslib","external/lodash","modules/clean/react/file_viewer/more_dropdown/models"],(function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n);var o=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.options=[],t}return r.__extends(t,e),t.prototype.isValidMoreOption=function(e){return null!=e.fileActionButtonType},t.prototype.isValidMoreOptionGroup=function(e){var t=this,r=e.options;return r.length&&r.every((function(e){return t.isValidMoreOption(e)}))},t.prototype.isValidOption=function(e){return e instanceof i.MoreOption&&this.isValidMoreOption(e)||e instanceof i.MoreOptionGroup&&this.isValidMoreOptionGroup(e)},t.prototype.reset=function(){this.options=[],this.removeListeners()},t.prototype.getOptionItems=function(){return n.sortBy(this.options.slice(),(function(e){return e.sortWeight}))},t.prototype.addOption=function(e){if(!this.isValidOption(e))throw new Error("Option needs to be a valid MoreOption or MoreOptionGroup");this.options=this.options.concat([e]),this.emitChange()},t.prototype.removeOption=function(e){if(null!=e&&!this.isValidOption(e))throw new Error("Option needs to be a valid MoreOption or MoreOptionGroup");var t,r,n=this.options.length;this.options=(t=this.options,r=e,t.filter((function(e){return e!==r}))),this.options.length<n&&this.emitChange()},t.prototype.replaceOption=function(e,t){if(null==t)throw new Error("Please provide option to replace it with. Otherwise use removeOption");if(!this.isValidOption(e)||!this.isValidOption(t))throw new Error("Option needs to be a valid MoreOption or MoreOptionGroup");if(!e.equals(t)){var r=!1;this.options=this.options.map((function(n){return n===e?(r=!0,t):n})),r&&this.emitChange()}},t})((function(){function e(){this.listeners=[]}return e.prototype.emitChange=function(){return this.listeners.forEach((function(e){return e()}))},e.prototype.addListener=function(e){var t=this;return this.listeners.push(e),function(){var r=t.listeners.indexOf(e);r>-1&&t.listeners.splice(r,1)}},e.prototype.removeListeners=function(){this.listeners=[]},e})());t.MoreOptionRegistry=o,t.moreOptionRegistry=new o}));__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};define("modules/clean/react/file_viewer_sidebar/buttons/more_dropdown",["require","exports","modules/clean/react/async/loadable"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncSharedFileMoreDropdown=r.Loadable({loader:function(){return new Promise((function(t,r){e(["modules/clean/react/file_viewer/shared_file_actions"],t,r)})).then(__importStar).then((function(e){return e.SharedFileMoreDropdown}))}}),t.AsyncMountedFileMoreDropdown=r.Loadable({loader:function(){return new Promise((function(t,r){e(["modules/clean/react/file_viewer/mounted_file_actions"],t,r)})).then(__importStar).then((function(e){return e.MountedFileMoreDropdown}))}})})),define("modules/clean/image_preview_util",["require","exports","tslib","jquery"],(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n);var i={PREVIEW_IMAGE_CONTAINER:"preview-image-container",PREVIEW_IMAGE_WRAPPER:"preview-image-wrapper",PREVIEW_IMAGE:"preview-image",getPreviewImageContainer:function(){return n.default("."+this.PREVIEW_IMAGE_CONTAINER)},getPreviewImageWrapper:function(){return n.default("."+this.PREVIEW_IMAGE_WRAPPER)},getPreviewImage:function(){return this.getPreviewImageContainer().find("."+this.PREVIEW_IMAGE)},getPreviewImageElement:function(){return this.getPreviewImage()[0]}};t.default=i})),define("modules/clean/image_size",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=[["480x320",480,320],["640x480",640,480],["800x600",800,600],["1024x768",1024,768],["1280x960",1280,960],["1600x1200",1600,1200],["2048x1536",2048,1536]];t.imageBestFitSize=function(e,t){for(var n=0,i=r;n<i.length;n++){var o=i[n],a=o[0],s=o[1],l=o[2];if(s>=e||l>=t)return a}return r[r.length-1][0]}})),define("modules/clean/mouse_button_code",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),(function(e){e[e.LEFT=0]="LEFT"})(t.MouseButtonCode||(t.MouseButtonCode={}))})),define("modules/clean/logging/hive/schemas/web-workflows",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){this.category="web-workflows",this.active_user_id=null,this.authed_user_ids=null,this.identity_gid=null,this.session_id=null,this.team_id=null,this.team_type=null,this.ua_browser_name=null,this.ua_browser_version=null,this.ua_os_name=null,this.ua_os_version=null,this.user_id=null,this.event_name=e.event_name,this.source_context=e.source_context,this.device_type=e.device_type,this.milestone=e.milestone,this.app_id=e.app_id,this.ns_id=e.ns_id,this.file_obj_id=e.file_obj_id,this.file_viewer_session_id=e.file_viewer_session_id,this.file_preview_session_id=e.file_preview_session_id,this.file_size=e.file_size,this.file_preview_size=e.file_preview_size,this.file_extension=e.file_extension,this.platform=e.platform,this.extra=e.extra,Object.seal(this)};t.WebWorklowsLoggingTableRow=r})),define("modules/clean/loggers/file_preview_logger",["require","exports","tslib","modules/clean/ajax","modules/clean/react/file_viewer/constants","modules/clean/react/previews/constants","modules/clean/web_timing_logger","modules/constants/request","modules/core/browser"],(function(e,t,r,n,i,o,a,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),a=r.__importStar(a),s=r.__importStar(s),l=r.__importStar(l);var c={};c[i.EventType.FilePreviewSessionEnded]="preview_session_ended",c[i.EventType.FilePreviewAttemptStarted]="preview_attempted",c[i.EventType.FilePreviewSupportConfirmed]="support_confirmed",c[i.EventType.FilePreviewSupportDenied]="support_denied",c[i.EventType.FilePreviewDownloadAttempted]="download_attempted",c[i.EventType.FilePreviewDownloadSucceeded]="download_succeeded",c[i.EventType.FilePreviewDownloadFailed]="download_failed",c[i.EventType.FilePreviewRenderSucceeded]="render_succeeded",c[i.EventType.FilePreviewRenderFailed]="render_failed",c[i.EventType.FilePreviewFidelitySurveyAsked]="fidelity_survey_asked",c[i.EventType.FilePreviewFidelitySurveyAnswered]="fidelity_survey_answered",c[i.EventType.FilePreviewFidelitySurveyDismissed]="fidelity_survey_dismissed",c[i.EventType.FilePreviewUserAction]="user_action",c[i.EventType.ArchivePreviewContentsScanned]="archive_contents_scanned",c[i.EventType.FilePreviewModeDetermined]="file_preview_mode_determined",c[i.EventType.FilePreviewModeBounce]="file_preview_mode_bounce",c[i.EventType.SidebarPaneSelected]="sidebar_pane_selected",c[i.EventType.SidebarModeSelected]="sidebar_mode_selected",c[i.EventType.SidebarOpened]="sidebar_opened",c[i.EventType.SidebarClosed]="sidebar_closed",c[i.EventType.SidebarCollapsedShareClicked]="sidebar_collapsed_share_clicked",c[i.EventType.SidebarOpenedShareClicked]="sidebar_opened_share_clicked",c[i.EventType.FilePreviewUpsellClicked]="preview_upsell_clicked",c[i.EventType.FilePreviewUpsellExposed]="preview_upsell_exposed",c[i.EventType.PersistentHeaderShown]="persistent_header_shown",c[i.EventType.PersistentFooterShown]="persistent_footer_shown";var u=(function(){function e(){this._eventHandlers={}}return e.prototype._getSerializedTimeline=function(e){return null},e.prototype.addEventHandlers=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0,n=e;r<n.length;r++){var i=n[r],o=i[0],a=i[1];this._eventHandlers[o]=a}},e.prototype._log=function(e,t,r){void 0===r&&(r={});var i=this._getSerializedTimeline(t),o={device_type:t.fileViewerSession.deviceType,event_name:c[e],extra:JSON.stringify(r),file_viewer_session_id:t.fileViewerSession.id,file_preview_session_id:t.id,file_ns_id:t.file.ns_id,file_sjid:t.file.sjid,file_preview_timeline:i?JSON.stringify(i):null,file_preview_size:t.previewSize};n.SilentBackgroundBeaconRequest({url:"/log/file_preview",data:o})},e.prototype.listenTo=function(e){for(var t in this._eventHandlers)if(this._eventHandlers.hasOwnProperty(t)){var r=this._eventHandlers[t];e.addListener(t,r)}},e.prototype.unlistenTo=function(e){for(var t in this._eventHandlers)if(this._eventHandlers.hasOwnProperty(t)){var r=this._eventHandlers[t];e.removeListener(t,r)}},e})(),d=(function(e){function t(){var t=e.call(this)||this;return t._logAsked=function(e){t._log(i.EventType.FilePreviewFidelitySurveyAsked,e)},t._logAnswered=function(e,r){t._log(i.EventType.FilePreviewFidelitySurveyAnswered,e,r)},t._logDismissed=function(e,r){t._log(i.EventType.FilePreviewFidelitySurveyDismissed,e,r)},t.addEventHandlers([i.EventType.FilePreviewFidelitySurveyAsked,t._logAsked],[i.EventType.FilePreviewFidelitySurveyAnswered,t._logAnswered],[i.EventType.FilePreviewFidelitySurveyDismissed,t._logDismissed]),t}return r.__extends(t,e),t.prototype._log=function(t,r,n){void 0===n&&(n={}),n._client_time=+Date.now();var i=r.sourceContext,o=r.sourceAction;i&&(n._source_context=i),o&&(n._source_action=o),e.prototype._log.call(this,t,r,n)},t})(u);t.FilePreviewFidelitySurveyLogger=d;var p=(function(e){function t(t){var r=e.call(this)||this;return r._handleFilePreviewAttemptStarted=function(e,t){r._handleEvent(i.EventType.FilePreviewAttemptStarted,e,t)},r._handleFilePreviewSupportConfirmed=function(e,t){r._handleEvent(i.EventType.FilePreviewSupportConfirmed,e,t)},r._handleFilePreviewSupportDenied=function(e,t){r._handleEvent(i.EventType.FilePreviewSupportDenied,e,t)},r._handleFilePreviewDownloadAttempted=function(e,t){r._handleEvent(i.EventType.FilePreviewDownloadAttempted,e,t)},r._handleFilePreviewDownloadSucceeded=function(e,t){r._handleEvent(i.EventType.FilePreviewDownloadSucceeded,e,t)},r._handleFilePreviewDownloadFailed=function(e,t){r._handleEvent(i.EventType.FilePreviewDownloadFailed,e,t)},r._handleFilePreviewRenderSucceeded=function(e,t){r._handleEvent(i.EventType.FilePreviewRenderSucceeded,e,t)},r._handleFilePreviewRenderFailed=function(e,t){r._handleEvent(i.EventType.FilePreviewRenderFailed,e,t)},r._handleFilePreviewSessionEnded=function(e,t){r._handleEvent(i.EventType.FilePreviewSessionEnded,e,t)},r._filePreviewSessionId=t,r.addEventHandlers([i.EventType.FilePreviewAttemptStarted,r._handleFilePreviewAttemptStarted],[i.EventType.FilePreviewSupportConfirmed,r._handleFilePreviewSupportConfirmed],[i.EventType.FilePreviewSupportDenied,r._handleFilePreviewSupportDenied],[i.EventType.FilePreviewDownloadAttempted,r._handleFilePreviewDownloadAttempted],[i.EventType.FilePreviewDownloadSucceeded,r._handleFilePreviewDownloadSucceeded],[i.EventType.FilePreviewDownloadFailed,r._handleFilePreviewDownloadFailed],[i.EventType.FilePreviewRenderSucceeded,r._handleFilePreviewRenderSucceeded],[i.EventType.FilePreviewRenderFailed,r._handleFilePreviewRenderFailed],[i.EventType.FilePreviewSessionEnded,r._handleFilePreviewSessionEnded]),r}return r.__extends(t,e),t.prototype._handleEvent=function(e,t,r){if(void 0===r&&(r={}),this._filePreviewSessionId===t.id){r.preview_type=t.previewType,r.file_preview_timeline=JSON.stringify(this._getSerializedTimeline(t)),r.web_timing_logger_req_id=s.REQUEST_ID,r.source_context=t.sourceContext,r.source_action=t.sourceAction,null!=t.primaryMarkTs&&(r.primary_mark_ts=t.primaryMarkTs,r.time_to_primary_mark=t.timeToPrimaryMark());var n=a.start_time();if(null!=t.lastEvent&&(r.last_event=c[t.lastEvent]),t.sourceAction===o.PreviewSourceAction.Visit&&e===i.EventType.FilePreviewRenderSucceeded){var u=a.time_to_interactive();null!=u&&null!=n&&(r.time_to_interactive=u-n);var d=l.performance();if(null!=d){var p=d.timing;null!=p&&null!=n&&(r.time_to_first_byte=p.responseStart-n,r.web_timing_data=JSON.stringify(p))}window._timingData&&window._timingData.img&&(delete window._timingData.img.dl_error_finish,r.img_timing_data=JSON.stringify(window._timingData.img))}e===i.EventType.FilePreviewSessionEnded&&(r.password_needed=t.passwordNeeded),this._log(e,t,r)}},t.prototype._getSerializedTimeline=function(e){var t={};for(var r in e.previewTimeline)if(e.previewTimeline.hasOwnProperty(r)){var n=e.previewTimeline[r];t[this._timelineKey(r)]=n.timestamp}return t},t.prototype._timelineKey=function(e){return c[e]+"_ts"},t})(u);t.FilePreviewTimelineLogger=p;var m=(function(e){function t(){var t=e.call(this)||this;return t.logContentsScanned=function(e,r){t._log(i.EventType.ArchivePreviewContentsScanned,e,r)},t.addEventHandlers([i.EventType.ArchivePreviewContentsScanned,t.logContentsScanned]),t}return r.__extends(t,e),t})(u);t.FilePreviewArchiveLogger=m;var f=(function(e){function t(){var t=e.call(this)||this;return t._logUpsellExposed=function(e){t._log(i.EventType.FilePreviewUpsellExposed,e)},t._logUpsellClicked=function(e){t._log(i.EventType.FilePreviewUpsellClicked,e)},t.addEventHandlers([i.EventType.FilePreviewUpsellExposed,t._logUpsellExposed],[i.EventType.FilePreviewUpsellClicked,t._logUpsellClicked]),t}return r.__extends(t,e),t})(u);t.FilePreviewUpsellLogger=f;var _=(function(e){function t(){var t=e.call(this)||this;return t._logPersistentHeaderShown=function(e){t._log(i.EventType.PersistentHeaderShown,e)},t._logPersistentFooterShown=function(e){t._log(i.EventType.PersistentFooterShown,e)},t.addEventHandlers([i.EventType.PersistentHeaderShown,t._logPersistentHeaderShown],[i.EventType.PersistentFooterShown,t._logPersistentFooterShown]),t}return r.__extends(t,e),t})(u);t.FilePreviewConversionLogger=_;var v=(function(e){function t(){var t=e.call(this)||this;return t._logUserAction=function(e,r,n,o){o.action=r,o.context=n,t._log(i.EventType.FilePreviewUserAction,e,o)},t.addEventHandlers([i.EventType.FilePreviewUserAction,t._logUserAction]),t}return r.__extends(t,e),t})(u);t.FilePreviewUserActionLogger=v;var h=(function(e){function t(){var t=e.call(this)||this;return t.determinedTime=0,t.bounceLogged=!1,t.logDetermined=function(e,r){t.determinedTime=Date.now(),t._log(i.EventType.FilePreviewModeDetermined,e,r)},t.logBounce=function(e){if(!t.bounceLogged&&0!==t.determinedTime){t.bounceLogged=!0;var r=Date.now()-t.determinedTime;t._log(i.EventType.FilePreviewModeBounce,e,{time:r})}},t.addEventHandlers([i.EventType.FilePreviewModeDetermined,t.logDetermined],[i.EventType.FilePreviewModeBounce,t.logBounce]),t}return r.__extends(t,e),t})(u);t.FilePreviewModeLogger=h;var g=(function(e){function t(){var t=e.call(this)||this;return t.logSidebarPaneSelected=function(e,r){t._log(i.EventType.SidebarPaneSelected,e,r)},t.logSidebarModeSelected=function(e,r){t._log(i.EventType.SidebarModeSelected,e,r)},t.logSidebarOpened=function(e){t._log(i.EventType.SidebarOpened,e)},t.logSidebarClosed=function(e){t._log(i.EventType.SidebarClosed,e)},t.logSidebarCollapsedShareClicked=function(e){t._log(i.EventType.SidebarCollapsedShareClicked,e)},t.logSidebarOpenedShareClicked=function(e){t._log(i.EventType.SidebarOpenedShareClicked,e)},t.addEventHandlers([i.EventType.SidebarPaneSelected,t.logSidebarPaneSelected],[i.EventType.SidebarModeSelected,t.logSidebarModeSelected],[i.EventType.SidebarOpened,t.logSidebarOpened],[i.EventType.SidebarClosed,t.logSidebarClosed],[i.EventType.SidebarCollapsedShareClicked,t.logSidebarCollapsedShareClicked],[i.EventType.SidebarOpenedShareClicked,t.logSidebarOpenedShareClicked]),t}return r.__extends(t,e),t})(u);t.FilePreviewSidebarLogger=g})),define("modules/clean/loggers/file_viewer_logger",["require","exports","tslib","modules/clean/analytics","modules/clean/file_store/utils","modules/clean/api_v2/user_client","modules/clean/api_v2/noauth_client"],(function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n);var s={Overall:"viewer_overall_time","Page Request":"viewer_page_request_time",Rendering:"viewer_rendering_time"};t.logPageRendered=function(e,t){e=e;for(var o=i.getExtension(e),a=r.__assign({},t.attributes,{total_time:-1,file_ext:o,source:"file-viewer",originalSize:null!=e.bytes?e.bytes:0}),l=0,c=t.stats;l<c.length;l++){var u=c[l];a[s[u.name]]=u.end-u.start}return n.UserActivityLogger.stop("web","file_view_first_page_rendered",a),n.PreviewActivityLogger.stop("file_view_first_page_rendered",{file_ext:o,extra:JSON.stringify(a)})},t.logView=function(e,t,r,n,i,s,l,c){void 0===l&&(l=!1),void 0===c&&(c=!1);var u=s?{url:s}:void 0,d={file_views:[{file_info:{file_identifier:e.file_id,shared_link_details:u},platform_type:{".tag":"web"},origin:n,action:i}]};return t?(new o.UserApiV2Client).ns("seen_state").rpc("log_file_view",d,{subjectUserId:t.id}):(new a.NoAuthApiV2Client).ns("seen_state").rpc("logged_out/log_file_view",d,{})}})),define("modules/clean/loggers/video_preview_logger",["require","exports","tslib","modules/clean/ajax","modules/clean/perf_tools/web_timing_utils"],(function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n);var o=(function(){function e(e,t){this.videoTruncated=!1,this.filePreviewSessionId=t?t.id:"",this.videoFormat=e}return e.prototype.populateVideoDuration=function(e){this.videoDuration=Math.round(e)},e.prototype.setVideoTruncated=function(){this.videoTruncated=!0},e.prototype.logEvent=function(e,t){var r={event_name:e,client_timestamp_ms:i.WebTimingUtil.getNow(),file_preview_session_id:this.filePreviewSessionId,video_format:this.videoFormat,video_duration_seconds:this.videoDuration,video_truncated:this.videoTruncated,extra:t?JSON.stringify(t):void 0};n.SilentBackgroundBeaconRequest({url:"/log/video_preview",data:r})},e})();t.VideoPreviewLogger=o})),define("modules/clean/loggers/workflows_logger",["require","exports","tslib","modules/clean/logging/hive/schemas/web-workflows","modules/clean/logging/telemetry","modules/clean/previews/util","modules/clean/react/file_viewer/models","modules/clean/logging/hive/schemas/web-workflows"],(function(e,t,r,n,i,o,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=r.__importStar(i),t.hiveLogger=new i.HiveLogger,t.WorkflowsEventExtra=s.WorkflowsEventExtra,(function(e){e.WatermarkApplyOverwrite="watermark_apply_overwrite",e.WatermarkApplySaveAsCopy="watermark_apply_save_as_copy",e.WatermarkCancel="watermark_cancel",e.WatermarkEducationTooltipExposed="watermark_education_tooltip_exposed",e.WatermarkEducationTooltipClicked="watermark_education_tooltip_clicked",e.WatermarkEnable="watermark_enable",e.WatermarkOpenApplyMenu="watermark_open_apply_menu",e.WatermarkPositionMenuOpened="watermark_position_menu_opened",e.WatermarkPositionMenuSelectionMade="watermark_position_menu_selection_made",e.WatermarkRotationClicked="watermark_rotation_clicked",e.WatermarkSizeChanged="watermark_size_changed",e.WatermarkTextInputEnterFocus="watermark_text_input_enter_focus",e.WatermarkTextInputExitFocus="watermark_text_input_exit_focus",e.WatermarkTransparencyChanged="watermark_transparency_changed",e.WatermarkUpsellHeaderButtonClicked="watermark_upsell_header_button_clicked",e.WatermarkUpsellPopoverClickedProCopy="watermark_upsell_popover_clicked_pro_copy",e.WatermarkUpsellPopoverClickedWmCopy="watermark_upsell_popover_clicked_wm_copy",e.WatermarkUpsellPopoverExposedProCopy="watermark_upsell_popover_exposed_pro_copy",e.WatermarkUpsellPopoverExposedWmCopy="watermark_upsell_popover_exposed_wm_copy",e.WatermarkUpsellSingleLineProClicked="watermark_upsell_single_line_pro_clicked",e.WatermarkUpsellSingleLineProExposed="watermark_upsell_single_line_pro_exposed",e.WatermarkUpsellTooltipClicked="watermark_upsell_tooltip_clicked",e.WatermarkUpsellTooltipExposed="watermark_upsell_tooltip_exposed",e.WatermarkVersionHistoryClicked="watermark_version_history_clicked",e.WatermarkTextTabClicked="watermark_type_text_clicked",e.WatermarkImageTabClicked="watermark_type_image_clicked",e.WatermarkImageUploadClicked="watermark_image_upload_clicked",e.WatermarkImageUploaded="watermark_image_uploaded",e.WatermarkImageDeleted="watermark_image_deleted",e.WatermarkColorClicked="watermark_color_clicked",e.WatermarkToolbarClicked="watermark_toolbar_clicked",e.WatermarkPageNumberClicked="watermark_page_number_clicked",e.WatermarkArrowClicked="watermark_arrow_clicked",e.WatermarkPagePreviewClicked="watermark_page_preview_clicked",e.MarkupEnabled="markup_enabled",e.MarkupRectangleClicked="markup_rectangle_clicked",e.MarkupCircleClicked="markup_circle_clicked",e.MarkupTextboxClicked="markup_textbox_clicked",e.MarkupArrowClicked="markup_arrow_clicked",e.MarkupDrawClicked="markup_draw_clicked",e.MarkupApplyOverwrite="markup_apply_overwrite",e.MarkupApplySaveAsCopy="markup_apply_save_as_copy",e.MarkupCancel="markup_cancel",e.MarkupDelete="markup_delete",e.MarkupCustomizationClicked="markup_customization_clicked"})(t.WorkflowsEvent||(t.WorkflowsEvent={})),t.logWorkflowsEvent=function(e,r,i){var s=a.FilePreviewSession.currentSession;if(s&&s.fileViewerSession){var l={event_name:e,source_context:s.sourceContext,device_type:s.fileViewerSession.deviceType,milestone:r,ns_id:s.file.ns_id,file_obj_id:s.file.file_id,file_viewer_session_id:s.fileViewerSession.id,file_preview_session_id:s.id,file_size:s.file.bytes||-1,file_preview_size:s.previewSize,file_extension:o.getWhitelistedExtensionFromFile(s.file),platform:"desktop"===s.fileViewerSession.deviceType?"web":"mobile_web",extra:i};t.hiveLogger.log(new n.WebWorklowsLoggingTableRow(l))}}})),define("modules/clean/auth/login_or_register/types",["require","exports"],(function(e,t){"use strict";var r,n,i,o;Object.defineProperty(t,"__esModule",{value:!0}),(function(e){e.COMMENT="comment",e.DOWNLOAD="download",e.IMMEDIATE="immediate"})(r||(r={})),t.LoginOrRegisterKind=r,(function(e){e.DIRECT_DOWNLOAD="direct_download",e.SAVE_TO_DROPBOX="add_to_dropbox"})(n||(n={})),t.DownloadAction=n,(function(e){e[e.LOGIN=0]="LOGIN",e[e.REGISTER=1]="REGISTER"})(i||(i={})),t.Mode=i,(function(e){e.DEFAULT="",e.POST="post_comment_variant",e.SUBSCRIBE="subscribe_variant"})(o||(o={})),t.CommentTextVariant=o})),define("modules/clean/integrations/zoom_share_dialog/async_modal",["require","exports","tslib"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.asyncShowModal=function(t,n,i,o){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(a){switch(a.label){case 0:return[4,new Promise((function(t,r){e(["modules/clean/integrations/zoom_share_dialog/modal"],t,r)})).then(r.__importStar)];case 1:return(0,a.sent().showModal)(t,n,i,o||"web"),[2]}}))}))}})),define("modules/clean/previews/actions",["require","exports","tslib","modules/clean/referrer_cleansing_redirect","modules/core/i18n"],(function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),t.imagePrint=function(e){var t=window.open("about:blank");if(!t)throw new Error(i._("Could not open new window"));window.setTimeout((function(){var r=t.document.createElement("style");r.innerHTML="\n      @page { margin: 0;}\n      img { max-width: 100%; max-height: 100%}\n    ",t.document.head.appendChild(r);var n=t.document.createElement("img");n.src=e,n.onload=function(){t.print()},n.onerror=function(){t.close()},t.document.body.appendChild(n)}),50)},t.docPrint=function(e){n.safe_open_tab_and_redirect(e)}})),define("modules/clean/previews/pending_upload_watcher",["require","exports","tslib","modules/clean/ajax","modules/clean/react/file_viewer/data/actions","modules/core/browser","modules/core/uri"],(function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),o=r.__importStar(o);var s=(function(){function e(e,t,r){void 0===r&&(r=""),this.pollUrl=new a.URI({path:"/sp/"}).updateQuery({link_type:e,link_key:t,secure_hash:r}).toString()}return e.prototype.startPolling=function(){this.pollPending()},e.prototype.pollSuccess=function(e){var t=JSON.parse(e);t.hasOwnProperty("upload_status")&&"complete"===t.upload_status?i.pendingFileUploaded():setTimeout(this.pollPending.bind(this),2e3)},e.prototype.pollFailure=function(e){e.status<400||e.status>=500?this.retryPoll():o.reload(!0)},e.prototype.retryPoll=function(){setTimeout(this.pollPending.bind(this),2e3)},e.prototype.pollPending=function(){var e=this;n.SilentBackgroundRequest({url:this.pollUrl,success:function(t){e.pollSuccess(t)},error:function(t){e.pollFailure(t)}})},e})();t.PendingUploadWatcher=s})),define("modules/clean/previews/util",["require","exports","tslib","modules/core/browser","modules/clean/analytics","modules/clean/datetime","modules/clean/filepath","modules/clean/previews/constants","modules/clean/cloud_docs/constants","modules/clean/file_store/utils","modules/clean/react/previews/constants","file-viewer/core","modules/constants/file_viewer","modules/core/uri"],(function(e,t,r,n,i,o,a,s,l,c,u,d,p,m){"use strict";function f(e,t){var r={};return r._subject_uid=String(t),e.updateQuery(r)}function _(e,t){return f(new m.URI({path:"/history"+e.fq_path}),t.id)}function v(e){return p.PRESENTATION_EXTS.map((function(e){return e.slice(1)})).includes(e)}function h(e){return["doc","docm","docx"].includes(e)}function g(e){return["odp","odt","rtf","wpd"].includes(e)}function w(e,t){var r=Number.MAX_VALUE;if("pdf"===e)r=Number(524288e3);else if(h(e)||g(e))r=s.MAX_WORD_DOC_FILE_SIZE_B;else if(v(e))r=s.MAX_PPT_FILE_SIZE_B;else if(t===s.PreviewType.Archive)r=s.MAX_ARCHIVE_FILE_SIZE_B;else if(t===s.PreviewType.HTML||t===s.PreviewType.Text)r=Number(8388608);else{if(t!==s.PreviewType.Linkfile)return;r=Number(10485760)}return r}Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),a=r.__importStar(a),p=r.__importStar(p),t.getIframeQuery=function(){return".react-file-viewer__preview iframe"},t.shouldShowPlatformInfo=function(){return p.PASS_PLATFORM_INFO},t.is_excel2_file=function(e){return["xls","csv","ods"].indexOf(e.substring(0,3))>-1},t.getWhitelistedExtension=function(e){var t=a.file_extension(e);return p.LOGGING_WHITELISTED_EXTS.includes("."+t)?t:p.LOGGING_EXT_PLACEHOLDER},t.getWhitelistedExtensionFromFile=function(e){var t=c.getExtension(e);return p.LOGGING_WHITELISTED_EXTS.includes("."+t)?t:p.LOGGING_EXT_PLACEHOLDER},t.normalize_extension=function(e){if("indd"===e)return e;var t=e.substring(0,3);switch(t){case"rtf":case"odt":case"wpd":return"doc";case"pps":case"odp":return"ppt";case"csv":case"ods":return"xls";default:return t}},t.getModifierString=function(e){if(e.ts)return o.getActingTime(1e3*e.ts)},t.getCapitalizedModifierString=function(e){if(e.ts)return o.getActingTime(1e3*e.ts,!1,!1,-1,!1,!0)},t.getCompactDateTimeString=function(e){if(e.ts)return o.getActingTime(1e3*e.ts,!1,!0,-1,!1,!0)},t.getCompactLowerCaseDateTimeString=function(e){if(e.ts)return o.getActingTime(1e3*e.ts,!1,!0,-1,!1,!1)},t.getDateTimeFromUTCString=function(e){if(e){var t=new Date(e);return o.getActingTime(t.getTime(),!1,!0,-1,!1,!0)}},t.update_url_for_annotation=function(e){return e=(e=e.updateQuery({annotation_highlight:"1"})).updateQuery({annotation_region:"1"})},t.update_url_with_user_id=f,t.getVersionHistoryUrl=_,t.redirectToVersionHistory=function(e,t){i.UserActivityLogger.log("web","view_version_history");var r=_(e,t);n.redirect(r.toString())},t.VALID_PREVIEW_TYPES=[s.PreviewType.Archive,s.PreviewType.Audio,s.PreviewType.CloudDoc,s.PreviewType.Excel,s.PreviewType.HTML,s.PreviewType.Image,s.PreviewType.Linkfile,s.PreviewType.Other,s.PreviewType.SsrDoc,s.PreviewType.RawHTML,s.PreviewType.Restricted,s.PreviewType.Video,s.PreviewType.Doc,s.PreviewType.Photo,s.PreviewType.Text],t.isPptExtension=v,t.isWordDocExtension=h,t.isLibreOfficeExtension=g,t.getFileSizeLimit=w,t.filesizeSupported=function(e,t){var r=e.bytes;if(void 0===r)return!0;var n=w(c.getExtension(e),t);return!n||r<=n},t.isEmptyFile=function(e){return 0===e.bytes},t.mapRivieraStatusToErrorType=function(e){var t=u.ErrorType.LoadError;return e===d.RivieraStatus.TooBig?t=u.ErrorType.FileSizeError:e===d.RivieraStatus.PasswordProtected&&(t=u.ErrorType.PasswordProtectedError),t},t.iOSIframeScrollStyles=function(){return{overflow:"auto","-webkit-overflow-scrolling":"touch"}},t.tagCriticalPathContentRequest=function(e,t){return e&&t?m.URI.parse(e).updateQuery({psid:t.id}).toString():e},t.isLimitedPreview=function(e,t){return s.IworkExtensions.includes(c.getExtension(e))&&!e.is_dir&&t===s.PreviewType.Image},t.isSupportedBundleFile=function(e){return s.IworkExtensions.includes(c.getExtension(e))},t.isCloudDocPreview=function(e){return e.preview_type===s.PreviewType.CloudDoc||l.isCloudDocByExtension(c.getExtension(e))}})),define("modules/clean/react/css_timing",["require","exports","modules/clean/react/css","modules/clean/js_client_stopwatch"],(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.requireCssWithComponent=function(e,t,i){void 0===i&&(i=[]);var o=e.displayName||"UnnamedComponent";return r.requireCssWithComponent(e,t,i,{onWillLoadCss:function(){return n.JSStopwatch.startSpan("requireCssWithComponent_"+o)},onCssResponse:function(){return n.JSStopwatch.endSpan("requireCssWithComponent_"+o)}})}})),define("modules/clean/react/comments2/video_annotations/constants",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventTypes={PAUSE:"PAUSE",SEEK_POSITION_AND_PAUSE:"SEEK_POSITION_AND_PAUSE"}})),define("modules/clean/react/comments2/video_annotations/annotation_helper",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),(function(e){e.unitConvertSecondsToDomainObjectTime=function(e){return null!=e?Math.round(100*e):0},e.unitConvertDomainObjectTimeToSeconds=function(e){return null!=e?e/100:0}})(t.VideoAnnotationHelper||(t.VideoAnnotationHelper={}))})),define("modules/clean/react/comments2/video_annotations/video_preview_event_emitter",["require","exports","tslib","eventemitter3"],(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),t.videoPreviewEventEmitter=new n.default})),define("modules/clean/react/file_sidebar/store/file_activity/actions",["require","exports","tslib","modules/clean/react/file_sidebar/store/file_activity/selectors","modules/clean/react/file_sidebar/store/file_activity/api"],(function(e,t,r,n,i){"use strict";function o(e){return{type:"FILE_ACTIVITY|RECEIVE_STREAM_ERROR",error:e}}function a(e,t){return{type:"FILE_ACTIVITY|RECEIVE_FILE_ACTIVITY",activities:e,enabled:t}}function s(e,t){return{type:"FILE_ACTIVITY|LOADING_START",userId:e,file:t}}function l(e){return{type:"FILE_ACTIVITY|LOADING_END",state:e}}function c(){return{type:"FILE_ACTIVITY|RESET_FILE_STATE"}}function u(e,t){return(e.file?e.file.file_id:-1)!==(t.file?t.file.file_id:-1)||e.userId!==t.userId}Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),t.api={create:function(e){return new i.FileActivityStreamApi(e)}},t.receiveStreamError=o,t.receiveFileActivity=a,t.loadingStart=s,t.loadingEnd=l,t.reset=function(){return{type:"FILE_ACTIVITY|RESET"}},t.resetFileState=c;var d=0;t.getActivityStream=function(e,r){return function(i,c){if(u({file:r,userId:e},n.getContext(c()))){var p=t.api.create(e);i({type:"FILE_ACTIVITY|RESET_FILE_STATE"}),i(s(e,r));var m=++d,f=r.file_id;return p.getActivityStream(f).then((function(t){var o=t.enabled,s=t.activity_group;u({file:r,userId:e},n.getContext(c()))||i(a(s,o))})).catch((function(e){m===d&&i(o(e))})).then((function(){m===d&&i(l(n.getState(c())))}))}}}})),define("modules/clean/react/file_sidebar/store/file_activity/api",["require","exports","tslib","external/lodash","modules/clean/api_v2/user_client"],(function(e,t,r,n,i){"use strict";function o(e,t,r,n){return".tag"===t?0===n?["type",r]:r in e?r:[null,r]:r}function a(e,t,r,n){return"string"==typeof r&&/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}Z$/.test(r)?new Date(r):r}function s(e,t,r){return void 0===r&&(r=0),Array.isArray(e)?e.map((function(e){return s(e,t,r+1)})):n.isObject(e)?Object.keys(e).reduce((function(i,o){var a=e[o];if(Array.isArray(a)||n.isObject(a))i[o]=s(a,t,r+1);else{var l=t(e,o,a,r);if(Array.isArray(l)){if(null===l[0])return l[1];i[l[0]]=l[1]}else i[o]=l}return i}),{}):t(null,"",e,r)}function l(e){return s(s(e,o),a)}function c(e){return r.__assign({},l(e.activities[0]),{groupActivities:e.activities.map(l),isGroup:!0})}Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),t.parseActivity=l,t.parseGroupActivity=c;var u=(function(){function e(e){this.userId=e,this.client=new i.UserApiV2Client}return e.prototype.getActivityStream=function(e){return this.client.ns("file_activity_stream").rpc("get_activity_stream",{file_path_or_id:e},{subjectUserId:this.userId}).then((function(e){return{enabled:e.enabled,activity_group:(e.activity_group||[]).map(c)}}))},e})();t.FileActivityStreamApi=u})),define("modules/clean/react/file_viewer/actionable",["require","exports","tslib","react","modules/clean/file_store/utils","modules/clean/react/open_in_app/button","modules/clean/react/share_download/button","modules/clean/react/app_actions/app_actions_menu","modules/clean/react/extensions/data/types","modules/clean/react/file_viewer/open_button/open_button"],(function(e,t,r,n,i,o,a,s,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),t.Actionable=function(e){var t,r=e.allowOpenInApp,u=e.extensionsEnabled,d=e.variant,p=e.location,m=e.sizeClass,f=e.user,_=e.userActionContext;return i.isSharedFile(e.file)?(t=e.file,r&&t.open_in_app_data?n.default.createElement(o.OpenInAppButton,{urls:t.open_in_app_data,userActionContext:_}):n.default.createElement(a.ShareDownloadButton,{copyable:t,importance:d,location:p,sharedLinkInfo:e.sharedLinkInfo,shareToken:e.shareToken,sharePermission:e.sharePermission,user:f})):f?(t=e.file,u?n.default.createElement(s.ExtensionsMenu,{file:t,user:f,showAsButtonIfDownloadOnly:!0,triggerType:l.TriggerType.PrimaryButton,telemetryContext:{surface:"previews"},onPresentInZoom:function(){}}):n.default.createElement(c.OpenButton,{file:t,user:f,justifyRight:!1,location:p,buttonVariant:d,sizeClass:m})):null}})),define("modules/clean/react/file_viewer/app_download_interstitial/file_preview_app_download_interstitial",["require","exports","tslib","react","modules/clean/analytics","modules/clean/react/file_viewer/constants","modules/clean/file_store/utils","modules/clean/react/file_viewer/models","modules/clean/react/previews/constants","modules/clean/web_timing_logger","modules/clean/react/file_viewer/app_download_interstitial/app_download_interstitial"],(function(e,t,r,n,i,o,a,s,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onContinue=function(){t.log(o.UserAction.AppDownloadInterstitialContinue),"function"==typeof t.props.onContinue&&t.props.onContinue()},t.onClose=function(){t.log(o.UserAction.AppDownloadInterstitialClose),"function"==typeof t.props.onClose&&t.props.onClose()},t.onAppDownload=function(){t.log(o.UserAction.AppDownloadInterstitialInstall)},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){c.mark_time_to_interactive(),this.setupLogger(),this.filePreviewSession.markPrimaryEvent(),this.log(o.UserAction.AppDownloadInterstitialView)},t.prototype.componentWillReceiveProps=function(e){e.file.ns_id===this.props.file.ns_id&&e.file.sjid===this.props.file.sjid&&e.fileViewerSession===this.props.fileViewerSession||this.setupLogger(e)},t.prototype.setupLogger=function(e){void 0===e&&(e=this.props);var t=this.props,r=t.file,n=t.fileViewerSession,i=t.previewType,o=t.previewSourceAction,a=void 0===o?l.PreviewSourceAction.Visit:o,c=t.previewSourceContext,u=void 0===c?l.PreviewSourceContext.SharedLinkFile:c;n&&(this.filePreviewSession=new s.FilePreviewSession({file:r,previewType:i,fileViewerSession:n,sourceAction:a,sourceContext:u}))},t.prototype.log=function(e){var t=this.props,r=t.fileViewerSession,n=t.file;this.filePreviewSession&&r&&n.ns_id&&n.sjid&&i.MobileFilePreviewLogger.log(e,r.id,this.filePreviewSession.id,n.ns_id,n.sjid,{context:o.UserActionContext.AppDownloadInterstitial})},t.prototype.render=function(){var e=this.props,t=e.file,i=e.sharedLinkInfo,o=r.__rest(e,["file","sharedLinkInfo"]);return n.default.createElement(u.AppDownloadInterstitial,r.__assign({fileOrFolderName:a.getFilename(t),open_in_app_data:t.open_in_app_data,onContinue:this.onContinue,onAppDownload:this.onAppDownload,ownerName:i.ownerName,ownerTeamName:i.ownerTeamName,onClose:this.onClose},o))},t})((n=r.__importDefault(n)).default.PureComponent);t.FilePreviewAppDownloadInterstitial=d})),define("modules/clean/react/file_viewer/cloud_doc_preview",["require","exports","tslib","react","modules/clean/cloud_docs/event_logging","modules/clean/cloud_docs/types","modules/clean/referrer_cleansing_redirect","modules/clean/file_store/utils","modules/clean/cloud_docs/constants"],(function(e,t,r,n,i,o,a,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),a=r.__importStar(a);var c=(function(e){function t(t){var r=e.call(this,t)||this;return r.logPreviewAction=function(){if(r.props.file.file_id){var e={};r.props.user?i.logUserAction({actionEvent:o.UserActionEventType.PREVIEW,userId:r.props.user.id,docPathOrId:r.props.file.file_id,actionSource:o.UserActionSourceType.WEB}):(r.props.LoggedOutUXGoogleVariant&&(e[l.CLOUD_DOCS_STORMCROW_LOGGED_OUT_UX_GOOGLE]=r.props.LoggedOutUXGoogleVariant||""),r.props.LoggedOutUXPaperVariant&&(e[l.CLOUD_DOCS_STORMCROW_LOGGED_OUT_UX_PAPER]=r.props.LoggedOutUXPaperVariant||""),i.logLoggedOutUserAction({actionEvent:o.UserActionEventType.PREVIEW,userId:0,docPathOrId:r.props.file.file_id,actionSource:o.UserActionSourceType.WEB,extra:e}))}},r.shouldRedirect=!t.showCloudDocPreview&&Boolean(t.cloudDoc.exit_url),r}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.logPreviewAction(),this.shouldRedirect&&a.redirect(this.props.cloudDoc.exit_url)},t.prototype.componentDidUpdate=function(e){this.props.file.file_id!==e.file.file_id&&this.logPreviewAction()},t.prototype.shouldComponentUpdate=function(e){return this.props.file.file_id!==e.file.file_id},t.prototype.render=function(){if(this.shouldRedirect)return null;var e=s.getExtension(this.props.file);return["gdoc","gslides","paper","papert"].includes(e)?this.props.renderPdfPreview(this.props.cloudDoc):["gsheet"].includes(e)?this.props.renderExcelPreview():this.props.renderUnsupportedErrorPreview()},t})(n.default.Component);t.CloudDocPreview=c})),define("modules/clean/react/file_viewer/conversions/conversion_utils",["require","exports","modules/constants/file_viewer"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){return r.PREVIEWS_CONVERSION_EXPERIMENTS};t.isInConversionExperiment=function(){return!["OFF","CONTROL"].includes(r.PREVIEWS_CONVERSION_EXPERIMENTS)},t.shouldShowPersistentHeader=function(){return t.isInConversionExperiment()&&"PERSISTENT_HEADER"===n()},t.shouldShowPersistentFooter=function(){return t.isInConversionExperiment()&&"PERSISTENT_FOOTER"===n()},t.shouldNotShowInitialModal=function(){return t.isInConversionExperiment()&&"NO_MODAL"===n()}})),define("modules/clean/react/file_viewer/conversions/persistent_header",["require","exports","tslib","react","modules/clean/auth/login_or_register/types","modules/clean/react/modal","modules/clean/react/file_viewer/conversions/sticky_header/sticky_header","modules/core/browser","modules/constants/file_viewer","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer/constants","modules/core/i18n","modules/clean/react/file_viewer/logging"],(function(e,t,r,n,i,o,a,s,l,c,u,d,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),s=r.__importStar(s);var f=(function(t){function f(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(f,t),f.prototype.componentDidMount=function(){var e=u.FilePreviewSession.currentSession;c.filePreviewEventEmitter.emit(d.EventType.PersistentHeaderShown,e)},f.prototype.showStickyBannerModal=function(t){var a=this;new Promise((function(t,r){e(["modules/clean/auth/login_or_register/modal"],t,r)})).then(r.__importStar).then((function(e){var r=e.LoginOrRegisterModal;o.Modal.showInstance(n.createElement(r,{downloadAction:null,onCancel:function(){},id:"persistent-header-modal",initialMode:t,kind:i.LoginOrRegisterKind.IMMEDIATE,onAuthenticateSuccess:function(e){a.redirectToCurrentPreview(e)},signup_tag:"persistent-header-modal",showAppleLogin:l.SHOW_APPLE_LOGIN}))}));var s=t===i.Mode.REGISTER?d.UserAction.SignUp:d.UserAction.SignIn;m.logUserAction(s,d.UserActionContext.PersistentHeader)},f.prototype.instanceOfLoggedInUserInfo=function(e){return"locale"in e},f.prototype.redirectToCurrentPreview=function(e){this.props.sharedLinkInfo&&this.instanceOfLoggedInUserInfo(e)&&s.redirect(this.props.sharedLinkInfo.url)},f.prototype.render=function(){var e=this;return n.createElement(a.StickyHeader,{primaryText:p._("Need this file later?"),secondaryText:p._("Quickly find it from any device by saving it to your own Dropbox folder."),primaryButton:{text:p._("Sign Up",{comment:"Dropbox Signup button on a sticky footer"}),buttonProps:{onClick:function(){return e.showStickyBannerModal(i.Mode.REGISTER)}}},secondaryButton:{text:p._("Sign In",{comment:"Dropbox Signin button on a sticky footer"}),buttonProps:{onClick:function(){return e.showStickyBannerModal(i.Mode.LOGIN)}}}})},f})(n.Component);t.PersistentHeader=f})),define("modules/clean/react/file_viewer/conversions/persistent_footer",["require","exports","tslib","react","modules/clean/auth/login_or_register/types","modules/clean/react/modal","modules/core/browser","modules/constants/file_viewer","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer/constants","spectrum/button","spectrum/icon_form","modules/core/i18n","modules/clean/react/css","modules/clean/react/file_viewer/logging"],(function(e,t,r,n,i,o,a,s,l,c,u,d,p,m,f,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),a=r.__importStar(a);var v=(function(t){function f(){var e=null!==t&&t.apply(this,arguments)||this;return e.state={isVisible:!0},e}return r.__extends(f,t),f.prototype.componentDidMount=function(){var e=c.FilePreviewSession.currentSession;l.filePreviewEventEmitter.emit(u.EventType.PersistentFooterShown,e)},f.prototype.showStickyBannerModal=function(t){var a=this;new Promise((function(t,r){e(["modules/clean/auth/login_or_register/modal"],t,r)})).then(r.__importStar).then((function(e){var r=e.LoginOrRegisterModal;o.Modal.showInstance(n.createElement(r,{downloadAction:null,onCancel:function(){},id:"persistent-footer-modal",initialMode:t,kind:i.LoginOrRegisterKind.IMMEDIATE,onAuthenticateSuccess:function(e){a.redirectToCurrentPreview(e)},signup_tag:"persistent-footer-modal",showAppleLogin:s.SHOW_APPLE_LOGIN}))}));var l=t===i.Mode.REGISTER?u.UserAction.SignUp:u.UserAction.SignIn;_.logUserAction(l,u.UserActionContext.PersistentFooter)},f.prototype.instanceOfLoggedInUserInfo=function(e){return"locale"in e},f.prototype.redirectToCurrentPreview=function(e){this.props.sharedLinkInfo&&this.instanceOfLoggedInUserInfo(e)&&a.redirect(this.props.sharedLinkInfo.url)},f.prototype.dismissFooter=function(){this.setState({isVisible:!1},(function(){_.logUserAction(u.UserAction.Dismiss,u.UserActionContext.PersistentFooter)}))},f.prototype.render=function(){var e=this;return this.state.isVisible?n.createElement("div",{className:"persistent-footer-container"},n.createElement("div",{className:"persistent-footer"},n.createElement("div",{className:"persistent-footer__close-button"},n.createElement(d.Button,{"aria-label":"Close Footer",onClick:function(){return e.dismissFooter()},tagName:"a",variant:"styleless"},n.createElement("span",{className:"react-title-bar__close-content"},n.createElement(p.IconForm,{name:"cancel"})))),n.createElement("div",{className:"persistent-footer__primary-text"},m._("Need this file later?")," "),n.createElement("div",{className:"persistent-footer__secondary-text"},m._("Quickly find it from any device by saving it to your own Dropbox folder.")," "),n.createElement("div",{className:"persistent-footer__footer-ctas"},n.createElement(d.Button,{className:"persistent-footer__signup-button",onClick:function(){return e.showStickyBannerModal(i.Mode.REGISTER)}},m._("Sign Up",{comment:"Dropbox Signup button on a sticky footer"})),n.createElement(d.Button,{className:"persistent-footer__login-button",onClick:function(){return e.showStickyBannerModal(i.Mode.LOGIN)},variant:"borderless"},m._("Sign In",{comment:"Dropbox Signin button on a sticky footer"}))))):null},f})(n.Component);t.PersistentFooter=f.requireCssWithComponent(v,["/static/css/file_viewer/persistent_footer-vflK75WYP.css"])})),define("modules/clean/react/file_viewer/conversions/sticky_header/sticky_header",["require","exports","tslib","react","spectrum/button","modules/clean/react/css","modules/clean/react/maestro_nav/shared_code/dropbox_logo"],(function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.primaryText,o=e.secondaryText,s=e.primaryButton,l=e.secondaryButton;return n.createElement("div",{className:"sticky-header"},n.createElement(a.DropboxLogo,{color:"white",className:"sticky-header__icon-svg"}),n.createElement("div",{className:"sticky-header__text-container"},n.createElement("div",{className:"sticky-header__primary-text"},t," "),o&&n.createElement("div",{className:"sticky-header__secondary-text"},o," ")),n.createElement("div",{className:"sticky-header__buttons"},n.createElement(i.Button,r.__assign({className:"sticky-header__primary-button"},s.buttonProps),s.text),l&&n.createElement(i.Button,r.__assign({className:"sticky-header__secondary-button",variant:"borderless"},l.buttonProps),l.text)))},t})((n=r.__importStar(n)).Component);t.StickyHeader=o.requireCssWithComponent(s,["/static/css/file_viewer/sticky_header-vfl9CA3j9.css"])})),define("modules/clean/react/file_viewer/exp_file_viewer_upsell_banner",["require","exports","tslib","react","modules/clean/react/css","modules/constants/payments","modules/core/i18n","modules/clean/react_format"],(function(e,t,r,n,i,o,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),o=r.__importStar(o);var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){var e=o.OUT_OF_SPACE_URL+"?oqa=oq_fp";return n.default.createElement("div",{className:"fileviewer-upsell-banner"},s.reactFormat(a._("Get more space to add more files to your Dropbox. <a>Upgrade now.</a>"),{a:n.default.createElement("a",{href:e})}))},t})(n.default.Component);t.ExpFileViewerUpsellBannerV2=i.requireCssWithComponent(l,["/static/css/exp_file_preview_upsell-vfli2_OuA.css"])})),define("modules/clean/react/file_viewer/file_preview",["require","exports","tslib","classnames","react","external/lodash","file-viewer/core","modules/clean/previews/constants","modules/clean/previews/data/preview_type_util","modules/clean/previews/util","modules/clean/previews/util","modules/clean/react/async/loadable","modules/clean/cloud_docs/shared_components/routing","modules/clean/react/file_viewer/cloud_doc_preview","modules/clean/file_store/utils","modules/clean/react/file_viewer/utils","modules/clean/react/previews/constants","file-viewer/core","modules/clean/react/previews/loading_indicator","modules/clean/react/previews/error/preview_error","modules/clean/react/previews/preview_html","modules/clean/react/previews/preview_image","modules/clean/react/previews/preview_linkfile","modules/clean/react/previews/video/preview_video","modules/clean/react/previews/preview_pdf_loadable","modules/clean/react/previews/preview_ppt_loadable","modules/clean/react/previews/archive/preview_archive_loadable","modules/clean/sharing/constants","modules/core/i18n","modules/core/browser","modules/clean/react/file_viewer/file_preview_logging_manager","modules/clean/redux/types","modules/clean/previews/data/util","modules/clean/react/snackbar"],(function(e,t,r,n,i,o,a,s,l,c,u,d,p,m,f,_,v,h,g,w,y,b,E,S,k,T,C,P,x,A,M,I,F,O){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),i=r.__importDefault(i),o=r.__importStar(o),l=r.__importStar(l),c=r.__importStar(c),A=r.__importStar(A);var D=d.Loadable({loader:function(){return new Promise((function(t,r){e(["modules/clean/react/previews/preview_image_zoom"],t,r)})).then(r.__importStar).then((function(e){return e.PreviewImageZoom}))}}),R=d.Loadable({loader:function(){return new Promise((function(t,r){e(["modules/clean/react/previews/limited_preview_message"],t,r)})).then(r.__importStar).then((function(e){return e.LimitedPreviewMessage}))}}),L=A.get_uri().getQuery(),N=L.forceRivieraException,U=L.forceTestPdf,W=L.forceTestExcelHtml,V=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.triggerDynamicRoutingModalCheck()},t.prototype.componentDidUpdate=function(e){var t=e.user,r=e.file,n=this.props,i=n.user,a=n.file;o.isEqual(r,a)&&o.isEqual(t,i)||this.triggerDynamicRoutingModalCheck()},t.prototype.triggerDynamicRoutingModalCheck=function(){var e=this.props,t=e.user,r=e.file,n=e.file.file_id;t&&n&&!this.isViewOnly()&&p.maybeShowDynamicRoutingModal(t,r,f.getExtension(r))},t.prototype.isViewOnly=function(){var e=!1;return this.props.hasOwnProperty("shareToken")&&void 0!==this.props.shareToken&&(e=this.props.shareToken.linkType===P.SharedLinkType.Shmodel),e},t.prototype.render=function(){var e=this.props,t=e.doc,n=t.autoprint_url,o=t.image_url_tmpl,s=t.refresh_url,l=void 0===s?"":s,c=t.text_url_tmpl,d=e.file,p=e.filePreviewSession,m=e.invalidateFrameMessenger,_=e.isFullscreen,v=e.isSidebarOpen,h=e.location,g=e.mode,w=void 0===g?a.FileViewerMode.Default:g,y=e.renderUnsupportedErrorPreview,b=e.setRenderStatusSuccess,E=e.sharePermission,S=e.sidebar,C=e.sizeClass,P=e.triggerError,x=e.user;if(!o||!c)return y();var A=f.getExtension(d),M={autoprintUrl:n,currentMode:{sidebar:S,mode:w},revisionId:F.buildRevisionId(d.ns_id,d.sjid),fileExtension:A,filePreviewSession:p,imageUrlTmpl:o,isArchiveFile:!1,isFullscreen:_,isSidebarOpen:v,onError:P,useCanned:!!U,refreshUrl:l,location:h,sharePermission:E,sizeClass:C,textUrlTmpl:c,invalidateFrameMessenger:m,setRenderStatusSuccess:b,user:x};return u.isPptExtension(A)?i.default.createElement(T.PreviewPPTLoadable,r.__assign({},M)):i.default.createElement(k.PreviewPDFLoadable,r.__assign({},M))},t})(i.default.Component),B=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={hasError:!1},t.shouldDisableDownload=function(){return!!t.props.sharePermission&&!t.props.sharePermission.canViewContextMenuRoles.length},t.onContextMenu=function(e){t.shouldDisableDownload()&&e.preventDefault()},t.onCopy=function(e){t.props.sharePermission&&0===t.props.sharePermission.canDownloadRoles.length&&e.preventDefault()},t.renderExcelPreview=function(){var e=t.props.previewApiData.data.preview_url;return e?i.default.createElement(y.PreviewHTML,r.__assign({src:e,isExcel:!0,forceRivieraException:Array.isArray(N)?N[0]:"",forceTestExcelHtml:!!W,usesFrameMessenger:!0},t.getCommonHtmlPreviewProps())):t.renderUnsupportedErrorPreview()},t.renderPdfPreview=function(e){return i.default.createElement(V,r.__assign({},t.props,{doc:e,renderUnsupportedErrorPreview:t.renderUnsupportedErrorPreview,triggerError:t.triggerError}))},t.renderUnsupportedErrorPreview=function(){return t.renderErrorPreview(v.ErrorType.SupportError)},t.showLoadingIndicator=function(){return i.default.createElement(g.LoadingIndicator,{className:"loading-indicator"})},t.getErrorMessage=function(e,t,r){if(r&&"sketch"===f.getExtension(r)&&e===v.ErrorType.LoadError&&t===h.RivieraStatus.UnsupportedFormat)return x._("This file can’t be previewed. Previews are               only available for files created in Sketch v43 and up.")},t.triggerError=function(e,r){t.setState({hasError:!0,errorType:e,rivieraStatusCode:r})},t}return r.__extends(t,e),t.prototype.componentWillReceiveProps=function(e){o.isEqual(e.file,this.props.file)||this.setState({hasError:!1,errorType:void 0})},t.prototype.componentDidMount=function(){if(s.PreviewType.Excel===l.getPreviewType(this.props.previewApiData.data)){var e=this.props.file,t=f.getExtension(e);this.props.user&&e.file_id&&!this.isViewOnly()&&p.maybeShowDynamicRoutingModal(this.props.user,e,t)}window.setTimeout(_.cleanupPrerenderPreview)},t.prototype.isViewOnly=function(){var e=!1;return this.props.hasOwnProperty("shareToken")&&void 0!==this.props.shareToken&&(e=this.props.shareToken.linkType===P.SharedLinkType.Shmodel),e},t.prototype.renderImagePreview=function(e){var t=this.props,n=t.file,o=t.mode,l=t.sidebar,u=f.getExtension(n),d={mode:o||a.FileViewerMode.Default,sidebar:l};if(this.props.isFullscreen)return i.default.createElement(D,{currentMode:d,thumbnailUrlTmpl:e.thumbnail_url_tmpl,fileCount:this.props.count,fileIndex:this.props.index,onError:this.triggerError,onFlipNext:this.props.onNext,onFlipPrevious:this.props.onPrevious,filePreviewSession:this.props.filePreviewSession,contextMenuDisabled:this.shouldDisableDownload(),fileExtension:u,fileId:this.props.file.file_id||"",fileName:f.getFilename(this.props.file),setRenderStatusSuccess:this.props.setRenderStatusSuccess});var p={currentMode:d,"preview-url":e.thumbnail_url_tmpl,"file-extension":u,isFullscreen:this.props.isFullscreen,shouldDisplayToolbar:this.props.shouldDisplayToolbar&&!c.isLimitedPreview(n,s.PreviewType.Image),index:this.props.index,count:this.props.count,onPrevious:this.props.onPrevious,onError:this.triggerError,onNext:this.props.onNext,filePreviewSession:this.props.filePreviewSession,contextMenuDisabled:this.shouldDisableDownload(),nsId:this.props.file.ns_id,sjId:this.props.file.sjid,fileName:f.getFilename(this.props.file),sizeClass:this.props.sizeClass,setRenderStatusSuccess:this.props.setRenderStatusSuccess,sharePermission:this.props.sharePermission};return i.default.createElement(b.PreviewImage,r.__assign({},p))},Object.defineProperty(t.prototype,"shouldShowActionables",{get:function(){return this.props.areActionablesEnabled&&!f.isArchiveFile(this.props.file)},enumerable:!0,configurable:!0}),t.prototype.renderVideoPreview=function(e){var t=this.props,r=t.file,n=t.hidePageChrome;return i.default.createElement(S.PreviewVideo,{title:f.getFilenameWithoutExtension(r),fileExtension:f.getExtension(r),previewUrl:e.transcode_url,separateResolutionUrls:e.transcode_urls_separate_resolutions,thumbnailUrlTmpl:e.poster_url_tmpl,videoMetadataUrl:e.metadata_url,videoContainer:e.container,shouldFocusOnReady:this.props.shouldFocusOnReady,filePreviewSession:this.props.filePreviewSession,onError:this.triggerError,sourceContext:this.props.sourceContext,vttThumbnailsUrl:e.thumb_scrubber_vtt_url,setRenderStatusSuccess:this.props.setRenderStatusSuccess,user:this.props.user,hidePageChrome:n})},t.prototype.renderLinkfilePreview=function(e){var t=this.props.file,r={url:e.url,authenticated:!!e.authenticated};return i.default.createElement(E.PreviewLinkfile,{filename:f.getFilename(t),data:r,source:e.authenticated?"browse":"sharedLink",filePreviewSession:this.props.filePreviewSession,setRenderStatusSuccess:this.props.setRenderStatusSuccess})},t.prototype.getCommonHtmlPreviewProps=function(){var e=this.props.file,t=f.getExtension(e);return{count:this.props.count,fileExtension:t,filePreviewSession:this.props.filePreviewSession,filename:f.getFilename(e),index:this.props.index,isFullscreen:this.props.isFullscreen,onClickNext:this.props.onNext,onClickPrevious:this.props.onPrevious,onError:this.triggerError,setRenderStatusSuccess:this.props.setRenderStatusSuccess,sharePermission:this.props.sharePermission,sizeClass:this.props.sizeClass}},t.prototype.renderHtmlifiedPreview=function(e){var t=e.htmlified_link,n=e.uses_frame_messenger;return t?i.default.createElement(y.PreviewHTML,r.__assign({src:t,isExcel:!1,usesFrameMessenger:n},this.getCommonHtmlPreviewProps())):this.renderUnsupportedErrorPreview()},t.prototype.renderRawHtmlPreview=function(){var e=this.props.previewApiData.data.preview_url;return e?i.default.createElement(y.PreviewHTML,r.__assign({src:e,isExcel:!1,usesFrameMessenger:!1},this.getCommonHtmlPreviewProps())):this.renderUnsupportedErrorPreview()},t.prototype.renderAudioPreview=function(e){var t=this.props.file;return i.default.createElement(S.PreviewVideo,{title:f.getFilenameWithoutExtension(t),fileExtension:f.getExtension(t),previewUrl:e.transcode_url,videoContainer:e.container,filePreviewSession:this.props.filePreviewSession,shouldFocusOnReady:this.props.shouldFocusOnReady,onError:this.triggerError,setRenderStatusSuccess:this.props.setRenderStatusSuccess,sourceContext:this.props.sourceContext,isAudio:!0,bytes:t.bytes,waveformUrl:e.waveform_url,user:this.props.user})},t.prototype.renderArchivePreview=function(){return i.default.createElement(C.PreviewArchiveLoadable,{rootFile:this.props.file,previewUrl:this.props.previewApiData.data.preview_url,fileSubpath:this.props.fileSubpath,filePreviewSession:this.props.filePreviewSession,onError:this.triggerError,setRenderStatusSuccess:this.props.setRenderStatusSuccess,sharedLinkUrl:this.props.sharedLinkUrl,user:this.props.user})},t.prototype.renderCloudDocPreview=function(e){return i.default.createElement(m.CloudDocPreview,{file:this.props.file,user:this.props.user,cloudDoc:e,showCloudDocPreview:this.props.showCloudDocPreview,renderExcelPreview:this.renderExcelPreview,renderPdfPreview:this.renderPdfPreview,renderUnsupportedErrorPreview:this.renderUnsupportedErrorPreview,LoggedOutUXGoogleVariant:this.props.LoggedOutUXGoogleVariant,LoggedOutUXPaperVariant:this.props.LoggedOutUXPaperVariant})},t.prototype.renderErrorPreview=function(e){var t=this.state.rivieraStatusCode,r=this.props,n=r.count,o=r.extensionsEnabled,c=r.file,u=r.previewApiData,d=r.filePreviewSession,p=r.index,m=r.isFullscreen,_=r.isMobileUserAgent,h=r.maxFilenameEmLength,g=r.mode,y=r.onNext,b=r.onPrevious,E=r.sharedLinkInfo,S=r.sharePermission,k=r.shareToken,T=r.user,C=l.getPreviewType(u.data),P=this.props.shouldDisplayToolbar&&!f.isArchiveFile(c)&&C===s.PreviewType.Image,x=e;return g===a.FileViewerMode.Watermarking&&(O.Snackbar.close(),x=v.ErrorType.WatermarkingError),i.default.createElement(w.PreviewError,{file:c,extensionsEnabled:o,preview:u.data,maxFilenameEmLength:h,filePreviewSession:d,errorType:x,user:T,areActionablesEnabled:this.shouldShowActionables,sharedLinkInfo:E,shareToken:k,sharePermission:S,shouldDisplayToolbar:P,index:p,isFullscreen:m,isMobileUserAgent:_,count:n,onPrevious:b,onNext:y,message:this.getErrorMessage(e,t,c),sizeClass:this.props.sizeClass})},t.prototype.getPreviewTypeWhitelist=function(){return this.props.previewTypeWhitelist||c.VALID_PREVIEW_TYPES},t.prototype.viewedByOwner=function(){return this.props.user&&this.props.user.home_ns_id===this.props.file.ns_id},t.prototype.choosePreview=function(){var e=this.props,t=e.file,n=e.previewApiData,o=this.getPreviewTypeWhitelist(),a=this.validateFile(t,n);if(a)return a;if(n.status===I.ApiClientStatus.Request)return this.showLoadingIndicator();if(n.status===I.ApiClientStatus.Error)return this.renderErrorPreview(v.ErrorType.ExtensionError);if(!n.data||!n.data.content)return this.renderErrorPreview(v.ErrorType.ExtensionError);var u=n.data.content,d=l.getPreviewType(n.data);if(c.isEmptyFile(t)&&d!==s.PreviewType.CloudDoc)return this.renderErrorPreview(v.ErrorType.EmptyFileError);if(!(null==o||o.includes(d)))return this.renderErrorPreview(v.ErrorType.ExtensionError);if(d===s.PreviewType.Restricted)return this.viewedByOwner()?this.renderErrorPreview(v.ErrorType.UpsellError):this.renderErrorPreview(v.ErrorType.ExtensionError);switch(d){case s.PreviewType.Video:return this.renderVideoPreview(u);case s.PreviewType.Audio:return this.renderAudioPreview(u);case s.PreviewType.Archive:return this.renderArchivePreview();case s.PreviewType.Image:return this.renderImagePreview(u);case s.PreviewType.SsrDoc:return i.default.createElement(V,r.__assign({},this.props,{doc:u,renderUnsupportedErrorPreview:this.renderUnsupportedErrorPreview,triggerError:this.triggerError}));case s.PreviewType.Linkfile:return this.renderLinkfilePreview(u);case s.PreviewType.CloudDoc:return this.renderCloudDocPreview(u);case s.PreviewType.Excel:return this.renderExcelPreview();case s.PreviewType.RawHTML:return this.renderRawHtmlPreview();case s.PreviewType.HTML:return this.renderHtmlifiedPreview(u)}},t.prototype.validateFile=function(e,t){return e.is_dir&&!c.isSupportedBundleFile(e)?this.renderErrorPreview(v.ErrorType.ExtensionError):null!=e.ns_id||f.isArchiveFile(e)?f.isSymLink(e)?this.renderErrorPreview(v.ErrorType.SymLinkError):t?c.filesizeSupported(e,l.getPreviewType(t.data))?void 0:this.renderErrorPreview(v.ErrorType.FileSizeError):this.renderErrorPreview(v.ErrorType.ExtensionError):this.renderErrorPreview(v.ErrorType.PendingUploadError)},t.prototype.render=function(){var e=this.props,t=e.file,r=e.previewApiData,o=e.sharedLinkInfo,a=e.shareToken,s=e.sharePermission,u=e.sizeClass,d=e.user,p=this.state,m=p.errorType;return p.hasError?this.renderErrorPreview(m):i.default.createElement("div",{className:n.default({"flex-preview-container":!0,"no-download":s&&0===s.canViewContextMenuRoles.length}),onContextMenu:this.onContextMenu,onCopy:this.onCopy},f.isArchiveFile(t)?null:i.default.createElement(M.FilePreviewPaasLoggerManager,{file:t}),this.choosePreview(),r&&c.isLimitedPreview(t,l.getPreviewType(r.data))?i.default.createElement(R,{extension:f.getExtension(t),file:t,sharedLinkInfo:o,shareToken:a,sharePermission:s,shouldShowActionables:this.shouldShowActionables,sizeClass:u,user:d}):null)},t.defaultProps={areActionablesEnabled:!0,isFullscreen:!1,sharePermission:null,setRenderStatusSuccess:o.noop,user:null},t})(i.default.Component);t.FilePreview=B,t.FilePreviewWithLogging=function(e){var t=e.file,n=e.sourceAction,o=e.sourceContext,a=e.previewApiData;return i.default.createElement(M.FilePreviewSessionManager,{file:t,previewType:l.getPreviewType(a.data),sourceAction:n,sourceContext:o,render:function(t){return i.default.createElement(B,r.__assign({},e,{filePreviewSession:t}))}})}})),define("modules/clean/react/file_viewer/file_preview_logging_manager",["require","exports","tslib","react","modules/clean/loggers/file_preview_logger","modules/clean/loggers/file_viewer_logger","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/models","modules/clean/react/previews/constants","modules/clean/react/previews/frame_messenger_host","external/lodash"],(function(e,t,r,n,i,o,a,s,l,c,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),o=r.__importStar(o),d=r.__importStar(d);var p=(function(e){function t(t){var r=e.call(this,t)||this;r.setUpFilePreviewLogger=function(e){r.teardownFilePreviewLogger(),r.filePreviewTimelineLogger=new i.FilePreviewTimelineLogger(e),r.filePreviewTimelineLogger.listenTo(s.filePreviewEventEmitter),r.filePreviewUserActionLogger=new i.FilePreviewUserActionLogger,r.filePreviewUserActionLogger.listenTo(s.filePreviewEventEmitter),r.filePreviewModeLogger=new i.FilePreviewModeLogger,r.filePreviewModeLogger.listenTo(s.filePreviewEventEmitter),r.filePreviewSidebarLogger=new i.FilePreviewSidebarLogger,r.filePreviewSidebarLogger.listenTo(s.filePreviewEventEmitter),r.filePreviewUpsellLogger=new i.FilePreviewUpsellLogger,r.filePreviewUpsellLogger.listenTo(s.filePreviewEventEmitter),r.filePreviewConversionLogger=new i.FilePreviewConversionLogger,r.filePreviewConversionLogger.listenTo(s.filePreviewEventEmitter)},r.teardownFilePreviewLogger=function(){null!=r.filePreviewTimelineLogger&&r.filePreviewTimelineLogger.unlistenTo(s.filePreviewEventEmitter),null!=r.filePreviewUserActionLogger&&r.filePreviewUserActionLogger.unlistenTo(s.filePreviewEventEmitter),null!=r.filePreviewModeLogger&&r.filePreviewModeLogger.unlistenTo(s.filePreviewEventEmitter),null!=r.filePreviewSidebarLogger&&r.filePreviewSidebarLogger.unlistenTo(s.filePreviewEventEmitter),null!=r.filePreviewUpsellLogger&&r.filePreviewUpsellLogger.unlistenTo(s.filePreviewEventEmitter),null!=r.filePreviewConversionLogger&&r.filePreviewConversionLogger.unlistenTo(s.filePreviewEventEmitter)},r.logPreviewSessionEnded=function(e){void 0===e&&(e=c.PreviewSessionEndReason.Unknown);var t={min_page_width_ratio:"",max_page_width_ratio:"",session_end_reason:e};r.state.filePreviewSession.recordEvent(a.EventType.FilePreviewSessionEnded,t)},r.getNewFilePreviewSession=function(e){var t=e.file,n=e.previewType,i=e.sourceAction,o=e.sourceContext,s=new l.FilePreviewSession({file:t,previewType:n,fileViewerSession:l.FileViewerSession.currentSession,sourceAction:i,sourceContext:o});return l.FilePreviewSession.currentSession=s,r.setUpFilePreviewLogger(s.id),s.recordEvent(a.EventType.FilePreviewAttemptStarted,{window_width:""+window.innerWidth,window_height:""+window.innerHeight}),s},r.windowCloseHandler=function(){r.logPreviewSessionEnded(c.PreviewSessionEndReason.BeforeUnload)};var n=r.getNewFilePreviewSession(r.props);return r.state={filePreviewSession:n},r}return r.__extends(t,e),t.prototype.componentDidMount=function(){window.addEventListener("beforeunload",this.windowCloseHandler)},t.prototype.componentWillUnmount=function(){this.logPreviewSessionEnded(c.PreviewSessionEndReason.Unmount),this.teardownFilePreviewLogger(),window.removeEventListener("beforeunload",this.windowCloseHandler)},t.prototype.componentWillReceiveProps=function(e){if(!d.isEqual(e.file,this.props.file)){this.logPreviewSessionEnded(c.PreviewSessionEndReason.NewFile);var t=this.getNewFilePreviewSession(e);this.setState({filePreviewSession:t})}},t.prototype.render=function(){return this.props.render(this.state.filePreviewSession)},t})(n.default.Component);t.FilePreviewSessionManager=p;var m=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onFrameMessage=function(e){var r=t.props.file,n=e.action,i=e.parameters;"pagerendered"===n&&o.logPageRendered(r,i)},t.startLogger=function(){t.frameMessenger=new u.PreviewFrameMessengerHost,t.frameMessenger.configureChildMessaging(".react-file-viewer__preview iframe",t.onFrameMessage,["pagerendered"]),t.frameMessenger.startListening()},t.stopLogger=function(){t.frameMessenger.stopListening()},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.startLogger()},t.prototype.componentWillUnmount=function(){this.stopLogger()},t.prototype.render=function(){return null},t})(n.default.Component);t.FilePreviewPaasLoggerManager=m})),define("modules/clean/react/file_viewer/file_viewer",["require","exports","tslib","classnames","keymaster","react","external/lodash","react-redux","modules/clean/react/comments2/components/mobile_web_comments","modules/clean/analytics","modules/clean/loggers/file_viewer_logger","modules/clean/loggers/workflows_logger","modules/clean/previews/constants","modules/clean/previews/data/preview_type_util","file-viewer/core","modules/clean/react/file_sidebar/file_sidebar_provider","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/app_download_interstitial/file_preview_app_download_interstitial","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/data/store","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/file_viewer/exp_file_viewer_upsell_banner","modules/clean/react/file_viewer/file_preview","modules/clean/react/file_viewer/flippable_controls","modules/clean/react/file_viewer/location_utils","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer_sidebar/sidebar","modules/clean/react/watermarking/utils","modules/clean/previews/data/preview_type_util","modules/clean/react/keyboard_binding/keyboard_binding_provider","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/keyboard_binding/keyboard_binding","modules/clean/keycode","modules/clean/react/location/with_location","modules/clean/react/modal","modules/clean/react/open_in_app/banner","modules/clean/react/previews/constants","modules/clean/react/previews/fidelity_survey/fidelity_survey","modules/clean/react/size_class/constants","modules/clean/react/size_class/size_class","modules/clean/viewer","modules/clean/web_timing_logger","modules/constants/python","modules/core/browser","modules/core/browser_detection","modules/core/dom","modules/core/i18n","modules/clean/react/file_viewer/data/selectors","modules/clean/previews/data/selectors","modules/clean/react/css","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/utils","modules/clean/file_store/utils","modules/clean/react/retrieval_success_banner/constants","modules/clean/react/retrieval_success_banner/retrieval_success_filesview_banner","modules/clean/sharing/constants","modules/clean/react/file_viewer_sidebar/data_managers/async_commenting_data_manager","modules/clean/react/file_viewer_sidebar/data_managers/async_activity_data_manager","modules/clean/react/workflows/i18n/with_translations","premium-workflows/components/trial/banner","modules/clean/abuse/async_report_flag","modules/clean/react/file_viewer_titlebar/titlebar","file-viewer/core/data/modes/types","modules/clean/react/file_viewer/prompt/loadable_prompt","modules/clean/react/file_viewer/mode_manager","modules/clean/react/file_viewer_sidebar/buttons/more_dropdown","modules/clean/react/file_viewer_titlebar/edit_mode_titlebar","modules/clean/react/file_viewer/conversions/conversion_utils","modules/clean/react/file_viewer/conversions/persistent_header","modules/clean/react/file_viewer/conversions/persistent_footer"],(function(e,t,r,n,i,o,a,s,l,c,u,d,p,m,f,_,v,h,g,w,y,b,E,S,k,T,C,P,x,A,M,I,F,O,D,R,L,N,U,W,V,B,j,q,K,H,z,G,Y,X,Z,Q,J,$,ee,te,re,ne,ie,oe,ae,se,le,ce,ue,de,pe,me,fe,_e){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),i=r.__importDefault(i),o=r.__importDefault(o),a=r.__importStar(a),u=r.__importStar(u),m=r.__importStar(m),B=r.__importStar(B),j=r.__importStar(j),q=r.__importStar(q),H=r.__importStar(H);var ve="",he="",ge=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={modeClassnames:""},t.previewSourceAction=t.props.initialPreviewSourceAction,t.previewSourceContext=t.props.initialPreviewSourceContext,t.fetchControllerMode=function(){var e=t.props,r=e.file,n=e.sharedLinkInfo,i=e.user,o=e.sizeClass;t.props.fetchControllerModeAction({path:r.fq_path,shared_link_url:n&&n.url},i,o)},t.resetControllerMode=function(){t.props.changeMode(f.FileViewerMode.Default)},t.setupKeymaster=function(){ve=i.default.getScope(),i.default.setScope("fileviewer")},t.cleanupKeymaster=function(){i.default.clearScope("fileviewer"),i.default.setScope(ve)},t.shouldShowOpenInAppBanner=function(){var e=t.props,r=e.hidePageChrome,n=e.isMobileUserAgent;return!r&&(n||K.is_mobile_or_tablet())},t.openInAppBannerOnClick=function(){v.logUserAction(Z.UserAction.OpenInApp,Z.UserActionContext.OpenInAppBanner)},t.renderOverflowMenuFnFactory=function(e){return function(){var r=t.props,n=r.file,i=r.sharedLinkInfo,a=r.isVersionHistoryMode,s=r.shareToken,l=r.sharePermission;if(i){if(n&&s&&l)return o.default.createElement(de.AsyncSharedFileMoreDropdown,{user:t.props.user,file:n,sizeClass:t.props.sizeClass,sharedLinkInfo:i,shouldDisplayActionButtons:!t.isViewingFileSubpath,shareToken:s,sharePermission:l,direction:e})}else{if(a)return null;if(t.props.user&&n)return o.default.createElement(de.AsyncMountedFileMoreDropdown,{user:t.props.user,file:n,sizeClass:t.props.sizeClass,direction:e})}return null}},t.renderManagers=function(){var e=null==t.props.file.ns_id;return o.default.createElement(o.default.Fragment,null,o.default.createElement(ue.ModeManager,{isViewingFileSubpath:t.isViewingFileSubpath}),o.default.createElement(re.AsyncCommentingDataManager,{currentFile:t.props.file,isVersionHistoryMode:!!t.props.isVersionHistoryMode,sharedLinkInfo:t.props.sharedLinkInfo,user:t.props.user}),e?null:o.default.createElement(ne.AsyncActivityDataManager,{file:t.props.file,isVersionHistoryMode:!!t.props.isVersionHistoryMode,user:t.props.user}))},t.onTrialBannerClicked=function(){d.logWorkflowsEvent(d.WorkflowsEvent.WatermarkUpsellHeaderButtonClicked,P.getWatermarkMilestone(t.props.user)),q.redirect("/buy?_tk=watermarking_header_upsell")},t.onInterstitialClose=function(){t.props.onAppDownloadInterstitialDismissed()},t.onInterstitialContinue=function(){t.props.onAppDownloadInterstitialDismissed()},t.getKeyboardBindings=a.memoize((function(e){var r=e.isFullscreen,n=e.isWatermarkingMode;return r?[I.hydrateKeyboardBinding({keyboardEventCriteria:{which:F.KeyCode.ESC},callback:function(){return y.exitFullScreen(Z.UserActionContext.Keyboard)}})]:n?[I.hydrateKeyboardBinding({keyboardEventCriteria:{which:F.KeyCode.ESC},callback:function(){return t.props.changeMode(f.FileViewerMode.Documentation)}})]:[I.hydrateKeyboardBinding({keyboardEventCriteria:{which:F.KeyCode.F},callback:function(){return y.enterFullScreen(Z.UserActionContext.Keyboard)}}),I.hydrateKeyboardBinding({keyboardEventCriteria:{which:F.KeyCode.ESC},callback:function(e){t.shouldIgnoreEscape(e)||null==t.props.onCloseViewer||t.props.onCloseViewer()}})]})),t}return r.__extends(t,e),t.prototype.componentWillMount=function(){this.setUpLogging()},t.prototype.componentDidMount=function(){var e=this.props,t=e.file,r=e.fetchShowOverQuotaUpsell,n=e.onComponentDidMount,i=e.user;null!=n&&n(),this.setDocumentTitle(J.getFilename(t),!0),H.scroll_lock_document(),this.logView(),r(i),i&&this.previewType&&!this.props.hidePageChrome&&this.props.fetchBestCampaignsAction(i,this.previewType),this.fetchControllerMode()},t.prototype.componentWillUpdate=function(e){var t=e.file;t!==this.props.file&&(this.setDocumentTitle(J.getFilename(t)),this.previewSourceAction=L.PreviewSourceAction.Click,this.previewSourceContext=L.PreviewSourceContext.FileViewer),i.default.setScope("fileviewer"),e.mode!==this.props.mode&&this.setState({modeClassnames:"state-"+this.props.mode+"-out state-"+e.mode+"-in"})},t.prototype.componentDidUpdate=function(e){J.areFilesEqual(e.file,this.props.file)||this.logView(),e.previewApiData&&x.isImage(e.previewApiData.data)&&this.props.previewApiData&&!x.isImage(this.props.previewApiData.data)&&y.exitFullScreen()},t.prototype.componentWillUnmount=function(){this.unsetDocumentTitle(),H.scroll_unlock_document(),null!=this.props.onComponentWillUnmount&&this.props.onComponentWillUnmount(),D.Modal.close(),this.resetControllerMode()},Object.defineProperty(t.prototype,"fileSubpath",{get:function(){return k.getFileSubpath(this.props.location)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"previewType",{get:function(){return this.props.previewApiData&&m.getPreviewType(this.props.previewApiData.data)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isViewingFileSubpath",{get:function(){return m.isArchive(this.props.previewApiData.data)&&!!this.fileSubpath},enumerable:!0,configurable:!0}),t.prototype.shouldSuppressPassInfo=function(){return null==this.props.file.ns_id},t.prototype.setUpLogging=function(){if(T.FileViewerSession.currentSession=new T.FileViewerSession,this.props.fileViewTarget===j.FileViewTargetType.SHARED_CONTENT_LINK){var e=B.start_time(),t=(new Date).getTime(),r=te.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE;this.props.user&&c.ShareTibEventLogger.log(this.props.user.id,"PREVIEW_RENDER",r,{timing:t-e,containing_ns_id:this.props.file.ns_id,sjid:this.props.file.sjid})}},t.prototype.isDownloadDisabled=function(){return!(!this.props.sharePermission||!this.props.sharePermission.canDownloadRoles)&&0===this.props.sharePermission.canDownloadRoles.length},t.prototype.shouldShowAppDownloadInterstitial=function(){return!this.props.appDownloadInterstitialDismissed&&this.props.file.open_in_app_data},t.prototype.shouldIgnoreEscape=function(e){var t=document.querySelector(".vjs-fullscreen");return H.focus_in_input()||H.is_input(e.target)||document.querySelector(".annotation-bubble")||this.props.isFullscreen||this.fileSubpath||t||this.props.isEditMode},t.prototype.setDocumentTitle=function(e,t){void 0===t&&(t=!1),t&&(he=document.title),document.title=e},t.prototype.unsetDocumentTitle=function(){""!==he&&(document.title=he)},t.prototype.logView=function(){null===this.props.file.ns_id||Q.getSourceContext()===L.PreviewSourceContext.SharedLinkCollection||this.props.hidePageChrome||u.logView(this.props.file,this.props.user,this.props.fileViewTarget,this.props.fileViewOrigin,this.props.fileViewAction,null!=this.props.sharedLinkInfo?this.props.sharedLinkInfo.url:void 0,this.isDownloadDisabled(),V.Viewer.get_viewer().is_assume_user_session)},t.prototype.isImagePreviewAnnotationEnabled=function(){return!(this.props.sizeClass===U.SizeClass.Small)&&!this.props.hidePageChrome},t.prototype.renderFlippableControls=function(){if(!(this.props.isFullscreen||this.isImagePreviewAnnotationEnabled()||null==this.props.fileIndex||[p.PreviewType.Video,p.PreviewType.Audio].includes(this.previewType)||this.props.isEditMode))return o.default.createElement(S.FlippableControls,{index:""+(this.props.fileIndex+1),numFlippableFiles:this.props.fileCount,onNext:this.props.onFlipNext,onPrevious:this.props.onFlipPrevious})},t.prototype.renderFilePreview=function(){var e=this.props.isEditMode;return o.default.createElement("div",{className:n.default("react-file-viewer__preview","react-file-preview",{"react-file-viewer__preview--edit-mode":e})},o.default.createElement("div",{className:"flex-preview-container"},this.maybeRenderFidelitySurvey(),this.renderReportFlag(),this.renderRetrievalSuccessBanner(),this.shouldShowOpenInAppBanner()&&o.default.createElement(R.OpenInAppBanner,{urls:this.props.file.open_in_app_data,onClick:this.openInAppBannerOnClick}),o.default.createElement(E.FilePreviewWithLogging,{areActionablesEnabled:!this.props.hidePageChrome&&null!=this.props.file.ns_id,count:this.props.fileCount,extensionsEnabled:this.props.extensionsEnabled,file:this.props.file,previewApiData:this.props.previewApiData,fileSubpath:this.fileSubpath,index:this.props.fileIndex,isFullscreen:this.props.isFullscreen,isMobileUserAgent:this.props.isMobileUserAgent,isSidebarOpen:this.props.isSidebarOpen,maxFilenameEmLength:Z.SizeClassFilenameLengthMap[this.props.sizeClass],onNext:this.props.onFlipNext,onPrevious:this.props.onFlipPrevious,sharedLinkInfo:this.props.sharedLinkInfo,location:this.props.location,sharePermission:this.props.sharePermission,shareToken:this.props.shareToken,shouldFocusOnReady:!this.props.hidePageChrome,sidebar:this.props.sidebar,sourceAction:this.previewSourceAction,sourceContext:this.previewSourceContext,sharedLinkUrl:null!=this.props.sharedLinkInfo?this.props.sharedLinkInfo.url:void 0,setRenderStatusSuccess:this.props.setRenderStatusSuccessForCurrentFile,shouldDisplayToolbar:this.isImagePreviewAnnotationEnabled(),sizeClass:this.props.sizeClass,user:this.props.user,mode:this.props.mode,showCloudDocPreview:this.props.showCloudDocPreview,LoggedOutUXGoogleVariant:this.props.LoggedOutUXGoogleVariant,LoggedOutUXPaperVariant:this.props.LoggedOutUXPaperVariant}),this.renderFlippableControls()))},t.prototype.shouldRenderSidebar=function(){return this.props.sizeClass!==U.SizeClass.Small&&!this.props.isFullscreen&&!this.props.hidePageChrome&&null!=this.props.file.ns_id},t.prototype.renderSidebar=function(){if(!this.shouldRenderSidebar())return null;var e=this.props,t=e.sizeClass,r=e.file,i=e.user,a=e.sharedLinkInfo,s=e.isVersionHistoryMode,l=e.shareToken,c=e.sharePermission,u=e.canRestoreRevision,d=e.onRestoreRevision,p=e.sidebar;return o.default.createElement("div",{className:n.default("react-file-viewer__sidebar",{"react-file-viewer__sidebar--closed":p.visibility===le.SidebarVisibility.Closed}),"data-preview-type":this.previewType,"data-theme":"web"},o.default.createElement(C.Sidebar,{sizeClass:t,file:r,user:i,sharedLinkInfo:a,isVersionHistoryMode:s,isViewingFileSubpath:!!this.isViewingFileSubpath,sharePermission:c,shareToken:l,previewType:this.previewType,isSeenStatesEnabled:!this.shouldSuppressPassInfo(),canRestoreRevision:u,onRestoreRevision:d,renderSidebarOverflowMenuFn:this.renderOverflowMenuFnFactory(Z.OverflowMenuDirection.BELOW)}))},t.prototype.shouldRenderMobileWebComments=function(){return this.props.sizeClass===U.SizeClass.Small},t.prototype.renderMobileComments=function(){var e=this.props,t=e.file,r=e.sharedLinkInfo,n=e.sizeClass,i=e.user,a=e.isFullscreen;return!this.shouldRenderMobileWebComments()||a||this.isViewingFileSubpath||this.props.hidePageChrome||null==t.ns_id?null:o.default.createElement(l.MobileWebComments,{currentFile:t,previewType:this.previewType,sharedLinkInfo:r,user:i,sizeClass:n})},t.prototype.renderBanner=function(){return o.default.createElement("div",{className:"react-file-viewer__banner"},this.renderUpsellBanner(),this.renderTrialBanner())},t.prototype.renderTitleBar=function(){return this.props.isFullscreen||this.props.hidePageChrome&&!m.isArchive(this.props.previewApiData.data)?null:this.props.mode===f.FileViewerMode.Watermarking?o.default.createElement(pe.EditModeTitlebar,{user:this.props.user,file:this.props.file,maxFilenameEmLength:Z.SizeClassFilenameLengthMap[this.props.sizeClass],title:z._("Watermarking",{project:"watermarking"}),mode:f.FileViewerMode.Watermarking,sizeClass:this.props.sizeClass}):this.props.mode===f.FileViewerMode.Markup?o.default.createElement(pe.EditModeTitlebar,{user:this.props.user,file:this.props.file,maxFilenameEmLength:Z.SizeClassFilenameLengthMap[this.props.sizeClass],title:z._("Markup",{project:"watermarking"}),beta:!0,mode:f.FileViewerMode.Markup,sizeClass:this.props.sizeClass}):o.default.createElement(se.FileTitleBar,{file:this.props.file,maxFilenameEmLength:Z.SizeClassFilenameLengthMap[this.props.sizeClass],isViewingFileSubpath:this.isViewingFileSubpath,user:this.props.user||null,isSidebarOpen:this.props.sidebar.visibility===le.SidebarVisibility.Open,closeUrl:this.props.titleBarCloseUrl,onClose:this.props.onCloseViewer,canClose:this.props.canClose,hidePageChrome:this.props.hidePageChrome,fileViewAction:this.props.fileViewAction,fileViewOrigin:this.props.fileViewOrigin,isVersionHistoryMode:this.props.isVersionHistoryMode,sharedLinkInfo:this.props.sharedLinkInfo,fileSubpath:this.fileSubpath,previewType:this.previewType,renderTitlebarOverflowMenuFn:this.renderOverflowMenuFnFactory(Z.OverflowMenuDirection.BELOW),hideIcon:this.shouldRenderPersistentHeader()})},t.prototype.shouldAllowFileDonation=function(){return null==this.props.sharedLinkInfo&&(null==this.props.user||this.props.user.home_ns_id===this.props.file.ns_id)},t.prototype.renderRetrievalSuccessBanner=function(){var e=this.props,t=e.user,r=e.hidePageChrome,n=e.isEditMode,i=e.renderStatus,a=e.sizeClass;return t&&Q.shouldShowRetrievalSuccessBanner({renderStatus:i,hidePageChrome:r,sizeClass:a,isEditMode:n})?o.default.createElement(ee.RetrievalSuccessFilesviewBanner,{user:this.props.user,displayContext:$.SearchSuccessDisplayContext.PREVIEW}):null},t.prototype.maybeRenderFidelitySurvey=function(){var e=this.props,t=e.file,r=e.hidePageChrome,n=e.isEditMode,i=e.renderStatus,a=e.sizeClass;return Q.canShowFidelitySurvey({file:t,sizeClass:a,hidePageChrome:r,renderStatus:i,isEditMode:n})?o.default.createElement(N.FidelitySurvey,{allowFileDonation:this.shouldAllowFileDonation(),file:t}):null},t.prototype.renderReportFlag=function(){return this.props.sharedLinkInfo&&!1!==this.props.sharedLinkInfo.hasPublicAudienceOrVisibility&&!this.props.hidePageChrome?o.default.createElement(ae.AsyncReportFlag,{sharedLink:this.props.sharedLinkInfo.url}):null},t.prototype.renderUpsellBanner=function(){return this.props.showOverQuotaUpsell?o.default.createElement(b.ExpFileViewerUpsellBannerV2,null):null},t.prototype.renderTrialBanner=function(){var e=this.props,t=e.mode;return e.isTrialMode?o.default.createElement(oe.Banner,{mode:t,onClick:this.onTrialBannerClicked}):null},t.prototype.shouldRenderPersistentHeader=function(){return!this.props.user&&!this.props.hidePageChrome&&this.props.sizeClass!==U.SizeClass.Small&&me.shouldShowPersistentHeader()},t.prototype.renderPersistentHeader=function(){return this.shouldRenderPersistentHeader()?o.default.createElement(fe.PersistentHeader,{sharedLinkInfo:this.props.sharedLinkInfo}):null},t.prototype.shouldRenderPersistentFooter=function(){return!this.props.user&&!this.props.hidePageChrome&&this.props.sizeClass!==U.SizeClass.Small&&me.shouldShowPersistentFooter()},t.prototype.renderPersistentFooter=function(){return this.shouldRenderPersistentFooter()?o.default.createElement(_e.PersistentFooter,{sharedLinkInfo:this.props.sharedLinkInfo}):null},t.prototype.render=function(){var e=this.props,t=e.className,r=e.file,i=e.hidePageChrome,a=e.isFullscreen,s=e.sharedLinkInfo,l=e.transparentBackground,c=e.user,u=e.isEditMode,d=void 0!==u&&u,m=e.isWatermarkingMode,f=void 0!==m&&m,_=e.campaign,v=J.getFilename(r),g=this.previewType;return this.shouldShowAppDownloadInterstitial()?o.default.createElement("div",{"aria-label":v},o.default.createElement(h.FilePreviewAppDownloadInterstitial,{sharedLinkInfo:s,file:r,previewType:g,fileViewerSession:T.FileViewerSession.currentSession,previewSourceAction:this.previewSourceAction,previewSourceContext:this.previewSourceContext,onClose:this.onInterstitialClose,onContinue:this.onInterstitialContinue})):o.default.createElement(A.KeyboardBindingProvider,{onDestroy:this.cleanupKeymaster,onSetup:this.setupKeymaster},o.default.createElement(we,{ns_id:r.ns_id},o.default.createElement("div",{"aria-label":v,className:n.default("react-file-viewer","preview-type-"+(this.previewType?this.previewType.toLowerCase():"unknown"),t,this.state.modeClassnames,{"no-background":l&&!a,"react-file-viewer--edit-mode":d}),role:"dialog"},this.renderPersistentHeader(),this.renderPersistentFooter(),o.default.createElement(M.KeyboardBindingConnector,{keyboardBindings:this.getKeyboardBindings({isFullscreen:a,isWatermarkingMode:f})}),this.renderBanner(),o.default.createElement("div",{className:"react-file-viewer__main"},_&&c&&!i?o.default.createElement(ce.FileViewerPrompt,{user:c,campaign:_}):null,o.default.createElement("div",{className:n.default("react-file-viewer__content","comments2",{"comments2-mobile-web":this.shouldRenderMobileWebComments(),"comments2-annotation-enabled":!0,"video-audio":this.previewType===p.PreviewType.Video||this.previewType===p.PreviewType.Audio,"react-file-viewer__content--edit-mode":d}),"data-preview-type":g,"data-theme":"web"},this.renderTitleBar(),this.renderFilePreview(),this.renderMobileComments(),this.renderManagers()),this.renderSidebar()))))},t.defaultProps={canClose:!1,canRestoreRevision:!1,className:"",hideComments:!1,hidePageChrome:!1,isVersionHistoryMode:!1,forceFileUnlocked:!1,oref:j.OREF_CONSTANTS.BROWSE_UNKNOWN,sizeClass:U.SizeClass.Large,fileCount:0,showCloudDocPreview:!1},t})(o.default.Component);t._FileViewer=ge;var we=function(e){var t=e.children;return null==e.ns_id?o.default.createElement(o.default.Fragment,null,t):o.default.createElement(_.FileSidebarProvider,null,t)},ye=O.withLocation((function(e){return null!=e.file?o.default.createElement(ge,r.__assign({},e)):o.default.createElement("div",null)})),be=W.withSizeClass(ye,{isResponsiveEnabled:Q.isResponsiveEnabled,responsiveClassName:Z.ResponsiveClassName}),Ee=ie.withTranslations(be),Se=s.connect((function(e,t){var r=G.getAppDownloadInterstitial(e);void 0===r&&t&&(r=t.appDownloadInterstitialDismissed);var n=G.getActiveFile(e);return{appDownloadInterstitialDismissed:r,file:n,mode:G.getMode(e),isFullscreen:G.getIsFullScreen(e),isSidebarOpen:G.getIsSidebarOpen(e),renderStatus:G.getRenderStatusForCurrentFile(e),showOverQuotaUpsell:G.getShowOverQuotaUpsell(e),sidebar:G.getSidebar(e),isEditMode:G.getIsEditMode(e),isWatermarkingMode:G.getIsWatermarkingMode(e),isTrialMode:G.getIsTrialMode(e),campaign:G.getSelectedPromptCampaign(e),previewApiData:Y.getApiDataForFile(e,n),extensionsEnabled:G.getExtensionsEnabled(e)}}),{onAppDownloadInterstitialDismissed:g.dismissAppDownloadInterstitial,fetchShowOverQuotaUpsell:g.fetchShowOverQuotaUpsell,setRenderStatusSuccessForCurrentFile:g.setRenderStatusSuccessForCurrentFile,fetchControllerModeAction:g.fetchControllerModeAction,fetchBestCampaignsAction:g.fetchBestCampaignsAction,changeMode:g.changeMode})(Ee),ke=w.getStoreForFileViewer(),Te=X.requireCssWithComponent((function(e){return o.default.createElement(s.Provider,{store:ke},o.default.createElement(Se,r.__assign({},e)))}),["/static/css/preview_flexbox_layout-vflcNZzXn.css","/static/css/react_file_viewer-vfl1UuQe2.css","/static/css/react_title_bar-vfletBR-r.css","/static/css/spectrum/index.web-vfl_-DzRS.css","/static/js/file-viewer/index.web-vflRmUOr2.css","/static/js/premium-workflows/index.web-vflA4HDJ9.css"]);t.FileViewer=Te})),define("modules/clean/react/file_viewer/flippable_controls",["require","exports","tslib","react","modules/clean/react/sprite","modules/core/i18n"],(function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handlePreviousClick=function(){t.props.onPrevious&&t.props.onPrevious()},t.handleNextClick=function(){t.props.onNext&&t.props.onNext()},t}return r.__extends(t,e),t.prototype.getNavText=function(){return o._("%(cur_file_num)s of %(num_total_files)s").format({cur_file_num:this.props.index,num_total_files:this.props.numFlippableFiles})},t.prototype.render=function(){if(this.props.numFlippableFiles<=1)return null;var e=o._("Flip left",{comment:"Flip to the previous file in a series of files when previewing files on the web"}),t=o._("Flip right",{comment:"Flip to the next file in a series of files when previewing files on the web"});return n.default.createElement("div",{className:"react-file-viewer__controls"},n.default.createElement("button",{className:"nav-control",onClick:this.handlePreviousClick},n.default.createElement(i.Sprite,{group:"web",name:"s_flip_left",alt:e})),n.default.createElement("div",{className:"nav-text"},this.getNavText()),n.default.createElement("button",{className:"nav-control",onClick:this.handleNextClick},n.default.createElement(i.Sprite,{group:"web",name:"s_flip_right",alt:t})))},t})((n=r.__importDefault(n)).default.Component);t.FlippableControls=a})),define("modules/clean/react/file_viewer/full_screen_helpers",["require","exports","modules/clean/react/file_viewer/data/store","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants"],(function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r.getStoreForFileViewer();function s(){m()||p(o.UserActionContext.Browser)}function l(){p(o.UserActionContext.Browser)}function c(){var e;e=s,document.addEventListener("fullscreenchange",e),document.addEventListener("webkitfullscreenchange",e),document.addEventListener("MSFullscreenChange",e),document.addEventListener("mozfullscreenchange",e),(function(e){window.addEventListener("popstate",e)})(l)}function u(){var e;e=s,document.removeEventListener("fullscreenchange",e),document.removeEventListener("webkitfullscreenchange",e),document.removeEventListener("MSFullscreenChange",e),document.removeEventListener("mozfullscreenchange",e),(function(e){window.removeEventListener("popstate",e)})(l)}function d(e){var t;a.dispatch(n.openFullScreen()),null!=(t=document.body).requestFullscreen?t.requestFullscreen():null!=t.msRequestFullscreen?t.msRequestFullscreen():null!=t.mozRequestFullScreen?t.mozRequestFullScreen():null!=t.webkitRequestFullscreen&&t.webkitRequestFullscreen(),c(),e&&i.logUserAction(o.UserAction.ToggleFullscreenOn,e)}function p(e){var t;u(),a.dispatch(n.closeFullScreen()),(t=document).exitFullscreen?t.exitFullscreen():t.msExitFullscreen?t.msExitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitExitFullscreen&&t.webkitExitFullscreen(),e&&i.logUserAction(o.UserAction.ToggleFullscreenOff,e)}function m(){var e=document;return null!=e.fullScreen?e.fullScreen:null!=e.webkitIsFullScreen?e.webkitIsFullScreen:null!=e.mozFullScreen?e.mozFullScreen:null!=e.msFullscreenElement||null!=e.fullscreenElement}t.enterFullScreen=d,t.exitFullScreen=p,t.browserSupportFullScreen=function(){var e=document.body;return e.requestFullscreen||e.msRequestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen},t.isBrowserFullScreen=m,t.toggleFullScreen=function(e,t){return e||m()?p(t):d(t)}}));__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};define("modules/clean/react/file_viewer/open_button/open_button",["require","exports","modules/clean/react/async/loadable"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpenButton=r.Loadable({loader:function(){return new Promise((function(t,r){e(["modules/clean/react/file_viewer/open_button/open_button_component"],t,r)})).then(__importStar).then((function(e){return e.OpenButton}))}})}));__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};define("modules/clean/react/file_viewer/prompt/loadable_prompt",["require","exports","modules/clean/react/async/loadable"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileViewerPrompt=r.Loadable({loader:function(){return new Promise((function(t,r){e(["modules/clean/react/file_viewer/prompt/prompt"],t,r)})).then(__importStar).then((function(e){return e.SyncFileViewerPrompt}))}})})),define("modules/clean/react/file_viewer/utils",["require","exports","tslib","modules/clean/ajax","modules/core/browser","modules/clean/previews/constants","modules/clean/react/file_viewer/constants","modules/clean/file_store/utils","modules/clean/previews/data/preview_type_util","modules/core/uri","modules/clean/react/previews/constants","modules/clean/react/previews/image_helpers","modules/clean/react/file_viewer/constants","modules/clean/react/size_class/constants","modules/clean/previews/api"],(function(e,t,r,n,i,o,a,s,l,c,u,d,p,m,f){"use strict";function _(){return new c.URI({path:"/login",query:{cont:i.get_href()}}).toString()}function v(e){return!e}function h(){var e=i.get_uri().path;return/^\/(home|work|personal|search)/.test(e)?u.PreviewSourceContext.Browse:/^\/h$/.test(e)?u.PreviewSourceContext.Home:/^\/(s|scl\/fi)\//.test(e)?u.PreviewSourceContext.SharedLinkFile:/^\/(sh|scl\/fo)\//.test(e)?u.PreviewSourceContext.SharedLinkFolder:/^\/sc\//.test(e)?u.PreviewSourceContext.SharedLinkCollection:/^\/history/.test(e)?u.PreviewSourceContext.VersionHistory:void 0}Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),i=r.__importStar(i),d=r.__importStar(d),t.TooltipHelpers={fetchTooltipInfo:function(e,t){n.SilentBackgroundRequest({url:"/ow/get_available_tooltips",dataType:"json",success:function(e){return t(e)},subject_user:e})},getVendorAndApplication:function(e,t){for(var r in e)if(e.hasOwnProperty(r)){var n=e[r];for(var i in n){if(n.hasOwnProperty(i))if(n[i].extensions.indexOf(t)>-1)return{vendor:r,application:i}}}return null},logImpression:function(e,t,r){"acrobat_or_reader"===r?n.SilentBackgroundRequest({url:"/ow/log_adobe_tooltip_impression",data:{app_name:r,extension:e},subject_user:t}):n.SilentBackgroundRequest({url:"/ow/msft/log_tooltip_impression",data:{app_type:r,extension:e},subject_user:t})}},t.getSplitButtonUserActionContext=function(e,t){if(e===a.SplitButtonActionLocation.Main){if(t===a.FileViewerPane.TitleBar)return a.UserActionContext.TitleBarMain;if(t===a.FileViewerPane.PreviewContent)return a.UserActionContext.PreviewContentMain}else if(e===a.SplitButtonActionLocation.Split){if(t===a.FileViewerPane.TitleBar)return a.UserActionContext.TitleBarSplitButton;if(t===a.FileViewerPane.PreviewContent)return a.UserActionContext.PreviewContentSplitButton}return a.UserActionContext.Unknown},t.modalIsUp=function(){for(var e=!1,t=document.getElementsByClassName("db-modal-wrapper"),r=0;!e&&r<t.length;r++){e="none"!==window.getComputedStyle(t[r]).display}return e},t.cleanupPrerenderPreview=function(){var e=document.querySelectorAll(".prerender-preview");Array.prototype.forEach.call(e,(function(e){e.style.display="none"}))},t.getSharedLinkLoginUrl=_,t.sharedLinkLoginUrl=_(),t.getFileViewerInterfaceTypeForSharedLink=function(e){switch(e){case o.PreviewType.Image:return a.FileViewerInterfaceType.Window;case o.PreviewType.SsrDoc:return a.FileViewerInterfaceType.Frame;default:return}},t.isMountedFile=v,t.isFileEditable=function(e){return!!e&&(s.isBrowseFile(e)&&!e.read_only)},t.canDownloadFile=function(e,t){return v(e)||t&&t.canDownloadRoles.length>0},t.canUserUsePaper=function(e){return null!=e&&!e.is_paper_disabled},t.canShowFidelitySurvey=function(e){var t=e.file,r=e.renderStatus,n=e.hidePageChrome,i=e.sizeClass,o=e.isEditMode;return!!t&&(r===p.PreviewRenderStatus.Succeeded&&(!n&&(i!==m.SizeClass.Small&&!o)))},t.getSourceContext=h,t.getSourceAction=function(){switch(h()){case u.PreviewSourceContext.SharedLinkFile:case u.PreviewSourceContext.SharedLinkFolder:return u.PreviewSourceAction.Visit;default:return u.PreviewSourceAction.Click}},t.preloadImages=function(e,t){if(0!==e.length){var r=[];[0,1,2,3,4,5,6,-1,-2].forEach((function(n){var i=(t+n+e.length)%e.length;-1===r.indexOf(i)&&r.push(i)})),r.forEach((function(t){if(e.length>t&&l.isImage(e[t])){var r=e[t];if(r){var n=r.content.thumbnail_url_tmpl||r.preview_url;n&&d.preloadResponsiveImage(n)}}}))}},t.shouldShowRetrievalSuccessBanner=function(e){var t=e.renderStatus,r=e.hidePageChrome,n=e.sizeClass,i=e.isEditMode;return t===p.PreviewRenderStatus.Succeeded&&!r&&n!==m.SizeClass.Small&&!i},t.fetchRivieraStatusCode=function(e,t,r){void 0===r&&(r=function(){});var n=new XMLHttpRequest;return n.open("GET",e),n.withCredentials=!0,n.onreadystatechange=function(){if(n.readyState===XMLHttpRequest.DONE){var e=f.getParsedDropboxMetadataHeader(n);e.rivieraStatusCode?t(e.rivieraStatusCode):r()}},n.send(),n},t.isResponsiveEnabled=function(){return h()!==u.PreviewSourceContext.VersionHistory}})),define("modules/clean/react/file_viewer_sidebar/panes/commenting_pane",["require","exports","tslib","react","file-viewer/modes","modules/clean/react/async/loadable","file-viewer/core"],(function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n);var s=o.Loadable({loader:function(){return new Promise((function(t,r){e(["modules/clean/react/file_viewer_sidebar/panes/commenting_pane_contents"],t,r)})).then(r.__importStar).then((function(e){return e.CommentingPaneContents}))}});t.CommentingPane=function(e){var t=e.coreFVUiProps;return n.default.createElement(i.Pane,r.__assign({paneId:a.SidebarPaneId.Comments},t),n.default.createElement(s,null))}}));__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};define("modules/clean/react/file_viewer_sidebar/panes/loadable_activity_pane",["require","exports","modules/clean/react/async/loadable","modules/clean/web_timing_logger"],(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadableActivityPane=r.Loadable({loader:function(){return n.waitForTTI().then((function(){return new Promise((function(t,r){e(["modules/clean/react/file_viewer_sidebar/panes/activity_pane"],t,r)})).then(__importStar).then((function(e){return e.ActivityPane}))}))}})})),define("modules/clean/react/file_viewer_sidebar/panes/documentation_pane",["require","exports","tslib","react","file-viewer/modes","file-viewer/core","modules/clean/em_string","modules/clean/file_store/utils","modules/clean/react/css","modules/clean/react/file_viewer_sidebar/panes/strings","modules/clean/react/file_viewer/data/actions","react-redux","modules/clean/react/file_viewer_sidebar/panes/file_activity_section","modules/clean/react/file_viewer_sidebar/panes/loadable_details_section"],(function(e,t,r,n,i,o,a,s,l,c,u,d,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),t.UnconnectedDocumentationPaneComponent=function(e){var t=e.file,l=e.user,u=e.maxFilenameEmLength,d=e.sharedLinkInfo,f=e.isVersionHistoryMode,_=e.coreFVUiProps,v=e.disableOnboardingCard,h=a.Emstring.em_snippet(s.getFilename(t),u);return n.default.createElement(i.Pane,r.__assign({paneId:o.SidebarPaneId.Documentation},_),n.default.createElement("div",{className:"documentation-pane"},n.default.createElement("div",{className:"documentation-pane__title"},h),n.default.createElement(m.LoadableDetailsSection,{title:c.DocumentationPaneStrings.details,file:t,user:l,sharedLinkInfo:d,pushMetadataPaneHandler:function(){return e.pushSidebarPane(o.SidebarPaneId.Metadata)}}),n.default.createElement(p.ConnectedFileActivitySection,{file:t,user:l,isVersionHistoryMode:f,title:c.DocumentationPaneStrings.activity,pushActivityPaneHandler:function(){return e.pushSidebarPane(o.SidebarPaneId.Activity)},disableOnboardingCard:v})))};var f={pushSidebarPane:u.pushSidebarPane};t.ConnectedDocumentationPaneComponent=d.connect(null,f)(t.UnconnectedDocumentationPaneComponent),t.DocumentationPane=l.requireCssWithComponent(t.ConnectedDocumentationPaneComponent,["/static/css/file_viewer_sidebar/documentation_pane-vflEFmR4q.css"])})),define("modules/clean/react/file_viewer_sidebar/panes/editing_pane",["require","exports","tslib","react","classnames","file-viewer/modes","modules/clean/react/css"],(function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),i=r.__importDefault(i);var s=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.componentWillUnmount=function(){var e=this.props.paneId,t=document.querySelector('[data-control-id="'+e+'"]');t&&t.focus()},t.prototype.render=function(){var e=this.props,t=e.coreFVUiProps,a=e.paneId,s=e.children,l=e.classname;return n.default.createElement(o.Pane,r.__assign({paneId:a,className:"editing-pane-wrapper"},t),n.default.createElement("div",{"aria-labelledby":"react-file-viewer__title-bar","aria-modal":"true",className:i.default("editing-pane",l),role:"dialog"},s))},t})(n.default.PureComponent);t.EditingPaneComponent=s,t.EditingPane=a.requireCssWithComponent(s,["/static/css/file_viewer_sidebar/editing_pane-vfljT-58j.css"])})),define("modules/clean/react/file_viewer_sidebar/panes/markup_pane",["require","exports","tslib","react","classnames","external/lodash","react-redux","file-viewer/core","modules/core/browser","modules/core/i18n","modules/clean/keycode","modules/clean/browse_uri_interface","modules/clean/file_store/utils","modules/clean/loggers/workflows_logger","modules/clean/previews/data/selectors","modules/clean/previews/data/preview_type_util","modules/clean/react/css","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/data/selectors","modules/clean/react/file_viewer_sidebar/panes/editing_pane","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/keyboard_binding/keyboard_binding","modules/clean/react/previews/constants","modules/clean/react/snackbar","spectrum/button","modules/clean/react/workflows/markup/fabric","modules/clean/react/workflows/markup/selectors","modules/clean/react/workflows/markup/types","modules/clean/react/workflows/markup/utils","premium-workflows/components/base/apply_button","modules/clean/react/workflows/markup_icons","spectrum/popover","spectrum/tooltip","spectrum/modal"],(function(e,t,r,n,i,o,a,s,l,c,u,d,p,m,f,_,v,h,g,w,y,b,E,S,k,T,C,P,x,A,M,I,F,O){"use strict";var D,R;Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),i=r.__importDefault(i),l=r.__importStar(l);var L=c.i18n_default_project("watermarking")._,N=function(e,t){return void 0===t&&(t=!0),e===P.MarkupColor.TRANSPARENT?M.transparentFillIcon:M.circleIcon({stroke:e,fill:t?e:void 0})},U=[P.MarkupColor.TRANSPARENT,P.MarkupColor.RED_CHERRY,P.MarkupColor.ORANGE_TANGERINE,P.MarkupColor.GREEN,P.MarkupColor.DARK_BLUE,P.MarkupColor.ULTRAVIOLET,P.MarkupColor.WHITE,P.MarkupColor.BLACK].map((function(e){return{color:e,icon:N(e)}})),W=((D={})[P.MarkupColor.TRANSPARENT]=L("No fill color",{comment:"Noun phrase; over text over icon that removes color fill from a shape"}),D[P.MarkupColor.RED_CHERRY]=L("Red",{comment:"Noun; hover text over icon that allows user to change the color of a shape they’ve added to their file"}),D[P.MarkupColor.ORANGE_TANGERINE]=L("Orange",{comment:"Noun; hover text over icon that allows user to change the color of a shape they’ve added to their file"}),D[P.MarkupColor.GREEN]=L("Green",{comment:"Noun; hover text over icon that allows user to change the color of a shape they’ve added to their file"}),D[P.MarkupColor.DARK_BLUE]=L("Blue",{comment:"Noun; hover text over icon that allows user to change the color of a shape they’ve added to their file"}),D[P.MarkupColor.ULTRAVIOLET]=L("Purple",{comment:"Noun; hover text over icon that allows user to change the color of a shape they’ve added to their file"}),D[P.MarkupColor.WHITE]=L("White",{comment:"Noun; hover text over icon that allows user to change the color of a shape they’ve added to their file"}),D[P.MarkupColor.BLACK]=L("Black",{comment:"Noun; hover text over icon that allows user to change the color of a shape they’ve added to their file"}),D),V=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isSubmenuOpen:!1},t.toggleSubMenu=function(e){var r=e.isOpen;t.setState({isSubmenuOpen:r})},t}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.icon,r=e.onChange,o=e.label,a=this.state.isSubmenuOpen;return n.default.createElement(I.Popover,{onSelection:r,onMenuToggle:this.toggleSubMenu,closeOnSelection:!1},n.default.createElement(I.PopoverTrigger,null,n.default.createElement("div",{className:"markup-pane__tool-buttons"},n.default.createElement(F.Tooltip,{positioning:"below",className:"markup-pane__tooltip",tooltipContent:o},n.default.createElement(k.Button,{variant:"secondary",size:"large",className:i.default("markup-pane__tool-button",{"markup-pane__tool-button--selected":a}),tagName:"span"},t)))),n.default.createElement(I.PopoverContent,null,U.map((function(e){var t=e.icon,r=e.color;return n.default.createElement(F.Tooltip,{positioning:"below",className:"markup-pane__tooltip",tooltipContent:W[r],key:W[r]},n.default.createElement(I.PopoverContentItem,{value:r},t))}))))},t})(n.default.Component),B=((R={})[P.MarkupType.TEXT]=m.WorkflowsEvent.MarkupTextboxClicked,R[P.MarkupType.FREEFORM]=m.WorkflowsEvent.MarkupDrawClicked,R[P.MarkupType.ARROW]=m.WorkflowsEvent.MarkupArrowClicked,R[P.MarkupType.RECT]=m.WorkflowsEvent.MarkupRectangleClicked,R[P.MarkupType.CIRCLE]=m.WorkflowsEvent.MarkupCircleClicked,R),j=(function(e){function t(t){var i=e.call(this,t)||this;return i.onStrokeChange=function(e){var t=i.props,r=t.markupState,n=t.currentPageIndex;(0,t.setMarkupStroke)(e);var o=r[n].fabric;T.setOptionsForActiveObjects(o,{stroke:e})},i.onFillChange=function(e){var t=i.props,r=t.markupState,n=t.currentPageIndex;(0,t.setMarkupFill)(e);var o=r[n].fabric;T.setOptionsForActiveObjects(o,{fill:e})},i.addMarkupObject=function(e){var t=i.props,r=t.currentPageIndex,n=t.markupState,o=t.markupState,a=o.strokeColor,s=o.fillColor,l=n[r].fabric;l&&(T.addMarkupObject(l,e,{stroke:a,fill:s,left:i.left,top:i.top}),i.props.setMarkupDrawingMode(!1),i.left+=x.OFFSET,i.top+=x.OFFSET,i.left>=l.getWidth()&&(i.left=x.DEFAULT_LEFT),i.top>=l.getHeight()&&(i.top=x.DEFAULT_TOP))},i.onClickDraw=function(){var e=i.props,t=e.markupState.isDrawingMode,r=e.setMarkupDrawingMode,n=e.setMarkupFormatSubmenu;t||n([P.FormatSubmenuEntry.STROKE]),r(!t),m.logWorkflowsEvent(m.WorkflowsEvent.MarkupDrawClicked)},i.onClickTool=function(e,t){return function(){(0,i.props.setMarkupFormatSubmenu)(t),i.addMarkupObject(e),m.logWorkflowsEvent(B[e])}},i.exitWithConfirmation=function(){i.props.markupState[i.props.currentPageIndex].fabric.isEmpty()?i.props.changeMode(s.FileViewerMode.Documentation):i.setState({isConfirmationModalOpen:!0})},i.handleCancel=function(e){e.preventDefault(),i.exitWithConfirmation()},i.handleApply=function(e){return r.__awaiter(i,void 0,void 0,(function(){var t,i,o,a,s,c,u;return r.__generator(this,(function(r){switch(r.label){case 0:S.Snackbar.sync(L("Marking up file..."),!1,"markup-notification"),m.logWorkflowsEvent(e?m.WorkflowsEvent.MarkupApplyOverwrite:m.WorkflowsEvent.MarkupApplySaveAsCopy),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,T.saveMarkup(this.props.user.id,this.props.file.file_id,e,this.props.markupState,this.props.previewType)];case 2:return t=r.sent(),[3,4];case 3:return i=r.sent(),o=x.getMarkupErrorMessage(i.error),a="over_quota_error"===i.error[".tag"],s=a?L("Upgrade",{comment:"Verb. Call-to-action button label to upgrade your account."}):L("Close",{comment:"Verb. Call-to-action button label to dismiss error."}),c=a?function(){return l.open_tab("/plans")}:function(){},[2,S.Snackbar.show(n.default.createElement(S.Snackbar,{id:"markup-notification",closeButtonText:s,timeoutDelayMs:5e3,title:o,variant:"fail",onCloseClick:c}))];case 4:return(u=t.fq_path||p.isBrowseFile(this.props.file)&&this.props.file.fq_path)?l.replace_location(d.preview_uri_for_fq_path(this.props.user,u,{context:E.PreviewSourceContext.Workflow})):l.reload(),[2]}}))}))},i.onDelete=function(e){e&&e instanceof KeyboardEvent&&e.preventDefault(),m.logWorkflowsEvent(m.WorkflowsEvent.MarkupDelete);var t=i.props.markupState[i.props.currentPageIndex].fabric;t&&(t.remove.apply(t,t.getActiveObjects()),t.discardActiveObject().requestRenderAll())},i.onEscape=function(){var e=i.props.markupState[i.props.currentPageIndex].fabric;if(i.props.markupState.isDrawingMode){i.props.setMarkupDrawingMode(!1);var t=o.last(e.getObjects());t&&e.setActiveObject(t).requestRenderAll()}else e.getActiveObject()?e.discardActiveObject().requestRenderAll():i.exitWithConfirmation()},i.onCopy=function(){i.props.markupState[i.props.currentPageIndex].fabric.getActiveObject().clone((function(e){i.clipboard=e}))},i.onPaste=function(){if(i.clipboard){var e=i.props.markupState[i.props.currentPageIndex].fabric;i.clipboard.top=(i.clipboard.top||x.DEFAULT_TOP)+x.OFFSET,i.clipboard.left=(i.clipboard.left||x.DEFAULT_LEFT)+x.OFFSET,i.clipboard.left>=e.getWidth()&&(i.clipboard.left=x.DEFAULT_LEFT),i.clipboard.top>=e.getHeight()&&(i.clipboard.top=x.DEFAULT_TOP),i.clipboard.clone((function(t){if(e.discardActiveObject(),t.set({evented:!0,strokeUniform:!0}),"activeSelection"===t.type){var r=t;r.canvas=e,r.forEachObject((function(t){e.add(t)})),r.setCoords()}else e.add(t);e.setActiveObject(t).requestRenderAll()}))}},i.onLeftArrowPressed=function(){i.moveActiveObject(-x.MOVE_DISTANCE_X,0)},i.onRightArrowPressed=function(){i.moveActiveObject(x.MOVE_DISTANCE_X,0)},i.onUpArrowPressed=function(){i.moveActiveObject(0,-x.MOVE_DISTANCE_Y)},i.onDownArrowPressed=function(){i.moveActiveObject(0,x.MOVE_DISTANCE_Y)},i.moveActiveObject=function(e,t){var r=i.props.markupState[i.props.currentPageIndex].fabric,n=r.getActiveObject();n&&(n.left=n.left+e,n.top=n.top+t,r.trigger("object:moving",{target:n}),r.requestRenderAll())},i.renderConfirmationModal=function(){var e=L("Exit without saving?");return n.default.createElement(O.UtilityModal,{title:e,ariaLabel:e,open:i.state.isConfirmationModalOpen,primaryAction:L("Yes"),onPrimaryAction:function(){return i.props.changeMode(s.FileViewerMode.Documentation)},secondaryAction:L("No"),onSecondaryAction:function(){return i.setState({isConfirmationModalOpen:!1})},overlayClassName:"file-viewer-modal-overlay",appElement:document.getElementById("embedded-app")||document.body},L("Your markup will be lost if you exit before saving this file."))},i.state={isConfirmationModalOpen:!1},i.left=x.DEFAULT_LEFT,i.top=x.DEFAULT_TOP,i}return r.__extends(t,e),t.prototype.componentDidMount=function(){m.logWorkflowsEvent(m.WorkflowsEvent.MarkupEnabled)},t.prototype.componentWillUnmount=function(){this.props.resetMarkupState(),m.logWorkflowsEvent(m.WorkflowsEvent.MarkupCancel)},t.prototype.render=function(){var e=this.props,t=e.coreFVUiProps,r=e.markupState,o=r.isDrawingMode,a=r.formatSubmenu,l=r.fillColor,c=r.strokeColor,d=[{icon:M.rectIcon,onClick:this.onClickTool(P.MarkupType.RECT,[P.FormatSubmenuEntry.FILL,P.FormatSubmenuEntry.STROKE]),label:L("Add square",{comment:"Verb phrase; hover text over an icon that lets user add a square shape to their file"})},{icon:M.circleIcon({stroke:"white",fill:"none"}),onClick:this.onClickTool(P.MarkupType.CIRCLE,[P.FormatSubmenuEntry.FILL,P.FormatSubmenuEntry.STROKE]),label:L("Add circle",{comment:"Verb phrase; hover text over an icon that lets user add a circle to their file"})},{icon:M.textIcon,onClick:this.onClickTool(P.MarkupType.TEXT,[P.FormatSubmenuEntry.STROKE]),label:L("Add text",{comment:"Verb phrase; hover text over an icon that lets user add a text box to their file"})},{icon:M.arrowIcon,onClick:this.onClickTool(P.MarkupType.ARROW,[P.FormatSubmenuEntry.STROKE]),label:L("Add arrow",{comment:"Verb phrase; hover text over an icon that lets user add an arrow to their file"})},{icon:M.drawIcon,onClick:this.onClickDraw,label:L("Draw",{comment:"Verb; hover text over an icon that lets a user draw on their file"}),className:i.default({"markup-pane__tool-button--selected":o})}];return n.default.createElement(w.EditingPane,{paneId:s.SidebarPaneId.Markup,coreFVUiProps:t},n.default.createElement("div",{className:"markup-pane__actions"},n.default.createElement(A.ApplyButton,{onApply:this.handleApply,onClick:function(){},disabled:!1}),n.default.createElement(k.Button,{tagName:"button",variant:"secondary",onClick:this.handleCancel},L("Cancel"))),n.default.createElement("div",{className:"markup-pane__control"},n.default.createElement("div",{className:i.default("markup-pane__main-tool-buttons",{"markup-pane__main-tool-buttons--submenu-open":a.length>0})},d.map((function(e,t){var r=e.icon,o=e.onClick,a=e.label,s=e.className;return n.default.createElement(F.Tooltip,{tooltipContent:a,className:"markup-pane__tooltip",positioning:"below",key:a},n.default.createElement(k.Button,{variant:"secondary",size:"large",onClick:o,className:i.default("markup-pane__tool-button",s)},r))})))),a.length>0&&n.default.createElement(q,{onFillChange:this.onFillChange,onStrokeChange:this.onStrokeChange,fillColor:l,strokeColor:c,menuEntries:a}),n.default.createElement(y.KeyboardBindingConnector,{keyboardBindings:[b.hydrateKeyboardBinding({keyboardEventCriteria:{which:u.KeyCode.BACKSPACE},callback:this.onDelete}),b.hydrateKeyboardBinding({keyboardEventCriteria:{which:u.KeyCode.DELETE},callback:this.onDelete}),b.hydrateKeyboardBinding({keyboardEventCriteria:{which:u.KeyCode.ESC},callback:this.onEscape}),b.hydrateKeyboardBinding({keyboardEventCriteria:{which:u.KeyCode.C,ctrlKey:!0},callback:this.onCopy}),b.hydrateKeyboardBinding({keyboardEventCriteria:{which:u.KeyCode.C,metaKey:!0},callback:this.onCopy}),b.hydrateKeyboardBinding({keyboardEventCriteria:{which:u.KeyCode.V,ctrlKey:!0},callback:this.onPaste}),b.hydrateKeyboardBinding({keyboardEventCriteria:{which:u.KeyCode.V,metaKey:!0},callback:this.onPaste}),b.hydrateKeyboardBinding({keyboardEventCriteria:{which:u.KeyCode.LEFT},callback:this.onLeftArrowPressed}),b.hydrateKeyboardBinding({keyboardEventCriteria:{which:u.KeyCode.UP},callback:this.onUpArrowPressed}),b.hydrateKeyboardBinding({keyboardEventCriteria:{which:u.KeyCode.RIGHT},callback:this.onRightArrowPressed}),b.hydrateKeyboardBinding({keyboardEventCriteria:{which:u.KeyCode.DOWN},callback:this.onDownArrowPressed})]}),this.renderConfirmationModal())},t})(n.default.Component);t.MarkupPaneComponent=j;var q=function(e){var t=e.menuEntries,r=e.onFillChange,i=e.onStrokeChange,o=e.fillColor,a=e.strokeColor;return n.default.createElement("div",{className:"markup-pane__control markup-pane__control-colors"},t.map((function(e){switch(e){case P.FormatSubmenuEntry.FILL:return n.default.createElement(V,{icon:N(o),onChange:r,key:"fill-menu",label:L("Change fill color",{comment:"Verb phrase; hover text over icon that gives user ability to add or remove a color fill from a shape that they’ve added to their file"})});case P.FormatSubmenuEntry.STROKE:return n.default.createElement(V,{icon:N(a,!1),onChange:i,key:"stroke-menu",label:L("Change line color",{comment:"Verb phrase; hover text over icon that gives user ability to change the color of a line that they’ve added to their file"})});default:return null}})))};t.ConnectedMarkupPaneComponent=a.connect((function(e,t){return{markupState:C.getMarkupState(e),currentPageIndex:g.getCurrentPageIndex(e)||0,previewType:_.getPreviewType(f.getApiDataForFile(e,t.file).data)}}),{changeMode:h.changeMode,setMarkupDrawingMode:h.setMarkupDrawingMode,resetMarkupState:h.resetMarkupState,setMarkupFill:h.setMarkupFill,setMarkupStroke:h.setMarkupStroke,setMarkupFormatSubmenu:h.setMarkupFormatSubmenu})(j),t.MarkupPane=v.requireCssWithComponent(t.ConnectedMarkupPaneComponent,["/static/css/file_viewer_sidebar/editing_pane-vfljT-58j.css","/static/css/file_viewer_sidebar/markup_pane-vflJdE0DJ.css"])})),define("modules/clean/react/workflows/markup_icons",["require","exports","tslib","react"],(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),t.arrowIcon=n.default.createElement("svg",{width:"21",height:"20",viewBox:"0 0 21 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n.default.createElement("line",{y1:"-1",x2:"18.4444",y2:"-1",transform:"matrix(0.714122 -0.700021 0.724869 0.688886 2 19.5325)",stroke:"white","stroke-width":"2"}),n.default.createElement("path",{d:"M15.6003 4.81822L15.4013 13.4904L6.62128 5.14504L15.6003 4.81822Z",fill:"white"})),t.circleIcon=function(e){var t=e.stroke,r=void 0===t?"white":t,i=e.fill,o=void 0===i?"none":i;return n.default.createElement("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:o,xmlns:"http://www.w3.org/2000/svg"},n.default.createElement("rect",{x:"1",y:"1",width:"18",height:"18",rx:"9",stroke:r,"stroke-width":"2"}))},t.drawIcon=n.default.createElement("svg",{width:"21",height:"20",viewBox:"0 0 21 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n.default.createElement("path",{d:"M1 3.12785C1 3.12785 5.98474 -0.481787 7.42857 1.70169C9.66397 5.08224 -0.322983 7.42821 2.28571 10.6819C4.85714 13.8892 11.2857 4.26736 13.8571 7.37626C16.659 10.7637 3.89286 14.5305 6.78571 18.3792C9.19643 21.5864 19 11.3233 19 11.3233",stroke:"white","stroke-width":"2",strokeLinecap:"round"}),n.default.createElement("circle",{cx:"19",cy:"11",r:"2",fill:"white"})),t.rectIcon=n.default.createElement("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n.default.createElement("rect",{x:"1",y:"1",width:"16",height:"16",stroke:"white","stroke-width":"2"})),t.textIcon=n.default.createElement("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n.default.createElement("rect",{x:"1",y:"1",width:"16",height:"16",stroke:"white","stroke-width":"2"}),n.default.createElement("line",{x1:"5",y1:"6",x2:"13",y2:"6",stroke:"white","stroke-width":"2"}),n.default.createElement("line",{x1:"9",y1:"5",x2:"9",y2:"13",stroke:"white","stroke-width":"2"})),t.transparentFillIcon=n.default.createElement("svg",{width:"20",height:"20",viewBox:"0 0 17 17",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n.default.createElement("rect",{x:"1",y:"1",width:"15",height:"15",rx:"7.5",stroke:"#F3F4F5","stroke-width":"2"}),n.default.createElement("line",{x1:"1.93223",y1:"13.6637",x2:"13.8322",y2:"4.31368",stroke:"#F3F4F5","stroke-width":"2"}))})),define("modules/clean/react/workflows/markup/api",["require","exports","modules/clean/react/file_viewer/feedback_form/types","modules/clean/react/file_viewer/feedback_form/api"],(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.submitMarkupFeedback=function(e,t,i){return n.submitFeedback(r.SubmitFeedbackProductName.DROPBOX_MARKUP,e,t,i)}})),define("modules/clean/react/file_viewer_sidebar/panes/metadata_pane",["require","exports","tslib","react","file-viewer/modes","file-viewer/core","modules/clean/react/file_metadata/component/loadable_metadata_details","modules/clean/react/css","modules/clean/react/file_viewer_sidebar/panes/strings","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer_sidebar/utils","react-redux","modules/clean/react/file_viewer/data/selectors","file-viewer/modes/sidebar/pane_title"],(function(e,t,r,n,i,o,a,s,l,c,u,d,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),t.UnconnectedMetadataPaneComponent=function(e){var t=u.isSidebarOpen(e.sidebar)&&u.isSidebarPaneIdAtTopOfStack(o.SidebarPaneId.Metadata,e.sidebar),s=u.getSecondFromTopSidebarPaneId(e.sidebar);return n.default.createElement(i.Pane,r.__assign({paneId:o.SidebarPaneId.Metadata},e.coreFVUiProps),n.default.createElement("div",{className:"metadata-pane"},n.default.createElement(m.PaneTitleComponent,{title:l.MetadataPaneStrings.details,backButton:s?{previousPaneId:s,onClick:e.popSidebarPane}:void 0,intl:e.coreFVUiProps.intl}),n.default.createElement(a.LoadableMetadataDetails,{file:e.file,user:e.user,sharedLinkInfo:e.sharedLinkInfo,isActiveTab:t,previewType:e.previewType})))};var f={popSidebarPane:c.popSidebarPane};t.ConnectedMetadataPaneComponent=d.connect((function(e){return{sidebar:p.getSidebar(e)}}),f)(t.UnconnectedMetadataPaneComponent),t.MetadataPane=s.requireCssWithComponent(t.ConnectedMetadataPaneComponent,["/static/css/file_viewer_sidebar/metadata_pane-vflcHAAtb.css"])})),define("modules/clean/react/file_viewer_sidebar/panes/strings",["require","exports","modules/core/i18n"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DocumentationPaneStrings={details:r._("Details",{comment:"Section header on the file preview sidebar shown on top of the section listing general file metadata."}),activity:r._("Activity",{comment:"Section header on the file preview sidebar shown on top of the section listing the latest file activity"})},t.MetadataPaneStrings={details:r._("Details",{comment:"Title of the content pane displaying file metadata (e.g., upload date, file size, filetype-specific metadata) on the file preview sidebar."})},t.ActivityPaneStrings={details:r._("Activity",{comment:"Title of the content pane displaying list of latest file activity on the file preview sidebar."})},t.DetailsSectionStrings={viewPreviousVersions:r._("View previous versions",{comment:"Text for outbound link from the file preview sidebar to take the user to the version history page showing the list of versions/revisions of the current file."}),viewAllDetails:r._("View all details",{comment:"Text for button on the file preview sidebar to take the user to the section."})},t.ActivitySectionStrings={viewAllActivities:r._("View all activity",{comment:"Text for button on the file preview sidebar showing subset of activity, that takes user to pane showing all activity."})}})),define("modules/clean/react/file_viewer_sidebar/panes/rotation_control",["require","exports","tslib","react","classnames","modules/core/i18n","spectrum/button","modules/clean/mouse_button_code","modules/clean/keycode"],(function(e,t,r,n,i,o,a,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),i=r.__importDefault(i);var c=o.i18n_default_project("watermarking")._,u=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.rotateTimeoutId=null,t.state={isRotating:!1},t.startRotatingAC=function(e){e.button!==s.MouseButtonCode.LEFT&&e.keyCode!==l.KeyCode.ENTER||t.startRotating(1)},t.startRotatingCW=function(e){e.button!==s.MouseButtonCode.LEFT&&e.keyCode!==l.KeyCode.ENTER||t.startRotating(-1)},t.startRotating=function(e){t.setState({isRotating:!0},(function(){return t.rotate(e)}))},t.stopRotating=function(){t.setState({isRotating:!1})},t.rotate=function(e){var r=t.props,n=r.onChange,i=r.step,o=void 0===i?15:i,a=r.value,s=void 0===a?0:a;if(n&&t.state.isRotating){var l=s+e*o;l>359&&(l-=360),l<0&&(l+=360),n(l),t.rotateTimeoutId&&clearTimeout(t.rotateTimeoutId);var c=setTimeout((function(){t.rotateTimeoutId=null,t.rotate(e)}),200);t.rotateTimeoutId=c}},t}return r.__extends(t,e),t.prototype.componentWillUnmount=function(){this.rotateTimeoutId&&clearTimeout(this.rotateTimeoutId)},t.prototype.render=function(){var e=this.props,t=e.className,r=e.disabled,o=e.value;return n.default.createElement("div",{className:i.default("rotation-control",t)},n.default.createElement("div",{className:"rotation-control--current-value ax-visually-hidden","aria-live":"polite"},c("%(value)d degrees",{comment:"Statement of mathematical rotation angle, e.g. 45 degrees"}).format({value:o})),n.default.createElement(a.Button,{disabled:r,onKeyDown:this.startRotatingAC,onKeyUp:this.stopRotating,onMouseDown:this.startRotatingAC,onMouseUp:this.stopRotating,size:"large",variant:"secondary"},n.default.createElement("span",{className:"ax-visually-hidden"},c("Rotate Anticlockwise")),n.default.createElement("svg",{"aria-hidden":!0,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n.default.createElement("path",{d:"M9.87193 19.7329C10.5328 19.9073 11.227 20.0002 11.943 20.0002C16.3929 20.0002 20.0002 16.4106 20.0002 11.9825C20.0002 7.55449 16.3929 3.96484 11.943 3.96484C8.793 3.96484 6.06518 5.76364 4.74032 8.38529",stroke:"white",strokeWidth:"2"}),n.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4.92141 7.72819L10.0233 7.21687L10.1704 8.66739L3.61077 9.3248L2.94905 2.79745L4.40675 2.65136L4.92141 7.72819Z",fill:"white"}))),n.default.createElement(a.Button,{disabled:r,onKeyDown:this.startRotatingCW,onKeyUp:this.stopRotating,onMouseDown:this.startRotatingCW,onMouseUp:this.stopRotating,size:"large",variant:"secondary"},n.default.createElement("span",{className:"ax-visually-hidden"},c("Rotate Clockwise")),n.default.createElement("svg",{"aria-hidden":!0,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n.default.createElement("path",{d:"M14.1283 19.7329C13.4674 19.9073 12.7732 20.0002 12.0572 20.0002C7.60734 20.0002 4 16.4106 4 11.9825C4 7.55449 7.60734 3.96484 12.0572 3.96484C15.2072 3.96484 17.9351 5.76364 19.2599 8.38529",stroke:"white",strokeWidth:"2"}),n.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M19.0788 7.72819L13.9769 7.21687L13.8299 8.66739L20.3895 9.3248L21.0512 2.79745L19.5935 2.65136L19.0788 7.72819Z",fill:"white"}))))},t})(n.default.Component);t.RotationControl=u})),define("modules/clean/react/file_viewer_sidebar/panes/watermarking_pane",["require","exports","tslib","react","react-dom","classnames","external/lodash","react-aria-tabpanel","file-viewer/core","react-redux","file-viewer/core","modules/clean/browse_uri_interface","modules/clean/file_store/utils","modules/clean/loggers/workflows_logger","modules/clean/react/css","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/data/selectors","modules/clean/react/file_viewer_sidebar/panes/editing_pane","modules/clean/react/snackbar","modules/clean/react/watermarking/drawing","modules/clean/react/watermarking/api","modules/core/i18n","spectrum/button","spectrum/dropdown_menu","spectrum/input","modules/clean/keycode","modules/clean/react/file_viewer_sidebar/panes/rotation_control","modules/clean/react/watermarking/utils","modules/clean/previews/data/selectors","modules/clean/previews/data/preview_type_util","modules/clean/react/previews/constants","modules/clean/react/watermarking/types","modules/core/browser","modules/clean/react/watermarking/selectors","modules/clean/react/file_viewer_sidebar/panes/image_chooser_section","modules/clean/react/watermarking/apply_watermark_button","modules/clean/react/watermarking/utils","premium-workflows/components/base/slider","spectrum/tabbed_header"],(function(e,t,r,n,i,o,a,s,l,c,u,d,p,m,f,_,v,h,g,w,y,b,E,S,k,T,C,P,x,A,M,I,F,O,D,R,L,N,U){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),i=r.__importStar(i),o=r.__importDefault(o),F=r.__importStar(F);var W,V=b.i18n_default_project("watermarking")._;t.WATERMARKING_PANE_POSITION_BUTTON_CLASSNAME="watermarking-pane__position-button",(function(e){e.TEXT="watermark_pane_text_tab",e.IMAGE="watermark_pane_image_tab"})(W||(W={}));var B=4*Math.pow(10,6),j=function(){return n.default.createElement("svg",{width:"24",height:"24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n.default.createElement("circle",{className:"northwest",cx:"7",cy:"7",r:"2"}),n.default.createElement("circle",{className:"northeast",cx:"17",cy:"7",r:"2"}),n.default.createElement("circle",{className:"southeast",cx:"17",cy:"17",r:"2"}),n.default.createElement("circle",{className:"southwest",cx:"7",cy:"17",r:"2"}),n.default.createElement("circle",{className:"center",cx:"12",cy:"12",r:"2"}))},q=[{key:I.WatermarkPosition.CENTER,description:V("Center",{comment:"Position in the center"})},{key:I.WatermarkPosition.NORTHWEST,description:V("Upper left",{comment:"Position in upper left corner"})},{key:I.WatermarkPosition.NORTHEAST,description:V("Upper right",{comment:"Position in upper right corner"})},{key:I.WatermarkPosition.SOUTHWEST,description:V("Lower left",{comment:"Position in lower left corner"})},{key:I.WatermarkPosition.SOUTHEAST,description:V("Lower right",{comment:"Position in lower right corner"})},{key:I.WatermarkPosition.REPEAT,description:V("Repeat",{comment:"Position repeated across the image"})}],K=[{key:"black",description:V("Dark",{comment:"Dark watermark text color"})},{key:"white",description:V("Light",{comment:"Light watermark text color"})}],H=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.defaultText="",t.getTiledImageWatermark=function(){var e=t.props,n=e.watermarkState,i=(0,e.tilingRenderer)(I.getWatermarkingOptions(n).scale),o=i.canvas.toDataURL().split(",",2).pop();if(o)return r.__assign({},i,{image:o})},t.getImageWatermark=function(){var e,r,n=t.props.watermarkState;if(n.mode===I.WatermarkingMode.TEXT){if(!(r=n.textWatermarkingOptions).text)return;e=w.drawTextTile(r.text,r.size*r.scale,r.fontFamily,r.color,r.opacity/100,r.angle/180*Math.PI).canvas}else{if(!(r=n.imageWatermarkingOptions).image)return;e=w.drawImageTile(r.image,r.size*r.scale,r.opacity/100,r.angle/180*Math.PI).canvas}if(e)return{image:e.toDataURL().split(",",2).pop(),position:r.position,marginX:r.position===I.WatermarkPosition.CENTER?0:r.marginX,marginY:r.position===I.WatermarkPosition.CENTER?0:r.marginY}},t.commitAndRedirect=function(e){return r.__awaiter(t,void 0,void 0,(function(){var t,n,i,o,a,s,l;return r.__generator(this,(function(r){switch(r.label){case 0:if(t=this.props.watermarkState,n=I.getWatermarkingOptions(t),!(i=n.position===I.WatermarkPosition.REPEAT?this.getTiledImageWatermark():this.getImageWatermark()))return[2];if(i.image.length>B)return[2,g.Snackbar.fail(V("That’s too big to save. Try making your watermark smaller.",{project:"watermarking"}),"watermarking-notification")];g.Snackbar.sync(V("Watermarking file..."),!1,"watermarking-notification"),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,y.sendWatermarkRequest(this.props.user.id,this.props.file.file_id,e,i)];case 2:return o=r.sent(),[3,4];case 3:return a=r.sent(),s=void 0,s=P.isOverQuotaError(a.error)?V("The watermark could not be saved because your account is over quota."):P.isFilesystemError(a.error)?V("The watermark could not be saved because the file was moved or deleted."):P.isUnsupportedFileError(a.error)?V("Watermarking is not available for this file type."):P.isUnauthorizedAccessError(a.error)?V("The watermark could not be saved because you do not have permission to save to this folder."):V("Couldn’t save watermark. Refresh the page to try again."),[2,g.Snackbar.fail(s,"watermarking-notification")];case 4:return(l=o.fq_path||p.isBrowseFile(this.props.file)&&this.props.file.fq_path)?F.replace_location(d.preview_uri_for_fq_path(this.props.user,l,{context:M.PreviewSourceContext.Workflow})):F.reload(),[2]}}))}))},t.updateCommonWatermarkingOptions=function(e){t.props.watermarkState.mode===I.WatermarkingMode.TEXT?t.updateTextWatermarkingOptions(e):t.updateImageWatermarkingOptions(e)},t.updateTextWatermarkingOptions=function(e){t.props.updateWatermarkOptions({textWatermarkingOptions:e})},t.updateImageWatermarkingOptions=function(e){t.props.updateWatermarkOptions({imageWatermarkingOptions:e})},t.debouncedLogOpacityChange=a.debounce((function(e){m.logWorkflowsEvent(m.WorkflowsEvent.WatermarkTransparencyChanged,L.getWatermarkMilestone(t.props.user),{watermark_type:t.props.watermarkState.mode,start_transparency:String(t.startingOpacity),end_transparency:String(e)}),t.startingOpacity=void 0}),200),t.handleOpacityChange=function(e){var r=t.props.watermarkState,n=I.getWatermarkingOptions(r).opacity;e!==n&&(t.startingOpacity=t.startingOpacity||n,t.debouncedLogOpacityChange(e),t.updateCommonWatermarkingOptions({opacity:e}))},t.debouncedLogSizeChange=a.debounce((function(e){m.logWorkflowsEvent(m.WorkflowsEvent.WatermarkSizeChanged,L.getWatermarkMilestone(t.props.user),{watermark_type:t.props.watermarkState.mode,start_size:String(t.startingSize),end_size:String(e)}),t.startingSize=void 0}),200),t.handleSizeChange=function(e){var r=t.props.watermarkState,n=I.getWatermarkingOptions(r).size;e!==n&&(t.startingSize=t.startingSize||n,t.debouncedLogSizeChange(e),t.updateCommonWatermarkingOptions({size:e}))},t.handleTextChange=function(e){t.textInput&&t.updateTextWatermarkingOptions({text:t.textInput.value})},t.logTextInputFocus=function(){m.logWorkflowsEvent(m.WorkflowsEvent.WatermarkTextInputEnterFocus,L.getWatermarkMilestone(t.props.user),{num_characters:t.textInput&&String(t.textInput.value.length)})},t.logTextInputBlur=function(){m.logWorkflowsEvent(m.WorkflowsEvent.WatermarkTextInputExitFocus,L.getWatermarkMilestone(t.props.user),{num_characters:t.textInput&&String(t.textInput.value.length)})},t.handleImageChange=function(e){t.updateImageWatermarkingOptions(r.__assign({image:e,imageAsDataURL:void 0},L.getImageDefaultSizes(e,t.props.pageDimensions)))},t.handlePositionChange=function(e){var r=t.props.watermarkState,n=I.getWatermarkingOptions(r).position,i={position:e};if(n===I.WatermarkPosition.REPEAT&&i.position!==I.WatermarkPosition.REPEAT&&(i.angle=0),n!==I.WatermarkPosition.REPEAT&&i.position===I.WatermarkPosition.REPEAT){var o=I.getWatermarkingOptions(P.DEFAULT_WATERMARKING_STATE);i.angle=o.angle}m.logWorkflowsEvent(m.WorkflowsEvent.WatermarkPositionMenuSelectionMade,L.getWatermarkMilestone(t.props.user),{watermark_type:r.mode,start_position:n,end_position:e}),t.updateCommonWatermarkingOptions(i)},t.handleColorChange=function(e){m.logWorkflowsEvent(m.WorkflowsEvent.WatermarkColorClicked,L.getWatermarkMilestone(t.props.user),{watermark_type:t.props.watermarkState.mode,color:e}),t.updateTextWatermarkingOptions({color:e})},t.handleRotationChange=function(e){var r=t.props.watermarkState,n=I.getWatermarkingOptions(r).angle;m.logWorkflowsEvent(m.WorkflowsEvent.WatermarkRotationClicked,L.getWatermarkMilestone(t.props.user),{watermark_type:r.mode,start_rotation:String(n),end_rotation:String(e)}),t.updateCommonWatermarkingOptions({angle:e})},t.handleCancel=function(e){e.preventDefault(),t.props.changeMode(u.FileViewerMode.Documentation)},t.onTabClicked=function(e){e.currentTarget.id===W.TEXT?(m.logWorkflowsEvent(m.WorkflowsEvent.WatermarkTextTabClicked,L.getWatermarkMilestone(t.props.user)),t.props.switchWatermarkingMode(I.WatermarkingMode.TEXT)):(m.logWorkflowsEvent(m.WorkflowsEvent.WatermarkImageTabClicked,L.getWatermarkMilestone(t.props.user)),t.props.switchWatermarkingMode(I.WatermarkingMode.IMAGE))},t.onTabKeyUp=function(e){[T.KeyCode.ENTER,T.KeyCode.SPACE].includes(e.keyCode)&&(e.currentTarget.id===W.TEXT?(m.logWorkflowsEvent(m.WorkflowsEvent.WatermarkTextTabClicked,L.getWatermarkMilestone(t.props.user)),t.props.switchWatermarkingMode(I.WatermarkingMode.TEXT)):(m.logWorkflowsEvent(m.WorkflowsEvent.WatermarkImageTabClicked,L.getWatermarkMilestone(t.props.user)),t.props.switchWatermarkingMode(I.WatermarkingMode.IMAGE)))},t.onInputRef=function(e){t.textInput=e},t.onTabWrapperRef=function(e){t.tabWrapperRef=e?i.findDOMNode(e):null;var r=t.tabWrapperRef&&t.tabWrapperRef.querySelector('[role="tab"][aria-selected="true"]');r&&r.focus()},t.onPositionRef=function(e){t.positionRef=e},t.handleApply=function(e){return r.__awaiter(t,void 0,void 0,(function(){var t,n,i,o;return r.__generator(this,(function(r){return t=this.props,n=t.isTrialMode,i=t.user,o=t.watermarkState,n?[2]:(m.logWorkflowsEvent(e?m.WorkflowsEvent.WatermarkApplyOverwrite:m.WorkflowsEvent.WatermarkApplySaveAsCopy,L.getWatermarkMilestone(i),{watermark_type:o.mode,num_characters:this.textInput&&String(this.textInput.value.length),end_position:String(I.getWatermarkingOptions(o).position),end_rotation:String(I.getWatermarkingOptions(o).angle),end_size:String(I.getWatermarkingOptions(o).size),end_transparency:String(I.getWatermarkingOptions(o).opacity)}),P.setUserMetadataTextWatermarkingState(i,o),this.commitAndRedirect(e),[2])}))}))},t.logApplyButtonClick=function(){m.logWorkflowsEvent(m.WorkflowsEvent.WatermarkOpenApplyMenu,L.getWatermarkMilestone(t.props.user),{watermark_type:t.props.watermarkState.mode})},t.getDropdownDescription=function(e,t){var r=t.find((function(t){return t.key===e}));return r?r.description:void 0},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){var e=this.props.watermarkState;this.updateScale(),m.logWorkflowsEvent(m.WorkflowsEvent.WatermarkEnable,L.getWatermarkMilestone(this.props.user),{num_characters:this.textInput&&String(this.textInput.value.length),start_position:String(I.getWatermarkingOptions(e).position),start_rotation:String(I.getWatermarkingOptions(e).angle),start_size:String(I.getWatermarkingOptions(e).size),start_transparency:String(I.getWatermarkingOptions(e).opacity)})},t.prototype.componentWillUnmount=function(){P.setUserMetadataTextWatermarkingState(this.props.user,this.props.watermarkState),m.logWorkflowsEvent(m.WorkflowsEvent.WatermarkCancel,L.getWatermarkMilestone(this.props.user),{watermark_type:this.props.watermarkState.mode})},t.prototype.updateScale=function(){var e=this.props,t=e.updateWatermarkOptions,r=e.previewType,n=P.getWatermarkScale(r);t({imageWatermarkingOptions:{scale:n},textWatermarkingOptions:{scale:n}})},t.prototype.render=function(){var e=this.props,t=e.coreFVUiProps,r=e.file,i=e.watermarkState,a=e.user,c=I.getWatermarkingOptions(i),u=i.textWatermarkingOptions,d=i.imageWatermarkingOptions,p=c.position||I.WatermarkPosition.REPEAT,m=u.color,f=i.mode===I.WatermarkingMode.TEXT&&!!u.text||i.mode===I.WatermarkingMode.IMAGE&&!!d.image;return n.default.createElement(h.EditingPane,{paneId:l.SidebarPaneId.Watermarking,coreFVUiProps:t,classname:"watermarking-pane"},n.default.createElement("div",{className:"watermarking-pane__control watermarking-pane__actions"},n.default.createElement(R.ApplyWatermarkButton,{onApply:this.handleApply,onClick:this.logApplyButtonClick,allowWatermark:L.allowWatermark(r,a),hasInput:i.mode===I.WatermarkingMode.TEXT?!!u.text:!!d.image,trialVariant:L.getWatermarkTrialVariant(a),milestone:L.getWatermarkMilestone(a),isPlusUser:a.paid}),n.default.createElement(E.Button,{tagName:"button",variant:"secondary",onClick:this.handleCancel},L.allowWatermarkTrial(a)?V("Exit"):V("Cancel"))),n.default.createElement(s.Wrapper,{ref:this.onTabWrapperRef},n.default.createElement(U.TabbedHeader,null,n.default.createElement(U.Tab,{id:W.TEXT,onClick:this.onTabClicked,onKeyUp:this.onTabKeyUp,active:i.mode===I.WatermarkingMode.TEXT},V("Text")),n.default.createElement(U.Tab,{id:W.IMAGE,onClick:this.onTabClicked,onKeyUp:this.onTabKeyUp,active:i.mode===I.WatermarkingMode.IMAGE},V("Image"))),n.default.createElement("div",{className:"watermarking-pane__tab-panels"},n.default.createElement(s.TabPanel,{active:i.mode===I.WatermarkingMode.TEXT,tabId:W.TEXT},n.default.createElement("label",{className:"watermarking-pane__control watermarking-pane__text"},n.default.createElement("p",{className:"watermarking-pane__label"},V("Watermark")),n.default.createElement(k.Input,{"aria-label":V("Text of Watermark"),autoComplete:"off",placeholder:V("Add watermark text"),forwardedRef:this.onInputRef,fullWidth:!0,name:"text",value:u.text,onChange:this.handleTextChange,onFocus:this.logTextInputFocus,onBlur:this.logTextInputBlur,maxLength:100}))),n.default.createElement(s.TabPanel,{active:i.mode===I.WatermarkingMode.IMAGE,tabId:W.IMAGE},n.default.createElement("p",{className:"watermarking-pane__label","aria-hidden":!0},V("Watermark")),n.default.createElement(D.ImageChooserSection,{coreFVUiProps:t,file:r,user:this.props.user,defaultImageURL:d.image?d.image.src:void 0,onImageSelected:this.handleImageChange,focusOnSelect:this.positionRef&&this.positionRef.querySelector("button"),isImageWatermarkingMode:i.mode===I.WatermarkingMode.IMAGE})))),n.default.createElement("div",{className:o.default({"watermarking-pane__controls--disabled":!f})},n.default.createElement("div",{className:"watermarking-pane__control watermarking-pane__position watermarking-pane__dropdown",ref:this.onPositionRef},n.default.createElement("p",{className:"watermarking-pane__label"},V("Position")),n.default.createElement(S.DropdownMenu,{disabled:!f,onSelection:this.handlePositionChange},n.default.createElement(S.DropdownMenuButton,null,n.default.createElement("span",{"aria-label":V("Position"),className:"icon icon-"+p.toLowerCase()},n.default.createElement(j,null)),this.getDropdownDescription(p,q)),n.default.createElement(S.Menu,null,q.map((function(e){return n.default.createElement(S.MenuItem,{key:e.key,value:e.key,selected:e.key===p},n.default.createElement("span",{className:"icon icon-"+e.key.toLowerCase()},n.default.createElement(j,null)),e.description)}))))),i.mode===I.WatermarkingMode.TEXT?n.default.createElement("div",{className:"watermarking-pane__control watermarking-pane__dropdown watermarking-pane__color"},n.default.createElement("p",{className:"watermarking-pane__label"},V("Color")),n.default.createElement(S.DropdownMenu,{disabled:!f,onSelection:this.handleColorChange},n.default.createElement(S.DropdownMenuButton,null,n.default.createElement("span",{className:"icon watermarking-pane__color-icon",style:{backgroundColor:m}}),this.getDropdownDescription(m,K)),n.default.createElement(S.Menu,null,K.map((function(e){return n.default.createElement(S.MenuItem,{key:e.key,value:e.key,selected:e.key===m},n.default.createElement("span",{className:"icon watermarking-pane__color-icon",style:{backgroundColor:e.key}}),e.description)}))))):null,n.default.createElement("div",{className:"watermarking-pane__control watermarking-pane__rotation"},n.default.createElement("p",{className:"watermarking-pane__label"},V("Rotation")),n.default.createElement(C.RotationControl,{disabled:!f,value:c.angle,onChange:this.handleRotationChange})),n.default.createElement("label",{className:"watermarking-pane__control watermarking-pane__opacity"},n.default.createElement("p",{className:"watermarking-pane__label"},V("Opacity")),n.default.createElement(N.Slider,{className:"watermarking-pane__opacity-slider",disabled:!f,min:0,max:100,darkMode:!0,fullWidth:!0,value:c.opacity,name:"opacity",onChange:this.handleOpacityChange})),n.default.createElement("label",{className:"watermarking-pane__control watermarking-pane__font_size"},n.default.createElement("p",{className:"watermarking-pane__label"},V("Size")),n.default.createElement(N.Slider,{className:"watermarking-pane__fontsize-slider",disabled:!f,min:c.minSize,max:c.maxSize,darkMode:!0,fullWidth:!0,value:c.size,name:"fontsize",onChange:this.handleSizeChange,step:"any"}))))},t})(n.default.Component);t.WatermarkingPaneComponent=H;t.ConnectedWatermarkingPaneComponent=c.connect((function(e,t){return{mode:v.getMode(e),isTrialMode:v.getIsTrialMode(e),watermarkState:O.getWatermarkState(e),tilingRenderer:O.getWatermarkTilingFunc(e),previewType:A.getPreviewType(x.getApiDataForFile(e,t.file).data),pageDimensions:v.getPageDimensions(e)}}),{changeMode:_.changeMode,updateWatermarkOptions:_.updateWatermarkOptions,switchWatermarkingMode:_.switchWatermarkingMode})(H),t.WatermarkingPane=f.requireCssWithComponent(t.ConnectedWatermarkingPaneComponent,["/static/css/file_viewer_sidebar/watermarking_pane-vflBawaqf.css"])})),define("modules/clean/react/file_viewer_sidebar/panes/image_chooser_section",["require","exports","tslib","react","dropins_sdk_refactor/dropins_sdk_internal","modules/clean/filepath","modules/clean/loggers/workflows_logger","spectrum/popover","modules/core/i18n","modules/clean/react/snackbar","modules/clean/react/css","classnames","spectrum/colorized_icon","spectrum/icon_action","spectrum/tooltip","modules/clean/react/watermarking/utils"],(function(e,t,r,n,i,o,a,s,l,c,u,d,p,m,f,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),d=r.__importDefault(d);var v,h=l.i18n_default_project("watermarking")._,g=["image/png","image/jpeg","image/jpg","image/gif","image/bmp"];(function(e){e.FROM_DROPBOX="dropbox",e.FROM_COMPUTER="computer",e.FROM_DRAGDROP="dragdrop"})(v=t.ImageSource||(t.ImageSource={}));var w=function(e){return n.default.createElement("svg",{className:e.className,viewBox:"0 0 24 24",version:"1.1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},n.default.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},n.default.createElement("path",{d:"M16.9849536,10.3304435 L21.935986,13.4846597 L16.9501078,16.6610755 L11.9679572,13.4870801 L6.98587822,16.6610755 L2,13.4846597 L6.950961,10.330489 L2,7.17634414 L6.9859499,4 L11.9679214,7.17394657 L16.9501795,4 L21.9359143,7.17634414 L16.9849536,10.3304435 Z M16.9151901,10.330489 L11.9679213,7.17874171 L7.020724,10.3304435 L11.9679572,13.4822392 L16.9151901,10.330489 Z M7.01792123,17.713692 L12.0037994,14.5376346 L16.9897493,17.713692 L12.0037994,20.8901078 L7.01792123,17.713692 Z",fill:e.fill?e.fill:"#ffffff"})))};w.displayName="DropboxIcon";var y=function(e){return n.default.createElement("svg",{className:e.className,viewBox:"0 0 24 24",version:"1.1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},n.default.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},n.default.createElement("path",{d:"M14,10 L24,10 L24,14 L14,14 L14,24 L10,24 L10,14 L0,14 L0,10 L10,10 L10,0 L14,0 L14,10 Z",fill:e.fill?e.fill:"#ffffff"})))};y.displayName="PlusIcon";var b=(function(e){function t(t){var s=e.call(this,t)||this;return s.handleDragOver=function(){s.setState({isDraggedOver:!0})},s.onChooseFromDropbox=function(e){return r.__awaiter(s,void 0,void 0,(function(){var t,n,i;return r.__generator(this,(function(r){switch(r.label){case 0:if(!(t=e.pop())||e.length)throw new Error("Dropbox chooser should only return one item");return n=t.link,[4,_.getImageFromURL(n)];case 1:return i=r.sent(),this.onImageSelected(i,n,t.name,v.FROM_DROPBOX),[2]}}))}))},s.onChooseFromComputer=function(e){return r.__awaiter(s,void 0,void 0,(function(){var t,n,i;return r.__generator(this,(function(r){switch(r.label){case 0:return e.currentTarget.files?(t=Array.from(e.currentTarget.files).pop())?(n=URL.createObjectURL(t),[4,_.getImageFromURL(n)]):[2]:[3,2];case 1:i=r.sent(),this.onImageSelected(i,n,t.name,v.FROM_COMPUTER),r.label=2;case 2:return[2]}}))}))},s.onDropFile=function(e){return r.__awaiter(s,void 0,void 0,(function(){var t,i,o;return r.__generator(this,(function(r){switch(r.label){case 0:return e.preventDefault(),this.setState({isDraggedOver:!1}),(t=e.dataTransfer.files[0])?g.includes(t.type)?(i=URL.createObjectURL(t),[4,_.getImageFromURL(i)]):(c.Snackbar.show(n.default.createElement(c.ControlledSnackbarComponent,{id:"image-watermarking-drag-drop-error",title:h("Can’t add. Choose an image file, like JPEG, GIF or PNG.",{project:"watermarking",comment:"Error message shown when a user tries to drag and drop a non-image file when in image watermarking mode"}),variant:"fail",closeButtonText:h("Try again",{project:"watermarking",comment:"Error message close button, encouraging user to try to drag and drop a different file"})})),[2]):[2];case 1:return o=r.sent(),this.onImageSelected(o,i,t.name,v.FROM_DRAGDROP),[2]}}))}))},s.onDragOver=function(e){e.preventDefault(),s.setState({isDraggedOver:!0})},s.onDragLeave=function(e){e.preventDefault(),s.setState({isDraggedOver:!1})},s.onImageSelected=function(e,t,r,n){if(s.setState({imageURL:t},(function(){var e=t&&s.props.focusOnSelect?s.props.focusOnSelect:document.querySelector(".image-chooser__popover-trigger");e&&e.focus()})),e){var i=o.file_extension_for_logging(r||"");a.logWorkflowsEvent(a.WorkflowsEvent.WatermarkImageUploaded,_.getWatermarkMilestone(s.props.user),{source:n,image_ext:i})}s.props.onImageSelected(e)},s.onDeleteButtonClicked=function(e){a.logWorkflowsEvent(a.WorkflowsEvent.WatermarkImageDeleted,_.getWatermarkMilestone(s.props.user)),s.onImageSelected(void 0,void 0)},s.onSourceSelection=function(e){if(a.logWorkflowsEvent(a.WorkflowsEvent.WatermarkImageUploadClicked,_.getWatermarkMilestone(s.props.user),{source:e}),e===v.FROM_DROPBOX)try{i.Dropbox.choose({multiselect:!1,success:s.onChooseFromDropbox,linkType:"direct",extensions:["images"]})}catch(e){c.Snackbar.fail(h("Couldn’t add image from Dropbox. Please reload the page and try again.",{project:"watermarking"}))}else s.imageUploadRef&&s.imageUploadRef.click()},s.state={isDraggedOver:!1,imageURL:t.defaultImageURL},i.Dropbox.init({appKey:"dropbox"}),s}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.props.isImageWatermarkingMode&&window.addEventListener("dragover",this.handleDragOver)},t.prototype.componentDidUpdate=function(e){this.props.isImageWatermarkingMode!==e.isImageWatermarkingMode&&(this.props.isImageWatermarkingMode?window.addEventListener("dragover",this.handleDragOver):window.removeEventListener("dragover",this.handleDragOver))},t.prototype.componentWillUnmount=function(){this.props.isImageWatermarkingMode&&window.removeEventListener("dragover",this.handleDragOver)},t.prototype.render=function(){var e=this;return n.default.createElement(n.default.Fragment,null,this.props.isImageWatermarkingMode&&n.default.createElement("div",{className:d.default("watermarking-drop-zone",{"watermarking-drop-zone--dragged-over":this.state.isDraggedOver}),onDrop:this.onDropFile,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave},this.state.isDraggedOver?n.default.createElement("p",{className:"watermarking-drop-zone__text"},h("Drop image here")):null),n.default.createElement("div",{className:"image-chooser-section"},this.state.imageURL?n.default.createElement(n.default.Fragment,null,n.default.createElement(f.Tooltip,{positioning:"left",positionOffset:8,tooltipContent:h("Delete")},n.default.createElement("button",{"aria-label":h("Delete selected watermark image"),className:"image-chooser-section__delete-button",onClick:this.onDeleteButtonClicked},n.default.createElement(p.ColorizedIcon,{color:"white"},n.default.createElement(m.IconAction,{name:"delete"})))),n.default.createElement("img",{className:"image-chooser-section__selected-image",src:this.state.imageURL,alt:h("Selected watermark image")})):n.default.createElement(n.default.Fragment,null,n.default.createElement(s.Popover,{onSelection:this.onSourceSelection},n.default.createElement(s.PopoverTrigger,{"aria-label":h("Open image source selection menu",{comment:"Explanation of what this button does - it opens a menu to allow the user to select an image source"}),className:"image-chooser__popover-trigger"},n.default.createElement("span",{className:"image-chooser-section__popover-button"},n.default.createElement(y,{className:"image-chooser-section__plus-svg"}))),n.default.createElement(s.PopoverContent,null,n.default.createElement(s.PopoverContentItem,{className:"image-chooser-section__add-from-dropbox",value:v.FROM_DROPBOX},n.default.createElement(w,{className:"image-chooser-section__logo-svg"}),h("Dropbox"),n.default.createElement("span",{className:"ax-visually-hidden"}," "+h("(opens a new window)",{comment:"Behavior explanation of button for screen-readers"}))),n.default.createElement(s.PopoverContentItem,{className:"image-chooser-section__add-from-computer",value:v.FROM_COMPUTER},n.default.createElement(p.ColorizedIcon,{color:"white"},n.default.createElement(m.IconAction,{name:"upload"})),h("My computer")))),n.default.createElement("p",{className:"image-chooser-section__drop-text","aria-hidden":"true"},h("Drop image here"))),n.default.createElement("input",{className:"image-chooser-section__image-upload",type:"file",accept:g.join(", "),onClick:function(e){return e.target.value=""},onChange:this.onChooseFromComputer,ref:function(t){return e.imageUploadRef=t}})))},t})(n.default.PureComponent);t.ImageChooserSectionWithoutCSS=b,t.ImageChooserSection=u.requireCssWithComponent(b,["/static/css/file_viewer_sidebar/image_chooser_section-vfl0uv17L.css"])}));__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};define("modules/clean/react/file_viewer_sidebar/panes/loadable_file_activity_stream_summary",["require","exports","modules/clean/react/async/loadable"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadableFileActivityStreamSummary=r.Loadable({loader:function(){return new Promise((function(t,r){e(["modules/clean/react/file_viewer_sidebar/panes/file_activity_stream_summary"],t,r)})).then(__importStar).then((function(e){return e.FileActivityStreamSummary}))}})})),define("modules/clean/react/file_viewer_sidebar/sidebar",["require","exports","tslib","react","react-redux","file-viewer/modes","file-viewer/core","modules/clean/i18n/formatters","file-viewer/strings","modules/clean/react/file_viewer_sidebar/utils","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/data/selectors","external/lodash","modules/clean/react/workflows/markup/utils","modules/clean/file_store/utils","modules/clean/react/watermarking/utils","modules/clean/react/file_viewer/utils","modules/clean/react/file_viewer_sidebar/panes/documentation_pane","modules/clean/integrations/data/selectors","modules/clean/react/file_viewer_sidebar/panes/metadata_pane","modules/clean/react/file_viewer_sidebar/panes/commenting_pane","modules/clean/react/file_viewer_sidebar/panes/loadable_activity_pane","modules/clean/react/file_viewer_sidebar/panes/markup_pane","modules/clean/react/file_viewer_sidebar/panes/watermarking_pane","modules/clean/react/user_notifications/dropdown","file-viewer/modes","file-viewer/core","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/logging","modules/clean/react/size_class/size_class","modules/clean/react/file_viewer/data/selectors","modules/clean/react/file_viewer_sidebar/render_utils/call_to_action","modules/clean/react/file_viewer_sidebar/widgets/seen_states","modules/clean/react/extensions/data/action_creators","modules/constants/page_load"],(function(e,t,r,n,i,o,a,s,l,c,u,d,p,m,f,_,v,h,g,w,y,b,E,S,k,T,C,P,x,A,M,I,F,O,D){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),p=r.__importStar(p);var R,L=s.createFormatters(D.USER_LOCALE,l.strings);(function(e){e[e.MOUNTED_FILE=0]="MOUNTED_FILE",e[e.SHARED_FILE=1]="SHARED_FILE",e[e.VERSION_HISTORY=2]="VERSION_HISTORY"})(R||(R={}));var N=(function(t){function i(i){var o=t.call(this,i)||this;return o.callToActionType=function(e){return e.sharedLinkInfo?R.SHARED_FILE:e.isVersionHistoryMode?R.VERSION_HISTORY:R.MOUNTED_FILE},o.renderSidebarNotificationsFn=function(){var e=o.props,t=e.sharedLinkInfo,r=e.user;return t||!r||r.is_guest_admin?null:n.default.createElement(k.UserNotificationsDropdown,{onClick:function(){return x.logUserAction(P.UserAction.ClickNotifications,P.UserActionContext.Sidebar)}})},o.registerSidebarPanesFn=function(e){var t,r=((t={})[C.SidebarPaneId.Documentation]=n.default.createElement(h.DocumentationPane,{key:"documentation-pane",coreFVUiProps:e,file:o.props.file,user:o.props.user,sharedLinkInfo:o.props.sharedLinkInfo,maxFilenameEmLength:P.SizeClassFilenameLengthMap[o.props.sizeClass],isVersionHistoryMode:!!o.props.isVersionHistoryMode}),t[C.SidebarPaneId.Metadata]=n.default.createElement(w.MetadataPane,{key:"metadata-pane",coreFVUiProps:e,file:o.props.file,user:o.props.user,sharedLinkInfo:o.props.sharedLinkInfo,previewType:o.props.previewType}),t[C.SidebarPaneId.Comments]=n.default.createElement(y.CommentingPane,{coreFVUiProps:e,key:"commenting-pane"}),t[C.SidebarPaneId.Activity]=n.default.createElement(b.LoadableActivityPane,{key:"activity-pane",coreFVUiProps:e,file:o.props.file,user:o.props.user,isVersionHistoryMode:!!o.props.isVersionHistoryMode}),t),i=o.props,a=i.file,s=i.user;return _.allowWatermarkOrTrial(a,s)&&v.isFileEditable(a)&&(r[C.SidebarPaneId.Watermarking]=n.default.createElement(S.WatermarkingPane,{key:"watermarking-pane",coreFVUiProps:e,file:o.props.file,user:o.props.user})),m.allowMarkup(a)&&(r[C.SidebarPaneId.Markup]=n.default.createElement(E.MarkupPane,{key:"markup-pane",coreFVUiProps:e,file:o.props.file,user:o.props.user})),r},o.handleWatermarkControlClick=function(){o.setState({watermarkControlHasBeenClicked:!0})},o.handleHelloSignControlClick=function(t){var n=o.props,i=n.user,a=n.file;i&&a&&f.isBrowseFile(a)&&new Promise((function(t,r){e(["modules/clean/react/app_actions/redirect"],t,r)})).then(r.__importStar).then((function(e){(0,e.redirectToActionOrShowAuth)(i,a,t,{},void 0,(function(e,t){o.props.updateLinkState({actionId:e,linkState:t})}))}))},o.createRenderSidebarControlsFn=p.memoize((function(e){return function(t){var i=[n.default.createElement(T.DocumentationControl,r.__assign({key:"documentation-control"},t))];o.props.isViewingFileSubpath||i.push(n.default.createElement(T.CommentControl,r.__assign({disabled:e[C.FileViewerMode.Commenting],key:"comment-control"},t)));var a=o.props,s=a.file,l=a.hellosignAppAction,c=a.isHellosignInSidebarEnabled,u=a.user,d=a.previewType,p=!_.fileIsWatermarkable(s);v.isFileEditable(s)&&(_.isWatermarkingEnabled(u)||_.allowWatermarkTrial(u))&&!o.props.isVersionHistoryMode&&i.push(n.default.createElement(T.WatermarkControl,r.__assign({key:"watermarking-control",disabled:p,labelText:_.getWatermarkingLabelText(p,d),onClick:o.handleWatermarkControlClick},t)));var f=!m.fileIsMarkupable(s);return m.userCanMarkup()&&v.isFileEditable(s)&&!o.props.isVersionHistoryMode&&i.push(n.default.createElement(T.MarkupControl,r.__assign({key:"markup-control",disabled:f,labelText:m.getMarkupLabelText(f,d)},t))),u&&l&&c&&i.push(n.default.createElement(T.HelloSignControl,r.__assign({key:"hellosign-control",onClick:o.handleHelloSignControlClick.bind(o,l)},t))),i}})),o.renderSidebarCallToActionsFn=function(e){var t=o.callToActionType(o.props),r=e.fileViewerUiData.sidebar.visibility===a.SidebarVisibility.Closed||o.props.sizeClass===A.SizeClass.Medium;switch(t){case R.SHARED_FILE:var n=o.props,i=n.sharedLinkInfo,s=n.shareToken,l=n.sharePermission;return I.renderSharedFileActions(o.props.file,o.props.user,o.props.sizeClass,i,s,l,!0,!0,r);case R.MOUNTED_FILE:return I.renderMountedFileActions(o.props.file,o.props.user,o.props.sizeClass,!0,o.props.extensionsEnabled,!0,r);case R.VERSION_HISTORY:return I.renderVersionHistoryActions(o.props.file,o.props.user,!0,!!o.props.canRestoreRevision,o.props.onRestoreRevision||function(){},!0,r)}return[]},o.renderSidebarPASSFn=function(e){return n.default.createElement(F.AsyncSeenStateFacepileConsumer,{isCollapsed:e.fileViewerUiData.sidebar.visibility===a.SidebarVisibility.Closed})},o.getPASSProviderProps=function(){var e=o.props,t=e.user,r=e.file,n=e.isVersionHistoryMode,i=e.sizeClass,a=e.sharePermission,s=e.isSeenStatesEnabled,l=e.isViewingFileSubpath,c=e.sharedLinkInfo,u=!(!a||0!==a.canViewMetadataRoles.length);return r?{user:t||null,file:r,isVersionHistoryMode:n,sizeClass:i,isViewMetadataDisabled:u,isSeenStatesEnabled:s,isViewingFileSubpath:l,sharedLinkInfo:c}:null},o.state={watermarkControlHasBeenClicked:!1},o}return r.__extends(i,t),i.prototype.sidebarWidth=function(){switch(this.props.sizeClass){case A.SizeClass.ExtraLarge:return 490;case A.SizeClass.Large:return 440;case A.SizeClass.Medium:return 320;case A.SizeClass.Small:return 0}},i.prototype.render=function(){var e,t=this.props,i=t.handleSidebarDispatch,s=t.fileViewerUiData,l={renderSidebarNotificationsFn:this.renderSidebarNotificationsFn,renderSidebarCallToActionsFn:this.renderSidebarCallToActionsFn,renderSidebarOverflowMenuFn:this.props.renderSidebarOverflowMenuFn,renderSidebarPASSFn:this.renderSidebarPASSFn},c=n.default.createElement(o.Sidebar,r.__assign({fileViewerUiData:s,fileId:"",intl:L,dispatch:i,fileViewerId:"dummy",registerSidebarPanesFn:this.registerSidebarPanesFn,renderSidebarControlsFn:this.createRenderSidebarControlsFn(this.props.disabledModes),width:s.sidebar.visibility===a.SidebarVisibility.Open?this.sidebarWidth():void 0},l));return(e=this.getPASSProviderProps())?n.default.createElement(F.AsyncSeenStatesProviderWrapper,r.__assign({},e),c):c},i})(n.default.PureComponent);t.UnconnectedSidebar=N,t.Sidebar=i.connect((function(e,t){return{fileViewerUiData:{currentMode:d.getMode(e),sidebar:d.getSidebar(e)},disabledModes:d.getDisabledModes(e),extensionsEnabled:M.getExtensionsEnabled(e),hellosignAppAction:(function(){if(t.file)return d.getHelloSignAppActionForFile(e,t.file)})(),isHellosignInSidebarEnabled:g.isHelloSignInFileViewerSidebarEnabled(e)}}),(function(e){return{handleSidebarDispatch:c.createSidebarDispatchHandler(e),changeMode:function(t){return e(u.changeMode(t))},updateLinkState:O.updateLinkState}}))(N)})),define("modules/clean/react/file_viewer_sidebar/utils",["require","exports","modules/clean/react/file_viewer/data/actions","file-viewer/core"],(function(e,t,r,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0});var o=((i={})[n.SidebarControlId.Documentation]=function(e){e(r.changeMode(n.FileViewerMode.Documentation))},i[n.SidebarControlId.Comments]=function(e){e(r.changeMode(n.FileViewerMode.Commenting))},i[n.SidebarControlId.Watermarking]=function(e){e(r.changeMode(n.FileViewerMode.Watermarking))},i[n.SidebarControlId.Zoom]=function(e){e(r.changeMode(n.FileViewerMode.Zoom))},i[n.SidebarControlId.Slack]=function(e){e(r.changeMode(n.FileViewerMode.Slack))},i[n.SidebarControlId.Markup]=function(e){e(r.changeMode(n.FileViewerMode.Markup))},i[n.SidebarControlId.HelloSign]=function(e){e(r.changeMode(n.FileViewerMode.HelloSign))},i);t.createSidebarDispatchHandler=function(e){return function(t){if((function(e){return e.type===n.Action.SidebarControlClick})(t)){var i=t.payload.controlId;return(0,o[i])(e,t)}return t.type===n.Action.CloseSidebar?e(r.setSidebarVisibility(n.SidebarVisibility.Closed)):t.type===n.Action.OpenSidebar?e(r.setSidebarVisibility(n.SidebarVisibility.Open)):void 0}},t.isSidebarOpen=function(e){return e.visibility===n.SidebarVisibility.Open},t.isSidebarPaneIdAtTopOfStack=function(e,t){var r=t.paneStack;return r.length>0&&r[r.length-1]===e},t.getSecondFromTopSidebarPaneId=function(e){var t=e.paneStack;return t.length<2?null:t[t.length-2]}})),define("modules/clean/react/file_viewer_sidebar/panes/file_activity_section",["require","exports","tslib","react","modules/clean/react/file_sidebar/file_sidebar_connect","modules/clean/react/file_sidebar/store/file_activity/selectors","spectrum/icon_arrow","spectrum/colorized_icon","modules/clean/react/css","modules/clean/react/file_viewer_sidebar/panes/loadable_file_activity_stream_summary","spectrum/button","modules/clean/react/file_viewer_sidebar/panes/strings"],(function(e,t,r,n,i,o,a,s,l,c,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),o=r.__importStar(o);var p=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.activities,r=e.user,i=e.isVersionHistoryMode,o=e.isFileActivityEnabled,l=e.disableOnboardingCard,p=e.title,m=e.pushActivityPaneHandler,f=e.file;if(!r||i||!o)return null;var _=t&&!t.loading&&0!==t.value.length;return n.default.createElement("div",{className:"documentation-pane__section"},n.default.createElement("div",{className:"documentation-pane__section-title"},p),n.default.createElement(c.LoadableFileActivityStreamSummary,{file:f,user:r,maxVisibleActivityCards:2,disableOnboardingCard:l}),_&&n.default.createElement("div",{className:"documentation-pane__push-pane-button-wrapper"},n.default.createElement(u.Button,{variant:"styleless",className:"documentation-pane__push-pane-button",onClick:m},d.ActivitySectionStrings.viewAllActivities,n.default.createElement("span",{className:"documentation-pane__arrow-right-icon"},n.default.createElement(s.ColorizedIcon,null,n.default.createElement(a.IconArrow,{name:"right-small",width:16,height:16}))))))},t})(n.default.Component);t.UnconnectedFileActivitySection=p,t.ConnectedFileActivitySection=i.fileSidebarConnect((function(e){return{isFileActivityEnabled:o.isActivityEnabled(e),activities:o.getActivitiesMetadata(e)}}))(l.requireCssWithComponent(p,["/static/css/file_activity_stream-vflgN2s72.css"]))})),define("modules/clean/react/file_viewer_sidebar/buttons/icon",["require","exports","tslib","react","spectrum/icon_action","spectrum/colorized_icon"],(function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n);t.ButtonIcon=function(e){var t=e.isPrimary,a=r.__rest(e,["isPrimary"]);return n.default.createElement(o.ColorizedIcon,{color:t?"white":"#717781"},n.default.createElement(i.IconAction,r.__assign({},a)))}})),define("modules/clean/react/file_viewer_sidebar/buttons/mounted_file_actions",["require","exports","tslib","react","modules/clean/react/async/loadable","modules/clean/react/app_actions/app_actions_menu","spectrum/tooltip","modules/clean/cloud_docs/constants","modules/clean/file_store/utils","modules/core/i18n","modules/clean/react/file_viewer/open_button/open_button"],(function(e,t,r,n,i,o,a,s,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),t.AsyncShareButton=i.Loadable({loader:function(){return new Promise((function(t,r){e(["modules/clean/react/file_viewer/share_button"],t,r)})).then(r.__importStar).then((function(e){return e.ShareButton}))}}),t.AsyncOpenButton=u.OpenButton,t.AsyncExtensionsButton=function(e){var t=n.default.createElement("div",{className:"control__button"},n.default.createElement(o.ExtensionsMenu,r.__assign({},e)));return"ON"===e.experiment&&s.isMicrosoftFileByExtension(l.getExtension(e.file))&&(t=n.default.createElement(a.Tooltip,{className:"open-with-menu-tooltip",positioning:"below",tooltipContent:c._("Now you can open Microsoft Office files with Google Docs, Sheets, and Slides, and save back to the original format.")},t)),t}}));__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};define("modules/clean/react/file_viewer_sidebar/buttons/shared_file_actions",["require","exports","modules/clean/react/async/loadable","modules/clean/react/share_download/button"],(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncEditNowButton=r.Loadable({loader:function(){return new Promise((function(t,r){e(["modules/clean/cloud_docs/edit_now_button"],t,r)})).then(__importStar).then((function(e){return e.EditNowButton}))}}),t.AsyncSignInButton=r.Loadable({loader:function(){return new Promise((function(t,r){e(["modules/clean/react/sign_in/button"],t,r)})).then(__importStar).then((function(e){return e.SignInButton}))}}),t.AsyncExtensionsMenuNoUnity=r.Loadable({loader:function(){return new Promise((function(t,r){e(["modules/clean/react/extensions/extensions_menu_component_v2"],t,r)})).then(__importStar).then((function(e){return e.ExtensionsMenuV2NoUnity}))}}),t.AsyncOpenInAppButton=r.Loadable({loader:function(){return new Promise((function(t,r){e(["modules/clean/react/open_in_app/button"],t,r)})).then(__importStar).then((function(e){return e.OpenInAppButton}))}}),t.AsyncShareDownloadButton=n.ShareDownloadButton})),define("modules/clean/react/file_viewer_sidebar/buttons/version_history_file_actions",["require","exports","tslib","react","classnames","spectrum/button","modules/clean/react/file_viewer_sidebar/buttons/icon","modules/core/i18n"],(function(e,t,r,n,i,o,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),i=r.__importDefault(i),t.RestoreButton=function(e){var t=s._("Restore");return n.default.createElement(o.Button,{variant:"primary",className:i.default("control__button","restore-button",{"control__button--collapsed":e.isCollapsed}),onClick:e.onClick},e.isCollapsed?n.default.createElement(a.ButtonIcon,{isPrimary:!0,name:"restore-file","aria-label":t}):t)}})),define("modules/clean/react/file_viewer_sidebar/render_utils/call_to_action",["require","exports","tslib","react","modules/clean/react/file_viewer_sidebar/buttons/mounted_file_actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/constants","modules/clean/react/extensions/data/types","modules/clean/sharing/constants","modules/clean/react/file_viewer_sidebar/buttons/shared_file_actions","modules/clean/previews/util","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer_sidebar/buttons/icon","modules/clean/react/file_viewer_sidebar/buttons/version_history_file_actions","modules/clean/react/file_viewer/conversions/conversion_utils","modules/constants/file_viewer"],(function(e,t,r,n,i,o,a,s,l,c,u,d,p,m,f,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),t.renderMountedFileActions=function(e,t,r,o,l,c,u){if(void 0===c&&(c=!1),void 0===u&&(u=!1),!o)return[];var d=[n.default.createElement(i.AsyncShareButton,{key:"share",file:e,user:t,isCollapsed:c&&u})];return l?d.push(n.default.createElement(i.AsyncExtensionsButton,{key:"extension",experiment:_.OPEN_WITH_TOOLTIP,user:t,file:e,showAsButtonIfDownloadOnly:!0,telemetryContext:{surface:"previews"},showBigTooltip:!0,onPresentInZoom:function(){},triggerType:u&&c?s.TriggerType.CollapsedButton:void 0,isInFVSidebar:c})):d.push(n.default.createElement(i.AsyncOpenButton,{file:e,location:c?a.FileViewerPane.Sidebar:a.FileViewerPane.TitleBar,user:t,key:"open",sizeClass:r,isCollapsed:c})),d},t.renderSharedFileActions=function(e,t,r,i,m,_,v,h,g){void 0===h&&(h=!1),void 0===g&&(g=!1);var w=!(!e.open_in_app_data||!e.preview_type),y=[],b=h?o.UserActionContext.Sidebar:o.UserActionContext.TitleBarMain;if(w&&v&&y.push(n.default.createElement(c.AsyncOpenInAppButton,{urls:e.open_in_app_data,userActionContext:b})),!t)if(u.isCloudDocPreview(e))y.push(n.default.createElement(c.AsyncEditNowButton,{isPrimaryButton:!w,onClick:function(){return d.logUserAction(o.UserAction.SignIn,b)},hideCallOut:!1,isCollapsed:h&&g}));else{var E=!w,S=g||h&&!E;f.shouldShowPersistentHeader()||y.push(n.default.createElement(c.AsyncSignInButton,{isPrimaryButton:E,onClick:function(){return d.logUserAction(o.UserAction.SignIn,b)},icon:S?n.default.createElement(p.ButtonIcon,{name:"sign-in",isPrimary:!w}):void 0}))}return t&&v&&(function(e){return e.linkType===l.SharedLinkType.Content})(m)&&y.push(n.default.createElement("div",{className:"control__button"},n.default.createElement(c.AsyncExtensionsMenuNoUnity,{file:e,user:t,triggerType:h&&(g||0!==y.length)?s.TriggerType.CollapsedButton:void 0,isInFVSidebar:h}))),m&&_&&v&&!u.isCloudDocPreview(e)&&y.push(n.default.createElement(c.AsyncShareDownloadButton,{copyable:e,location:h?a.FileViewerPane.Sidebar:a.FileViewerPane.TitleBar,sharedLinkInfo:i,sharePermission:_,shareToken:m,user:t,isCollapsed:h&&(g||0!==y.length)})),y},t.renderVersionHistoryActions=function(e,t,r,o,s,l,c){if(void 0===l&&(l=!1),void 0===c&&(c=!1),!r)return[];var u=[];return o&&u.push(n.default.createElement(m.RestoreButton,{key:"restore",onClick:s,isCollapsed:c})),u.push(n.default.createElement(i.AsyncOpenButton,{key:"open",file:e,user:t,isUnityDisabled:!0,isOpenWithDisabled:!0,isCloudEditorDisabled:!0,location:l?a.FileViewerPane.Sidebar:a.FileViewerPane.TitleBar,isCollapsed:l})),u}})),define("modules/clean/react/file_viewer_sidebar/widgets/seen_states",["require","exports","tslib","react","modules/clean/react/async/loadable","modules/clean/previews/util"],(function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),t.AsyncSeenStateFacepileProvider=i.Loadable({loader:function(){return new Promise((function(t,r){e(["modules/clean/react/pass/seen_state_facepile_controller"],t,r)})).then(r.__importStar).then((function(e){return e.SeenStateFacepileProvider}))}}),t.AsyncSeenStateFacepileConsumer=i.Loadable({loader:function(){return new Promise((function(t,r){e(["modules/clean/react/pass/seen_state_facepile_consumer"],t,r)})).then(r.__importStar).then((function(e){return e.SeenStateFacepileConsumer}))}}),t.AsyncSeenStatesProviderWrapper=function(e){var r=e.children,i=e.file,a=e.isSeenStatesEnabled,s=e.isVersionHistoryMode,l=e.isViewingFileSubpath,c=e.isViewMetadataDisabled,u=e.sharedLinkInfo,d=e.sizeClass,p=e.user;return!a||s||null===i.ns_id||o.isCloudDocPreview(i)?n.default.createElement(n.default.Fragment,null,r):n.default.createElement(t.AsyncSeenStateFacepileProvider,{file:i,isViewMetadataDisabled:c,isViewingFileSubpath:!!l,sharedLinkInfo:u,sizeClass:d,user:p},r)}}));__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};define("modules/clean/react/file_viewer_sidebar/panes/loadable_details_section",["require","exports","modules/clean/react/async/loadable"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadableDetailsSection=r.Loadable({loader:function(){return new Promise((function(t,r){e(["modules/clean/react/file_viewer_sidebar/panes/details_section"],t,r)})).then(__importStar).then((function(e){return e.DetailsSection}))}})})),define("modules/clean/react/file_viewer/feedback_form/feedback_form_modal",["require","exports","tslib","react","modules/core/i18n","file-transfers/feedback-form","modules/clean/react/css","spectrum/modal","modules/clean/react/snackbar"],(function(e,t,r,n,i,o,a,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n);var c="feedback-snackbar-id",u=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={comment:"",rating:null},t.handlePrimaryAction=function(){var e=t.state,r=e.rating,n=e.comment,o=t.props.user;r?(t.props.submitFeedback(r,n,o),t.props.onRequestClose(),l.Snackbar.complete(i._("Feedback submitted!",{comment:"Text indicating that feedback was successfully submitted"}),c)):l.Snackbar.fail(i._("Please provide a rating",{comment:"Text on pop-up notification indicating that a satisfaction rating must be provided"}),c)},t.handleRatingChange=function(e){t.setState({rating:e})},t.handleCommentsChange=function(e){t.setState({comment:e})},t}return r.__extends(t,e),t.prototype.render=function(){var e=this.state,t=e.comment,r=e.rating;return n.default.createElement(s.UtilityModal,{ariaLabel:this.props.title,title:this.props.title,open:this.props.open,displayCloseButton:!0,overlayClickClose:!0,onReady:this.props.onReady,onRequestClose:this.props.onRequestClose,primaryAction:i._("Submit"),onPrimaryAction:this.handlePrimaryAction,secondaryAction:i._("Not now"),onSecondaryAction:this.props.onRequestClose,shouldRequestCloseOnActions:!1,overlayClassName:"file-viewer-modal-overlay",appElement:document.getElementById("embedded-app")||document.body},n.default.createElement(o.FeedbackForm,{comment:t,rating:r,commentPrompt:this.props.commentPrompt,onRatingChange:this.handleRatingChange,onCommentsChange:this.handleCommentsChange}))},t})(n.default.Component);t.FeedbackFormModalComponent=u,t.FeedbackFormModal=a.requireCssWithComponent(u,["/static/js/file-transfers/index.web-vflFeJKmu.css"])})),define("modules/clean/react/file_viewer/feedback_form/api",["require","exports","tslib","modules/clean/api_v2/user_client","modules/clean/react/file_viewer/feedback_form/types"],(function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.submitFeedback=function(e,t,o,a){return r.__awaiter(this,void 0,Promise,(function(){var s,l;return r.__generator(this,(function(r){switch(r.label){case 0:return a?(s=t===i.NOT_APPLICABLE_SATISFACTION_RATING_VALUE?void 0:t,l={product_name:e,satisfaction_rating:s,comment:o},[4,(new n.UserApiV2Client).ns("workflows").rpc("submit_feedback",l,{subjectUserId:a.id})]):[2];case 1:return[2,r.sent()]}}))}))}})),define("modules/clean/react/file_viewer/feedback_form/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),(function(e){e.DROPBOX_MARKUP="Dropbox Markup"})(t.SubmitFeedbackProductName||(t.SubmitFeedbackProductName={})),t.NOT_APPLICABLE_SATISFACTION_RATING_VALUE=-1})),define("modules/clean/react/file_viewer_titlebar/loadable_icon",["require","exports","tslib","react","modules/clean/react/async/loadable"],(function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),t.LoadableTitleIcon=i.Loadable({loader:function(){return new Promise((function(t,r){e(["modules/clean/react/title_bar/title_bar_title"],t,r)})).then(r.__importStar).then((function(e){return e.TitleBarTitle}))},loading:n.default.createElement("div",{className:"react-title-icon"})})})),define("modules/clean/react/file_viewer_titlebar/loadable_title",["require","exports","tslib","react","modules/clean/react/async/loadable"],(function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),t.LoadableTitle=i.Loadable({loader:function(){return new Promise((function(t,r){e(["modules/clean/react/file_viewer/title_name"],t,r)})).then(r.__importStar).then((function(e){return e.TitleName}))},loading:n.default.createElement("div",{className:"react-title-name"})})})),define("modules/clean/react/file_viewer_titlebar/titlebar",["require","exports","tslib","file-viewer/titlebar/titlebar","modules/clean/file_store/utils","modules/clean/react/file_viewer/title_utils","modules/clean/react/file_viewer_titlebar/loadable_icon","modules/clean/react/file_viewer_titlebar/loadable_title","modules/clean/react/size_class/constants","react","spectrum/file_icon","modules/clean/react/file_viewer/utils","modules/clean/react/file_viewer/constants","modules/clean/react/size_class/size_class","classnames"],(function(e,t,r,n,i,o,a,s,l,c,u,d,p,m,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),c=r.__importDefault(c),f=r.__importDefault(f);var _=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.overrideIcon=t.props.hidePageChrome?c.default.createElement("div",{className:"file-icon"},c.default.createElement(u.FileIcon,{path:i.getFilename(t.props.file)})):null,t}return r.__extends(t,e),t.prototype.render=function(){return c.default.createElement("div",{className:"files2-title-bar"},c.default.createElement(n.Titlebar,r.__assign({className:f.default("title",{isSidebarOpen:this.props.isSidebarOpen}),title:c.default.createElement(s.LoadableTitle,{file:this.props.file,fileSubpath:this.props.fileSubpath,hidePageChrome:this.props.hidePageChrome,isViewingFileSubpath:this.props.isViewingFileSubpath,maxFilenameEmLength:this.props.maxFilenameEmLength,sharedLinkInfo:this.props.sharedLinkInfo,sizeClass:this.props.sizeClass,user:this.props.user}),icon:this.props.hideIcon?null:c.default.createElement(a.LoadableTitleIcon,{customLogoUrl:o.customLogoUrl(this.props.sharedLinkInfo),closeTitle:o.closeButtonTitle({file:this.props.file,fileViewAction:this.props.fileViewAction,fileViewOrigin:this.props.fileViewOrigin,sharedLinkInfo:this.props.sharedLinkInfo,isVersionHistoryMode:this.props.isVersionHistoryMode}),canClose:this.props.canClose,closeUrl:this.props.closeUrl,file:this.props.file,isSendForSignatureMode:!1,isSigningMode:!1,onClose:this.props.onClose,shouldShowIcon:!this.props.isViewingFileSubpath,sizeClass:this.props.sizeClass,overrideIcon:this.overrideIcon})},{renderTitleOverflowMenuFn:this.props.sizeClass===l.SizeClass.Small?this.props.renderTitlebarOverflowMenuFn:void 0})))},t})(c.default.PureComponent);t.Titlebar=_,t.FileTitleBar=m.withSizeClass(_,{isResponsiveEnabled:d.isResponsiveEnabled,responsiveClassName:p.ResponsiveClassName})})),define("modules/clean/react/file_viewer_titlebar/edit_mode_titlebar",["require","exports","tslib","react","classnames","file-viewer/titlebar/titlebar","modules/clean/file_store/utils","modules/clean/em_string","modules/clean/react/file_viewer/feedback_form/feedback_form_modal","spectrum/button","modules/core/i18n","modules/clean/react/workflows/markup/api","file-viewer/core","modules/clean/react/size_class/constants","modules/constants/file_viewer"],(function(e,t,r,n,i,o,a,s,l,c,u,d,p,m,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),i=r.__importDefault(i);var _=(function(e){function t(t){var r=e.call(this,t)||this;return r.openFeedbackModal=function(){r.setState({isFeedbackModalOpen:!0})},r.closeFeedbackModal=function(){r.setState({isFeedbackModalOpen:!1})},r.renderFeedbackFormModal=function(){if(r.props.mode===p.FileViewerMode.Markup){var e=u._("How satisfied are you with Dropbox Markup?"),t=u._("Tell us what you liked and didn’t like about Dropbox Markup.",{comment:"Text prompting user to indicate which aspects they liked and did not like about the given product"});return n.default.createElement(l.FeedbackFormModal,{user:r.props.user,title:e,commentPrompt:t,open:r.state.isFeedbackModalOpen,onRequestClose:r.closeFeedbackModal,submitFeedback:d.submitMarkupFeedback})}return null},r.state={isFeedbackModalOpen:!1},r}return r.__extends(t,e),t.prototype.render=function(){var e=f.FILE_MARKUP_FEEDBACK_FORM&&this.props.mode===p.FileViewerMode.Markup&&this.props.sizeClass!==m.SizeClass.Small;return n.default.createElement("div",{className:"files2-title-bar"},n.default.createElement(o.Titlebar,{className:i.default("title"),title:n.default.createElement(n.default.Fragment,null,e&&n.default.createElement(c.Button,{className:"files2-title-bar__feedback-button",size:"large",variant:"primary",onClick:this.openFeedbackModal},u._("Feedback")),n.default.createElement("h1",{className:i.default("filename")},n.default.createElement("div",{className:"filename--text"},n.default.createElement("span",{className:"filename--prefix"},this.props.title+": "),s.Emstring.em_snippet(a.getFilename(this.props.file),this.props.maxFilenameEmLength),this.props.beta?n.default.createElement("span",{className:"filename--beta-tag"},"beta"):null),this.renderFeedbackFormModal()))}))},t})(n.default.PureComponent);t.EditModeTitlebar=_})),define("modules/clean/react/keyboard_binding/keyboard_binding",["require","exports","tslib","external/lodash","modules/clean/keycode"],(function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),t.genericKeyboardEventCriteria={altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1,which:0};var o={altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1,which:0};t.SimpleKeyboardEventKeys=Object.keys(o),t.KeyboardEventCriteriaKeys=Object.keys(t.genericKeyboardEventCriteria),t.generateUnmodifiedKeyboardEventCriteria=function(e){return r.__assign({},t.genericKeyboardEventCriteria,{which:e})},t.generateUnmodifiedSimpleKeyboardEvent=function(e){return r.__assign({},o,{which:e})};var a=function(){};function s(e){return{keyboardEventCriteria:r.__assign({},t.genericKeyboardEventCriteria,e.keyboardEventCriteria),callback:null!=e.callback?e.callback:a}}function l(e){return n.flatten(e.map((t="shiftKey",function(e){return(function(e,t){var r,n;return[(r={which:e},r[t]=!0,r),(n={which:e},n[t]=!1,n)]})(e,t)})));var t}function c(e,t){return e.map((function(e){return s({keyboardEventCriteria:e,callback:t})}))}t.hydrateKeyboardBinding=s,t.getKeyboardEventCriteria=function(e){return{altKey:!!e.altKey,ctrlKey:!!e.ctrlKey,metaKey:!!e.metaKey,shiftKey:!!e.shiftKey,which:e.which||e.keyCode}},t.getSimpleKeyboardEvent=function(e){return{altKey:e.altKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,which:e.which||e.keyCode}},t.addLegacyPropertiesToSimpleKeyboardEvent=function(e){return r.__assign({},e,{keyCode:null!=e.keyCode?e.keyCode:e.which})};var u=l([i.KeyCode.EQUALS,i.KeyCode.PLUS_EQUALS_FF,i.KeyCode.PLUS_CHROME,i.KeyCode.PLUS_EQUALS_FF_GERMAN]),d=l([i.KeyCode.MINUS_FF_MAC,i.KeyCode.MINUS_FF,i.KeyCode.MINUS_CHROME]),p=[{which:i.KeyCode.P},{which:i.KeyCode.P,ctrlKey:!0},{which:i.KeyCode.P,metaKey:!0}];function m(e){return void 0!==e.preventDefault}t.getEqualsKeyBindings=function(e){return c(u,e)},t.getMinusKeyBindings=function(e){return c(d,e)},t.getPrintKeyBindings=function(e){return c(p,e)},t.isKeyboardEvent=m,t.withPreventDefault=function(e){return function(t){e(),m(t)&&t.preventDefault()}}})),define("modules/clean/react/keyboard_binding/keyboard_binding_connector",["require","exports","tslib","react","modules/clean/react/keyboard_binding/keyboard_binding_provider"],(function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){function t(t,r){var n=e.call(this,t,r)||this;if(!r.registerKeyBindings||!r.unregisterKeyBindings)throw new Error("KeyboardBindingConnector must be a child of a KeyboardBindingProvider");return n}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.registrationIdentifier=this.context.registerKeyBindings(this.props.keyboardBindings),this.context.registerAllKeyCallback(this.registrationIdentifier,this.props.allKeyCallback)},t.prototype.componentWillReceiveProps=function(e){this.props.keyboardBindings!==e.keyboardBindings&&this.context.updateKeyBindings(this.registrationIdentifier,e.keyboardBindings),this.props.allKeyCallback!==e.allKeyCallback&&this.context.registerAllKeyCallback(this.registrationIdentifier,e.allKeyCallback)},t.prototype.componentWillUnmount=function(){this.context.unregisterKeyBindings(this.registrationIdentifier)},t.prototype.render=function(){return null},t.contextTypes=i.KeyboardBindingProviderContextTypes,t})((n=r.__importDefault(n)).default.Component);t.KeyboardBindingConnector=o})),define("modules/clean/react/keyboard_binding/keyboard_binding_provider",["require","exports","tslib","react","prop-types","modules/clean/callback_chain/callback_chain","modules/clean/keycode","modules/clean/react/keyboard_binding/keyboard_binding"],(function(e,t,r,n,i,o,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),i=r.__importStar(i),t.KeyboardBindingProviderContextTypes={registerAllKeyCallback:i.func,registerKeyBindings:i.func,unregisterKeyBindings:i.func,updateKeyBindings:i.func};var l=[];t.noop=function(e){};var c=(function(e){function i(r){var n=e.call(this,r)||this;return n.registrationIdentifier=0,n.registeredBindings=[],n.keyboardBindingsByCriteria={},n.allKeyHandlers=[],n.registerKeyBindings=function(e){var r=n.registrationIdentifier++;return n.updateKeyBindings(r,e),n.allKeyHandlers[r]||(n.allKeyHandlers[r]=t.noop),r},n.registerAllKeyCallback=function(e,r){n.allKeyHandlers[e]=null!=r?r:t.noop},n.unregisterKeyBindings=function(e){n.updateKeyBindings(e,[]),n.allKeyHandlers[e]=t.noop},n.updateKeyBindings=function(e,t){n.registeredBindings[e]=null!=t?t:[],n.keyboardBindingsByCriteria=d(n.registeredBindings)},n.onKeyDown=function(e){if((function(e){var t=e.target||e.srcElement;if(!t)return!0;var r=t.tagName,n=e.which,i="INPUT"===r||"SELECT"===r||"TEXTAREA"===r,o=-1!==["submit","button"].indexOf(t.type),s=t.hasAttribute&&t.hasAttribute("contenteditable")&&"false"!==t.getAttribute("contenteditable").toLowerCase();if(i&&!o||s)return n===a.KeyCode.ESC||n===a.KeyCode.TAB;return!0})(e)){var t=n.getCallbacksForKey(e);new o.CallbackChain(t).run(e)}},n.allKeyHandlers=[],n.registeredBindings=[],n}return r.__extends(i,e),i.prototype.componentDidMount=function(){document.addEventListener("keydown",this.onKeyDown),this.providerIdentifier=l.length,l.push(this.onKeyDown),this.props.onSetup&&this.props.onSetup()},i.prototype.componentWillUnmount=function(){document.removeEventListener("keydown",this.onKeyDown),l[this.providerIdentifier]=t.noop,this.props.onDestroy&&this.props.onDestroy()},i.prototype.getChildContext=function(){return{registerAllKeyCallback:this.registerAllKeyCallback,registerKeyBindings:this.registerKeyBindings,unregisterKeyBindings:this.unregisterKeyBindings,updateKeyBindings:this.updateKeyBindings}},i.prototype.getCallbacksForKey=function(e){var t=u(e);return(this.keyboardBindingsByCriteria[t]||[]).concat(this.allKeyHandlers)},i.prototype.render=function(){return n.default.Children.only(this.props.children)},i.childContextTypes=t.KeyboardBindingProviderContextTypes,i})(n.default.Component);function u(e){var t=s.getKeyboardEventCriteria(e),r="";return s.KeyboardEventCriteriaKeys.forEach((function(e){r+=e+":"+t[e]+","})),r}function d(e){return e.reduce((function(e,t){return t.reduce((function(e,t){var r=t.keyboardEventCriteria,n=t.callback,i=u(r);return e[i]=e[i]||[],e[i].push(n),e}),e)}),{})}t.KeyboardBindingProvider=c,t.getIndexForkeyboardBindingsByCriteria=u,t.generateKeyboardBindingsByCriteriaFromKeyboardBindings=d,t.simulateKeyEvent=function(e){var t=s.addLegacyPropertiesToSimpleKeyboardEvent(e);new o.CallbackChain(l).run(t)}})),define("modules/clean/react/open_in_app/button",["require","exports","tslib","react","spectrum/button","modules/clean/open_in_app/actions","modules/core/i18n","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants"],(function(e,t,r,n,i,o,a,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(t){var r=e.call(this,t)||this;return r.handleClick=function(){s.logUserAction(l.UserAction.OpenInApp,r.props.userActionContext),o.openInApp(r.props.urls,{onAppNeeded:function(){return r.setState({showInstallAppText:!0})},onAppInstalled:function(){return r.setState({showInstallAppText:!1})}})},r.state={showInstallAppText:!1},r}return r.__extends(t,e),t.prototype.componentWillUnmount=function(){o.cleanUp()},t.prototype.render=function(){return n.default.createElement(i.Button,{className:"control__button open-in-app-button",variant:"primary",onClick:this.handleClick},this.state.showInstallAppText?a._("Install app?"):a._("Open in app"))},t})((n=r.__importDefault(n)).default.Component);t.OpenInAppButton=c}));__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};define("modules/clean/react/previews/archive/preview_archive_loadable",["require","exports","modules/clean/react/async/loadable"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewArchiveLoadable=r.Loadable({loader:function(){return new Promise((function(t,r){e(["modules/clean/react/previews/archive/preview_archive"],t,r)})).then(__importStar).then((function(e){return e.PreviewArchive}))}})})),define("modules/clean/react/previews/video/audio_waveform/utils",["require","exports","modules/clean/average_counter"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.buildFromBuffer=function(e,t,n,i,o){var a=e.getChannelData(0),s=new Array(t);setTimeout((function e(l){return function(){if(l>=t)o(s);else{var c=[],u=Math.ceil(l*a.length/t),d=Math.ceil((l+1)*a.length/t),p=d-u;if(p>n)for(var m=0;m<n;m++){var f=Math.floor(Math.random()*p)+u;c.push(Math.abs(a[f]))}else for(m=u;m<d;m++){var _=Math.floor(Math.abs(a[m]));c.push(_)}var v=new r.AverageCounter;v.addArray(c),s[l]=v.getAverage(),i()&&setTimeout(e(l+1),0)}}})(0),0)},t.returnWaveform=function(e,t,n){void 0===n&&(n=1);var i=[];if(0===e.length||t<=0||isNaN(t))return i;for(var o=[],a=0;a<t;a++)o.push(new r.AverageCounter);var s=0,l=0;for(a=0;a<e.length;a++){var c=e[a],u=Math.floor(a*t/e.length),d=o[u];d.add(c),i[u]=d.getAverage(),u!==l&&(s=Math.max(s,i[l]),l=u)}return s=Math.max(s,i[t-1]),i.map((function(e){return e*n/s}))}})),define("modules/clean/react/previews/error/file_info",["require","exports","tslib","react","modules/clean/display_format"],(function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),t.PreviewErrorFileInfo=function(e){var t=e.bytes,r=e.filename;return n.default.createElement("div",{className:"preview-error__info"},r,void 0!==t?n.default.createElement("span",null,n.default.createElement("span",{className:"bottom-dot"}," · "),i.format_bytes(t)):null)}})),define("modules/clean/react/previews/error/fullscreen_view",["require","exports","tslib","react","modules/clean/react/css","modules/clean/react/file_viewer/actionable","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/previews/error/file_info","modules/clean/react/previews/error/message","modules/clean/react/previews/preview_zoom_container"],(function(e,t,r,n,i,o,a,s,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n);var d=i.requireCssWithComponent((function(e){var t=e.allowOpenInApp,r=e.areActionablesEnabled,i=e.count,d=e.errorType,p=e.extensionsEnabled,m=e.file,f=e.filename,_=e.index,v=e.message,h=e.onNext,g=e.onPrevious,w=e.preview,y=e.sharedLinkInfo,b=e.shareToken,E=e.sharePermission,S=e.user;return n.default.createElement(u.PreviewZoomContainer,{fileCount:i,fileIndex:_,onClose:s.exitFullScreen,onFlipNext:h,onFlipPrevious:g,renderZoomControls:!1},n.default.createElement("div",{className:"preview-error--fullscreen fullscreen"},n.default.createElement(c.PreviewErrorMessage,{file:m,preview:w,errorType:d,message:v}),n.default.createElement(l.PreviewErrorFileInfo,{bytes:m.bytes,filename:f}),r?n.default.createElement(o.Actionable,{allowOpenInApp:!!t,extensionsEnabled:p,file:m,variant:"primary",location:a.FileViewerPane.PreviewContent,sharedLinkInfo:y,shareToken:b,sharePermission:E,user:S,userActionContext:a.UserActionContext.PreviewContentMain}):null))}),["/static/css/preview_image-vflIgjzwo.css","/static/css/preview_error-vflPf33PO.css"]);t.PreviewErrorFullscreenView=d})),define("modules/clean/react/previews/error/image",["require","exports","tslib","react","modules/clean/react/image","modules/clean/react/previews/constants","modules/clean/static_urls"],(function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),t.PreviewErrorImage=function(e){var t;switch(e.errorType){case o.ErrorType.PendingUploadError:t=n.default.createElement(i.Image,{src:a.static_url("/static/js/file-viewer/img/error/file_uploading_1x-vflRuLSg0.png"),srcHiRes:a.static_url("/static/js/file-viewer/img/error/file_uploading_2x-vflKOdrWj.png")});break;case o.ErrorType.ExtensionError:t=n.default.createElement(i.Image,{src:a.static_url("/static/js/file-viewer/img/error/filetype_not_supported_1x-vflmIVODZ.png"),srcHiRes:a.static_url("/static/js/file-viewer/img/error/filetype_not_supported_2x-vflE8HW8X.png")});break;case o.ErrorType.FileSizeError:t=n.default.createElement(i.Image,{src:a.static_url("/static/js/file-viewer/img/error/file_too_large_1x-vflDGNPuo.png"),srcHiRes:a.static_url("/static/js/file-viewer/img/error/file_too_large_2x-vfl-r0UPt.png")});break;case o.ErrorType.PasswordProtectedError:t=n.default.createElement(i.Image,{src:a.static_url("/static/js/file-viewer/img/error/password_protected_1x-vflnFAKjt.png"),srcHiRes:a.static_url("/static/js/file-viewer/img/error/password_protected_2x-vflnBXZ1k.png")});break;case o.ErrorType.NeedFlashError:case o.ErrorType.SymLinkError:case o.ErrorType.EmptyFileError:case o.ErrorType.WatermarkingError:case o.ErrorType.LoadError:default:t=n.default.createElement(i.Image,{src:a.static_url("/static/js/file-viewer/img/error/unavailable_1x-vflG2AHMd.png"),srcHiRes:a.static_url("/static/js/file-viewer/img/error/unavailable_2x-vflGPrE5d.png")})}return n.default.createElement("div",{className:"u-mar-bottom-s preview-error__image"},t)}})),define("modules/clean/react/previews/error/message",["require","exports","tslib","react","modules/clean/file_store/utils","modules/clean/react/previews/constants","modules/clean/react_format","modules/core/i18n","modules/clean/previews/data/preview_type_util","modules/clean/previews/util","modules/clean/display_format","modules/constants/trademark"],(function(e,t,r,n,i,o,a,s,l,c,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),l=r.__importStar(l),t.PreviewErrorMessage=function(e){var t,r=e.file?i.getExtension(e.file):void 0;if(e.message)t=e.message;else switch(e.errorType){case o.ErrorType.PendingUploadError:t=s._("File is uploading...");break;case o.ErrorType.EmptyFileError:t=s._("Empty files can’t be previewed");break;case o.ErrorType.ExtensionError:if(!e.file)throw new Error("Extension error requires a file prop");if(r){var p=i.isArchiveFile(e.file)&&e.preview?s._("<span>.%(extension)s</span> files can’t be previewed from an archive file.",{comment:"Like '.exe files can’t be previewed from an archive file'"}):s._("<span>.%(extension)s</span> files can’t be previewed.",{comment:"Like '.exe files can’t be previewed'"});t=a.reactFormat(p,{span:n.default.createElement("span",{className:"preview-error__message--bold"}),extension:r})}else t=s._("This file cannot be previewed. Please check to see if your file extension is correct.");break;case o.ErrorType.FileSizeError:var m=l.getPreviewType(e.preview),f=r&&m?c.getFileSizeLimit(r,m):void 0;t=f?a.reactFormat(s._("This file is too big to preview. <br /> The maximum file size for <span>.%(extension)s</span> is <span>%(limit)s</span>"),{br:n.default.createElement("br",null),span:n.default.createElement("span",{className:"preview-error__message--bold"}),extension:r,limit:u.format_bytes(f)}):s._("This file is too big to preview.");break;case o.ErrorType.PasswordProtectedError:t=r?a.reactFormat(s._("This <span>.%(extension)s</span> file is password-protected."),{span:n.default.createElement("span",{className:"preview-error__message--bold"}),extension:r}):s._("This file is password-protected.");break;case o.ErrorType.NeedFlashError:t=a.reactFormat(s._("Install <a>Adobe Flash Player</a> to preview this video."),{a:n.default.createElement("a",{href:"https://get.adobe.com/flashplayer/"})});break;case o.ErrorType.SymLinkError:t=s._("SymLink files cannot be previewed.");break;case o.ErrorType.WatermarkingError:t=s._("This file could not be watermarked.");break;case o.ErrorType.UpsellError:t=a.reactFormat(s._("<p>Can’t preview <span>.%(extension)s</span> files. <br />Upgrade to %(trademark_professional)s to preview more file types.</p>"),{br:n.default.createElement("br",null),p:n.default.createElement("p",null),span:n.default.createElement("span",{className:"preview-error__message--bold"}),trademark_professional:d.TRADEMARK_PROFESSIONAL,extension:r});break;case o.ErrorType.LoadError:default:t=r?a.reactFormat(s._("<span>.%(extension)s</span> files are supported but something went wrong."),{span:n.default.createElement("span",{className:"preview-error__message--bold"}),extension:r}):s._("This file can’t be previewed")}return n.default.createElement("div",{className:"preview-error__message"},t)}})),define("modules/clean/react/previews/error/preview_error",["require","exports","tslib","react","modules/clean/em_string","modules/clean/previews/pending_upload_watcher","modules/clean/react/css","modules/clean/file_store/utils","modules/clean/react/file_viewer/constants","modules/clean/react/previews/constants","modules/clean/react/previews/error/fullscreen_view","modules/clean/react/previews/error/view","modules/clean/web_timing_logger","modules/clean/react/previews/error/upsell"],(function(e,t,r,n,i,o,a,s,l,c,u,d,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),p=r.__importStar(p);var f=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.componentDidMount=function(){(p.set_tti_exclusion_flow("failed previews not included"),p.mark_time_to_view(),p.mark_time_to_interactive(),this.logPreviewSupportDenied(),this.props.errorType===c.ErrorType.PendingUploadError&&this.props.shareToken)&&new o.PendingUploadWatcher(this.props.shareToken.linkType,this.props.shareToken.linkKey,this.props.shareToken.secureHash).startPolling()},Object.defineProperty(t.prototype,"allowOpenInApp",{get:function(){return!!this.props.file.open_in_app_data&&!this.props.isMobileUserAgent},enumerable:!0,configurable:!0}),t.prototype.logPreviewSupportDenied=function(){this.props.errorType!==c.ErrorType.LoadError&&this.props.errorType!==c.ErrorType.PendingUploadError&&this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(l.EventType.FilePreviewSupportDenied,{errorType:this.props.errorType})},t.prototype.render=function(){var e=i.Emstring.em_snippet(s.getFilename(this.props.file),this.props.maxFilenameEmLength);return this.props.errorType===c.ErrorType.UpsellError?n.default.createElement(m.PreviewUpsellErrorView,{areActionablesEnabled:this.props.areActionablesEnabled,allowOpenInApp:this.allowOpenInApp,count:this.props.count,errorType:this.props.errorType,extensionsEnabled:this.props.extensionsEnabled,file:this.props.file,filePreviewSession:this.props.filePreviewSession,filename:e,index:this.props.index,onNext:this.props.onNext,onPrevious:this.props.onPrevious,preview:this.props.preview,sharePermission:this.props.sharePermission,shareToken:this.props.shareToken,sharedLinkInfo:this.props.sharedLinkInfo,shouldDisplayToolbar:this.props.shouldDisplayToolbar,sizeClass:this.props.sizeClass,user:this.props.user}):this.props.isFullscreen?n.default.createElement(u.PreviewErrorFullscreenView,r.__assign({},this.props,{allowOpenInApp:this.allowOpenInApp,filename:e})):n.default.createElement(d.PreviewErrorView,r.__assign({},this.props,{allowOpenInApp:this.allowOpenInApp,filename:e}))},t.defaultProps={areActionablesEnabled:!0,isFullscreen:!1},t})(n.default.Component);t._PreviewError=f;var _=a.requireCssWithComponent(f,["/static/css/preview_error-vflPf33PO.css"]);t.PreviewError=_})),define("modules/clean/react/previews/error/view",["require","exports","tslib","classnames","react","modules/clean/react/previews/preview_toolbar","modules/clean/file_store/utils","modules/clean/react/file_viewer/actionable","modules/clean/react/file_viewer/constants","modules/clean/react/previews/constants","modules/clean/react/previews/error/file_info","modules/clean/react/previews/error/image","modules/clean/react/previews/error/message","modules/core/i18n","modules/clean/react/previews/toolbar_flip_buttons"],(function(e,t,r,n,i,o,a,s,l,c,u,d,p,m,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),i=r.__importDefault(i),t.PreviewErrorView=function(e){var t=e.areActionablesEnabled,r=e.allowOpenInApp,m=e.count,v=e.errorType,h=e.extensionsEnabled,g=e.file,w=e.filename,y=e.index,b=e.message,E=e.onNext,S=e.onPrevious,k=e.preview,T=e.sharedLinkInfo,C=e.shareToken,P=e.sharePermission,x=e.shouldDisplayToolbar,A=e.sizeClass,M=e.user;return i.default.createElement("div",{className:n.default({"preview-content":!0,"preview-content--center":!0,"preview-error":!0,"has-toolbar":x})},i.default.createElement("div",{className:"preview-error__wrapper"},i.default.createElement("div",{className:"preview-error__content"},i.default.createElement(d.PreviewErrorImage,{errorType:v}),i.default.createElement(p.PreviewErrorMessage,{file:g,preview:k,errorType:v,message:b}),i.default.createElement(u.PreviewErrorFileInfo,{filename:w,bytes:g.bytes}),t?i.default.createElement(s.Actionable,{allowOpenInApp:!!r,extensionsEnabled:h,file:g,variant:"primary",location:l.FileViewerPane.PreviewContent,sharedLinkInfo:T,shareToken:C,sharePermission:P,user:M,userActionContext:l.UserActionContext.PreviewContentMain,sizeClass:A}):null,v!==c.ErrorType.ExtensionError||a.isArchiveFile(g)?null:i.default.createElement(_,null)),x&&null!=y&&null!=m?i.default.createElement("div",{className:"preview-toolbar-container"},i.default.createElement(o.PreviewToolbar,{isFullscreen:!1},i.default.createElement(f.ToolbarFlipButtons,{index:y,count:m,onClickPrevious:S,onClickNext:E}))):null))};var _=function(){return i.default.createElement("div",{className:"preview-error__help-link"},i.default.createElement("a",{href:l.UnsupportedExtensionHelpLink,target:"_blank",rel:"noopener\n    noreferrer"},m._("Learn more.")))}})),define("modules/clean/react/previews/error/upsell",["require","exports","tslib","classnames","react","modules/clean/react/file_viewer/actionable","modules/clean/react/file_viewer/constants","modules/clean/react/previews/error/file_info","modules/clean/react/previews/error/image","modules/clean/react/previews/error/message","modules/core/i18n","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/previews/preview_toolbar","modules/clean/react/previews/toolbar_flip_buttons"],(function(e,t,r,n,i,o,a,s,l,c,u,d,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n);var f=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClickCTA=function(){t.props.filePreviewSession&&d.filePreviewEventEmitter.emit(a.EventType.FilePreviewUpsellClicked,t.props.filePreviewSession)},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.props.filePreviewSession&&d.filePreviewEventEmitter.emit(a.EventType.FilePreviewUpsellExposed,this.props.filePreviewSession)},t.prototype.render=function(){return i.default.createElement("div",{className:n.default({"preview-content":!0,"preview-content--center":!0,"preview-error":!0,"has-toolbar":this.props.shouldDisplayToolbar})},i.default.createElement("div",{className:"preview-error__wrapper"},i.default.createElement("div",{className:"preview-error__content"},i.default.createElement(l.PreviewErrorImage,{errorType:this.props.errorType}),i.default.createElement(c.PreviewErrorMessage,{file:this.props.file,preview:this.props.preview,errorType:this.props.errorType}),i.default.createElement(s.PreviewErrorFileInfo,{filename:this.props.filename,bytes:this.props.file.bytes}),this.props.areActionablesEnabled?i.default.createElement("div",{className:"preview-error__upsell-cta"},i.default.createElement(o.Actionable,{allowOpenInApp:!!this.props.allowOpenInApp,extensionsEnabled:this.props.extensionsEnabled,file:this.props.file,variant:"primary",location:a.FileViewerPane.PreviewContent,sharedLinkInfo:this.props.sharedLinkInfo,shareToken:this.props.shareToken,sharePermission:this.props.sharePermission,user:this.props.user,userActionContext:a.UserActionContext.PreviewContentMain,sizeClass:this.props.sizeClass})):null,i.default.createElement("div",{className:"preview-error__help-link"},i.default.createElement("a",{href:a.PreviewsUpsellUrl,onClick:this.onClickCTA},u._("Upgrade"))),this.props.shouldDisplayToolbar&&null!=this.props.index&&null!=this.props.count?i.default.createElement("div",{className:"preview-toolbar-container"},i.default.createElement(p.PreviewToolbar,{isFullscreen:!1},i.default.createElement(m.ToolbarFlipButtons,{index:this.props.index,count:this.props.count,onClickPrevious:this.props.onPrevious,onClickNext:this.props.onNext}))):null)))},t})((i=r.__importDefault(i)).default.Component);t.PreviewUpsellErrorView=f})),define("modules/clean/react/previews/fidelity_survey/fidelity_survey",["require","exports","tslib","modules/clean/react/async/loadable","modules/clean/web_timing_logger","modules/constants/file_viewer","react"],(function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importDefault(a),t.LoadableFidelitySurvey=n.Loadable({loader:function(){return i.waitForTTI().then((function(){return new Promise((function(t,r){e(["modules/clean/react/previews/fidelity_survey/fidelity_survey_component"],t,r)})).then(r.__importStar).then((function(e){return e.FidelitySurvey}))}))}});var s=(function(e){function n(t){var r=e.call(this,t)||this;return r.shouldLoad=100*Math.random()<o.PREVIEW_FIDELITY_SURVEY_PROBABILITY,r}return r.__extends(n,e),n.prototype.render=function(){var e=this.props,r=e.allowFileDonation,n=e.file;return this.shouldLoad&&n?a.default.createElement(t.LoadableFidelitySurvey,{allowFileDonation:r,file:n}):null},n})(a.default.Component);t.FidelitySurvey=s})),define("modules/clean/react/previews/frame_messenger_host",["require","exports","tslib","file-viewer/libraries/frame_messenger"],(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(function(e){function t(){var t=["www.dropboxstatic.com","cf.dropboxstatic.com","cfl.dropboxstatic.com","www.dropbox.com","dl-web.dropbox.com","dl.dropboxusercontent.com","previews.dropboxusercontent.com","previews.dropbox.com"].map((function(e){return"https://"+e}));return t.push("null"),t.push(RegExp(".*previews.*.dropboxusercontent.com")),e.call(this,t)||this}return r.__extends(t,e),t})(n.FrameMessengerHost);t.PreviewFrameMessengerHost=i})),define("modules/clean/react/previews/image_helpers",["require","exports","tslib","modules/constants/python","modules/clean/photos/thumbnail_url_util"],(function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n);var o=[[480,320],[640,480],[800,600],[1024,768],[1280,960],[1600,1200],[2048,1536]];function a(e,t){return(t?o.filter((function(e){var r=e[0],n=e[1];return r<=t[0]&&n<=t[1]})):o).map((function(t){var r=t[0],o=t[1];return i.thumbnailUrlForSize(e,r,o,n.THUMBNAIL_SIZE_MODE.ABSTRACT)+" "+r+"w"})).join(", ")}function s(e){return i.thumbnailUrlForSize(e,800,600,n.THUMBNAIL_SIZE_MODE.ABSTRACT)}function l(e,t){return new Promise((function(r,n){var i=Date.now(),o=new Image;o.onload=function(){r({started:i,completed:Date.now()})},o.onerror=function(){n({started:i,failed:Date.now()})},t&&(t.srcset&&(o.srcset=t.srcset),t.sizes&&(o.sizes=t.sizes)),o.src=e}))}t.IMG_SIZES_ATTR="90vw",t.getSrcSet=a,t.getFallbackSrc=s,t.preloadResponsiveImage=function(e){return l(s(e),{srcset:a(e),sizes:t.IMG_SIZES_ATTR})},t.preloadImage=l})),define("modules/clean/react/previews/loading_indicator",["require","exports","tslib","classnames","react"],(function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),i=r.__importDefault(i),t.LoadingIndicator=function(e){return i.default.createElement("div",{className:n.default("c-loader",e.className)})}})),define("modules/clean/react/previews/preview_html",["require","exports","tslib","react","react-dom","file-viewer/core","modules/clean/previews/util","modules/clean/react/file_viewer/constants","modules/clean/react/previews/frame_messenger_host","modules/clean/react/previews/preview_toolbar","modules/clean/react/size_class/constants","modules/clean/web_timing_logger","modules/core/browser_detection","modules/core/uri","modules/clean/react/previews/toolbar_flip_buttons","modules/clean/react/file_viewer/full_screen_helpers","file-viewer/toolbar","file-viewer/strings","modules/clean/i18n/formatters","modules/clean/react/previews/preview_toolbar_button","modules/clean/react/previews/print_helpers","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/keyboard_binding/keyboard_binding","modules/clean/keycode","modules/clean/react/previews/preview_toolbar_frame_messenger","modules/clean/react/file_viewer/logging","modules/constants/page_load"],(function(e,t,r,n,i,o,a,s,l,c,u,d,p,m,f,_,v,h,g,w,y,b,E,S,k,T,C){"use strict";var P;Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),i=r.__importStar(i),d=r.__importStar(d),p=r.__importStar(p);var x,A=g.createFormatters(C.USER_LOCALE,h.strings),M=["failed","viewer-ready","idle-mouse","active-mouse","exit-parent-fullscreen","keydown","child-focus","get-keydown-keys-handled-by-parent"];(function(e){e.ClearMouseTracking="clear-mouse-tracking",e.EnableRegionCreation="enable-region-creation",e.EnterFullscreen="enter-fullscreen",e.ExitViewerFullscreen="exit-viewer-fullscreen",e.PageDown="page-down",e.PageUp="page-up",e.SetCurrentPage="set-current-page",e.PreviewToolbarMounted="preview-toolbar-mounted",e.Print="print",e.ScreenDown="screen-down",e.ScreenUp="screen-up",e.ZoomIn="zoom-in",e.ZoomOut="zoom-out"})(x||(x={}));var I=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.getIframeProps=function(){var e={title:t.props.filename,name:"preview-content",type:"text/html",src:t.getIframeSrc(),sandbox:"",className:"previewhtml",ref:t.setRefIframe};return t.props.usesFrameMessenger&&(e.sandbox="allow-modals allow-scripts allow-forms"),e},t.handleTrustedMessageFromChild=function(e){switch(e.action){case"failed":t.logFilePreviewEvent(s.EventType.FilePreviewDownloadSucceeded),t.logFilePreviewEvent(s.EventType.FilePreviewRenderFailed);var r=o.RivieraStatus.Unknown;e.parameters&&(r=e.parameters.rivieraStatusCode),t.props.onError&&t.props.onError(a.mapRivieraStatusToErrorType(r));break;case"viewer-ready":t.markWebTiming(),t.logFilePreviewEvent(s.EventType.FilePreviewDownloadSucceeded),t.logFilePreviewEvent(s.EventType.FilePreviewRenderSucceeded),t.props.setRenderStatusSuccess(),t.props.isFullscreen?t.frameMessenger.postMessageToChildren("enter-fullscreen"):t.frameMessenger.postMessageToChildren("exit-viewer-fullscreen"),t.props.sharePermission&&0===t.props.sharePermission.canDownloadRoles.length&&t.frameMessenger.postMessageToChildren("disable-download"),t.shouldIncreaseTabHeightForExcel()&&t.frameMessenger.postMessageToChildren("increase-tab-height");break;case"exit-parent-fullscreen":_.exitFullScreen(s.UserActionContext.Unknown);break;case"get-keydown-keys-handled-by-parent":t.postKeysHandledByParent()}},t.handleIframeLoad=function(){t.logFilePreviewEvent(s.EventType.FilePreviewDownloadSucceeded),t.props.usesFrameMessenger||(t.markWebTiming(),t.logFilePreviewEvent(s.EventType.FilePreviewRenderSucceeded),t.props.setRenderStatusSuccess())},t.handleIframeError=function(){t.logFilePreviewEvent(s.EventType.FilePreviewDownloadFailed)},t.setRefIframe=function(e){t.iframe=e},t.printDocument=function(e){t.frameMessenger.postMessageToChildren(x.Print,{context:e})},t.keyboardBindings=[E.hydrateKeyboardBinding({keyboardEventCriteria:{which:S.KeyCode.P},callback:function(){return t.printDocument(s.UserActionContext.Keyboard)}})],t.handleClickPrevious=T.wrapToolbarActionWithLogging((function(){var e=t.props.onClickPrevious;return e&&e()}),s.UserAction.FlipPrevious),t.handleClickNext=T.wrapToolbarActionWithLogging((function(){var e=t.props.onClickNext;return e&&e()}),s.UserAction.FlipNext),t}return r.__extends(t,e),t.prototype.getIframeSrc=function(){var e=m.URI.parse(this.props.src);return this.props.isExcel&&(this.props.forceTestExcelHtml?e.updateQuery({canned_file_name:s.CannedTestFilename.ExcelHTML}):"password_protected"===this.props.forceRivieraException?e.updateQuery({canned_exception:"riviera_exception_password"}):"too_big"===this.props.forceRivieraException&&e.updateQuery({canned_exception:"riviera_exception_too_big"})),e.toString()},t.prototype.shouldIncreaseTabHeightForExcel=function(){return this.props.isExcel&&p.is_mobile_or_tablet()},t.prototype.logFilePreviewEvent=function(e){this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},t.prototype.postKeysHandledByParent=function(){this.frameMessenger.postMessageToChildren("keydown-keys-handled-by-parent",{keycodes:F})},t.prototype.markWebTiming=function(){this.props.filePreviewSession&&this.props.filePreviewSession.markPrimaryEvent(),d.mark_time_to_view(),d.mark_time_to_interactive()},t.prototype.componentDidMount=function(){this.logFilePreviewEvent(s.EventType.FilePreviewSupportConfirmed),this.logFilePreviewEvent(s.EventType.FilePreviewDownloadAttempted),this.props.usesFrameMessenger&&(this.frameMessenger=new l.PreviewFrameMessengerHost,this.frameMessenger.configureChildMessaging("iframe.previewhtml",this.handleTrustedMessageFromChild,M),this.frameMessenger.startListening(),this.postKeysHandledByParent());var e=i.findDOMNode(this.iframe);e.onload=this.handleIframeLoad,e.onerror=this.handleIframeError},t.prototype.componentWillUnmount=function(){this.props.usesFrameMessenger&&this.frameMessenger.stopListening()},t.prototype.render=function(){var e=this,t={};p.iOS&&(t=a.iOSIframeScrollStyles());var i=this.props,o=i.count,l=i.index,d=i.isFullscreen,m=i.isExcel,h=i.sharePermission,g=i.sizeClass,E=i.onClickNext,S=i.onClickPrevious;return n.default.createElement("div",{className:"preview-content",style:t},n.default.createElement("iframe",r.__assign({},this.getIframeProps())),n.default.createElement(c.PreviewToolbar,{elevateToolbar:m,isFullscreen:d,isHidden:g===u.SizeClass.Small,fadeController:function(e){var t=e.fadeIn,r=e.fadeOut;return n.default.createElement(k.PreviewToolbarFrameMessenger,{activeMouse:t,idleMouse:r})}},m?null:n.default.createElement(f.ToolbarFlipButtons,{index:l,count:o,onClickPrevious:S&&this.handleClickPrevious,onClickNext:E&&this.handleClickNext}),n.default.createElement(v.FullScreenButton,{className:"toolbar-button-entry",intl:A,onClick:function(){return _.toggleFullScreen(d,s.UserActionContext.Toolbar)}}),n.default.createElement(w.PreviewToolbarButton,{"data-test":"print",disabled:!y.canPrint(h),spriteGroup:"web",spriteName:"print",tooltip:y.getPrintTooltip(h),onClick:y.canPrint(h)?function(){return e.printDocument(s.UserActionContext.Toolbar)}:function(){}}),n.default.createElement(b.KeyboardBindingConnector,{keyboardBindings:this.keyboardBindings})))},t.defaultProps={usesFrameMessenger:!0},t})(n.default.Component);t.PreviewHTML=I;var F=((P={})[S.KeyCode.ESC]={altKey:!0,ctrlKey:!0,metaKey:!0},P[S.KeyCode.ENTER]={altKey:!0,ctrlKey:!0,metaKey:!0},P[S.KeyCode.SPACE]={altKey:!0,ctrlKey:!0,metaKey:!0},P[S.KeyCode.PAGE_UP]={altKey:!0,ctrlKey:!0,metaKey:!0},P[S.KeyCode.PAGE_DOWN]={altKey:!0,ctrlKey:!0,metaKey:!0},P[S.KeyCode.LEFT]={altKey:!0,ctrlKey:!0,metaKey:!0},P[S.KeyCode.UP]={altKey:!0,ctrlKey:!0,metaKey:!0},P[S.KeyCode.RIGHT]={altKey:!0,ctrlKey:!0,metaKey:!0},P[S.KeyCode.DOWN]={altKey:!0,ctrlKey:!0,metaKey:!0},P[S.KeyCode.EQUALS]={altKey:!0,ctrlKey:!0,metaKey:!0},P[70]={altKey:!1,ctrlKey:!0,metaKey:!0},P[80]={altKey:!0,ctrlKey:!0,metaKey:!0},P[S.KeyCode.PLUS_EQUALS_FF]={altKey:!0,ctrlKey:!0,metaKey:!0},P[S.KeyCode.MINUS_FF]={altKey:!0,ctrlKey:!0,metaKey:!0},P[S.KeyCode.PLUS_EQUALS_FF_GERMAN]={altKey:!0,ctrlKey:!0,metaKey:!0},P[S.KeyCode.MINUS_FF_MAC]={altKey:!0,ctrlKey:!0,metaKey:!0},P[S.KeyCode.PLUS_CHROME]={altKey:!0,ctrlKey:!0,metaKey:!0},P[S.KeyCode.MINUS_CHROME]={altKey:!0,ctrlKey:!0,metaKey:!0},P)})),define("modules/clean/react/previews/preview_toolbar_frame_messenger",["require","exports","tslib","react","modules/clean/react/previews/frame_messenger_host","modules/clean/previews/util"],(function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),o=r.__importStar(o);var a=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.setupFrameMessenger=function(){t.frameMessenger=new i.PreviewFrameMessengerHost,t.frameMessenger.configureChildMessaging(o.getIframeQuery(),t.handleMessageFromChild,["idle-mouse","active-mouse"]),t.frameMessenger.startListening(),t.frameMessenger.postMessageToChildren("preview-toolbar-mounted")},t.handleMessageFromChild=function(e){switch(e.action){case"idle-mouse":t.props.idleMouse();break;case"active-mouse":t.props.activeMouse()}},t.teardownFrameMessenger=function(){t.frameMessenger.resetOriginsForPosting(),t.frameMessenger.stopListening()},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.setupFrameMessenger()},t.prototype.componentWillUnmount=function(){this.teardownFrameMessenger()},t.prototype.render=function(){return null},t})(n.default.Component);t.PreviewToolbarFrameMessenger=a})),define("modules/clean/react/previews/preview_image",["require","exports","tslib","classnames","react","react-redux","modules/clean/analytics","modules/clean/image_preview_util","modules/clean/photos/thumbnail_url_util","modules/clean/previews/actions","modules/clean/react/comments2/components/annotations/loadable","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/data/selectors","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/file_viewer/utils","modules/clean/react/previews/constants","file-viewer/core","modules/clean/i18n/formatters","modules/clean/react/previews/image_helpers","modules/clean/react/previews/preview_toolbar","modules/clean/react/size_class/constants","modules/clean/web_timing_logger","modules/clean/react/css","spectrum/dimensions","file-viewer/preview_image","file-viewer/strings","modules/clean/file_store/utils","modules/clean/react/previews/toolbar_flip_buttons","file-viewer/toolbar","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/keyboard_binding/keyboard_binding","file-viewer/assets-metaserver","modules/clean/react/previews/print_helpers","modules/clean/react/previews/preview_toolbar_button","modules/clean/react/keyboard_binding/keyboard_binding","modules/clean/keycode","modules/clean/react/file_viewer/logging","modules/clean/react/watermarking/watermarking_layer","modules/clean/react/workflows/markup/markup_layer","modules/constants/page_load","file-viewer/polyfills"],(function(e,t,r,n,i,o,a,s,l,c,u,d,p,m,f,_,v,h,g,w,y,b,E,S,k,T,C,P,x,A,M,I,F,O,D,R,L,N,U,W,V,B){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),i=r.__importDefault(i),s=r.__importDefault(s),c=r.__importStar(c),y=r.__importStar(y),S=r.__importStar(S);var j=w.createFormatters(B.USER_LOCALE,P.strings),q=g.resolveAsset.bind(null,O.assets);function K(){}var H=(function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e.imgLoaded=!1,e.state={},e.logTTI=function(){e.props.filePreviewSession&&e.props.filePreviewSession.markPrimaryEvent(),S.mark_time_to_view(),S.mark_time_to_interactive()},e.logRenderSuccess=function(){e.imgLoaded||(e.imgLoaded=!0,e.logFilePreviewEvent(d.EventType.FilePreviewDownloadSucceeded),e.logFilePreviewEvent(d.EventType.FilePreviewRenderSucceeded),e.props.setRenderStatusSuccess(),null!=e.props.onLoad&&e.props.onLoad())},e.onImageDoubleClick=function(){e.shouldDisableZoom()&&e.props.sizeClass!==E.SizeClass.Small&&e.openFullscreen()},e.openFullscreen=function(){null!=e.props.isFullscreen&&_.enterFullScreen()},e.logRenderFailure=function(){var t=function(t){var r={};void 0!==t&&(r.rivieraStatusCode=t.toString()),e.logFilePreviewEvent(d.EventType.FilePreviewDownloadFailed,r),e.props.onError&&e.props.onError(h.ErrorType.LoadError,t)};e.rivieraStatusCodeRequest=v.fetchRivieraStatusCode(e.props["preview-url"],t,t)},e.onZoomIn=function(){e.zoomWithMultiplier(1.25),p.logUserAction(d.UserAction.ZoomIn,d.UserActionContext.Toolbar)},e.onZoomOut=function(){e.zoomWithMultiplier(.8),p.logUserAction(d.UserAction.ZoomOut,d.UserActionContext.Toolbar)},e.onZoomOriginalOrFit=function(){var t=e.state,r=t.scaleFactor,n=t.fitScaleFactor;e.setState({scaleFactor:r===n?1:n})},e.onPrint=function(t){c.imagePrint(l.fullSizeUrl(e.props["preview-url"])),p.logUserAction(d.UserAction.Print,t)},e.handleFitScaleFactorChange=function(t){isNaN(t)||e.state.fitScaleFactor===t||e.setState({fitScaleFactor:t})},e.keyboardBindings=F.getEqualsKeyBindings(U.wrapKeyboardActionWithLogging(e.onZoomIn,d.UserAction.ZoomIn)).concat(F.getMinusKeyBindings(U.wrapKeyboardActionWithLogging(e.onZoomOut,d.UserAction.ZoomOut)),[L.hydrateKeyboardBinding({keyboardEventCriteria:{which:N.KeyCode.P},callback:function(){return e.onPrint(d.UserActionContext.Keyboard)}})]),e.handleClickPrevious=U.wrapToolbarActionWithLogging((function(){var t=e.props.onPrevious;return t&&t()}),d.UserAction.FlipPrevious),e.handleClickNext=U.wrapToolbarActionWithLogging((function(){var t=e.props.onNext;return t&&t()}),d.UserAction.FlipNext),e.renderLayers=function(t){return function(n){var o=i.default.createElement(C.ImageLayer,r.__assign({},t,n)),a=e.state.scaleFactor||e.state.fitScaleFactor||1,s=n.originalWidth,l=n.originalHeight,c=s&&l?{width:s*a,height:l*a}:void 0,d=s&&l?{width:s,height:l}:void 0,p=n.data.thumbnailUrl,m=c&&d&&e.props.isWatermarkingMode?i.default.createElement(W.WatermarkingLayer,{layerSize:c,pageDimensions:d,thumbUrl:p}):null,f=c&&d&&e.props.isMarkupMode?i.default.createElement(V.MarkupLayer,{layerSize:c,pageDimensions:d,page:0}):null;return c&&e.props.annotationAllowed?[i.default.createElement(u.AnnotationConductorLayer,{layerSize:c},i.default.createElement(u.AnnotationInstructionalTooltipPane,{layerSize:c},o,m,f,i.default.createElement(u.AnnotationViewLayer,null)))]:[o,m,f]}},e}return r.__extends(o,t),o.prototype.componentWillUnmount=function(){this.rivieraStatusCodeRequest&&this.rivieraStatusCodeRequest.readyState!==XMLHttpRequest.DONE&&this.rivieraStatusCodeRequest.abort(),this.props.overflowZoomOff()},o.prototype.componentWillMount=function(){this.logFilePreviewEvent(d.EventType.FilePreviewSupportConfirmed),this.logFilePreviewEvent(d.EventType.FilePreviewDownloadAttempted)},o.prototype.componentDidMount=function(){this.logOpen();var t=this.props,n=t.nsId,i=t.sjId,o=n+"_"+i;null!=n&&null!=i&&window._timingData&&window._timingData.img&&window._timingData.img.dl_error_finish&&window._timingData.img.dl_error_finish[o]&&this.logRenderFailure(),new Promise((function(t,r){e(["modules/clean/react/previews/preview_image_zoom"],t,r)})).then(r.__importStar)},o.prototype.componentWillReceiveProps=function(e){if(e["preview-url"]!==this.props["preview-url"]){var t=e.filePreviewSession;this.logFilePreviewEvent(d.EventType.FilePreviewSupportConfirmed,void 0,t),this.logFilePreviewEvent(d.EventType.FilePreviewDownloadAttempted,void 0,t),this.logOpen(),this.setState({scaleFactor:void 0,fitScaleFactor:void 0}),this.imgLoaded=!1}},o.prototype.componentDidUpdate=function(e,t){t.scaleFactor!==this.state.scaleFactor&&(null!=this.state.scaleFactor&&null!=this.state.fitScaleFactor&&this.state.scaleFactor>this.state.fitScaleFactor?this.props.overflowZoomOn():this.props.overflowZoomOff())},o.prototype.logFilePreviewEvent=function(e,t,r){void 0===t&&(t={}),void 0===r&&(r=this.props.filePreviewSession),null!=r&&r.recordEvent(e,t)},o.prototype.logOpen=function(){a.PreviewActivityLogger.log("open",{file_ext:this.props["file-extension"]})},o.prototype.shouldDisableZoom=function(){var e=this.props,t=e.sizeClass;return e.shouldDisplayToolbar||t===E.SizeClass.Small},o.prototype.zoomWithMultiplier=function(e){var t=this.state.fitScaleFactor,r=this.state.scaleFactor||t;if(1!==e&&r){var n=.05*Math.round(r*e/.05);Math.abs(n-r)<.05&&(n+=e>1?.05:-.05),this.setState({scaleFactor:Math.min(Math.max(n,t||0),16)})}},o.prototype.render=function(){var e=this,t=this.props,r=t.count,o=t.currentMode,a=t.index,c=t.onNext,u=t.onPrevious,p=t.shouldDisplayToolbar,m=t.isEditMode,f=t.isFlippingEnabled,v=t.isFullscreen,h=t.sharePermission,w=t.contextMenuDisabled,E=t.windowWidth,S=t.windowHeight,k=t.nsId,T=void 0===k?0:k,P=t.sjId,F=void 0===P?0:P,O=t["preview-url"],L=this.state,U=L.scaleFactor,W=L.fitScaleFactor,V=U||W;return i.default.createElement("div",{className:n.default("flex-preview-container","image-visible","annotations-visible",s.default.PREVIEW_IMAGE_CONTAINER,{"zoom-disabled":this.shouldDisableZoom(),"has-toolbar":p})},i.default.createElement(C.PreviewImage,{previewMetadata:{content:{".tag":"image",default_src:y.getFallbackSrc(O),src_set:y.getSrcSet(O),full_size_src:l.fullSizeUrl(O),thumbnail_url_tmpl:O}},fileMetadata:{file_id:x.getFileRevisionId({ns_id:T,sjid:F}),file_name:""},fileInfo:{ns_id:T,sj_id:F,file_id:x.getFileRevisionId({ns_id:T,sjid:F}),bootstrapped:!0},currentMode:o,data:void 0,filePreviewUiData:{zoomScaleFactor:U,currentPageIndex:0,fitScaleFactor:W||0,isSidebarOpen:!1},coreFileViewerUiData:{isDocSidebarOpen:!1},fileViewerId:"",intl:j,dispatch:K,config:g.DEFAULT_CONFIG,contextMenuDisabled:!!w,onDoubleClick:this.onImageDoubleClick,onInteractive:this.logTTI,onRenderSucceeded:this.logRenderSuccess,onRenderFailed:this.logRenderFailure,sizerClassName:s.default.PREVIEW_IMAGE,className:n.default(s.default.PREVIEW_IMAGE_WRAPPER,"preview-content"),width:+E,height:+S,layerRenderFn:this.renderLayers,onFitScaleFactorChanged:this.handleFitScaleFactorChange,resolveAsset:q}),!m&&i.default.createElement(I.KeyboardBindingConnector,{keyboardBindings:this.keyboardBindings}),!m&&p&&i.default.createElement(b.PreviewToolbar,{isFullscreen:!!v},f?i.default.createElement(A.ToolbarFlipButtons,{index:a,count:r,onClickPrevious:u&&this.handleClickPrevious,onClickNext:c&&this.handleClickNext}):null,i.default.createElement(M.ZoomOutButton,{className:"toolbar-button-entry",disabled:null!=V&&null!=W&&V<=W,intl:j,onClick:this.onZoomOut,onKeyUp:function(t){t.keyCode===N.KeyCode.ENTER&&e.onZoomOut()}}),i.default.createElement(M.ZoomToFitButton,{className:"zoom-label toolbar-button-entry",intl:j,onClick:this.onZoomOriginalOrFit,zoomPercent:V}),i.default.createElement(M.ZoomInButton,{className:"toolbar-button-entry",disabled:null!=V&&V>=16,intl:j,onClick:this.onZoomIn,onKeyUp:function(t){t.keyCode===N.KeyCode.ENTER&&e.onZoomIn()}}),i.default.createElement(M.FullScreenButton,{className:"toolbar-button-entry",intl:j,onClick:function(){return _.toggleFullScreen(!!v,d.UserActionContext.Toolbar)}}),i.default.createElement(R.PreviewToolbarButton,{"data-test":"print",disabled:!D.canPrint(h),spriteGroup:"web",spriteName:"print",tooltip:D.getPrintTooltip(h),onClick:D.canPrint(h)?function(){return e.onPrint(d.UserActionContext.Toolbar)}:K})))},o})(i.default.Component);t._PreviewImage=H;var z=k.requireCssWithComponent((function(e){return i.default.createElement(T.Dimensions,{className:"flex-preview-container"},(function(t){var n=t.width,o=t.height;return i.default.createElement(H,r.__assign({},e,{windowHeight:o,windowWidth:n}))}))}),["/static/css/preview_image-vflIgjzwo.css"]),G=o.connect((function(e){return{isFlippingEnabled:m.getIsFlippingEnabled(e),annotationAllowed:m.getAnnotationAllowed(e),isEditMode:m.getIsEditMode(e),isWatermarkingMode:m.getIsWatermarkingMode(e),isMarkupMode:m.getIsMarkupMode(e)}}),{overflowZoomOn:f.overflowZoomOn,overflowZoomOff:f.overflowZoomOff})(z);t.PreviewImage=G})),define("modules/clean/react/previews/preview_linkfile",["require","exports","tslib","classnames","react","modules/clean/ajax","modules/clean/em_string","modules/clean/filepath","modules/clean/react/css_timing","modules/clean/react/file_viewer/constants","modules/clean/referrer_cleansing_redirect","modules/clean/web_timing_logger","modules/clean/static_urls","modules/core/i18n"],(function(e,t,r,n,i,o,a,s,l,c,u,d,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),i=r.__importDefault(i),o=r.__importStar(o),u=r.__importStar(u),d=r.__importStar(d);var f=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={description:null,hadError:!1,link:null,isMounted:!1},t.requestLinkfileData=function(e){t.logFilePreviewEvent(c.EventType.FilePreviewDownloadAttempted);var r={url:e,dataType:"json",success:t.handleLinkDataSuccess,error:t.handleLinkDataError,xhrFields:{withCredentials:!1}};t.props.data.authenticated?(r.xhrFields={withCredentials:!0},o.SilentBackgroundRequest(r)):o.Request(r)},t.handleLinkDataSuccess=function(e){null!=e.uri?(t.logFilePreviewEvent(c.EventType.FilePreviewDownloadSucceeded),t.markWebTiming(),t.setState({description:e.uri,hadError:!1,link:e.uri}),t.logFilePreviewEvent(c.EventType.FilePreviewRenderSucceeded),t.props.setRenderStatusSuccess()):t.handleLinkDataError()},t.handleLinkDataError=function(){t.logFilePreviewEvent(c.EventType.FilePreviewDownloadFailed),t.markWebTiming(),t.state.isMounted&&t.setState({description:m._("Can’t show link. Something’s wrong with this file."),hadError:!0,link:null})},t.handleClickOpenLinkButton=function(e){if(null!=t.state.link){var r=u.get_redirect_uri(t.state.link);window.open(r.toString(),"_blank")}},t}return r.__extends(t,e),t.prototype.logFilePreviewEvent=function(e){this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},t.prototype.markWebTiming=function(){d.mark_time_to_view(),d.mark_time_to_interactive()},t.prototype.isFileDataFetched=function(){return null==this.state.description},t.prototype.componentDidMount=function(){this.logFilePreviewEvent(c.EventType.FilePreviewSupportConfirmed),this.state.isMounted=!0,this.requestLinkfileData(this.props.data.url)},t.prototype.componentWillUnmount=function(){this.state.isMounted=!1},t.prototype.render=function(){var e={"preview-linkfile-content":!0,"loading-content":this.isFileDataFetched()},r={"preview-linkfile-button-openlink":!0,"button-primary":!0,"has-link":null!=this.state.link},o="-",l="";null!=this.props.filename&&(o=s.filename_without_extension(this.props.filename),""!==(l=s.file_extension(this.props.filename))&&(l="."+l));var c=t.MAX_DISPLAYED_FILENAME_CHARS-l.length,u=a.Emstring.em_snippet(o,c),d="-";null!=this.state.description&&(d=this.state.description);var f={"preview-linkfile-description":!0,"force-show-all-text":this.state.hadError},_=p.static_url("/static/images/icons128/page_white_linkfile-vfloEntlU.png");return i.default.createElement("div",{className:"flex-preview-container"},i.default.createElement("div",{className:"preview-content preview-content--center"},i.default.createElement("div",{className:"preview-linkfile-box"},i.default.createElement("div",{className:n.default(e)},i.default.createElement("div",{className:"preview-linkfile-icon"},i.default.createElement("img",{src:_,alt:""})),i.default.createElement("div",{className:"preview-linkfile-title"},i.default.createElement("span",{className:"preview-linkfile-filebase"},u),i.default.createElement("span",{className:"preview-linkfile-fileext"},l)),i.default.createElement("div",{className:"preview-linkfile-info"},i.default.createElement("div",{className:n.default(f)},d),i.default.createElement("button",{className:n.default(r),onMouseUp:this.handleClickOpenLinkButton,ref:"openLinkButton"},m._("Open in new tab")))))))},t.SPINNER_FADE_DELAY_MSEC=150,t.MAX_DISPLAYED_FILENAME_CHARS=21,t})(i.default.Component);t._PreviewLinkfile=f;var _=l.requireCssWithComponent(f,["/static/css/preview_linkfile-vflI60wqL.css"]);t.PreviewLinkfile=_})),define("modules/clean/react/previews/preview_pdf_loadable",["require","exports","tslib","react","modules/clean/react/async/loadable","modules/clean/react/css_timing","modules/clean/react/previews/loading_indicator"],(function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n);var s=i.Loadable({loader:function(){return new Promise((function(t,r){e(["modules/clean/react/previews/preview_pdf"],t,r)})).then(r.__importStar).then((function(e){return e.PreviewPDF}))},loading:function(e){return e.previewThumbnailUrl?n.default.createElement("div",{className:"preview-pdf-ssr"},n.default.createElement("div",{className:"preview-ssr-viewer"},n.default.createElement(a.LoadingIndicator,{className:"loading-indicator"}))):null}}),l=o.requireCssWithComponent(s,["/static/css/preview_pdf-vfl5Q96aj.css","/static/css/snackbar-vfl8chDI1.css"]);t.PreviewPDFLoadable=l})),define("modules/clean/react/previews/preview_ppt_loadable",["require","exports","tslib","react","modules/clean/react/async/loadable","modules/clean/react/css_timing","modules/clean/react/previews/loading_indicator"],(function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n);var s=i.Loadable({loader:function(){return new Promise((function(t,r){e(["modules/clean/react/previews/preview_ppt"],t,r)})).then(r.__importStar).then((function(e){return e.PreviewPPT}))},loading:function(e){return e.previewThumbnailUrl?n.default.createElement("div",{className:"preview-pdf-ssr"},n.default.createElement("div",{className:"preview-ssr-viewer"},n.default.createElement(a.LoadingIndicator,{className:"loading-indicator"}))):null}}),l=o.requireCssWithComponent(s,["/static/css/preview_pdf-vfl5Q96aj.css","/static/css/snackbar-vfl8chDI1.css"]);t.PreviewPPTLoadable=l}));__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};define("modules/clean/react/previews/preview_toolbar",["require","exports","modules/clean/react/async/loadable"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewToolbar=r.Loadable({loader:function(){return new Promise((function(t,r){e(["modules/clean/react/previews/preview_toolbar_component"],t,r)})).then(__importStar).then((function(e){return e.PreviewToolbar}))}})})),define("modules/clean/react/previews/preview_zoom_container",["require","exports","tslib","keymaster","classnames","react","external/lodash","jquery","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/flippable_controls","modules/clean/react/sprite","modules/clean/react/title_bubble","modules/core/i18n"],(function(e,t,r,n,i,o,a,s,l,c,u,d,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),i=r.__importDefault(i),o=r.__importDefault(o),a=r.__importStar(a),s=r.__importDefault(s);var f="",_="previewzoomcontainer",v=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={controlsHidden:!1},t.flipNext=function(e){void 0===e&&(e=c.UserActionContext.LightboxToolbar),t.props.onFlipNext&&t.props.onFlipNext(),l.logUserAction(c.UserAction.FlipNext,e)},t.flipPrevious=function(e){void 0===e&&(e=c.UserActionContext.LightboxToolbar),t.props.onFlipPrevious&&t.props.onFlipPrevious(),l.logUserAction(c.UserAction.FlipPrevious,e)},t.onClick=function(e){e.target===e.currentTarget&&(e.preventDefault(),t.onCloseFactory({},c.UserActionContext.LightboxFrame))},t.onMouseMove=function(e){0===s.default(e.target).parents(".preview-toolbar-overlay").length?t.startControlsTimer():clearTimeout(t.controlsHideTimer)},t.onCloseFactory=function(e,r){void 0===e&&(e={}),void 0===r&&(r=c.UserActionContext.LightboxCloseButton),l.logUserAction(c.UserAction.ToggleFullscreenOff,r),t.props.onClose()},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){var e=this;this.flipNext=a.throttle(this.flipNext,100),this.flipPrevious=a.throttle(this.flipPrevious,100),n.default("esc",_,(function(){e.onCloseFactory({},c.UserActionContext.Keyboard)})),null!=this.props.onZoomOut&&n.default("space",_,this.props.onZoomOut),f=n.default.getScope(),n.default.setScope(_),this.startControlsTimer()},t.prototype.componentWillUpdate=function(){n.default.setScope(_)},t.prototype.componentWillUnmount=function(){n.default.clearScope(_),n.default.setScope(f),clearTimeout(this.controlsHideTimer)},t.prototype.startControlsTimer=function(){var e=this;this.showControls(),clearTimeout(this.controlsHideTimer),this.controlsHideTimer=setTimeout((function(){e.hideControls()}),3e3)},t.prototype.showControls=function(){this.setState({controlsHidden:!1})},t.prototype.hideControls=function(){this.setState({controlsHidden:!0})},t.prototype.renderFlippableControls=function(){return this.props.fileCount?o.default.createElement(u.FlippableControls,{index:""+(this.props.fileIndex+1),numFlippableFiles:this.props.fileCount,onNext:this.flipNext,onPrevious:this.flipPrevious}):null},t.prototype.renderControls=function(){var e=this.props,t=e.renderZoomControls,r=e.scaleFactor,n=i.default("preview-toolbar-container",{hidden:this.state.controlsHidden});return o.default.createElement("div",{className:n,ref:"previewZoomerToolbarContainer"},o.default.createElement("div",{className:"preview-toolbar-overlay-container"},o.default.createElement("div",{className:"preview-toolbar-overlay"},o.default.createElement("div",{className:"preview-toolbar-content"},this.renderFlippableControls(),t?o.default.createElement("div",{className:i.default("toolbar-button-entry","zoom-out",{disabled:this.props.zoomOutDisabled}),onClick:this.props.onZoomOut},o.default.createElement(d.Sprite,{alt:m._("Zoom out"),group:"web",name:"zoomout"})):null,t?o.default.createElement("div",{className:"toolbar-button-entry",ref:"zoomLabelContainer",onClick:this.props.onViewActualSize},o.default.createElement(p.TitleBubble,{content:m._("View actual size"),position:p.TitleBubble.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},o.default.createElement("span",null,Math.floor(100*(r||0)),"%"))):null,t?o.default.createElement("div",{className:i.default("toolbar-button-entry","zoom-in",{disabled:this.props.zoomInDisabled}),onClick:this.props.onZoomIn},o.default.createElement(d.Sprite,{alt:m._("Zoom in"),group:"web",name:"zoom"})):null))))},t.prototype.renderClose=function(){var e=i.default("preview-zoomer-close",{hidden:this.state.controlsHidden});return o.default.createElement("span",null,o.default.createElement("button",{"aria-label":m._("Close"),className:e,onClick:this.onCloseFactory,ref:"previewZoomerClose"},o.default.createElement(d.Sprite,{alt:m._("Close"),group:"web",name:"xclose"})))},t.prototype.render=function(){var e=i.default("preview-zoomer-container",{"zoomer-drag-disabled":this.props.dragDisabled});return o.default.createElement("div",{className:e,onClick:this.onClick,onMouseMove:this.onMouseMove,ref:"previewZoomerContainer"},this.props.children,this.renderClose(),this.renderControls())},t.defaultProps={dragDisabled:!0,zoomInDisabled:!0,zoomOutDisabled:!0},t})(o.default.Component);t.PreviewZoomContainer=v})),define("modules/clean/react/previews/toolbar_flip_buttons",["require","exports","tslib","react","external/lodash","classnames","file-viewer/strings","modules/clean/i18n/formatters","file-viewer/toolbar","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants","modules/constants/page_load"],(function(e,t,r,n,i,o,a,s,l,c,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),i=r.__importStar(i),o=r.__importDefault(o);var p=s.createFormatters(d.USER_LOCALE,a.strings);t.ToolbarFlipButtons=function(e){var t=e.className,r=e.count,a=e.index,s=e.onClickNext,d=void 0===s?i.noop:s,m=e.onClickPrevious,f=void 0===m?i.noop:m;return null==r||null==a||r<1?null:n.default.createElement(l.ToolbarFlipButtons,{buttonClassName:"toolbar-button-entry",className:o.default("flip-buttons","image-toolbar__item",t),count:r,intl:p,index:a,onClickPrevious:c.wrapToolbarActionWithLogging(f,u.UserAction.FlipPrevious),onClickNext:c.wrapToolbarActionWithLogging(d,u.UserAction.FlipNext)})}})),define("modules/clean/react/previews/video/constants",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),(function(e){e.PlayerRendered="player_rendered",e.FirstClickPlay="first_click_play",e.MediaError="media_error",e.ChangePlaybackRate="change_playback_rate",e.ChangeVideoQuality="change_video_quality",e.ClosePreview="close_preview",e.SeekVideo="seek_video",e.VideoStartsPlaying="video_starts_playing",e.VideoResumesPlaying="video_resumes_playing",e.VideoStalled="video_stalled",e.VideoPaused="video_paused",e.ScrubberThumbnailsLoaded="scrubber_thumbnails_loaded",e.ScrubberThumbnailsFailed="scrubber_thumbnails_failed",e.AudioWaveformLoaded="audio_waveform_loaded",e.AudioWaveformFailed="audio_waveform_failed"})(t.VideoPreviewEvent||(t.VideoPreviewEvent={})),t.HdLabels=["1080p","720p"],t.QualityLabelOrder=t.HdLabels.concat(["480p","360p","240p","256k","192k","128k"]).reverse()})),define("modules/clean/react/previews/video/preview_video",["require","exports","tslib","react","modules/clean/react/previews/video/preview_video_basic","modules/clean/react/previews/video/preview_video_comments2","modules/clean/react/previews/constants"],(function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),t.PreviewVideoProps=i.PreviewVideoProps,t.PreviewVideo=function(e){var t=e.sourceContext,s=e.hidePageChrome;return t!==a.PreviewSourceContext.EmbeddedSharedLinkFile&&!s?n.default.createElement(o.PreviewVideoComments2,r.__assign({},e)):n.default.createElement(i.PreviewVideoBasic,r.__assign({},e))}})),define("modules/clean/react/previews/video/preview_video_basic",["require","exports","tslib","classnames","external/lodash","react","modules/clean/image_size","modules/clean/keycode","modules/clean/loggers/file_preview_logger","modules/clean/loggers/video_preview_logger","modules/clean/previews/util","modules/clean/react/async/loadable","modules/clean/react/css","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/helpers","modules/clean/react/keyboard_binding/keyboard_binding","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/previews/constants","modules/clean/react/previews/video/constants","modules/clean/web_timing_logger","modules/core/browser_detection","modules/core/uri","modules/clean/react/previews/video/utils","modules/clean/react/file_viewer/data/actions","react-redux"],(function(e,t,r,n,i,o,a,s,l,c,u,d,p,m,f,_,v,h,g,w,y,b,E,S,k,T){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),i=r.__importStar(i),o=r.__importDefault(o),y=r.__importStar(y),t.AsyncVideoPlayer=d.Loadable({loader:function(){return new Promise((function(t,r){e(["modules/clean/react/previews/video/video_player"],t,r)})).then(r.__importStar).then((function(e){return e.VideoPlayer}))}});var C=(function(e){function d(){var t=null!==e&&e.apply(this,arguments)||this;return t.lastPlaybackRate=1,t.startsPlayingEvent=w.VideoPreviewEvent.VideoStartsPlaying,t.onEmbed=function(){t.logFilePreviewTimelineEvent(m.EventType.FilePreviewSupportConfirmed),t.logFilePreviewTimelineEvent(m.EventType.FilePreviewDownloadAttempted)},t.onLoadedMetadata=function(e){void 0===e&&(e=0),t.videoLogger.populateVideoDuration(e)},t.onReady=function(e){void 0===e&&(e=!1),t.logFilePreviewTimelineEvent(m.EventType.FilePreviewDownloadSucceeded),t.props.filePreviewSession&&t.props.filePreviewSession.markPrimaryEvent(),y.mark_time_to_view(),y.mark_time_to_interactive(),t.markRenderSucceeded(),t.videoLogger.logEvent(w.VideoPreviewEvent.PlayerRendered)},t.logPlay=i.once((function(){t.videoLogger.logEvent(w.VideoPreviewEvent.FirstClickPlay)})),t.onPlay=function(){var e=t.props.setMediaPlaying;t.logPlay(),e&&e()},t.onPause=function(e){var r=t.props.setMediaPaused;r&&r(),t.videoLogger.logEvent(w.VideoPreviewEvent.VideoPaused,{video_timestamp:e.toString()})},t.onStartsPlaying=function(e){t.videoLogger.logEvent(t.startsPlayingEvent,{play_latency:e.latency.toString(),play_latency_since:e.trigger}),t.startsPlayingEvent=w.VideoPreviewEvent.VideoResumesPlaying},t.onUserInactive=function(e){e!==t.lastPlaybackRate&&(t.lastPlaybackRate=e,t.logUserAction(m.UserAction.VideoPlaybackRateChanged,{playback_rate:e.toString()}))},t.onScrubberThumbnailsLoaded=function(e){e?t.videoLogger.logEvent(w.VideoPreviewEvent.ScrubberThumbnailsLoaded):t.videoLogger.logEvent(w.VideoPreviewEvent.ScrubberThumbnailsFailed)},t.onAudioWaveformLoaded=function(){t.videoLogger.logEvent(w.VideoPreviewEvent.AudioWaveformLoaded)},t.onAudioWaveformFailed=function(){t.videoLogger.logEvent(w.VideoPreviewEvent.AudioWaveformFailed)},t.onError=function(e){if(e&&(t.videoLogger.logEvent(w.VideoPreviewEvent.MediaError,{errorCode:e.code?e.code.toString():"",errorMessage:e.message||""}),"needflash"===e.message))return t.logFilePreviewTimelineEvent(m.EventType.FilePreviewSupportDenied),void("function"==typeof t.props.onError&&t.props.onError(g.ErrorType.NeedFlashError));t.logFilePreviewTimelineEvent(m.EventType.FilePreviewDownloadFailed),y.mark_time_to_view(),y.mark_time_to_interactive(),t.props.onError&&t.props.onError(g.ErrorType.LoadError)},t.onPlaybackRateChange=function(e,r){t.videoLogger.logEvent(w.VideoPreviewEvent.ChangePlaybackRate,{old_playback_rate:e.toString(),new_playback_rate:r.toString()})},t.onSeek=function(e,r){t.videoLogger.logEvent(w.VideoPreviewEvent.SeekVideo,{old_video_time:e.toString(),new_video_time:r.toString()})},t.onStalled=function(e,r){t.videoLogger.logEvent(w.VideoPreviewEvent.VideoStalled,{video_timestamp:e.toString(),playback_rate:r.toString()})},t.onTruncated=function(){f.filePreviewEventEmitter.emit(m.EventType.FilePreviewVideoTruncated),t.videoLogger.setVideoTruncated()},t.onClose=function(e){t.videoLogger.logEvent(w.VideoPreviewEvent.ClosePreview,{video_time_on_close:e.toString()})},t.onSelectQuality=function(e,r){t.videoLogger.logEvent(w.VideoPreviewEvent.ChangeVideoQuality,{old_video_quality:e,new_video_quality:r})},t.handleKeyPress=function(e){return e.keyCode===s.KeyCode.SPACE&&(t.togglePlayback(),e.preventDefault(),!0)},t.keyboardBindings=[{keyboardEventCriteria:v.generateUnmodifiedKeyboardEventCriteria(s.KeyCode.SPACE),callback:t.handleKeyPress}],t.processGutterClick=function(e){var r=t.props.onGutterClick;r&&e.target===e.currentTarget&&r()},t}return r.__extends(d,e),d.prototype.setUpLoggers=function(){this.teardownLoggers(),this.userActionLogger=new l.FilePreviewUserActionLogger,this.userActionLogger.listenTo(f.filePreviewEventEmitter),this.videoLogger=new c.VideoPreviewLogger(this.props.fileExtension,this.props.filePreviewSession)},d.prototype.teardownLoggers=function(){this.userActionLogger&&(this.userActionLogger.unlistenTo(f.filePreviewEventEmitter),delete this.userActionLogger)},d.prototype.logFilePreviewTimelineEvent=function(e){this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},d.prototype.logUserAction=function(e,t){f.filePreviewEventEmitter.emit(m.EventType.FilePreviewUserAction,this.props.filePreviewSession,e,m.UserActionContext.VideoPlayer,t)},d.prototype.markRenderSucceeded=function(){this.logFilePreviewTimelineEvent(m.EventType.FilePreviewRenderSucceeded),this.props.setRenderStatusSuccess()},d.prototype.getPlaybackRates=function(){return[.5,1,1.25,1.5,2,4]},d.prototype.componentDidMount=function(){this.setUpLoggers()},d.prototype.componentWillUnmount=function(){this.teardownLoggers()},d.prototype.shouldComponentUpdate=function(e){return _.compareStateAndProps(e,{})},d.prototype.togglePlayback=function(){f.filePreviewEventEmitter.emit(m.EventType.FilePreviewVideoToggled)},d.prototype.render=function(){var e=this.props,i=e.title,s=e.previewUrl,l=e.separateResolutionUrls,c=e.sourceContext,d=e.thumbnailUrlTmpl,p=e.videoMetadataUrl,m=e.videoContainer,f=e.vttThumbnailsUrl,_=e.waveformUrl,v=S.video_type(m),w=c!==g.PreviewSourceContext.EmbeddedSharedLinkFile,y=!1,k=!1,T=0;b.is_mobile_or_tablet()&&(y=!0,k=!0,T=1);var C={preload:"auto",playbackRates:this.getPlaybackRates(),nativeControlsForTouch:k,playsinline:T};null!=d&&(C.poster=u.tagCriticalPathContentRequest((function(e){return E.URI.parse(e).updateQuery({size:a.imageBestFitSize(window.innerWidth,window.innerHeight),size_mode:"2"}).toString()})(d),this.props.filePreviewSession));var P={videoProps:{src:s,separateResolutionSrcs:l,sourceContentType:v,metadataLink:p,title:i,vttThumbnailsUrl:f,waveformUrl:_},playerCallbacks:{onLoadedMetadata:this.onLoadedMetadata,onError:this.onError,onReady:this.onReady,onPlay:this.onPlay,onPause:this.onPause,onStartsPlaying:this.onStartsPlaying,onUserInactive:this.onUserInactive,onScrubberThumbnailsLoaded:this.onScrubberThumbnailsLoaded,onAudioWaveformLoaded:this.onAudioWaveformLoaded,onAudioWaveformFailed:this.onAudioWaveformFailed,onPlaybackRateChange:this.onPlaybackRateChange,onSeek:this.onSeek,onStalled:this.onStalled,onSelectQuality:this.onSelectQuality,onTimeUpdate:this.props.onTimeUpdate},playerOptions:C,seekPosition:this.props.seekPosition,shouldEnableControls:!this.props.hideControls,noDownload:y,shouldFocusOnReady:this.props.shouldFocusOnReady,onEmbed:this.onEmbed,onTruncated:this.onTruncated,onClose:this.onClose,shouldShowTruncationMessage:w,isAudio:this.props.isAudio,bytes:this.props.bytes,showOnboarding:!!this.props.showOnboarding,playerIntegrationEnabled:!!this.props.playerIntegrationEnabled};return o.default.createElement("div",{className:n.default({"flex-preview-container":!0,"touch-device":b.is_mobile_or_tablet()})},this.props.disableKeyboardShortcuts?null:o.default.createElement(h.KeyboardBindingConnector,{keyboardBindings:this.keyboardBindings}),o.default.createElement("div",{className:"preview-content preview-video",onClick:this.processGutterClick},o.default.createElement("div",{className:"preview-video__wrapper"},o.default.createElement("div",{className:n.default({"preview-video__aspect-container":!0,"preview-audio-transcoded":this.props.isAudio})},o.default.createElement("div",{className:"preview-video__container"},o.default.createElement(t.AsyncVideoPlayer,r.__assign({},P)))))))},d})(o.default.Component);t._PreviewVideoBasic=C;var P=T.connect(void 0,{setMediaPlaying:k.setMediaPlaying,setMediaPaused:k.setMediaPaused})(C),x=p.requireCssWithComponent(P,["/static/css/preview_video-vfljF09ZK.css","/static/css/video-js-7-custom-v1-vfloXXZya.css"]);t.PreviewVideoBasic=x})),define("modules/clean/react/previews/video/preview_video_comments2",["require","exports","tslib","react","react-redux","modules/clean/react/comments2/data/actions","modules/clean/react/comments2/data/store","modules/clean/react/comments2/data/selectors","modules/clean/react/comments2/video_annotations/annotation_helper","modules/clean/react/comments2/video_annotations/constants","modules/clean/react/comments2/video_annotations/video_preview_event_emitter","modules/clean/react/previews/video/preview_video_basic"],(function(e,t,r,n,i,o,a,s,l,c,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.seekToActivatedTimecode()},t.prototype.componentDidUpdate=function(e){e.activatedTimecodeThread!==this.props.activatedTimecodeThread&&this.seekToActivatedTimecode()},t.prototype.seekToActivatedTimecode=function(){var e=this.props.activatedTimecodeThread;if(e){var t=l.VideoAnnotationHelper.unitConvertDomainObjectTimeToSeconds(e.annotation.time);u.videoPreviewEventEmitter.emit(c.EventTypes.SEEK_POSITION_AND_PAUSE,t)}},t.prototype.render=function(){var e=this.props,t=e.onTimeUpdate,i=e.playerIntegrationEnabled;return n.default.createElement(d.PreviewVideoBasic,r.__assign({},this.props,{onTimeUpdate:i?t:void 0}))},t})((n=r.__importDefault(n)).default.PureComponent);t.PreviewVideoBasicWithPlayerIntegration=p,t.ConnectedPreviewVideoComments2=i.connect((function(e){var t=s.getIsPlayerIntegrationEnabled(e);return{showOnboarding:s.getShowOnboardingOnVideo(e),playerIntegrationEnabled:t,activatedTimecodeThread:t?s.getActivatedTimecodeThread(e):void 0}}),{onTimeUpdate:o.Actions.updatePlayerCurrentTime,onGutterClick:o.Actions.deactivateAllThreads})(p);var m=(function(e){function o(t){var r=e.call(this,t)||this;return r.store=a.getStoreForComments2(),r}return r.__extends(o,e),o.prototype.render=function(){return n.default.createElement(i.Provider,{store:this.store},n.default.createElement(t.ConnectedPreviewVideoComments2,r.__assign({},this.props)))},o})(n.default.PureComponent);t.PreviewVideoComments2=m})),define("modules/clean/react/previews/video/utils",["require","exports","tslib","modules/core/browser_detection"],(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),t.showQualityNativeHls=function(){return n.edge||n.safari};t.video_type=function(e){return"application/vnd.apple.mpegurl"},t.getTechFromPlayer=function(e){return e.tech({IWillNotUseThisInPlugins:!0})}}));__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};define("modules/clean/react/share_download/button",["require","exports","modules/clean/react/async/loadable"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DownloadSimpleButton=r.Loadable({loader:function(){return new Promise((function(t,r){e(["modules/clean/react/share_download/button_component"],t,r)})).then(__importStar).then((function(e){return e.DownloadSimpleButton}))}}),t.ShareDownloadButton=r.Loadable({loader:function(){return new Promise((function(t,r){e(["modules/clean/react/share_download/button_component"],t,r)})).then(__importStar).then((function(e){return e.ShareDownloadButton}))}})})),define("modules/clean/react/file_sidebar/file_sidebar_connect",["require","exports","tslib","react","react-redux","hoist-non-react-statics"],(function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),i=r.__importStar(i),o=r.__importDefault(o),t.FILE_SIDEBAR_REDUX_STORE_KEY="SIDEBAR_REDUX_STORE_KEY",t.fileSidebarConnect=function(e,a){var s={storeKey:t.FILE_SIDEBAR_REDUX_STORE_KEY},l=a?i.connect(e,a,void 0,s):i.connect(e,void 0,void 0,s);return function(e){var t=l(e),i=(function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(i,e),i.prototype.render=function(){return n.default.createElement(t,r.__assign({},this.props))},i.displayName="FileSidebar"+t.displayName,i.WrappedComponent=t,i})(n.default.Component);return o.default(i,t)}}})),define("modules/clean/react/file_sidebar/file_sidebar_logger",["require","exports","tslib","modules/clean/ajax","modules/clean/react/file_viewer/models"],(function(e,t,r,n,i){"use strict";function o(e,t){var r=i.FileViewerSession.currentSession,o=i.FilePreviewSession.currentSession;if(o&&r){var a={event_name:e,file_viewer_session_id:r.id,file_preview_session_id:o.id,file_ns_id:o.file.ns_id,file_sjid:o.file.sjid,extra:JSON.stringify(t)};n.SilentBackgroundRequest({url:"/log/file_sidebar",data:a})}}Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),t.logSidebarTabSelected=function(e){o("sidebar_tab_selected",e)},t.logSidebarOpened=function(e){o("sidebar_opened",e)},t.logSidebarClosed=function(e){o("sidebar_closed",e)},t.logActivityStreamInteractivity=function(e){o("activity_stream_interactivity",e)},t.logFileViewActivityCardExpanded=function(e){o("file_view_activity_expanded",e)}})),define("modules/clean/react/file_sidebar/file_sidebar_provider",["require","exports","tslib","react","modules/clean/react/file_sidebar/generic_file_sidebar_provider","modules/clean/react/file_sidebar/store/instance"],(function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(t){var r=e.call(this,t)||this;return r.state={loaded:!0,store:o.store},r}return r.__extends(t,e),t.prototype.componentWillUnmount=function(){var e=this.state.store;e&&e.dispatch({type:"::RESET"})},t.prototype.render=function(){return n.default.createElement(i.GenericFileSidebarProvider,null,this.props.children)},t})((n=r.__importDefault(n)).default.Component);t.FileSidebarProvider=a})),define("modules/clean/react/file_sidebar/generic_file_sidebar_provider",["require","exports","tslib","react","react-redux","modules/clean/react/file_sidebar/file_sidebar_connect","modules/clean/react/file_sidebar/store/instance"],(function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n);var s=i.createProvider(o.FILE_SIDEBAR_REDUX_STORE_KEY),l=(function(e){function t(t){var r=e.call(this,t)||this;return r.state={loaded:!0,store:a.store},r}return r.__extends(t,e),t.prototype.render=function(){return n.default.createElement(s,{store:this.state.store},this.props.children)},t})(n.default.Component);t.GenericFileSidebarProvider=l})),define("modules/clean/react/file_sidebar/managed_comments_tab",["require","exports","tslib","react","react-redux","modules/clean/react/comments2/data/actions","modules/clean/react/comments2/data/store","modules/clean/react/comments2/components/comments_tab","modules/clean/file_store/utils"],(function(e,t,r,n,i,o,a,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),t.streamFromProps=function(e){var t=e.currentFile,r=e.currentFile,n=r.bytes,i=r.file_id,o=r.ns_id,a=r.sjid,s=e.sharedLinkInfo,c=e.isVersionHistoryMode;return{id:i,linkUrl:s&&s.url,ns_id:o,sjid:a,type:"file",fq_path:"fq_path"in t?t.fq_path:void 0,isVersionHistoryMode:c,bytes:n,filename:l.getFilename(t)}};var c=(function(e){function l(r){var n=e.call(this,r)||this;return n.setContext=function(e){n.store.dispatch(o.Actions.setFileContext({stream:t.streamFromProps(e),viewer:e.user}))},n.store=a.getStoreForComments2(),n}return r.__extends(l,e),l.prototype.componentDidMount=function(){this.setContext(this.props)},l.prototype.componentWillUpdate=function(e){this.setContext(e)},l.prototype.render=function(){return this.store?n.default.createElement(i.Provider,{store:this.store},n.default.createElement(s.CommentsTab,r.__assign({},this.props))):null},l})(n.default.Component);t.ManagedCommentsTab=c})),define("modules/clean/react/file_sidebar/store/app/reducer",["require","exports","tslib"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.INITIAL_STATE={hideComments:!1,hidePageChrome:!1},t.reducer=function(e,n){switch(void 0===e&&(e=t.INITIAL_STATE),n.type){case"APP_SET_STATE":var i=n.hideComments,o=n.hidePageChrome;return r.__assign({},e,{hideComments:i,hidePageChrome:o})}return e}})),define("modules/clean/react/file_sidebar/store/file_activity/activity_sorted_set",["require","exports","tslib","modules/clean/react/file_sidebar/store/file_activity/sorted_set"],(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(function(e){function t(r){return void 0===r&&(r=[]),e.call(this,r,t.compare,t.equals)||this}return r.__extends(t,e),t.compare=function(e,t){return e.id===t.id?0:t.timestamp.getTime()-e.timestamp.getTime()},t.equals=function(e,t){return e.id===t.id},t})(n.SortedSet);t.ActivitySortedSet=i})),define("modules/clean/react/file_sidebar/store/file_activity/reducer",["require","exports","tslib","modules/clean/react/file_sidebar/store/file_activity/activity_sorted_set"],(function(e,t,r,n){"use strict";function i(e){return e.map((function(e){return e.isGroup&&1===e.groupActivities.length?e.groupActivities[0]:e}))}Object.defineProperty(t,"__esModule",{value:!0}),t.INITIAL_STATE={activities:{error:void 0,loaded:!1,loading:!1,value:[]},enabled:!1,userId:-1},t.ungroupSingleActivityGroups=i,t.reducer=function(e,o){switch(void 0===e&&(e=t.INITIAL_STATE),o.type){case"FILE_ACTIVITY|RESET":return r.__assign({},t.INITIAL_STATE);case"FILE_ACTIVITY|RESET_FILE_STATE":return r.__assign({},e,{activities:t.INITIAL_STATE.activities});case"FILE_ACTIVITY|LOADING_START":return r.__assign({},e,{activities:r.__assign({},e.activities,{error:void 0,loading:!0}),userId:o.userId,file:o.file});case"FILE_ACTIVITY|LOADING_END":return r.__assign({},e,{activities:r.__assign({},e.activities,{loaded:!0,loading:!1})});case"FILE_ACTIVITY|RECEIVE_FILE_ACTIVITY":var a=o.enabled?new n.ActivitySortedSet(e.activities.value.concat(i(o.activities))).toArray():[];return r.__assign({},e,{activities:r.__assign({},e.activities,{value:a}),enabled:o.enabled});case"FILE_ACTIVITY|RECEIVE_STREAM_ERROR":return r.__assign({},e,{activities:r.__assign({},e.activities,{error:o.error})})}return e}})),define("modules/clean/react/file_sidebar/store/file_activity/selectors",["require","exports"],(function(e,t){"use strict";function r(e){return e.fileActivity}function n(e){return r(e).activities.value}function i(e){return r(e).file}function o(e){return r(e).userId}Object.defineProperty(t,"__esModule",{value:!0}),t.getState=r,t.getActivities=n,t.getActivitiesMetadata=function(e){return r(e).activities},t.getVisibleActivityCount=function(e){return n(e).length},t.getFile=i,t.getUserId=o,t.getContext=function(e){return{file:i(e),userId:o(e)}},t.isActivityEnabled=function(e){return r(e).enabled}})),define("modules/clean/react/file_sidebar/store/file_activity/sorted_set",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,r){void 0===e&&(e=[]),this.items=[],this.compare=t,this.equals=r,this.add(e)}return e.prototype.add=function(e){var t=this;Array.isArray(e)||(e=[e]);var r=this.items.concat(e);return r.sort(this.compare),this.items=r.filter((function(e,r,n){return 0===r||!t.equals(e,n[r-1])})),this},e.prototype.toArray=function(){return Array.prototype.slice.call(this.items)},e})();t.SortedSet=r})),define("modules/clean/react/file_sidebar/store/instance",["require","exports","tslib","redux","modules/clean/react/file_sidebar/store/app/reducer","modules/clean/react/file_sidebar/store/file_activity/reducer","modules/clean/react/file_sidebar/store/sidebar/reducer","modules/clean/react/file_sidebar/store/middleware/thunk","modules/clean/react/file_sidebar/store/middleware/reactor","modules/clean/react/file_sidebar/store/sidebar/reactors","modules/clean/redux/unsupported","modules/clean/redux/devtools"],(function(e,t,r,n,i,o,a,s,l,c,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=(n=r.__importStar(n)).combineReducers({app:i.reducer,fileActivity:o.reducer,sidebar:a.reducer});function m(e,t){return"::RESET"===t.type&&(e=void 0),p(e,t)}t.store=u.createStore(m,d.composeEnhancersWithDevTools(n.applyMiddleware(s.thunk(),l.reactor(c.reactors))))})),define("modules/clean/react/file_sidebar/store/middleware/reactor",["require","exports","modules/clean/shallow_equal"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t){return r.shallowEqual(e,t)};function i(e){return"function"==typeof e.changes}function o(e){return"function"==typeof e.changesIn}function a(e){return"function"==typeof e.changesFrom&&"function"==typeof e.changesTo}t.reactor=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=[];function s(e,t,s){var l;if(void 0===s&&(s=n),i(e))l=function(t,r){return{changed:e.changes(t,r)}};else if(o(e))l=function(t,r){var n=e.changesIn(t),i=e.changesIn(r);return{prevValue:n,nextValue:i,changed:!s(n,i)}};else{if(!a(e))throw new Error;l=function(t,r){var n=e.changesFrom(t),i=e.changesTo(r);return{changed:n&&i}}}r.push({checkForChange:l,onChange:t})}for(var l=0,c=e;l<c.length;l++){var u=c[l];u(s)}return function(e){var t=e.getState;return function(e){return function(n){for(var i=t(),o=e(n),a=t(),s=0,l=r;s<l.length;s++){var c=l[s],u=c.checkForChange(i,a),d=u.prevValue,p=u.nextValue;u.changed&&c.onChange({nextValue:p,prevValue:d,nextState:a,prevState:i})}return o}}}}})),define("modules/clean/react/file_sidebar/store/middleware/thunk",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.thunk=function(){return function(e){var t=e.dispatch,r=e.getState;return function(e){return function(n){return"function"==typeof n?n(t,r):e(n)}}}}})),define("modules/clean/react/file_sidebar/store/sidebar/actions",["require","exports","tslib","modules/clean/react/file_sidebar/store/file_activity/selectors","modules/clean/react/file_sidebar/store/sidebar/helpers","modules/clean/react/file_sidebar/store/sidebar/selectors","modules/clean/react/file_sidebar/file_sidebar_logger","modules/clean/react/file_sidebar/store/sidebar/types","file-viewer/core"],(function(e,t,r,n,i,o,a,s,l){"use strict";function c(e){return function(t,r){t({type:s.ActionType.SidebarOpen,payload:{reason:e}})}}function u(){return function(e,t){var r=t(),i=o.getSidebarContext(r).user;o.getSidebarState(r).open&&(e({type:s.ActionType.SidebarClose}),a.logSidebarClosed({num_comments:o.getTabState(r,"comments").extra.commentCount,num_events:n.getVisibleActivityCount(r),viewing_user_id:i?i.id:null}))}}function d(){return{type:s.ActionType.SidebarIndicateNewFileNav}}Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),i=r.__importStar(i),o=r.__importStar(o),t.reset=function(){return{type:s.ActionType.SidebarReset}},t.open=c,t.close=u,t.toggle=function(){return function(e,t){var r=t();o.getSidebarState(r).open?e(u()):e(c("toggle_button"))}},t.completeToggleOpen=function(){return function(e){e(c("toggle_button_after_transition"))}},t.selectTab=function(e){return{type:s.ActionType.SidebarSelectTab,payload:{tabName:e}}},t.thirdpartyBlueDotOnboard=function(){return{type:s.ActionType.SidebarSetThirdPartyBlueDotOnboardState}},t.openFile=function(e){return function(t,r){var n=r(),a=o.getSidebarContext(n);i.isContextChanged(a,e)&&(t({type:s.ActionType.SidebarOpenFile,payload:e}),t(d()))}},t.setComments2DisabledState=function(){return{type:s.ActionType.SidebarSetComments2DisabledState}},t.setComments2ShownState=function(e){return{type:s.ActionType.SidebarSetComments2ShownState,payload:e}},t.setCommentingOnNewFile=d,t.OverrideInitialState=function(e){var t=e===l.FileViewerMode.Documentation?"metadata":"comments";return{type:s.ActionType.SidebarOverrideInitialState,payload:{open:!0,tab:t}}}})),define("modules/clean/react/file_sidebar/store/sidebar/helpers",["require","exports","modules/clean/file_store/utils"],(function(e,t,r){"use strict";function n(e,t){return!e&&!t||!!e&&!!t&&r.areFilesEqual(e,t)}function i(e,t){return!e&&!t||!!e&&!!t&&e.id===t.id}Object.defineProperty(t,"__esModule",{value:!0}),t.isFileSame=n,t.isUserSame=i,t.isContextChanged=function(e,t){return!n(e.file,t.file)||!i(e.user,t.user)}})),define("modules/clean/react/file_sidebar/store/sidebar/reactors",["require","exports","tslib","modules/clean/react/file_sidebar/file_sidebar_logger","modules/clean/react/file_sidebar/store/sidebar/selectors","modules/clean/react/file_sidebar/store/file_activity/selectors"],(function(e,t,r,n,i,o){"use strict";function a(e){var t=i.getSidebarState(e),r=t.open,n=t.ready;return r&&n}function s(e){return!a(e)}function l(e){var t=i.getSidebarContext(e).user;n.logSidebarOpened({reason:i.getOpenReason(e),num_comments:i.getTabState(e,"comments").extra.commentCount,num_events:o.getVisibleActivityCount(e),viewing_user_id:t?t.id:null})}Object.defineProperty(t,"__esModule",{value:!0}),i=r.__importStar(i),o=r.__importStar(o),t.reactors=function(e){e({changesFrom:s,changesTo:a},(function(e){l(e.nextState)})),e({changes:function(e,t){if(a(e)&&a(t)){var r=t.sidebar.tabs,n=e.sidebar.tabs;return!(n.activity.ready&&n.comments.ready)&&r.activity.ready&&r.comments.ready}return!1}},(function(e){l(e.nextState)}))}})),define("modules/clean/react/file_sidebar/store/sidebar/reducer",["require","exports","tslib","modules/clean/react/file_sidebar/store/sidebar/types"],(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.INITIAL_STATE={activeTab:"comments",open:!0,openReason:void 0,ready:!1,context:{file:void 0,isVersionHistoryMode:void 0,user:void 0},tabs:{activity:{ready:!1,show:!1,count:0},comments:{ready:!1,show:!1,count:0,extra:{commentCount:0}},metadata:{ready:!1,show:!1}},hasOverride:!1,thirdpartyBlueDotOnboarded:!1},t.reducer=function(e,i){void 0===e&&(e=t.INITIAL_STATE);var o=(function(e,i){var o;switch(i.type){case n.ActionType.SidebarOverrideInitialState:var a=i.payload,s=a.open,l=a.tab;return r.__assign({},e,{open:s,activeTab:l,tabs:r.__assign({},e.tabs,(o={},o[l]=r.__assign({},e.tabs[l],{show:!0}),o)),hasOverride:!0});case n.ActionType.SidebarReset:return r.__assign({},t.INITIAL_STATE,{open:e.open});case n.ActionType.SidebarOpen:return r.__assign({},e,{open:!0,openReason:i.payload.reason});case n.ActionType.SidebarClose:return r.__assign({},e,{open:!1,openReason:void 0});case n.ActionType.SidebarSelectTab:return r.__assign({},e,{activeTab:i.payload.tabName});case n.ActionType.SidebarSetThirdPartyBlueDotOnboardState:return r.__assign({},e,{thirdpartyBlueDotOnboarded:!0});case n.ActionType.SidebarOpenFile:var c=i.payload,u=c.file,d=c.isVersionHistoryMode,p=c.user;return r.__assign({},e,{openReason:void 0,context:{file:u,isVersionHistoryMode:d,user:p},tabs:{activity:{ready:!p,show:!1===d&&e.tabs.activity.show,count:0},comments:{ready:!1,show:!1,count:0,extra:{commentCount:0}},metadata:{ready:!1,show:!0}}});case"FILE_ACTIVITY|LOADING_END":return r.__assign({},e,{tabs:r.__assign({},e.tabs,{activity:{ready:!0,show:!1===e.context.isVersionHistoryMode&&i.state.enabled,count:0}})});case n.ActionType.SidebarSetComments2DisabledState:return r.__assign({},e,{tabs:r.__assign({},e.tabs,{comments:{ready:!0,show:!1,count:0,extra:{commentCount:0}}})});case n.ActionType.SidebarSetComments2ShownState:return r.__assign({},e,{activeTab:e.hasOverride?e.activeTab:"comments",tabs:r.__assign({},e.tabs,{comments:{ready:!0,show:!e.hasOverride||e.tabs.comments.show,count:0,extra:{commentCount:i.payload.commentCount}}})});case n.ActionType.SidebarIndicateNewFileNav:return r.__assign({},e,{tabs:r.__assign({},e.tabs,{comments:{ready:!1,show:!0,count:0,extra:{commentCount:0}}})})}return e})(e,i);return o.ready=e.ready||o.tabs.activity.ready&&o.tabs.comments.ready,e.ready||!o.ready||e.hasOverride||(o.tabs.comments.show&&!o.tabs.activity.show?o.activeTab="comments":!o.tabs.comments.show&&o.tabs.activity.show&&(o.activeTab="activity"),o.tabs.comments.show&&o.tabs.comments.count>0&&(o.open=!0,o.openReason=o.openReason||"unread_comments",o.activeTab="comments"),o.tabs.comments.show&&o.tabs.comments.extra&&o.tabs.comments.extra.commentCount>0&&(o.open=!0,o.openReason=o.openReason||"comments2_unresolved_threads",o.activeTab="comments")),o.ready&&o.open&&!o.openReason&&(o.openReason="sticky_state"),o}})),define("modules/clean/react/file_sidebar/store/sidebar/selectors",["require","exports"],(function(e,t){"use strict";function r(e){return e.sidebar}function n(e){return r(e).tabs}Object.defineProperty(t,"__esModule",{value:!0}),t.getState=r,t.getSidebarState=function(e){var t=r(e);return{activeTab:t.activeTab,open:t.open,openReason:t.openReason,ready:t.ready}},t.getOpenReason=function(e){return r(e).openReason},t.getSidebarContext=function(e){return r(e).context},t.getTabsState=n,t.getTabState=function(e,t){return n(e)[t]},t.getThirdPartyBlueDotOnboardedState=function(e){return r(e).thirdpartyBlueDotOnboarded}})),define("modules/clean/react/file_sidebar/store/sidebar/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),(function(e){e.SidebarOpen="SIDEBAR|OPEN",e.SidebarReset="SIDEBAR|RESET",e.SidebarClose="SIDEBAR|CLOSE",e.SidebarSelectTab="SIDEBAR|SELECT_TAB",e.SidebarOpenFile="SIDEBAR|OPEN_FILE",e.SidebarToggle="SIDEBAR|TOGGLE",e.SidebarIndicateNewFileNav="SIDEBAR|INDICATE_NEW_FILE_NAV",e.SidebarSetComments2DisabledState="SIDEBAR|SET_COMMENTS2_DISABLED_STATE",e.SidebarSetComments2ShownState="SIDEBAR|SET_COMMENTS2_SHOWN_STATE",e.SidebarSetThirdPartyBlueDotOnboardState="SIDEBAR|SET_THIRDPARTY_BLUEDOT_ONBOARDED_STATE",e.SidebarOverrideInitialState="SIDEBAR|OVERRIDE_INITIAL_STATE"})(t.ActionType||(t.ActionType={}))})),define("modules/clean/react/watermarking/api",["require","exports","modules/clean/api_v2/user_client"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sendWatermarkRequest=function(e,t,n,i){var o,a,s=new r.UserApiV2Client;i&&(!(function(e){return"distanceX"in e})(i)?a={image:i.image,position:i.position,margin_x:Math.round(i.marginX),margin_y:Math.round(i.marginY)}:o={image:i.image,distance_x:Math.round(i.distanceX),distance_y:Math.round(i.distanceY),start_x:Math.round(i.startX),start_y:Math.round(i.startY),offset_x_per_row:Math.round(i.offsetXPerRow),offset_y_per_col:Math.round(i.offsetYPerCol)});var l={path:t,overwrite:n,tiled_image:o,image_watermark:a};return s.ns("file_viewer").rpc("watermarking/watermark_file",l,{subjectUserId:e})}})),define("modules/clean/react/watermarking/apply_watermark_button",["require","exports","tslib","react","modules/core/browser","modules/core/i18n","spectrum/popover","spectrum/button","premium-workflows/components/trial/trial_popover_content","modules/clean/loggers/workflows_logger","spectrum/tooltip"],(function(e,t,r,n,i,o,a,s,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),i=r.__importStar(i);var d=o.i18n_default_project("watermarking")._,p=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClickedTrialPopover=function(){c.logWorkflowsEvent(c.WorkflowsEvent.WatermarkUpsellPopoverClickedWmCopy,t.props.milestone),i.redirect(t.getLink("?_tk=watermarking_popover_wm_upsell"))},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.isPopoverTrialVariant()&&c.logWorkflowsEvent(c.WorkflowsEvent.WatermarkUpsellPopoverExposedWmCopy,this.props.milestone)},t.prototype.getLink=function(e){return this.props.isPlusUser?"/buy"+e:"/pro/try"+e},t.prototype.isPopoverTrialVariant=function(){var e=this.props,t=e.allowWatermark,r=e.trialVariant;return!t&&"POPOVER_WM_VALUE_PROPS"===r},t.prototype.renderPopoverContent=function(){return this.isPopoverTrialVariant()?n.default.createElement(a.PopoverContent,null,n.default.createElement(l.TrialPopoverContent,{variant:"watermarking_wm",onClick:this.onClickedTrialPopover})):n.default.createElement(a.PopoverContent,null,n.default.createElement(a.PopoverContentItem,{value:!1,className:"apply-watermark-menu-item__copy"},d("Make a copy",{comment:"As in: save the watermarked file as a copy"})),n.default.createElement(a.PopoverContentItem,{value:!0,className:"apply-watermark-menu-item__overwrite"},d("Replace original",{comment:"As in: overwrite this file with watermarked file"})))},t.prototype.renderButton=function(){var e=this.props,t=e.onClick,r=e.hasInput,i=n.default.createElement(s.Button,{className:"apply-watermark-button",tagName:"div",disabled:!r,variant:"primary",onClick:t},d("Save"));return r?i:n.default.createElement(u.Tooltip,{className:"watermarking-save-bubble--no-watermark",tooltipContent:d("Add an image or text watermark to save",{comment:"As in: notifying user they cannot save watermark if no image uploaded or text set"}),positioning:"below"},i)},t.prototype.render=function(){var e=this.props.hasInput;return n.default.createElement(a.Popover,{onSelection:this.props.onApply},n.default.createElement(a.PopoverTrigger,{disabled:!e},this.renderButton()),this.renderPopoverContent())},t})(n.default.Component);t.ApplyWatermarkButton=p})),define("modules/clean/react/watermarking/watermarking_layer",["require","exports","tslib","react","react-redux","modules/clean/react/css","modules/clean/react/file_viewer/data/actions","modules/clean/react/watermarking/drawing","modules/clean/react/watermarking/selectors","modules/clean/react/watermarking/utils","modules/clean/react/watermarking/types"],(function(e,t,r,n,i,o,a,s,l,c,u){"use strict";function d(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var r=t.getContext("2d");if(!r)return 0;r.drawImage(e,0,0);for(var n,i,o,a=r.getImageData(0,0,t.width,t.height).data,s=0,l=0,c=a.length;l<c;l+=4)n=a[l],i=a[l+1],o=a[l+2],s+=Math.floor((n+i+o)/3);return Math.floor(s/(e.width*e.height))}Object.defineProperty(t,"__esModule",{value:!0});var p=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.updateWatermarkColor=function(){var e=t.props,r=e.thumbUrl,n=e.watermark;r?(t.img=new Image,t.img.crossOrigin="use-credentials",t.img.onload=function(){var e=d(t.img)<127?"white":"black";t.setTextWatermark({color:e})},t.img.src=r):t.setTextWatermark({color:n.textWatermarkingOptions.color})},t.updateWatermarkFontSize=function(){var e=t.props,r=e.pageDimensions,n=e.watermark;if(r){var i=n.textWatermarkingOptions.size,o=Math.floor((r.width+r.height)/2),a=Math.floor(o/200),s=Math.floor(o/5),l=i!==c.DEFAULT_WATERMARKING_STATE.textWatermarkingOptions.size&&a<i&&i<s?i:Math.floor(o/40);t.setTextWatermark({size:l,minSize:a,maxSize:s})}},t.canvasRef=function(e){t.canvas=e},t.redraw=function(){var e=t.props,r=e.tilingFunc,n=e.watermark;if(r&&t.canvas&&n){var i=t.canvas.getContext("2d");if(i){var o=u.getWatermarkingOptions(n),a=t.getCanvasSize(),l=a.canvasWidth,d=a.canvasHeight,p=a.scale;if(i.clearRect(0,0,l,d),o.position!==u.WatermarkPosition.REPEAT){var m,f=o.angle/180*Math.PI;if(n.mode===u.WatermarkingMode.TEXT){if(!(_=n.textWatermarkingOptions).text)return;m=s.drawTextTile(_.text,_.size*p,_.fontFamily,_.color,_.opacity/100,f).canvas}else{var _;if(!(_=n.imageWatermarkingOptions).image)return;m=s.drawImageTile(_.image,_.size*p,_.opacity/100,f).canvas}if(m){var v=o.marginX*p,h=o.marginY*p,g=v,w=h;switch(o.position){case u.WatermarkPosition.CENTER:g=(l-m.width)/2,w=(d-m.height)/2;break;case u.WatermarkPosition.NORTHEAST:g=l-m.width-v;break;case u.WatermarkPosition.SOUTHWEST:w=d-m.height-h;break;case u.WatermarkPosition.SOUTHEAST:g=l-m.width-v,w=d-m.height-h}i.drawImage(m,g,w)}}else{var y=void 0;try{y=r(p)}catch(e){if(e.message===c.WatermarkingError.TILE_NO_INPUT)return;throw e}for(var b=0,E=0,S=(y.startY+E)%y.distanceY-y.height;S<d;S+=y.distanceY){for(var k=(y.startX+b)%y.distanceX-y.width;k<l;k+=y.distanceX)i.drawImage(y.canvas,k,S);b+=y.offsetXPerRow,E+=y.offsetYPerCol}}}}},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.updateWatermarkColor(),this.updateWatermarkFontSize(),this.redraw(),this.props.pageDimensions&&this.props.setPageDimensions(this.props.pageDimensions)},t.prototype.componentDidUpdate=function(e){this.props.thumbUrl!==e.thumbUrl&&this.updateWatermarkColor(),this.redraw()},t.prototype.setTextWatermark=function(e){var t=this.props,r=t.updateWatermarkOptions;t.watermark.mode===u.WatermarkingMode.TEXT&&r({textWatermarkingOptions:e})},t.prototype.getCanvasSize=function(){var e=this.props.layerSize.width,t=this.props.pageDimensions||this.props.layerSize,r=t.width,n=t.height,i=e/r;if(this.props.watermark){var o=u.getWatermarkingOptions(this.props.watermark);i=Math.min(i,o.scale)}return{canvasWidth:Math.round(r*i),canvasHeight:Math.round(n*i),scale:i}},t.prototype.render=function(){var e=this.props,t=e.watermark,r=e.tilingFunc;if(!t||!r)return null;var i=this.props.layerSize,o=i.width,a=i.height,s=this.getCanvasSize(),l=s.canvasWidth,c=s.canvasHeight,u={width:o+"px",height:a+"px"};return n.default.createElement("canvas",{ref:this.canvasRef,className:"fv-watermarking-layer",style:u,width:l,height:c})},t})((n=r.__importDefault(n)).default.PureComponent);t._WatermarkingLayer=p;t.ConnectedWatermarkingLayer=i.connect((function(e){return{watermark:l.getWatermarkState(e),tilingFunc:l.getWatermarkTilingFunc(e)}}),{updateWatermarkOptions:a.updateWatermarkOptions,setPageDimensions:a.setPageDimensions})(p);var m=o.requireCssWithComponent(t.ConnectedWatermarkingLayer,["/static/css/file_viewer/watermarking_layer-vflNek1am.css"]);t.WatermarkingLayer=m})),define("modules/clean/react/workflows/i18n/apply_translation",["require","exports","modules/core/i18n"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.applyTranslation=function(e){return"Test string"===e.text&&"this is an unused string for sample purposes only"===e.description?r._("Test string",{comment:"this is an unused string for sample purposes only"}):"Upgrade"===e.text&&"Upgrade Dropbox account"===e.description?r._("Upgrade",{comment:"Upgrade Dropbox account"}):"You’re in trial mode."===e.text&&"This will be shown to basic and plus users when they test out watermarking"===e.description&&"watermarking"===e.project?r._("You’re in trial mode.",{comment:"This will be shown to basic and plus users when they test out watermarking",project:"watermarking"}):"Upgrade to Professional to apply your watermark."===e.text&&"When basic or plus users test out a professional feature such as watermarking, they will not be able to save their changes until they upgrade"===e.description&&"watermarking"===e.project?r._("Upgrade to Professional to apply your watermark.",{comment:"When basic or plus users test out a professional feature such as watermarking, they will not be able to save their changes until they upgrade",project:"watermarking"}):"Upgrade to Professional for advanced features"===e.text&&"When basic or plus users test out a professional feature such as watermarking, they will not be able to save their changes until they upgrade"===e.description&&"watermarking"===e.project?r._("Upgrade to Professional for advanced features",{comment:"When basic or plus users test out a professional feature such as watermarking, they will not be able to save their changes until they upgrade",project:"watermarking"}):"Upgrade to Professional to get watermarking"===e.text&&"When basic or plus users test out a professional feature such as watermarking, they will not be able to save their changes until they upgrade"===e.description&&"watermarking"===e.project?r._("Upgrade to Professional to get watermarking",{comment:"When basic or plus users test out a professional feature such as watermarking, they will not be able to save their changes until they upgrade",project:"watermarking"}):"Protect work right in Dropbox"===e.text&&"Value prop: Users can protect their images/pdfs by watermarking them right in Dropbox"===e.description&&"watermarking"===e.project?r._("Protect work right in Dropbox",{comment:"Value prop: Users can protect their images/pdfs by watermarking them right in Dropbox",project:"watermarking"}):"Apply watermarks quickly"===e.text&&"Value prop: Users can apply watermarks to their pdf/images quickly"===e.description&&"watermarking"===e.project?r._("Apply watermarks quickly",{comment:"Value prop: Users can apply watermarks to their pdf/images quickly",project:"watermarking"}):"Create custom watermarks"===e.text&&"Value prop: Users can create custom watermarks (e.g. changing text, uploading an image)"===e.description&&"watermarking"===e.project?r._("Create custom watermarks",{comment:"Value prop: Users can create custom watermarks (e.g. changing text, uploading an image)",project:"watermarking"}):"Protect work with watermarking"===e.text&&"Value prop: Users can protect their images/pdfs by watermarking them in Dropbox"===e.description&&"watermarking"===e.project?r._("Protect work with watermarking",{comment:"Value prop: Users can protect their images/pdfs by watermarking them in Dropbox",project:"watermarking"}):"Get %(pro_space_limit)s of storage"===e.text&&"Value prop: Users get more storage if they upgrade to Professional"===e.description&&"watermarking"===e.project?r._("Get %(pro_space_limit)s of storage",{comment:"Value prop: Users get more storage if they upgrade to Professional",project:"watermarking"}).format({pro_space_limit:e.pro_space_limit}):"Free up space with Smart Sync"===e.text&&"Value prop: Users can free up space with Smart Sync if they upgrade to Professional"===e.description&&"watermarking"===e.project?r._("Free up space with Smart Sync",{comment:"Value prop: Users can free up space with Smart Sync if they upgrade to Professional",project:"watermarking"}):"Make a copy"===e.text&&"As in: save the markup file as a copy"===e.description&&"watermarking"===e.project?r._("Make a copy",{comment:e.description,project:e.project}):"Replace original"===e.text&&"As in: overwrite this file with markup file"===e.description&&"watermarking"===e.project?r._("Replace original",{comment:e.description,project:e.project}):"Save"===e.text&&"Save the file"===e.description&&"watermarking"===e.project?r._("Save",{comment:e.description,project:e.project}):"Try Professional free"===e.text&&"Try Dropbox Professional for free"===e.description?r._("Try Professional free",{comment:"Try Dropbox Professional for free"}):"Set expiration dates for file requests"===e.text&&"Value prop: Users can set expiration dates for their file requests"===e.description?r._("Set expiration dates for file requests",{comment:"Value prop: Users can set expiration dates for their file requests"}):"Add an image or text watermark to save"===e.text&&"As in: notifying user they cannot save watermark if no image uploaded or text set"===e.description&&"watermarking"===e.project?r._("Add an image or text watermark to save",{comment:"As in: notifying user they cannot save watermark if no image uploaded or text set",project:"watermarking"}):null}})),define("modules/clean/react/workflows/i18n/with_translations",["require","exports","tslib","react","premium-workflows/common/i18n","modules/core/i18n","modules/clean/react/helpers","modules/clean/react/workflows/i18n/apply_translation","modules/clean/display_format"],(function(e,t,r,n,i,o,a,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),t.withTranslations=function(e){var t=function(t){return n.default.createElement(i.TranslationProvider,{applyTranslation:s.applyTranslation,formatBytes:l.format_bytes,formatPercent:o.format_percent,isEnvExternal:!0},n.default.createElement(e,r.__assign({},t)))};return t.displayName="WithTranslations("+a.getDisplayName(e)+")",t}})),define("modules/clean/react/workflows/markup/markup_layer",["require","exports","tslib","react","react-redux","external/lodash","modules/clean/react/workflows/markup/fabric_wrapper","modules/clean/react/css","modules/clean/react/workflows/markup/selectors","modules/clean/react/file_viewer/data/actions","modules/clean/react/workflows/markup/types","modules/clean/react/workflows/markup/fabric"],(function(e,t,r,n,i,o,a,s,l,c,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleSelectionChange=function(e){if(e.selected){var r=e.selected,n=r.some((function(e){return["circle","rect"].includes(e.type||"")}))?[u.FormatSubmenuEntry.FILL,u.FormatSubmenuEntry.STROKE]:[u.FormatSubmenuEntry.STROKE];t.props.setMarkupFormatSubmenu(n);var i=r.filter((function(e){return d.getStroke(e)})),o=d.getStroke(i[0]),a=i.every((function(e){return d.getStroke(e)===o})),s=r.filter((function(e){return d.getFill(e)})),l=d.getFill(s[0]),c=s.every((function(e){return d.getFill(e)===l}));o&&a&&t.props.setMarkupStroke(o),l&&c&&t.props.setMarkupFill(l)}},t.handleObjectMoving=function(e){var t=e.target;if(t&&t.canvas&&null!=t.top&&null!=t.left){t.setCoords();var r=t.canvas.getWidth(),n=t.canvas.getHeight(),i=t.getBoundingRect().width,o=t.getBoundingRect().height,a=t.getBoundingRect().top,s=t.getBoundingRect().left;if(!(o>n||i>r)){var l=.9*i,c=.9*o,u=Math.max(t.top,t.top-a-c),d=Math.max(t.left,t.left-s-l);t.top=Math.min(u,n+c-o+t.top-a),t.left=Math.min(d,r+l-i+t.left-s),t.setCoords()}}},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){var e=this.createFabricCanvas(),t=this.props.markupState[this.props.page];t&&t.fabric&&e.loadFromJSON(t.fabric.toJSON(),(function(){e.requestRenderAll()})),this.props.setMarkupCanvas(this.props.page,e,this.getCanvasSize().scale)},t.prototype.createFabricCanvas=function(){var e=new a.fabric.Canvas(this.canvasId);return e.on("selection:updated",this.handleSelectionChange),e.on("selection:created",this.handleSelectionChange),e.on("object:moving",this.handleObjectMoving),e.isDrawingMode=this.props.markupState.isDrawingMode,e},t.prototype.componentDidUpdate=function(){var e=this.props,t=e.markupState,r=e.page,n=this.getCanvasSize(),i=n.width,o=n.height,a=n.scale,s=t[r]&&t[r].fabric;if(s)s.setDimensions({width:i,height:o}),this.props.updateMarkupCanvasScale(r,a);else{var l=this.createFabricCanvas();this.props.setMarkupCanvas(r,l,a)}},t.prototype.shouldComponentUpdate=function(e){return this.props.page!==e.page||!o.isEqual(this.props.pageDimensions,e.pageDimensions)||!o.isEqual(this.props.layerSize,e.layerSize)},t.prototype.getCanvasSize=function(){var e=this.props.layerSize.width,t=this.props.pageDimensions||this.props.layerSize,r=t.width,n=t.height,i=e/r;return{width:Math.round(r*i),height:Math.round(n*i),scale:i}},t.prototype.render=function(){var e=this.getCanvasSize(),t=e.width,r=e.height,i={width:t+"px",height:r+"px"};return this.canvasId="markup-canvas"+this.props.page,n.default.createElement("div",{className:"fv-markup-layer",style:i},n.default.createElement("canvas",{id:this.canvasId,width:t,height:r}))},t})((n=r.__importDefault(n)).default.Component);t._MarkupLayer=p;t.ConnectedMarkupLayer=i.connect((function(e){return{markupState:l.getMarkupState(e)}}),{setMarkupCanvas:c.setMarkupCanvas,updateMarkupCanvasScale:c.updateMarkupCanvasScale,setMarkupFormatSubmenu:c.setMarkupFormatSubmenu,setMarkupFill:c.setMarkupFill,setMarkupStroke:c.setMarkupStroke})(p);var m=s.requireCssWithComponent(t.ConnectedMarkupLayer,["/static/css/file_viewer/markup_layer-vfl8rimjm.css"]);t.MarkupLayer=m})),define("modules/clean/shallow_equal",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.prototype.hasOwnProperty;function n(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!=e&&t!=t}t.shallowEqual=function(e,t){if(n(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var i=Object.keys(e),o=Object.keys(t);if(i.length!==o.length)return!1;for(var a=0;a<i.length;a++)if(!r.call(t,i[a])||!n(e[i[a]],t[i[a]]))return!1;return!0}})),define("modules/clean/react/comments2/components/annotations/empty_layer",["require","exports","tslib","react"],(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),t.EmptyLayer=function(e){return n.default.createElement("div",{style:{position:"absolute",left:0,top:0,right:0,bottom:0}},e.children)}}));__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};define("modules/clean/react/comments2/components/annotations/loadable",["require","exports","modules/clean/react/async/loadable","modules/clean/react/comments2/components/annotations/empty_layer"],(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationViewLayer=r.Loadable({loader:function(){return new Promise((function(t,r){e(["modules/clean/react/comments2/components/annotations/annotation_view_layer"],t,r)})).then(__importStar).then((function(e){return e.AnnotationViewLayer}))}}),t.AnnotationConductorLayer=r.Loadable({loader:function(){return new Promise((function(t,r){e(["modules/clean/react/comments2/components/annotations/annotation_conductor_layer"],t,r)})).then(__importStar).then((function(e){return e.AnnotationConductorLayer}))},loading:n.EmptyLayer}),t.AnnotationInstructionalTooltipPane=r.Loadable({loader:function(){return new Promise((function(t,r){e(["modules/clean/react/comments2/components/annotations/annotation_instructional_tooltip_pane"],t,r)})).then(__importStar).then((function(e){return e.AnnotationInstructionalTooltipPane}))},loading:n.EmptyLayer})})),define("modules/clean/react/comments2/components/mobile_web_comments",["require","exports","tslib","react","external/lodash","modules/clean/web_timing_logger","modules/clean/react/async/loadable"],(function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),i=r.__importStar(i),t.AsyncManagedCommentsTab=a.Loadable({loader:function(){return o.waitForTTI().then((function(){return new Promise((function(t,r){e(["modules/clean/react/file_sidebar/managed_comments_tab"],t,r)})).then(r.__importStar).then((function(e){return e.ManagedCommentsTab}))}))}}),t.MobileWebComments=function(e){return n.default.createElement(t.AsyncManagedCommentsTab,r.__assign({},e,{collapsed:!1,fileSidebarDispatch:i.noop,isMobile:!0,isVersionHistoryMode:!1}))}})),define("modules/clean/react/comments2/components/snackbars",["require","exports","tslib","react","modules/clean/react/snackbar","modules/core/i18n"],(function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n);var a=o._("Close",{comment:"Button to dismiss snackbar message"}),s=o._("Retry",{comment:"Button to retry a failed action"});t.showSuccessSnackbar=function(e){var t=e.message,r=n.default.createElement(i.Snackbar,{title:t,variant:"complete",closeButtonText:a,id:"comments2"});i.Snackbar.show(r)},t.showErrorSnackbar=function(e){var t=e.message,r=e.retryFn,o=r?n.default.createElement(i.Snackbar,{title:t,variant:"fail",closeButtonText:a,actionButtonText:s,onActionClick:function(){r(),i.Snackbar.close()},id:"comments2"}):n.default.createElement(i.Snackbar,{title:t,variant:"fail",closeButtonText:a,id:"comments2"});i.Snackbar.show(o)}})),define("modules/clean/react/comments2/data/action_helper",["require","exports","tslib","modules/clean/react/comments2/data/selectors","modules/clean/react/comments2/util"],(function(e,t,r,n,i){"use strict";var o=this;function a(e){return{error:e+".Error",request:e+".Request",success:e+".Success"}}function s(e){return{actionTypes:a(e),name:e,type:"async"}}function l(e){return{actionType:e,name:e,type:"sync",zero:!1}}function c(e){return{actionType:e,name:e,type:"sync",zero:!0}}function u(){var e=this;return function(t,o){return r.__awaiter(e,void 0,void 0,(function(){var e,a,s,l,c,u,d;return r.__generator(this,(function(r){switch(r.label){case 0:return e=o.action,a=o.args,s=o.dispatch,l=o.context,c=o.getState,i.isContextSame(l,n.getContext(c()))?[3,2]:[4,t(o)];case 1:return[2,r.sent()];case 2:s({type:e.actionTypes.request,payload:a,meta:{args:a}}),r.label=3;case 3:return r.trys.push([3,5,,6]),[4,t(o)];case 4:return u=r.sent(),s({type:e.actionTypes.success,payload:u,meta:{args:a}}),[2,u];case 5:throw d=r.sent(),s({type:e.actionTypes.error,error:d,meta:{args:a}}),d;case 6:return[2]}}))}))}}Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),t.syncReduxAction=function(e,t){return e.zero?{type:e.actionType}:{type:e.actionType,payload:t}},t.requestReduxAction=function(e,t){return{type:e.actionTypes.request,payload:t,meta:{args:t}}},t.successReduxAction=function(e,t,r){return{type:e.actionTypes.success,payload:r,meta:{args:t}}},t.errorReduxAction=function(e,t,r){return{type:e.actionTypes.error,error:r,meta:{args:t}}},t.asyncActionConstants=a,t.asyncAction=s,t.syncAction=l,t.syncAction0=c,t.namespacedActions=function(e){return{asyncAction:function(t){return s(e+"/"+t)},syncAction:function(t){return l(e+"/"+t)},syncAction0:function(t){return c(e+"/"+t)}}},t.syncHandler=function(e){return e.zero?function(){return{type:e.name}}:function(t){return{payload:t,type:e.name}}},t.createAsyncHandler=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t,i){return function(a){return function(s,l){return r.__awaiter(o,void 0,void 0,(function(){var o,c,u=this;return r.__generator(this,(function(d){switch(d.label){case 0:o=n.getContext(l()),c=e.reduceRight((function(e,t){return function(n){return r.__awaiter(u,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return[4,t(e,n)];case 1:return[2,r.sent()]}}))}))}}),(function(e){return i(a,e)})),d.label=1;case 1:return d.trys.push([1,3,,4]),[4,c({action:t,args:a,dispatch:s,getState:l,context:o})];case 2:return[2,d.sent()];case 3:return d.sent(),[3,4];case 4:return[2]}}))}))}}}},t.dispatchMiddleware=u,t.thunkHandler=t.createAsyncHandler(),t.asyncHandler=t.createAsyncHandler(u())})),define("modules/clean/react/comments2/data/actions",["require","exports","tslib","external/lodash","modules/core/browser","modules/core/i18n","modules/clean/redux/types","modules/clean/react/comments2/data/api","file-viewer/core","modules/clean/react/file_sidebar/store/instance","comments2/transforms","modules/clean/react/comments2/data/types","modules/clean/react/comments2/components/snackbars","modules/clean/react/comments2/util","modules/clean/react/comments2/data/logger","modules/clean/react/comments2/data/perf_util","modules/clean/react/comments2/data/selectors","comments2/components/utils/throttle-debounce","modules/clean/bolt","modules/clean/browse_interface","modules/clean/react/comments2/data/action_helper","modules/clean/react/file_sidebar/store/sidebar/actions","modules/clean/react/file_viewer/data/actions"],(function(e,t,r,n,i,o,a,s,l,c,u,d,p,m,f,_,v,h,g,w,y,b,E){"use strict";var S=this;function k(e){var t=this,n=e.clientFn,i=e.successCallback,o=e.eventToLog;return function(e,a){return r.__awaiter(t,void 0,void 0,(function(){var t,l,c;return r.__generator(this,(function(r){switch(r.label){case 0:if(!(t=v.getContext(a()))||!t.viewer)throw new Error;l=new s.Comments2Api(t.viewer.id,t.stream),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,n(l)];case 2:return c=r.sent(),f.logEvent(o,{stream:t.stream}),i(e,a,c),[3,4];case 3:return r.sent(),f.logErrorEvent("error trying to execute client event "+o,{stream:t.stream}),[3,4];case 4:return[2]}}))}))}}function T(e){return function(r,n){r(Z(e));var i=e.thread,o=n(),a=v.getStream(o);f.logEvent("activate_thread",{stream:a,thread:i}),i.read||i.readonly||r(t.Actions.markThreadRead({threadId:i.id,origin:d.MarkThreadReadOrigin.ThreadActivated}))}}function C(){return k({clientFn:function(e){return e.enableCommenting()},successCallback:P,eventToLog:"enable_comments"})}function P(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return v.getStreamId(t())!==n.id?[2]:[4,e(z(d.Comments2ContextStatus.Pending))];case 1:return r.sent(),e(Y(!0,!1)),[2]}}))}))}function x(){return k({clientFn:function(e){return e.disableCommenting()},successCallback:A,eventToLog:"disable_comments"})}function A(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){var i;return r.__generator(this,(function(r){return v.getStreamId(t())!==n.id?[2]:(i=v.getContext(t()),M(e,i,!0),[2])}))}))}function M(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return[4,e(z(d.Comments2ContextStatus.Disabled))];case 1:return t.sent(),e(E.disableMode(l.FileViewerMode.Commenting)),[4,c.store.dispatch(b.setComments2DisabledState())];case 2:return t.sent(),[2]}}))}))}Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),i=r.__importStar(i),m=r.__importStar(m),f=r.__importStar(f),_=r.__importStar(_),v=r.__importStar(v),b=r.__importStar(b),t.HandleErrorArg=p.ShowErrorSnackbarArg,t.enableCommenting=C,t.disableCommenting=x,t.bolt={client:null,subscribe:function(e,r,n){var i=e.app_id,o=e.revision,a=e.token,s=e.unique_id,l=new g.SignedChannelState(i,s,o,a);t.bolt.client?t.bolt.client.update_states([l]):(t.bolt.client=new g.BoltClient([l],r,n),t.bolt.client.start())},unsubscribe:function(){t.bolt.client&&(t.bolt.client.unsubscribe(),t.bolt.client=null)}};var I=m.createBackoff(),F=I.backoff,O=I.resetBackoff;function D(e){var n=this;return function(i,o){return r.__awaiter(n,void 0,void 0,(function(){var n,a,s;return r.__generator(this,(function(r){switch(r.label){case 0:return n=o(),a=v.getContext(n),m.isContextSame(a,e)?[3,2]:(t.bolt.unsubscribe(),i(K(e)),i(Ke({setContextTime:+new Date,listCompleteTime:0})),e?(s=a&&a.viewer,e.viewer&&!m.isUserSame(s,e.viewer)&&(i(t.Actions.checkOnboardingStatus(void 0)),i(re(void 0))),v.getStickers(n)||i(t.Actions.getStickers(void 0)),[4,i(Y(!0))]):[3,2]);case 1:r.sent(),r.label=2;case 2:return[2]}}))}))}}t.setFileContext=D;var R=y.namespacedActions("Comments2"),L=R.asyncAction,N=R.syncAction,U=R.syncAction0;function W(e){var t=this,n=e.handleError,i=e.handleSuccess;return function(e,a){return r.__awaiter(t,void 0,void 0,(function(){function t(){return r.__awaiter(this,void 0,void 0,(function(){var l,c,u,d;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e(a)];case 1:return l=r.sent(),[3,3];case 2:throw c=r.sent(),(u=(function(e,t){if(t instanceof s.Comments2Error&&(t.code===s.ErrorCode.FILE_NOT_FOUND||t.code===s.ErrorCode.PERMISSION_DENIED))return{message:o._("Either that file was deleted or you no longer have access to it."),isRetriable:!1};switch(e){case he.name:case we.name:case Se.name:return{message:o._("We were unable to post the comment."),isRetriable:!0};case be.name:return{message:o._("We were unable to delete the comment."),isRetriable:!0};case Ae.name:return{message:o._("We were unable to resolve the thread."),isRetriable:!0};case Ie.name:return{message:o._("We were unable to unresolve the thread."),isRetriable:!0};case Te.name:return{message:o._("We were unable to mark the thread as read."),isRetriable:!0};case Pe.name:return{message:o._("We were unable to mark the thread as unread."),isRetriable:!0};case Ge.name:return{message:o._("We were unable to subscribe to the file."),isRetriable:!0};case Qe.name:return{message:o._("We were unable to unsubscribe from the file."),isRetriable:!0};case $.name:case ce.name:case qe.name:default:return null}})(a.action.name,c))&&n({message:u.message,retryFn:u.isRetriable?t:void 0}),c;case 3:return(d=(function(e){switch(e){case Ge.name:return{message:o._("You have subscribed to the file.")};case Qe.name:return{message:o._("You have unsubscribed from the file.")};default:return null}})(a.action.name))&&i(d),[2,l]}}))}))}return r.__generator(this,(function(e){switch(e.label){case 0:return[4,t()];case 1:return[2,e.sent()]}}))}))}}function V(){return+new Date}function B(e){var t=this;return function(n,i){return r.__awaiter(t,void 0,void 0,(function(){function t(t){var r=e(i.action.name,t);if(r){var n=V();i.dispatch(bt(r,i.context,n-o))}}var o,a,l;return r.__generator(this,(function(e){switch(e.label){case 0:o=V(),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,n(i)];case 2:return a=e.sent(),[3,4];case 3:throw l=e.sent(),t(l instanceof s.Comments2Error?l.code:"unknown_error"),l;case 4:return t(),[2,a]}}))}))}}t.statusHandlingMiddleware=W,t.perfLoggingMiddleware=B;var j=y.createAsyncHandler(W({handleError:p.showErrorSnackbar,handleSuccess:p.showSuccessSnackbar}),(function(e,t){var r=t.context;if(!r||!r.viewer)throw new Error("Bad state");var i=new s.Comments2Api(r.viewer.id,r.stream);return e(n.merge({},t,{api:i,context:r}))}),(function(e){var t=this;return function(i,o){return r.__awaiter(t,void 0,void 0,(function(){var t,s;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,i(o)];case 1:return t=r.sent(),e(n.merge({},o,{payload:t,status:a.ApiClientStatus.Success})),[2,t];case 2:throw s=r.sent(),e(n.merge({},o,{error:s,status:a.ApiClientStatus.Error})),s;case 3:return[2]}}))}))}})((function(e){var t=e.context.stream,r=v.getThreadMap(e.getState());if(e.status===a.ApiClientStatus.Error)f.logErrorEvent("encountered an error with async api call "+e.action.name,{stream:t});else if(e.status===a.ApiClientStatus.Success){var n=e.args,i=e.payload;switch(e.action.name){case he.name:var o=r[i.id];f.logEvent("new_comment",{commentId:i.id,stream:t,thread:o});break;case we.name:o=r[n.threadId];f.logEvent("reply_to_comment",{commentId:i.id,stream:t,thread:o});break;case be.name:o=r[n.threadId];f.logEvent("delete_comment",{commentId:n.commentId,stream:t,thread:o});break;case Se.name:o=r[n.threadId];f.logEvent("edit_comment",{commentId:n.commentId,stream:t,thread:o});break;case Ae.name:o=r[n.threadId];f.logEvent("resolve_thread",{stream:t,thread:o});break;case Ie.name:o=r[n];f.logEvent("unresolve_thread",{stream:t,thread:o});break;case Te.name:var s=n.origin===d.MarkThreadReadOrigin.ThreadActivated?"read_thread":"mark_thread_as_read";o=r[n.threadId];f.logEvent(s,{stream:t,thread:o});break;case Pe.name:o=r[n];f.logEvent("mark_thread_as_unread",{stream:t,thread:o});break;case Ge.name:f.logEvent("subscribe",{stream:t});break;case Qe.name:f.logEvent("unsubscribe",{stream:t})}}})),B((function(e,t){switch(e){case he.name:case we.name:case Te.name:case Pe.name:case Ae.name:case Ie.name:return _.threadActionCompleted(e,t);case be.name:case Se.name:return _.commentActionCompleted(e,t)}})),y.dispatchMiddleware()),q=N("SetContext"),K=y.syncHandler(q),H=N("SetContextStatus"),z=y.syncHandler(H),G=L("ListComments"),Y=function(e,n){return void 0===e&&(e=!1),void 0===n&&(n=!0),function(a,_){return r.__awaiter(S,void 0,void 0,(function(){var g,w,y,S,k,T,C,P,x,A,I,D,R,L,N,U,W,V,B,j,q,K,H,X,Z,Q,J,$;return r.__generator(this,(function(r){switch(r.label){case 0:if(g=_(),!(w=v.getContext(g)))return[2];a({type:G.actionTypes.request}),y=w.stream,S=w.viewer,k=S?new s.Comments2Api(S.id,y):new s.Comments2LoggedOutApi(y),r.label=1;case 1:return r.trys.push([1,6,,7]),[4,k.listComments(e,v.getCursor(g))];case 2:if(T=r.sent(),C=T.bolt_info,P=T.cursor,x=T.status,A=T.supported_enhancements,I=T.threads,D=T.users,R=T.permissions,L=+new Date,N=v.getContextStatus(g),U=x[".tag"],W="enabled"===U||"readonly"===U,N===d.Comments2ContextStatus.Pending&&W&&(V=v.getData(g),B=V.perfEvents&&V.perfEvents.setContextTime||0,a(t.Actions.logSimplePerfEvent("initial_list_completed_ms",L-B))),j=_(),q=v.getContext(j),!m.isContextSame(q,w))return[2];if(R&&(a(je({canEnable:R.can_enable_commenting})),a(ze({canSubscribe:R.can_subscribe,isSubscribed:R.is_subscribed})),a(Ve(R.can_see_comment_editor)),a(W?E.enableMode(l.FileViewerMode.Commenting):E.disableMode(l.FileViewerMode.Commenting))),A&&(K=A.third_party_source,H=A.time_based_annotations,X=A.time_based_annotations_upsell_tooltip_variant,Z=(void 0===X?{".tag":"other"}:X)[".tag"],H&&a(De()),"other"!==Z&&a(Le(Z)),K&&a(Ue(K[".tag"]))),Q=n?(te=/comment_id=(.*)/.exec(i.get_uri().getFragment()))?te[1]:void 0:void 0,N===d.Comments2ContextStatus.Pending)switch(x[".tag"]){case"disabled":null!=R&&R.can_enable_commenting,M(a),Q&&p.showErrorSnackbar({message:o._("Comments are disabled on this file.")});break;case"enabled":a(Ke({listCompleteTime:L})),a(z(d.Comments2ContextStatus.FullyEnabled)),c.store.dispatch(b.setComments2ShownState({commentCount:I.filter((function(e){return!e.resolved})).length}));break;case"readonly":a(Ke({listCompleteTime:L})),a(z(d.Comments2ContextStatus.ReadOnly)),c.store.dispatch(b.setComments2ShownState({commentCount:I.filter((function(e){return!e.resolved})).length}));break;case"comments1":a(z(d.Comments2ContextStatus.Comments1))}return v.isEnabled(g)||N===d.Comments2ContextStatus.Pending&&("enabled"===x[".tag"]||"readonly"===x[".tag"])?[4,a((ee=C,function(e){if(m.useBolt()){var r=h.debounce((function(){O(),e(Y(!1,!1))}),2e3);t.bolt.subscribe(ee,r,(function(){t.bolt.unsubscribe(),F((function(){e(Y(!1,!1))}))}))}}))]:[3,5];case 3:return r.sent(),J=u.streamToRevision(y),[4,a({type:G.actionTypes.success,payload:{authors:D,cursor:P,threads:I,currentRevision:J}})];case 4:r.sent(),Q&&a(t.Actions.activateComment(Q)),r.label=5;case 5:return[3,7];case 6:return($=r.sent())instanceof s.Comments2Error&&($.code===s.ErrorCode.FILE_NOT_FOUND?a(z(d.Comments2ContextStatus.Disabled)):S&&k instanceof s.Comments2Api&&f.logErrorEvent(($.message,": "+$.message),{stream:y})),a({type:G.actionTypes.error,error:$}),[3,7];case 7:return[2]}var ee,te}))}))}},X=N("ActivateThread"),Z=y.syncHandler(X),Q=U("DeactivateAllThreads"),J=y.syncHandler(Q),$=L("CheckOnboardingStatus"),ee=j($,(function(e,t){return t.api.checkOnboardingStatus()})),te=L("CheckUpsellExperimentDismissed"),re=j(te,(function(e,t){return t.api.checkUpsellExperiment()})),ne=L("GetStickers"),ie=j(ne,(function(e,t){return t.api.getStickers()})),oe=N("HoverAnnotation"),ae=y.syncHandler(oe),se=N("FocusAnnotation"),le=y.syncHandler(se),ce=L("MarkOnboarded"),ue=j(ce,(function(e,t){return t.api.markHasOnboarded(e)})),de=L("DismissUpsellExperiment"),pe=j(de,(function(e,t){return t.api.dismissUpsellExperiment()})),me=N("DismissOnboarding"),fe=y.syncHandler(me),_e=N("MarkModalVariantShown"),ve=y.syncHandler(_e),he=L("CreateThread"),ge=j(he,(function(e,t){var r=e.annotation,n=(e.author,e.content),i=(e.guid,e.source),o=t.api,a=t.context.stream,s=u.iCommentContentToUserSubmittedComment({annotation:r,content:n,stream:a});return o.createThread(s,i)})),we=L("ReplyToThread"),ye=j(we,(function(e,t){e.author;var r=e.content,n=(e.guid,e.threadId),i=t.api,o=t.context.stream,a=u.iCommentContentToUserSubmittedComment({content:r,stream:o});return i.replyToThread(a,n)})),be=L("DeleteComment"),Ee=j(be,(function(e,t){var r=e.commentId;e.threadId;return t.api.deleteComment(r)})),Se=L("EditComment"),ke=j(Se,(function(e,t){var r=e.commentId,n=e.content,i=(e.threadId,t.api),o=t.context.stream,a=u.iCommentContentToUserSubmittedComment({content:n,stream:o});return i.editComment(r,a)})),Te=L("MarkThreadRead"),Ce=j(Te,(function(e,t){e.origin;var r=e.threadId;return t.api.markThreadRead(r)})),Pe=L("MarkThreadUnread"),xe=j(Pe,(function(e,t){return t.api.markThreadUnread(e)})),Ae=L("MarkThreadResolved"),Me=j(Ae,(function(e,t){var r=e.threadId;return t.api.markThreadResolved(r)})),Ie=L("MarkThreadUnresolved"),Fe=j(Ie,(function(e,t){return t.api.markThreadUnresolved(e)})),Oe=U("EnablePlayerIntegration"),De=y.syncHandler(Oe),Re=N("SetUpsellTooltipVariant"),Le=y.syncHandler(Re),Ne=N("SetThirdPartySource"),Ue=y.syncHandler(Ne),We=N("SetCanSeeCommentEditor"),Ve=y.syncHandler(We),Be=N("RecordEnabledStatus"),je=y.syncHandler(Be),qe=N("SetPerfData"),Ke=y.syncHandler(qe),He=N("SetSubscriptionStatus"),ze=y.syncHandler(He),Ge=L("Subscribe"),Ye=j(Ge,(function(e,t){return t.api.subscribe()})),Xe=U("ToggleShowResolved"),Ze=y.syncHandler(Xe),Qe=L("Unsubscribe"),Je=j(Qe,(function(e,t){return t.api.unsubscribe()})),$e=N("UpdateDocumentCurrentPage"),et=y.syncHandler($e),tt=N("UpdateEditorIsEmpty"),rt=y.syncHandler(tt),nt=N("UpdatePlayerCurrentTime"),it=y.syncHandler(nt),ot=N("DocMetadataLoad"),at=y.syncHandler(ot),st=N("SetPendingNumberedAnnotation"),lt=y.syncHandler(st),ct=U("ClearPendingNumberedAnnotation"),ut=y.syncHandler(ct),dt=U("SetPendingNumberedAnnotationMayBeOffscreen"),pt=y.syncHandler(dt),mt=U("RequestEditorFocus"),ft=y.syncHandler(mt),_t=U("FulfillEditorFocusRequest"),vt=y.syncHandler(_t),ht=N("TrackSidebarCommentsVisibility"),gt=y.syncHandler(ht),wt=N("ResetStore"),yt=y.syncHandler(wt);function bt(e,t,n){var i=this;return function(){return r.__awaiter(i,void 0,void 0,(function(){var i,o;return r.__generator(this,(function(r){return t?(i=t.viewer,o=t.stream,(i?new s.Comments2Api(i.id,o):new s.Comments2LoggedOutApi(o)).logPerfEvent(e,n),[2]):[2]}))}))}}t.ActionTypes={SetContext:q,SetContextStatus:H,ActivateThread:X,CheckOnboardingStatus:$,CheckUpsellExperimentDismissed:te,CreateThread:he,DeactivateAllThreads:Q,DeleteComment:be,EditComment:Se,EnablePlayerIntegration:Oe,ListComments:G,HoverThread:oe,FocusThread:se,MarkOnboarded:ce,DismissOnboarding:me,DismissUpsellExperiment:de,GetStickers:ne,MarkModalVariantShown:_e,MarkThreadRead:Te,MarkThreadResolved:Ae,MarkThreadUnread:Pe,MarkThreadUnresolved:Ie,RecordEnabledStatus:Be,ReplyToThread:we,SetCanSeeCommentEditor:We,SetPerfData:qe,SetSubscriptionStatus:He,SetThirdPartySource:Ne,SetUpsellTooltipVariant:Re,Subscribe:Ge,ToggleShowResolved:Xe,Unsubscribe:Qe,UpdateDocumentCurrentPage:$e,UpdateEditorIsEmpty:tt,UpdatePlayerCurrentTime:nt,DocMetadataLoad:ot,SetPendingNumberedAnnotation:st,ClearPendingNumberedAnnotation:ct,SetPendingNumberedAnnotationMayBeOffscreen:dt,RequestEditorFocus:mt,FulfillEditorFocusRequest:_t,TrackSidebarCommentsVisibility:ht,ResetStore:wt},t.Actions={setContextStatus:z,setFileContext:D,activateComment:function(e){return function(t,r){var n=v.getThreads(r()),i=m.findCommentThread(n,e);!i||i.comment.deleted?p.showErrorSnackbar({message:o._("That comment has been deleted.")}):i.thread.resolved&&p.showErrorSnackbar({message:o._("That comment has been resolved.")}),i&&t(T({thread:i.thread,pendingAnnotationInfo:m.getAnnotationInfoForThread(i.thread)}))}},activateThread:Z,activateThreadAndMarkAsRead:T,activateThreadByLayerClick:function(e,t){return function(r,n){var i=n();if(v.getIsComments2Ready(i)){var o=v.getDisplayedThreadsForLayer(i,e.page);r(J());var a=m.getThreadForNumberedAnnotationAtPoint(e,o,t);a&&r(T({thread:a,wasPreviewLayerClick:!0}))}}},activateThreadByMarkerClick:function(e){return function(t){return r.__awaiter(S,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return(n=c.store.getState().sidebar).open?[3,2]:[4,c.store.dispatch(b.open("annotation_select"))];case 1:r.sent(),r.label=2;case 2:return"comments"===n.activeTab?[3,4]:[4,c.store.dispatch(b.selectTab("comments"))];case 3:r.sent(),r.label=4;case 4:return t(T(e)),[2]}}))}))}},checkOnboardingStatus:ee,checkUpsellExperimentDismissed:re,createThread:ge,deactivateAllThreads:J,deleteComment:Ee,disableCommenting:x,editComment:ke,enableCommenting:C,enablePlayerIntegration:De,hoverThread:ae,focusThread:le,hoverThreadByLayer:function(e,t){return function(r,n){var i=n();if(v.getIsComments2Ready(i)){var o=v.getDisplayedThreadsForLayer(i,e.page),a=m.getThreadForNumberedAnnotationAtPoint(e,o,t);v.getHoverThreadId(i)!==(a&&a.id)&&r(ae(a&&a.id))}}},getStickers:ie,listComments:Y,markOnboarded:ue,markOnboardedIfUnmarked:function(e){return function(t,r){v.getOnboardingVariants(r())[e]&&t(ue(e))}},dismissOnboarding:fe,dismissUpsellExperiment:pe,markModalVariantShown:ve,markThreadRead:Ce,markThreadResolved:Me,markThreadUnread:xe,markThreadUnresolved:Fe,recordEnabledStatus:je,replyToThread:ye,setCanSeeCommentEditor:Ve,setPerfData:Ke,setSubscriptionStatus:ze,setThirdPartySource:Ue,setUpsellTooltipVariant:Le,subscribe:Ye,toggleShowResolved:Ze,unsubscribe:Je,updateDocumentCurrentPage:et,updateEditorIsEmpty:rt,updatePlayerCurrentTime:it,setPendingNumberedAnnotation:lt,clearPendingNumberedAnnotation:ut,setPendingNumberedAnnotationMayBeOffscreen:pt,requestEditorFocus:ft,fulfillEditorFocusRequest:vt,trackSidebarCommentsVisibility:gt,openVersionHistory:function(){return function(e,t){var r=t(),n=v.getViewerId(r),o=v.getFQPath(r);if(o&&n){var a=w.getFileHistoryUrl({fqPath:o,userId:n});i.redirect(a)}}},docMetadataLoad:at,logPerfEvent:function(e,t){var n=this;return function(i,o){return r.__awaiter(n,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){return n=v.getContext(o()),i(bt(e,n,t)),[2]}))}))}},logSimplePerfEvent:function(e,t){var n=this;return function(i,o){return r.__awaiter(n,void 0,void 0,(function(){var n,i;return r.__generator(this,(function(r){return n=o(),(i=v.getContext(n))&&i.viewer&&new s.Comments2Api(i.viewer.id,i.stream).logSimplePerfEvent(e,t),[2]}))}))}},resetStore:yt}})),define("modules/clean/react/comments2/data/api",["require","exports","tslib","modules/clean/api_v2/error","modules/clean/api_v2/user_client","modules/clean/api_v2/noauth_client","modules/core/exception"],(function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importStar(a);var s=function(e,t,r){this.code=e,this.message=t,this.apiError=r};function l(e,t){if(e instanceof n.ApiError){var r=t;return e.message&&(r+=". Detailed message: "+e.message.toString()),new s(e.error[".tag"],r,e)}return e}function c(e){var t={".tag":e.type};return e.linkUrl?{type:t,identifier:{".tag":"shared_link_details",url:e.linkUrl}}:{type:t,identifier:{".tag":"file_path_or_id",file_path_or_id:e.id}}}t.Comments2Error=s,(function(e){e.FILE_NOT_FOUND="file_not_found",e.PERMISSION_DENIED="permission_denied",e.BAD_REQUEST="bad_request"})(t.ErrorCode||(t.ErrorCode={}));var u=(function(){function e(e){this.routes=(new o.NoAuthApiV2Client).ns("comments2"),this.params={},this.stream=c(e)}return e.prototype.listComments=function(e,t){return void 0===e&&(e=!1),this.routes.rpc("logged_out/list_comments",{stream:this.stream,cursor:t,include_permissions:e},this.params).catch((function(e){throw l(e,"/logged_out/list_comments did not complete successfully")}))},e.prototype.logPerfEvent=function(e,t,r){return void 0===r&&(r={}),this.logPerfEventImpl(e,t,r)},e.prototype.logPerfEventImpl=function(e,t,r){var n=r.threadId,i=r.commentId,o=r.oref,s=r.errorMessage,c={event:e,value:t,stream:this.stream,thread_id:n,comment_id:i,error_message:s,oref:o};return this.routes.rpc("log_perf_event",c,this.params).catch((function(e){throw a.reportStack("comments2 perf logging failed",{severity:a.SEVERITY.NONCRITICAL,tags:["comments2_logging"],exc_extra:c}),l(e,"/log_perf_event did not complete successfully")}))},e})();t.Comments2LoggedOutApi=u;var d=(function(){function e(e,t){var r=new i.UserApiV2Client;this.routes=r.ns("comments2"),this.stickerRoutes=r.ns("stickers"),this.params={subjectUserId:e},this.stream=c(t)}return e.prototype.getStickers=function(){return this.stickerRoutes.rpc("get_stickers",void 0,this.params).catch((function(e){throw l(e,"/get_stickers did not complete successfully")}))},e.prototype.checkOnboardingStatus=function(){return this.routes.rpc("check_onboarding_status",void 0,this.params).catch((function(e){throw l(e,"/check_onboarding_status did not complete successfully")}))},e.prototype.checkUpsellExperiment=function(){return this.routes.rpc("check_upsell_experiment",void 0,this.params).catch((function(e){throw l(e,"/check_onboarding_status did not complete successfully")}))},e.prototype.createThread=function(e,t){return this.routes.rpc("add_comment",{stream:this.stream,comment:e,source:t},this.params).catch((function(e){throw l(e,"/add_comment (new comment) did not complete successfully")}))},e.prototype.deleteComment=function(e){return this.routes.rpc("delete_comment",{stream:this.stream,id:e},this.params).catch((function(e){throw l(e,"/delete_comment did not complete successfully")}))},e.prototype.disableCommenting=function(){return this.routes.rpc("disable_commenting",{stream:this.stream},this.params).catch((function(e){throw l(e,"/disable_commenting did not complete successfully")}))},e.prototype.dismissUpsellExperiment=function(){return this.routes.rpc("dismiss_upsell_experiment",void 0,this.params).catch((function(e){throw l(e,"/dismiss_upsell_experiment did not complete successfully")}))},e.prototype.editComment=function(e,t){return this.routes.rpc("edit_comment",{stream:this.stream,id:e,comment:t},this.params).catch((function(e){throw l(e,"/edit_comment did not complete successfully")}))},e.prototype.enableCommenting=function(){return this.routes.rpc("enable_commenting",{stream:this.stream},this.params).catch((function(e){throw l(e,"/enable_commenting did not complete successfully")}))},e.prototype.listComments=function(e,t){return void 0===e&&(e=!1),this.routes.rpc("list_comments",{stream:this.stream,cursor:t,include_permissions:e},this.params).catch((function(e){throw l(e,"/list_comments did not complete successfully")}))},e.prototype.logPerfEvent=function(e,t){return this.logPerfEventImpl(e,t)},e.prototype.logSimplePerfEvent=function(e,t){return this.logPerfEvent({".tag":e},t)},e.prototype.logPerfEventImpl=function(e,t){var r={event:e,value:t,stream:this.stream};return this.routes.rpc("log_perf_event",r,this.params).catch((function(e){throw a.reportStack("comments2 perf logging failed",{severity:a.SEVERITY.NONCRITICAL,tags:["comments2_logging"],exc_extra:r}),l(e,"/log_perf_event did not complete successfully")}))},e.prototype.markHasOnboarded=function(e){var t={".tag":e};return this.routes.rpc("mark_has_onboarded",{type:t},this.params).catch((function(e){throw l(e,"/mark_has_onboarded did not complete successfully")}))},e.prototype.markThreadRead=function(e){return this.routes.rpc("mark_thread_read",{stream:this.stream,id:e},this.params).catch((function(e){throw l(e,"/mark_thread_read did not complete successfully")}))},e.prototype.markThreadUnread=function(e){return this.routes.rpc("mark_thread_unread",{stream:this.stream,id:e},this.params).catch((function(e){throw l(e,"/mark_thread_unread did not complete successfully")}))},e.prototype.markThreadResolved=function(e){return this.routes.rpc("resolve_thread",{stream:this.stream,id:e},this.params).catch((function(e){throw l(e,"/resolve_thread did not complete successfully")}))},e.prototype.markThreadUnresolved=function(e){return this.routes.rpc("unresolve_thread",{stream:this.stream,id:e},this.params).catch((function(e){throw l(e,"/unresolve_thread did not complete successfully")}))},e.prototype.replyToThread=function(e,t){return this.routes.rpc("add_comment",{stream:this.stream,comment:e,thread_id:t},this.params).catch((function(e){throw l(e,"/add_comment (reply comment) did not complete successfully")}))},e.prototype.subscribe=function(){return this.routes.rpc("subscribe",{stream:this.stream},this.params).catch((function(e){throw l(e,"/subscribe did not complete successfully")}))},e.prototype.unsubscribe=function(){return this.routes.rpc("unsubscribe",{stream:this.stream},this.params).catch((function(e){throw l(e,"/unsubscribe did not complete successfully")}))},e})();t.Comments2Api=d})),define("modules/clean/react/comments2/data/initial_state",["require","exports","modules/clean/react/comments2/data/types"],(function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.INITIAL_STATE={context:void 0,data:{editorIsEmpty:!0,threads:{},authors:{},activatedThreadId:void 0,documentRectangleToMakeVisible:void 0,hoverThreadId:void 0,cursor:void 0,modalVariantsShown:(n={},n[r.ModalVariant.EmailVerifyModal]=!1,n[r.ModalVariant.SignUpModal]=!1,n),onboardingVariants:{premium_av_comments_pane_surface:!1,premium_av_preview_surface:!1,non_premium_av_comments_pane_surface:!1,not_annotatable_file_comments_pane_surface:!1,how_to_at_mention_comments_pane_surface:!1,image_preview_surface:!1,document_preview_surface:!1,share_as_comment:!1},pendingAnnotationInfo:{playerCurrentTime:0,annotationMayBeOffscreen:!1},showResolved:!1,upsellExperimentNotDismissed:!1,canSeeCommentEditor:!1,playerIntegrationEnabled:!1,enabledStatus:{canEnable:!1},subscriptionStatus:{canSubscribe:!1,isSubscribed:!1},requestEditorFocus:!1,visibleInSidebar:!0,perfEvents:{},upsellTooltipVariant:void 0,thirdPartySource:void 0,stickers:void 0},statuses:{}}})),define("modules/clean/react/comments2/data/logger",["require","exports","tslib","external/lodash","modules/clean/logging/hive/schemas/web-comments2","modules/clean/logging/telemetry","modules/clean/previews/util","modules/clean/react/comments2/data/util","modules/clean/react/comments2/util","modules/constants/python","modules/core/browser","modules/core/browser_detection"],(function(e,t,r,n,i,o,a,s,l,c,u,d){"use strict";var p;function m(){var e=u.get_uri().getQuery().oref,t=n.findKey(c.OREF_CONSTANTS,(function(t){return t===e})),r={oref_name:t=t&&t.toLowerCase(),platform:"web",is_mobile:d.is_mobile_or_tablet(),product_surface:"file_preview"};return e===c.OREF_CONSTANTS.DESKTOP_HARMONY&&(r.referral_source="badge"),r}Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),o=r.__importStar(o),u=r.__importStar(u),t.hiveLogger=new o.HiveLogger,(function(e){e.PageLevel="page-level",e.Targeted="targeted"})(p||(p={})),t.logEvent=function(e,n){var o=r.__assign({event:e},m());if(n){var c=n.commentId,u=n.stream,d=n.thread,f=n.threadId;c&&(o.comment_gid=c),f&&(o.thread_gid=f),d&&(o.thread_gid=d.id,o.is_annotation=!!d.annotation,o.is_third_party=d.isThirdParty,s.isThreadWithTimecodeAnnotation(d)&&(o.annotation_type="time",o.time_comment_offset=d.annotation.time),s.isThreadWithDocumentAnnotation(d)&&(o.annotation_type=d.annotation.regionType,o.page=d.annotation.regions[0].page,o.annotation_position=l.isFullPageAnnotation(d.annotation)?p.PageLevel:p.Targeted),s.isThreadWithImageAnnotation(d)&&(o.annotation_type="rectangle",o.annotation_position=l.isFullImageAnnotation(d.annotation)?p.PageLevel:p.Targeted)),u&&(o.stream_gid=u.id,o.file_obj_id=u.id,o.ns_id=u.ns_id,o.file_size=u.bytes,o.file_extension=a.getWhitelistedExtension(u.filename))}t.hiveLogger.log(new i.Comments2LoggingTableRow(o))},t.logErrorEvent=function(e,n){var o=n.stream,s=r.__assign({event:"comment_error",error_message:e},m());o&&(s.stream_gid=o.id,s.file_obj_id=o.id,s.ns_id=o.ns_id,s.file_size=o.bytes,s.file_extension=a.getWhitelistedExtension(o.filename)),t.hiveLogger.log(new i.Comments2LoggingTableRow(s))}})),define("modules/clean/react/comments2/data/perf_util",["require","exports"],(function(e,t){"use strict";function r(){return+new Date}Object.defineProperty(t,"__esModule",{value:!0}),t.threadActionCompleted=function(e,t){return{".tag":"thread_action_completed_ms",action:e,error_message:t}},t.commentActionCompleted=function(e,t){return{".tag":"comment_action_completed_ms",action:e,error_message:t}},t.mentionsQueryCompleted=function(){return{".tag":"mentions_query_completed_ms"}},t.currentTime=r,t.withTiming=function(e,t){var n=r();return function(i){e(i);var o=r()-n;t(o)}}})),define("modules/clean/react/comments2/data/reducer_helper",["require","exports","tslib","modules/clean/redux/types"],(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createStatusReducer=function(e){for(var t={},i=0,o=Object.keys(e).map((function(t){return e[t]}));i<o.length;i++){var a=o[i];"async"===a.type&&(t[a.actionTypes.request]={name:a.name,status:n.ApiClientStatus.Request},t[a.actionTypes.error]={name:a.name,status:n.ApiClientStatus.Error})}return function(e,n){var i,o=t[n.type];return o&&(e=r.__assign({},e,((i={})[o.name]=o.status,i))),e}},t.createActionReducer=function(){return function(e,t){switch(e.type){case"async":return"function"==typeof t?[[e.actionTypes.success,t]]:[t.Error&&[e.actionTypes.error,t.Error],t.Request&&[e.actionTypes.request,t.Request],t.Success&&[e.actionTypes.success,t.Success]].filter((function(e){return e}));case"sync":if("function"==typeof t)return[[e.actionType,t]]}throw new Error}},t.createReducerFrom=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r={},n=0,i=e;n<i.length;n++)for(var o=i[n],a=0,s=o;a<s.length;a++){var l=s[a],c=l[0],u=l[1];r[c]||(r[c]=[]),r[c].push(u)}return function(e,t){for(var n=0,i=r[t.type]||[];n<i.length;n++){var o=i[n],a=t.meta&&t.meta.args;e=o(e,"payload"in t?t.payload:t.error,a)}return e}}})),define("modules/clean/react/comments2/data/reducer",["require","exports","tslib","external/lodash","modules/clean/react/comments2/data/actions","modules/clean/react/comments2/data/initial_state","modules/clean/react/comments2/data/util","modules/clean/react/comments2/data/reducer_helper","modules/clean/react/comments2/data/types","comments2/transforms"],(function(e,t,r,n,i,o,a,s,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),c=r.__importStar(c);var u=s.createStatusReducer(i.ActionTypes),d=s.createActionReducer(),p=s.createReducerFrom(d(i.ActionTypes.SetContext,(function(e,t){return t?r.__assign({},t,{status:l.Comments2ContextStatus.Pending}):void 0})),d(i.ActionTypes.SetContextStatus,(function(e,t){return r.__assign({},e,{status:t})})));function m(e,t,r){return e.map((function(e){return e.id===t?r(e):e}))}function f(e,t,i){var o=e.threads[t];return o?(function(e,t){var n;return r.__assign({},e,{threads:r.__assign({},e.threads,(n={},n[t.id]=t,n))})})(e,n.assignIn({},o,i)):e}function _(e,t,n,i){var o,a=t.threads[n];return a?f(t,n,a.pending?r.__assign({},a,((o={})[i]=a.pending.originalValue,o.pending=r.__assign({},a.pending,{error:e}),o)):a):t}function v(e,t,r,n){var i=e.threads[r];return i?f(e,r,{comments:m(i.comments,t,n)}):e}function h(e,t,n,i,o){return v(t,n,i,(function(t){var n;return t.pending?r.__assign({},t,((n={})[o]=t.pending.originalValue,n.pending=r.__assign({},t.pending,{error:e}),n)):t}))}var g=s.createActionReducer(),w=s.createReducerFrom(g(i.ActionTypes.ActivateThread,(function(e,t){var n=t.thread,i=t.pendingAnnotationInfo,o=t.wasPreviewLayerClick;return r.__assign({},e,{activatedThreadId:n.id,documentRectangleToMakeVisible:o?void 0:a.documentRectangleFromThread(n),pendingAnnotationInfo:i||e.pendingAnnotationInfo})})),g(i.ActionTypes.DeactivateAllThreads,(function(e){return n.assignIn({},e,{activatedThreadId:void 0,activatedDocumentAnnotationRectangle:void 0})})),g(i.ActionTypes.ListComments,{Success:function(e,t,n){var i=r.__assign({},e.authors,c.usersToIUserMap(t.authors)),o=r.__assign({},e.threads,c.threadsToIThreadMap(t.threads,i,t.currentRevision));return r.__assign({},e,{threads:o,authors:i,cursor:t.cursor})}}),g(i.ActionTypes.CreateThread,{Request:function(e,t,n){var o,s=new Date,l=n.annotation,c=n.author,u=n.content,d=n.guid,p={id:d,timestamp:s,read:!0,readonly:!0,isShownInBrowseSurface:!1,isThirdParty:!1,resolved:!1,comments:[{id:d,threadId:d,timestamp:s,author:c,content:u,revisionInfo:{isCurrent:!0},userPermissions:{canDelete:!1,canEdit:!1}}],annotation:l},m=r.__assign({},p,{pending:{action:i.ActionTypes.CreateThread.name,originalValue:void 0,pendingValue:p}}),f=e.pendingAnnotationInfo.annotationMayBeOffscreen?a.documentRectangleFromThread(p):void 0;return r.__assign({},e,{activatedThreadId:d,documentRectangleToMakeVisible:f,threads:r.__assign({},e.threads,(o={},o[d]=m,o))})},Success:function(e,t,n){var i,o=n.guid,a=e.threads,s=o,l=a[s],c=r.__rest(a,["symbol"==typeof s?s:s+""]),u=m(l.comments,o,(function(e){return r.__assign({},e,{id:t.id,userPermissions:{canDelete:!0,canEdit:!(e.content.metadata[0]&&"sticker"===e.content.metadata[0].type)},readonly:!1})}));return r.__assign({},e,{activatedThreadId:e.activatedThreadId===n.guid?t.id:e.activatedThreadId,threads:r.__assign({},c,(i={},i[t.id]=r.__assign({},l,{id:t.id,comments:u,pending:void 0}),i))})},Error:function(e,t,n){var i=e.threads,o=n.guid,a=(i[o],r.__rest(i,["symbol"==typeof o?o:o+""]));return r.__assign({},e,{threads:a})}}),g(i.ActionTypes.ReplyToThread,{Request:function(e,t,n){var o,a=new Date,s=n.author,l=n.content,c=n.guid,u=n.threadId,d={id:c,threadId:u,timestamp:a,author:s,content:l,revisionInfo:{isCurrent:!0},userPermissions:{canDelete:!1,canEdit:!1}},p=e.threads[u],m=r.__assign({},p,{read:!0,comments:p.comments.concat([d])}),f=r.__assign({},m,{pending:{action:i.ActionTypes.ReplyToThread.name,originalValue:p,pendingValue:m}});return r.__assign({},e,{activatedThreadId:u,threads:r.__assign({},e.threads,(o={},o[u]=f,o))})},Success:function(e,t,n){var i,o=n.guid,a=n.threadId,s=e.threads[a],l=m(s.comments,o,(function(e){return r.__assign({},e,{id:t.id,userPermissions:{canDelete:!0,canEdit:!(e.content.metadata[0]&&"sticker"===e.content.metadata[0].type)}})}));return r.__assign({},e,{threads:r.__assign({},e.threads,(i={},i[a]=r.__assign({},s,{comments:l,pending:void 0}),i))})},Error:function(e,t,n){var i,o=e.threads[n.threadId],a=o.comments.filter((function(e){return e.id!==n.guid}));return r.__assign({},e,{threads:r.__assign({},e.threads,(i={},i[n.threadId]=r.__assign({},o,{comments:a,pending:void 0}),i))})}}),g(i.ActionTypes.DeleteComment,{Request:function(e,t,n){return v(e,n.commentId,n.threadId,(function(e){return r.__assign({},e,{deleted:!0,pending:{action:i.ActionTypes.DeleteComment.name,originalValue:e.deleted,pendingValue:!0}})}))},Success:function(e,t,n){return v(e,n.commentId,n.threadId,(function(e){return r.__assign({},e,{pending:void 0})}))},Error:function(e,t,r){return h(t,e,r.commentId,r.threadId,"deleted")}}),g(i.ActionTypes.EditComment,{Request:function(e,t,n){return v(e,n.commentId,n.threadId,(function(e){return r.__assign({},e,{content:n.content,pending:{action:i.ActionTypes.EditComment.name,originalValue:e.content,pendingValue:n.content}})}))},Success:function(e,t,n){return v(e,n.commentId,n.threadId,(function(e){return r.__assign({},e,{pending:void 0})}))},Error:function(e,t,r){return h(t,e,r.commentId,r.threadId,"content")}}),g(i.ActionTypes.SetPerfData,(function(e,t){return r.__assign({},e,{perfEvents:r.__assign({},e.perfEvents,t)})})),g(i.ActionTypes.CheckUpsellExperimentDismissed,(function(e,t){return r.__assign({},e,{upsellExperimentNotDismissed:!t.has_dismissed})})),g(i.ActionTypes.CheckOnboardingStatus,(function(e,t){return r.__assign({},e,{onboardingVariants:{premium_av_comments_pane_surface:!1===t.premium_av_comments_pane_surface,premium_av_preview_surface:!1===t.premium_av_preview_surface,non_premium_av_comments_pane_surface:!1===t.non_premium_av_comments_pane_surface,not_annotatable_file_comments_pane_surface:!1===t.not_annotatable_file_comments_pane_surface,how_to_at_mention_comments_pane_surface:!1===t.how_to_at_mention_comments_pane_surface,image_preview_surface:!1===t.image_preview_surface,document_preview_surface:!1===t.document_preview_surface,share_as_comment:!1===t.share_as_comment}})})),g(i.ActionTypes.MarkOnboarded,(function(e,t,n){var i;return r.__assign({},e,{onboardingVariants:r.__assign({},e.onboardingVariants,(i={},i[n]=!1,i))})})),g(i.ActionTypes.MarkModalVariantShown,(function(e,t){var n;return r.__assign({},e,{modalVariantsShown:r.__assign({},e.modalVariantsShown,(n={},n[t]=!0,n))})})),g(i.ActionTypes.DismissOnboarding,(function(e){return r.__assign({},e,{onboardingVariants:n.mapValues(e.onboardingVariants,(function(){return!1}))})})),g(i.ActionTypes.MarkThreadRead,{Request:function(e,t,r){return f(e,r.threadId,{read:!0,pending:{action:i.ActionTypes.MarkThreadRead.name,originalValue:e.threads[r.threadId].read,pendingValue:!0}})},Success:function(e,t,r){return f(e,r.threadId,{pending:void 0})},Error:function(e,t,r){return _(t,e,r.threadId,"read")}}),g(i.ActionTypes.MarkThreadUnread,{Request:function(e,t,r){return f(e,r,{read:!1,pending:{action:i.ActionTypes.MarkThreadUnread.name,originalValue:e.threads[r].read,pendingValue:!1}})},Success:function(e,t,r){return f(e,r,{pending:void 0})},Error:function(e,t,r){return _(t,e,r,"read")}}),g(i.ActionTypes.MarkThreadResolved,{Request:function(e,t,r){var n={type:"with_details",resolver:r.resolver,resolvedTimestamp:new Date};return f(e,r.threadId,{resolvedInfo:n,pending:{action:i.ActionTypes.MarkThreadResolved.name,originalValue:e.threads[r.threadId].resolvedInfo,pendingValue:n}})},Success:function(e,t,r){return f(e,r.threadId,{pending:void 0})},Error:function(e,t,r){return _(t,e,r.threadId,"resolvedInfo")}}),g(i.ActionTypes.MarkThreadUnresolved,{Request:function(e,t,r){return f(e,r,{resolvedInfo:void 0,pending:{action:i.ActionTypes.MarkThreadUnresolved.name,originalValue:e.threads[r].resolvedInfo,pendingValue:void 0}})},Success:function(e,t,r){return f(e,r,{pending:void 0})},Error:function(e,t,r){return _(t,e,r,"resolvedInfo")}}),g(i.ActionTypes.SetContext,(function(e,t){return r.__assign({},e,n.pick(o.INITIAL_STATE.data,"activatedThreadId","authors","cursor","documentMetadata","enabledStatus","pendingAnnotationInfo","playerIntegrationEnabled","requestEditorFocus","canSeeCommentEditor","subscriptionStatus","threads"))})),g(i.ActionTypes.ToggleShowResolved,(function(e){return r.__assign({},e,{showResolved:!e.showResolved})})),g(i.ActionTypes.UpdateEditorIsEmpty,(function(e,t){return r.__assign({},e,{editorIsEmpty:t})})),g(i.ActionTypes.UpdateDocumentCurrentPage,(function(e,t){return r.__assign({},e,{pendingAnnotationInfo:r.__assign({},e.pendingAnnotationInfo,{currentPageNumber:t})})})),g(i.ActionTypes.UpdatePlayerCurrentTime,(function(e,t){return r.__assign({},e,{pendingAnnotationInfo:r.__assign({},e.pendingAnnotationInfo,{playerCurrentTime:t})})})),g(i.ActionTypes.HoverThread,(function(e,t){return r.__assign({},e,{hoverThreadId:t})})),g(i.ActionTypes.FocusThread,(function(e,t){return r.__assign({},e,{focusedThreadId:t})})),g(i.ActionTypes.SetPendingNumberedAnnotation,(function(e,t){return r.__assign({},e,{pendingAnnotationInfo:r.__assign({},e.pendingAnnotationInfo,{numberedAnnotation:t,annotationMayBeOffscreen:!1})})})),g(i.ActionTypes.ClearPendingNumberedAnnotation,(function(e,t){return r.__assign({},e,{pendingAnnotationInfo:r.__assign({},e.pendingAnnotationInfo,{numberedAnnotation:void 0,annotationMayBeOffscreen:!1})})})),g(i.ActionTypes.SetPendingNumberedAnnotationMayBeOffscreen,(function(e){return r.__assign({},e,{pendingAnnotationInfo:r.__assign({},e.pendingAnnotationInfo,{annotationMayBeOffscreen:!0})})})),g(i.ActionTypes.TrackSidebarCommentsVisibility,(function(e,t){return r.__assign({},e,{visibleInSidebar:t})})),g(i.ActionTypes.DocMetadataLoad,(function(e,t){return r.__assign({},e,{documentMetadata:t})})),g(i.ActionTypes.RequestEditorFocus,(function(e){return r.__assign({},e,{requestEditorFocus:!0})})),g(i.ActionTypes.FulfillEditorFocusRequest,(function(e){if(!e.requestEditorFocus)throw new Error("Fulfilling request for editor focus, but isnt requested in store");return r.__assign({},e,{requestEditorFocus:!1})})),g(i.ActionTypes.EnablePlayerIntegration,(function(e,t){return r.__assign({},e,{playerIntegrationEnabled:!0})})),g(i.ActionTypes.SetUpsellTooltipVariant,(function(e,t){return r.__assign({},e,{upsellTooltipVariant:t})})),g(i.ActionTypes.DismissUpsellExperiment,{Request:function(e){return r.__assign({},e,{upsellExperimentNotDismissed:!1})}}),g(i.ActionTypes.SetThirdPartySource,(function(e,t){return r.__assign({},e,{thirdPartySource:t})})),g(i.ActionTypes.SetCanSeeCommentEditor,(function(e,t){return r.__assign({},e,{canSeeCommentEditor:t})})),g(i.ActionTypes.RecordEnabledStatus,(function(e,t){return r.__assign({},e,{enabledStatus:n.merge({},e.enabledStatus,t)})})),g(i.ActionTypes.SetSubscriptionStatus,(function(e,t){return r.__assign({},e,{subscriptionStatus:t})})),g(i.ActionTypes.Subscribe,(function(e){return r.__assign({},e,{subscriptionStatus:n.merge({},e.subscriptionStatus,{isSubscribed:!0})})})),g(i.ActionTypes.Unsubscribe,(function(e){return r.__assign({},e,{subscriptionStatus:n.merge({},e.subscriptionStatus,{isSubscribed:!1})})})),g(i.ActionTypes.ResetStore,(function(e,t){return r.__assign({},o.INITIAL_STATE.data)})),g(i.ActionTypes.GetStickers,(function(e,t){return r.__assign({},e,{stickers:t.sticker_sets})})));t.reducer=function(e,t){void 0===e&&(e=o.INITIAL_STATE);var r=p(e.context,t),n=w(e.data,t),i=u(e.statuses,t);return r!==e.context||n!==e.data||i!==e.statuses?{context:r,data:n,statuses:i}:e}})),define("modules/clean/react/comments2/data/selectors",["require","exports","tslib","external/lodash","reselect","modules/clean/redux/selectors","modules/clean/redux/namespaces","modules/clean/react/comments2/data/types","modules/clean/react/comments2/data/util","modules/clean/react/comments2/util","modules/clean/react/file_viewer/data/selectors","modules/clean/previews/constants","modules/clean/previews/data/preview_type_util","modules/clean/react/file_viewer/data/selectors","comments2/transforms"],(function(e,t,r,n,i,o,a,s,l,c,u,d,p,m,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),c=r.__importStar(c),m=r.__importStar(m);t.IMAGE_SENTINEL="IMAGE_SENTINEL",t.getState=function(e){return o.getStateAtNamespace(e,a.COMMENTS2_NAMESPACE_KEY)};t.getContext=function(e){var r=t.getState(e).context;return r?{stream:r.stream,viewer:r.viewer}:void 0},t.getContextStatus=function(e){var r=t.getState(e).context;return r?r.status:void 0};var _=i.createSelector(t.getContextStatus,(function(e){return e===s.Comments2ContextStatus.FullyEnabled})),v=i.createSelector(t.getContextStatus,(function(e){return e===s.Comments2ContextStatus.ReadOnly}));function h(e){return p.getPreviewType(m.getPreviewApiDataForCurrentFile(e))}function g(e){return i.createSelector(t.getData,(function(t){return t[e]}))}t.isEnabled=i.createSelector([_,v],(function(e,t){return e||t})),t.getFQPath=function(e){var r=t.getContext(e);return r?r.stream.fq_path:void 0},t.getViewer=function(e){var r=t.getContext(e);return r?r.viewer:void 0},t.getViewerId=function(e){var r=t.getViewer(e);return r?r.id:void 0},t.canCreateAnnotations=function(e){var r=t.getContext(e);return!(!r||!r.viewer)&&!c.isComments2Mobile()&&t.getVisibleInSidebar(e)},t.getPreviewTypeForCurrentFile=h,t.getIsComments2Ready=function(e){var t=e[a.COMMENTS2_NAMESPACE_KEY];return!(!t||!t.context||t.context.status!==s.Comments2ContextStatus.FullyEnabled&&t.context.status!==s.Comments2ContextStatus.ReadOnly)},t.getData=function(e){return t.getState(e).data},t.getRevision=i.createSelector(t.getContext,(function(e){return e&&f.streamToRevision(e.stream)})),t.getSort=i.createSelector(h,(function(e){switch(e){case d.PreviewType.Audio:case d.PreviewType.Video:return s.SortType.VideoTimeCode;default:return s.SortType.Chronological}})),t.getEditorIsEmpty=g("editorIsEmpty"),t.getThreadMap=g("threads");var w=i.createSelector(t.getThreadMap,(function(e){return n.values(e)})),y=i.createSelector(t.getContext,(function(e){return e&&e.stream.isVersionHistoryMode}));function b(e){return t.isEnabled(e)&&!c.isComments2Mobile()&&(function(e){var r=t.getData(e).onboardingVariants;switch(h(e)){case d.PreviewType.Audio:case d.PreviewType.Video:return t.getIsPlayerIntegrationEnabled(e)?r.premium_av_comments_pane_surface:r.non_premium_av_comments_pane_surface;case d.PreviewType.SsrDoc:return r.document_preview_surface||r.how_to_at_mention_comments_pane_surface;case d.PreviewType.Image:return r.image_preview_surface||r.how_to_at_mention_comments_pane_surface;case void 0:return!1;default:return r.not_annotatable_file_comments_pane_surface}})(e)}t.getThreads=i.createSelector([w,t.getSort,y,t.getRevision],(function(e,t,r,i){var o=(function(e,t){switch(t){case s.SortType.Chronological:return n.sortBy(e,[function(e){return e.timestamp.getTime()}]);case s.SortType.VideoTimeCode:var r=n.groupBy(e,(function(e){return e.annotation?"video":"global"})),i=r.video,o=r.global;return n.sortBy(i,[function(e){return e.annotation.time},function(e){return e.timestamp.getTime()}]).concat(n.sortBy(o,[function(e){return e.timestamp.getTime()}]))}})(e,t);return r?(function(e,t){return e.filter((function(e){var r=e.comments[0].revisionInfo;return r.isCurrent||!t||r.revision&&r.revision.nsId===t.ns_id&&r.revision.sjId<=t.sjid}))})(o,i):o})),t.getCursor=g("cursor"),t.getUnmarkedOnboardingKeysRelevantToCurrentFile=function(e){var r,n=t.getData(e).onboardingVariants;switch(h(e)){case d.PreviewType.SsrDoc:r=["document_preview_surface","how_to_at_mention_comments_pane_surface"];break;case d.PreviewType.Image:r=["image_preview_surface","how_to_at_mention_comments_pane_surface"];break;case d.PreviewType.Audio:case d.PreviewType.Video:r=t.getIsPlayerIntegrationEnabled(e)?["premium_av_comments_pane_surface","premium_av_preview_surface"]:["non_premium_av_comments_pane_surface"];break;case void 0:return[];default:r=["not_annotatable_file_comments_pane_surface"]}return r.filter((function(e){return n[e]}))},t.getShowOnboardingOnVideo=function(e){var r=t.getData(e).onboardingVariants,n=!u.getIsMediaPlaying(e),i=u.getPauseCount(e);return t.isEnabled(e)&&!c.isComments2Mobile()&&t.getIsPlayerIntegrationEnabled(e)&&n&&!b(e)&&r.premium_av_preview_surface&&i%5==1&&i<15},t.getShowShareAsCommentOnboarding=function(e){return t.getData(e).onboardingVariants.share_as_comment},t.getShowOnboardingOnCommentsPane=b,t.getOnboardingVariants=function(e){return t.getData(e).onboardingVariants},t.getHasShownAnyModalVariant=function(e){var r=t.getData(e).modalVariantsShown;return r[s.ModalVariant.EmailVerifyModal]||r[s.ModalVariant.SignUpModal]},t.getActivatedThreadId=g("activatedThreadId");var E=i.createSelector(t.getActivatedThreadId,t.getThreadMap,(function(e,t){return e&&t[e]}));t.getActivatedTimecodeThread=function(e){var t=E(e);return t&&l.isThreadWithTimecodeAnnotation(t)?t:void 0};var S=g("documentRectangleToMakeVisible");t.getDocumentRectangleToMakeVisibleIfComments2Ready=function(e){return t.getIsComments2Ready(e)?S(e):void 0},t.getHoverThreadId=g("hoverThreadId"),t.getFocusedThreadId=g("focusedThreadId"),t.getUnresolvedTimecodeThreads=function(e){return(function(e){return t.getThreads(e).filter((function(e){return!e.resolvedInfo}))})(e).filter((function(e){var t=e.annotation;return t&&("video"===t.type||"audio"===t.type)}))},t.getShowResolved=g("showResolved"),t.getStatuses=function(e){return t.getState(e).statuses},t.getIsPlayerIntegrationEnabled=g("playerIntegrationEnabled"),t.getStickers=function(e){return t.getData(e).stickers},t.getCanEnable=function(e){return t.getData(e).enabledStatus.canEnable},t.getCanSubscribe=function(e){return t.getData(e).subscriptionStatus.canSubscribe},t.getIsSubscribed=function(e){return t.getData(e).subscriptionStatus.isSubscribed},t.getStream=function(e){var r=t.getContext(e);return r&&r.stream},t.getStreamId=function(e){var r=t.getContext(e);return r&&r.stream.id};var k=g("pendingAnnotationInfo");function T(e){return k(e).numberedAnnotation}t.getPlayerCurrentTime=function(e){return k(e).playerCurrentTime},t.getCurrentPageNumber=function(e){return k(e).currentPageNumber},t.getPendingNumberedAnnotation=T,t.getHasPendingNumberedAnnotation=function(e){return t.getIsComments2Ready(e)&&!!T(e)},t.getVisibleInSidebar=g("visibleInSidebar");var C=i.createSelector([t.getVisibleInSidebar,t.isEnabled,t.getShowResolved,w],(function(e,t,r,n){return e&&t?(r?n:n.filter((function(e){return!e.resolvedInfo}))).filter((function(e){return e.comments.some((function(e){return!e.deleted}))})):[]})),P=i.createSelector(C,(function(e){return e.filter(l.isThreadWithDocumentAnnotation)})),x=i.createSelector(P,(function(e){return n.groupBy(e,(function(e){return e.annotation.regions[0].page}))}));function A(e,t){return n.get(x(e),t,[])}function M(e){var t=e.annotation;return!!t&&("document"===t.type||"image"===t.type)}function I(e){return C(e).filter((function(e){return e&&void 0!==e.annotation&&"image"===e.annotation.type}))}t.getDisplayedThreadsForLayer=function(e,t){return void 0===t?I(e):A(e,t)},t.getDisplayedThreadsWithDocumentAnnotationsOnPage=A,t.getDisplayedThreadsWithImageAnnotations=I,t.getDisplayedThreadsWithNumberedAnnotations=function(e){return C(e).filter(M)};var F=g("canSeeCommentEditor");t.getStreamSettings=i.createSelector([_,t.getViewer,F],(function(e,t,r){return{canComment:e,canModifyThreads:r&&!!t,canShowEditor:r}})),t.getDocumentMetadata=function(e){switch(h(e)){case d.PreviewType.SsrDoc:return t.getData(e).documentMetadata;case d.PreviewType.Image:return t.IMAGE_SENTINEL;default:return}},t.getIsEditorFocusRequested=g("requestEditorFocus"),t.getThirdPartySource=g("thirdPartySource")})),define("modules/clean/react/comments2/data/sidebar_watcher",["require","exports","tslib","eventemitter3"],(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),t.sideChannelEventEmitter=new n.default,t.COMMENTS_VISIBLE_SIGNAL="comments_visible",t.COMMENTS_HIDDEN_SIGNAL="comments_hidden"})),define("modules/clean/react/comments2/data/store",["require","exports","tslib","external/lodash","modules/clean/redux/namespaces","modules/clean/react/comments2/data/reducer","modules/clean/redux/store"],(function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),t.getStoreForComments2=n.once((function(){var e;return a.getStoreAndRegisterReducers(((e={})[i.COMMENTS2_NAMESPACE_KEY]=o.reducer,e))}))})),define("modules/clean/react/comments2/data/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),(function(e){e[e.Pending=0]="Pending",e[e.Comments1=1]="Comments1",e[e.Disabled=2]="Disabled",e[e.ReadOnly=3]="ReadOnly",e[e.FullyEnabled=4]="FullyEnabled"})(t.Comments2ContextStatus||(t.Comments2ContextStatus={})),(function(e){e.EmailVerifyModal="EmailVerifyModal",e.SignUpModal="SignUpModal"})(t.ModalVariant||(t.ModalVariant={})),(function(e){e[e.EditorFocus=0]="EditorFocus",e[e.OnPost=1]="OnPost"})(t.ShowModalReason||(t.ShowModalReason={})),(function(e){e.Chronological="CHRONOLOGICAL",e.VideoTimeCode="VIDEO_TIME_CODE"})(t.SortType||(t.SortType={})),(function(e){e[e.ThreadActivated=0]="ThreadActivated",e[e.UIButtonClicked=1]="UIButtonClicked"})(t.MarkThreadReadOrigin||(t.MarkThreadReadOrigin={}))})),define("modules/clean/react/comments2/data/util",["require","exports","tslib","modules/clean/react/comments2/util"],(function(e,t,r,n){"use strict";function i(e){var t=e.annotation;return!!t&&"document"===t.type}Object.defineProperty(t,"__esModule",{value:!0}),t.isThreadWithDocumentAnnotation=i,t.isThreadWithImageAnnotation=function(e){var t=e.annotation;return!!t&&"image"===t.type},t.isThreadWithTimecodeAnnotation=function(e){var t=e.annotation;return!!t&&n.isTimecodeAnnotation(t)},t.documentRectangleFromThread=function(e){if(e&&i(e)){var t=e.annotation.regions[0];return r.__assign({},t,{page:t.page-1})}}})),define("modules/clean/react/comments2/util",["require","exports","tslib","external/lodash","modules/core/browser_detection","modules/constants/comments2","modules/core/browser_detection"],(function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n);function s(e){return function(t,r){return void 0===t||void 0===r?t===r:e(t,r)}}function l(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return s((function(t,r){return e.every((function(e){return t[e]===r[e]}))}))}function c(e){return void 0!==e&&("audio"===e.type||"video"===e.type)}function u(e,t,r){return t<=e&&e<=r}t.createBackoff=function(e,t){void 0===e&&(e=1e3),void 0===t&&(t=3e5);var r,n=0;return{resetBackoff:function(){n=0,clearTimeout(r)},backoff:function(i){return r=setTimeout(i,Math.random()*Math.min(e*(Math.pow(2,n++)-1),t))}}},t.isUserSame=l("id"),t.isStreamSame=l("type","id"),t.isContextSame=s((function(e,r){return t.isStreamSame(e.stream,r.stream)&&t.isUserSame(e.viewer,r.viewer)})),t.findCommentThread=function(e,t){for(var r=0,i=e;r<i.length;r++){var o=i[r],a=n.find(o.comments,{id:t});if(a)return{comment:a,thread:o}}return null},t.getAnnotationInfoForThread=function(e){var t=e.annotation;if(c(t))return{playerCurrentTime:t.time,annotationMayBeOffscreen:!1}},t.isComments2Mobile=i.is_mobile_or_tablet,t.canShowUnreadPill=function(){return!a.msie},t.isTimecodeAnnotation=c,t.useBolt=function(){return!o.COMMENTS2_DISABLE_BOLT};var d=function(e,t,r){return Math.min.apply(Math,(function(e){return"image"===e.annotation.type?[e.annotation.region]:e.annotation.regions})(e).map((function(e){return(function(e,t,r){var n=e.x+e.width,i=e.y+e.height,o=function(e,t){return e<t?e:1/0};if(u(t.x,e.x,n)&&u(t.y,e.y,i)){var a=16/r.width,s=16/r.height;return Math.min(o(Math.min(t.x-e.x,n-t.x),a),o(Math.min(t.y-e.y,i-t.y),s))}return 1/0})(e,t,r)})))};function p(e){var t=e.x,r=e.y,n=e.width,i=e.height;return 0===t&&0===r&&1===n&&1===i}t.getThreadForNumberedAnnotationAtPoint=function(e,t,r){return n=function(t){return d(t,e,r)},t.reduce((function(e,t){var r=e.minRank,i=e.minElem,o=n(t);return r<=o?{minRank:r,minElem:i}:{minRank:o,minElem:t}}),{minRank:1/0,minElem:void 0}).minElem;var n},t.isFullPageAnnotation=function(e){return 1===e.regions.length&&p(e.regions[0])},t.isFullImageAnnotation=function(e){return p(e.region)},t.createFullRectangle=function(){return{x:0,y:0,width:1,height:1}}}));__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};define("modules/clean/react/file_metadata/component/loadable_metadata_details",["require","exports","modules/clean/react/async/loadable","modules/clean/web_timing_logger"],(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadableMetadataDetails=r.Loadable({loader:function(){return n.waitForTTI().then((function(){return new Promise((function(t,r){e(["modules/clean/react/file_metadata/component/metadata_details"],t,r)})).then(__importStar).then((function(e){return e.MetadataDetails}))}))}})})),define("modules/clean/react/file_activity_stream/tti_logger",["require","exports","modules/clean/react/file_sidebar/file_sidebar_logger"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(){this.hasLogged=!1}return e.prototype.recordStart=function(e){this.startTs=(new Date).getTime(),this.fileId=e,this.hasLogged=!1},e.prototype.recordInteractive=function(e){if(!this.hasLogged&&e===this.fileId&&this.startTs){var t=(new Date).getTime();r.logActivityStreamInteractivity({time_start:this.startTs,time_interactive:t}),this.hasLogged=!0}},e})();t.faStreamTTILogger=new n})),define("modules/clean/logging/hive/schemas/web-comments2",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){this.category="web-comments2",this.active_user_id=null,this.authed_user_ids=null,this.identity_gid=null,this.locale_browser_header=null,this.locale_user_selected=null,this.referrer=null,this.session_id=null,this.team_id=null,this.team_type=null,this.ua_browser_name=null,this.ua_browser_version=null,this.ua_dist_name=null,this.ua_dist_version=null,this.ua_os_name=null,this.ua_os_version=null,this.user_agent=null,this.user_id=null,this.event=e.event,this.comment_gid=e.comment_gid,this.thread_gid=e.thread_gid,this.stream_gid=e.stream_gid,this.timestamp=Math.floor(Date.now()/1e3),this.is_annotation=e.is_annotation,this.time_comment_offset=e.time_comment_offset,this.file_extension=e.file_extension,this.file_obj_id=e.file_obj_id,this.platform=e.platform,this.oref_name=e.oref_name,this.ns_id=e.ns_id,this.file_size=e.file_size,this.error_message=e.error_message,this.annotation_type=e.annotation_type,this.page=e.page,this.referral_source=e.referral_source,this.product_surface=e.product_surface,this.is_mobile=e.is_mobile,this.annotation_position=e.annotation_position,this.is_third_party=e.is_third_party,Object.seal(this)};t.Comments2LoggingTableRow=r})),define("premium-workflows/common/i18n",["require","exports","tslib","react","prop-types"],(function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),i=r.__importStar(i),t.IntlString=function(e,t){if(t.applyTranslation?t.applyTranslation(e):null)return n.createElement("span",null,t.applyTranslation(e));var r={};return t.isEnvExternal||(r={textShadow:"2px 2px 0px red"}),n.createElement("span",{style:r},e.text)},t.IntlString.displayName="IntlString",t.IntlString.contextTypes={applyTranslation:i.func},t.IntlPluralString=function(e,r){return t.IntlString(e,r)},t.IntlPluralString.displayName="IntlPluralString",t.IntlPluralString.contextTypes={applyTranslation:i.func};var o=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.getChildContext=function(){return{applyTranslation:this.props.applyTranslation,formatBytes:this.props.formatBytes,formatPercent:this.props.formatPercent,isEnvExternal:this.props.isEnvExternal}},t.prototype.render=function(){return n.createElement("div",null,this.props.children)},t})(n.Component);t.TranslationProvider=o,o.displayName="TranslationProvider",o.childContextTypes={applyTranslation:i.func,formatBytes:i.func,formatPercent:i.func,isEnvExternal:i.bool}})),define("premium-workflows/components/base/apply_button",["require","exports","tslib","react","spectrum/popover","spectrum/button","premium-workflows/common/i18n"],(function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.renderPopoverContent=function(){var e=this.props.makeACopyText||n.createElement(a.IntlString,{text:"Make a copy",description:"As in: save the markup file as a copy",project:"watermarking"}),t=this.props.overwriteText||n.createElement(a.IntlString,{text:"Replace original",description:"As in: overwrite this file with markup file",project:"watermarking"});return n.createElement(i.PopoverContent,null,n.createElement(i.PopoverContentItem,{value:!1,className:"apply-workflow-menu-item__copy"},e),n.createElement(i.PopoverContentItem,{value:!0,className:"apply-workflow-menu-item__overwrite"},t))},t.prototype.renderButton=function(){var e=this.props,t=e.onClick,r=e.disabled,i=this.props.buttonText||n.createElement(a.IntlString,{text:"Save",description:"Save the file",project:"watermarking"});return n.createElement(o.Button,{className:"apply-workflow-button",tagName:"div",disabled:r,variant:"primary",onClick:t},i)},t.prototype.render=function(){var e=this.props,t=e.onApply,r=e.disabled;return n.createElement(i.Popover,{className:"apply-workflow-button__popover",onSelection:t},n.createElement(i.PopoverTrigger,{disabled:r},this.renderButton()),this.renderPopoverContent())},t})((n=r.__importStar(n)).Component);t.ApplyButton=s})),define("premium-workflows/components/base/slider",["require","exports","tslib","react","classnames"],(function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),i=r.__importDefault(i);var o={trackBaseColor:"#dddfe1",trackFillColor:"#0d2484"},a={trackBaseColor:"#6a7c8f",trackFillColor:"#fff"},s=(function(e){function t(t){var r=e.call(this,t)||this;return r.handleChange=function(){if(r.inputEl){var e=Number(r.inputEl.value),t=r.props.onChange,n={value:e};r.setState(n,(function(){t&&t(e)}))}},r.getTrackStyleBackground=function(e){var t=r.props,n=t.darkMode,i=t.max,s=t.min,l=Math.round(100*(e-s)*100/(i-s))/100,c=n?a:o,u=c.trackFillColor,d=c.trackBaseColor;return"linear-gradient(to right, "+u+" 0%, "+u+" "+l+"%, "+d+" "+l+"%, "+d+" 100%)"},r.handleRef=function(e){r.inputEl=e||void 0,r.handleChange()},r.state={value:t.value||50},r}return r.__extends(t,e),t.prototype.componentDidUpdate=function(e){e.value!==this.props.value&&this.setState({value:this.props.value})},t.prototype.render=function(){var e=this.props,t=e.className,r=e.darkMode,o=e.disabled,a=e.fullWidth,s=e.min,l=e.max,c=e.name,u=e.step,d=this.state.value,p=i.default("range-slider__wrapper",{"range-slider--dark-mode":r,"range-slider--full-width":a,"range-slider--disabled":o},t);return n.createElement("span",{className:p},n.createElement("span",{className:"range-slider__track",style:{background:this.getTrackStyleBackground(d)}}),n.createElement("input",{className:"range-slider",disabled:o,type:"range",min:s,max:l,value:d,name:c,step:u,onChange:this.handleChange,ref:this.handleRef,"aria-valuemin":s,"aria-valuemax":l,"aria-valuenow":d}))},t})(n.PureComponent);t.Slider=s,s.defaultProps={disabled:!1,min:0,max:100,step:1},t.default=s})),define("premium-workflows/components/base/top_banner",["require","exports","tslib","react","spectrum/button"],(function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),t.TopBanner=function(e){var t=e.primaryText,r=e.secondaryText,o=e.buttonText,a=e.href,s=e.onClick;return n.createElement("div",{className:"top-banner"},n.createElement("div",{className:"top-banner__text"},n.createElement("div",{className:"top-banner__primary-text"},t," "),r),n.createElement(i.Button,{variant:"secondary",href:a,onClick:s},o))}})),define("premium-workflows/components/trial/banner",["require","exports","tslib","react","premium-workflows/components/base/top_banner","premium-workflows/common/i18n"],(function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),t.PrimaryText=function(e){switch(e.mode){case"watermarking":return n.createElement(o.IntlString,{text:"You’re in trial mode.",description:"This will be shown to basic and plus users when they test out watermarking",project:"watermarking"});default:return null}},t.SecondaryText=function(e){switch(e.mode){case"watermarking":return n.createElement(o.IntlString,{text:"Upgrade to Professional to apply your watermark.",description:"When basic or plus users test out a professional feature such as watermarking, they will not be able to save their changes until they upgrade",project:"watermarking"});default:return null}},t.Banner=function(e){var r=e.mode,a=e.onClick;return n.createElement(i.TopBanner,{primaryText:n.createElement(t.PrimaryText,{mode:r}),secondaryText:n.createElement(t.SecondaryText,{mode:r}),buttonText:n.createElement(o.IntlString,{text:"Upgrade",description:"Upgrade Dropbox account"}),onClick:a})}})),define("premium-workflows/components/trial/trial_popover_content",["require","exports","tslib","react","prop-types","premium-workflows/common/i18n","spectrum/button","spectrum/icon_form"],(function(e,t,r,n,i,o,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),i=r.__importStar(i),t.Title=function(e){switch(e.variant){case"watermarking_wm":return n.createElement(o.IntlString,{text:"Upgrade to Professional to get watermarking",description:"When basic or plus users test out a professional feature such as watermarking, they will not be able to save their changes until they upgrade",project:"watermarking"});case"file_requests":return n.createElement(o.IntlString,{text:"Upgrade to Professional for advanced features",description:"When basic or plus users test out a professional feature such as watermarking, they will not be able to save their changes until they upgrade",project:"watermarking"});default:return null}},t.ValueProp1=function(e){switch(e.variant){case"watermarking_wm":return n.createElement(o.IntlString,{text:"Protect work right in Dropbox",description:"Value prop: Users can protect their images/pdfs by watermarking them right in Dropbox",project:"watermarking"});case"file_requests":return n.createElement(o.IntlString,{text:"Set expiration dates for file requests",description:"Value prop: Users can set expiration dates for their file requests"});default:return null}},t.ValueProp2=function(e){switch(e.variant){case"watermarking_wm":return n.createElement(o.IntlString,{text:"Apply watermarks quickly",description:"Value prop: Users can apply watermarks to their pdf/images quickly",project:"watermarking"});case"file_requests":return n.createElement(o.IntlString,{text:"Get %(pro_space_limit)s of storage",pro_space_limit:e.proSpaceLimit||"",description:"Value prop: Users get more storage if they upgrade to Professional",project:"watermarking"});default:return null}},t.ValueProp2.contextTypes={formatBytes:i.func},t.ValueProp3=function(e){switch(e.variant){case"watermarking_wm":return n.createElement(o.IntlString,{text:"Create custom watermarks",description:"Value prop: Users can create custom watermarks (e.g. changing text, uploading an image)",project:"watermarking"});case"file_requests":return n.createElement(o.IntlString,{text:"Free up space with Smart Sync",description:"Value prop: Users can free up space with Smart Sync if they upgrade to Professional",project:"watermarking"});default:return null}},t.ValueProp=function(e){var t=e.children;return n.createElement("span",{className:"value-prop"},n.createElement(s.IconForm,{className:"value-prop__check",name:"check"}),t)},t.TrialPopoverContent=function(e){var r=e.variant,i=e.proSpaceLimit,s=e.onClick;return n.createElement("div",{className:"trial-popover-content"},n.createElement("div",{className:"trial-popover-content__title"},n.createElement(t.Title,{variant:r})),n.createElement("div",{className:"trial-popover-content__value-props"},n.createElement(t.ValueProp,null,n.createElement(t.ValueProp1,{variant:r})),n.createElement(t.ValueProp,null,n.createElement(t.ValueProp2,{variant:r,proSpaceLimit:i})),n.createElement(t.ValueProp,null,n.createElement(t.ValueProp3,{variant:r}))),n.createElement(a.Button,{variant:"primary",onClick:s,shouldWrapContent:!0},n.createElement(o.IntlString,{text:"Try Professional free",description:"Try Dropbox Professional for free"})))}})),define("file-transfers/common/constants",["require","exports","file-transfers/common/types"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MILLISECONDS_IN_DAY=864e5,t.BYTES_IN_KILOBYTE=1024,t.BYTES_IN_MEGABYTE=1048576,t.BYTES_IN_GIGABYTE=1073741824,t.COLOR_STONE="#637282",t.NOT_APPLICABLE_SATISFACTION_RATING_VALUE=-1,t.DEFAULT_EXPIRATION_OPTION=r.ExpirationOption.SEVEN_DAYS,t.DEFAULT_MAX_UNEXPIRED_DAYS=365,t.S3_STATIC_URL="https://showcase-marketing.dropboxstatic.com/file_transfers/backgrounds/"})),define("file-transfers/common/types",["require","exports"],(function(e,t){"use strict";var r,n;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.ExpirationOption||(t.ExpirationOption={}))[r.THREE_DAYS=3]="THREE_DAYS",r[r.SEVEN_DAYS=7]="SEVEN_DAYS",r[r.THIRTY_DAYS=30]="THIRTY_DAYS",r[r.NINETY_DAYS=90]="NINETY_DAYS",r[r.CUSTOM=0]="CUSTOM",(n=t.TransferShareStatus||(t.TransferShareStatus={})).EXPIRED="expired",n.SHARED="shared"})),define("file-transfers/feedback-form",["require","exports","tslib","react","spectrum/radio_button","spectrum/input","file-transfers/i18n","file-transfers/common/constants"],(function(e,t,r,n,i,o,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),t.FeedbackForm=function(e,t){var r=e.comment,i=e.rating,c=e.commentPrompt,u=e.onRatingChange,d=e.onCommentsChange,p=function(e){u(parseInt(e.target.value,10))};return n.createElement("div",{className:"feedback-form"},n.createElement("div",{className:"feedback-form__satisfaction-rating-container"},n.createElement("div",{className:"feedback-form__satisfaction-rating-radio-buttons"},n.createElement(l,{currentRating:i,buttonRating:1,text:n.createElement(a.IntlString,{text:"Extremely dissatisfied",description:"label on radio button denoting that the user is extremely dissatisfied with Dropbox Transfer"}),onChange:p}),n.createElement(l,{currentRating:i,buttonRating:2,onChange:p}),n.createElement(l,{currentRating:i,buttonRating:3,text:n.createElement(a.IntlString,{text:"Neutral",description:"label on radio button denoting that the user is neither satisfied nor dissatisfied with Dropbox Transfer"}),onChange:p}),n.createElement(l,{currentRating:i,buttonRating:4,onChange:p}),n.createElement(l,{currentRating:i,buttonRating:5,text:n.createElement(a.IntlString,{text:"Extremely satisfied",description:"label on radio button denoting that the user is extremely satisfied with Dropbox Transfer"}),onChange:p}),n.createElement(l,{currentRating:i,buttonRating:s.NOT_APPLICABLE_SATISFACTION_RATING_VALUE,text:n.createElement(a.IntlString,{text:"N/A",description:"label on radio button as an acronym for 'Not Applicable'"}),onChange:p}))),n.createElement("div",{className:"feedback-form__comments-container"},n.createElement("span",{className:"feedback-form__comments-prompt"},n.createElement("label",{htmlFor:"feedback-form__comments-textarea"},c)),n.createElement(o.TextArea,{className:"feedback-form__comments-textarea",id:"feedback-form__comments-textarea",placeholder:t.applyTranslation?t.applyTranslation({text:"Optional",description:"Placeholder label on input or textarea field denoting that filling the field out is optional"}):"Optional",value:r,onChange:function(e){d(e.currentTarget.value)}})))};var l=function(e){return n.createElement("div",{className:"satisfaction-rating-radio-button-block"},n.createElement(i.RadioButton,{name:"satisfaction-rating-radio-button","aria-checked":e.currentRating===e.buttonRating,checked:e.currentRating===e.buttonRating,id:e.buttonRating.toString(),onChange:e.onChange,value:e.buttonRating,className:"satisfaction-rating-radio-button"}),n.createElement("div",{className:"satisfaction-rating-radio-button-block__label"},n.createElement("span",{className:"satisfaction-rating-radio-button-block__rating-number"},e.buttonRating!==s.NOT_APPLICABLE_SATISFACTION_RATING_VALUE&&e.buttonRating),e.text&&n.createElement("span",{className:"satisfaction-rating-radio-button-block__rating-description"},e.text)))};l.displayName="SatisfactionRatingRadioButtonBlock"})),define("file-transfers/i18n",["require","exports","tslib","react","prop-types"],(function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),i=r.__importStar(i),t.IntlString=function(e,t){if(t.applyTranslation?t.applyTranslation(e):null)return n.createElement("span",null,t.applyTranslation(e));var r={};return t.isEnvExternal||(r={textShadow:"2px 2px 0px red"}),n.createElement("span",{style:r},e.text)},t.IntlString.displayName="IntlString",t.IntlString.contextTypes={applyTranslation:i.func},t.IntlPluralString=function(e,r){return t.IntlString(e,r)},t.IntlPluralString.displayName="IntlPluralString",t.IntlPluralString.contextTypes={applyTranslation:i.func};var o=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.getChildContext=function(){return{applyTranslation:this.props.applyTranslation,formatBytes:this.props.formatBytes,formatDate:this.props.formatDate,formatPercent:this.props.formatPercent,isEnvExternal:this.props.isEnvExternal}},t.prototype.render=function(){return n.createElement("div",null,this.props.children)},t})(n.Component);t.TranslationProvider=o,o.displayName="TranslationProvider",o.childContextTypes={applyTranslation:i.func,formatBytes:i.func,formatDate:i.func,formatPercent:i.func,isEnvExternal:i.bool}})),define("comments2/components/utils/throttle-debounce",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.throttle=function(e,t){var r=!0,n=null;function i(){r=!0,null!==n&&(e.apply(void 0,n),n=null)}return function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];r?(r=!1,e.apply(void 0,o),setTimeout(i,t)):n=o}},t.debounce=function(e,t,r){var n;return void 0===r&&(r=!1),function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];var a=this,s=function(){n=void 0,r||e.apply(a,i)},l=r&&void 0===n;void 0!==n&&window.clearTimeout(n),n=window.setTimeout(s,t),l&&e.apply(a,i)}}})),define("modules/clean/react/previews/print_helpers",["require","exports","modules/core/i18n"],(function(e,t,r){"use strict";function n(e){return!(e&&e.canPrintRoles&&0===e.canPrintRoles.length)}Object.defineProperty(t,"__esModule",{value:!0}),t.canPrint=n,t.getPrintTooltip=function(e){return n(e)?r._("Print"):r._("Printing is turned off for this file.")}}));__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};define("modules/clean/react/file_viewer_sidebar/data_managers/async_commenting_data_manager",["require","exports","modules/clean/react/async/loadable","modules/clean/web_timing_logger"],(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncCommentingDataManager=r.Loadable({loader:function(){return n.waitForTTI().then((function(){return new Promise((function(t,r){e(["modules/clean/react/file_viewer_sidebar/data_managers/commenting_data_manager"],t,r)})).then(__importStar)})).then((function(e){return e.CommentingDataManager}))}})}));__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};define("modules/clean/react/file_viewer_sidebar/data_managers/async_activity_data_manager",["require","exports","modules/clean/react/async/loadable","modules/clean/web_timing_logger"],(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncActivityDataManager=r.Loadable({loader:function(){return n.waitForTTI().then((function(){return new Promise((function(t,r){e(["modules/clean/react/file_viewer_sidebar/data_managers/activity_data_manager"],t,r)})).then(__importStar)})).then((function(e){return e.ActivityDataManager}))}})})),define("spectrum/tabbed_header",["require","exports","tslib","spectrum/tabbed_header/tabbed_header","spectrum/tabbed_header/tab"],(function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r.__exportStar(n,t),r.__exportStar(i,t)})),define("spectrum/tabbed_header/tab",["require","exports","tslib","classnames","react","react-aria-tabpanel"],(function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),i=r.__importStar(i),t.Tab=function(e){var t=e.children,a=e.className,s=e.id,l=e.ref,c=r.__rest(e,["children","className","id","ref"]),u=n.default("mc-tabbed-header-tab",a);return i.createElement(o.Tab,Object.assign({id:s,tag:"div",className:u,ref:l},c),(function(e){var r=e.isActive,o=n.default("mc-tabbed-header-tab-content",{"mc-tabbed-header-tab-content-selected":r});return[i.createElement("span",{key:"space",className:"mc-tabbed-header-tab-content-space"},t),i.createElement("span",{key:"content",className:o},t)]}))},t.Tab.displayName="Tab"})),define("spectrum/tabbed_header/tabbed_header",["require","exports","tslib","react","react-aria-tabpanel"],(function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),t.TabbedHeader=function(e){var t=e.children,o=e.onSelection,a=r.__rest(e,["children","onSelection"]);return n.createElement(i.Wrapper,Object.assign({className:"mc-tabbed-header",onChange:o},a),n.createElement(i.TabList,{tag:"ul",className:"mc-tabbed-header-list"},t&&n.Children.map(t,(function(e){return n.createElement("li",{className:"mc-tabbed-header-item",key:e.key||void 0,role:"presentation"},e)}))))},t.TabbedHeader.displayName="TabbedHeader"})),define("react-aria-tabpanel",["react","prop-types","create-react-class"],(function(e,t,r){return(function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=4)})([function(t,r){t.exports=e},function(e,r){e.exports=t},function(e,t){e.exports=r},function(e,t){e.exports=function(e,t,r){for(var n in t)t.hasOwnProperty(n)&&(e[n]||r[n]||(e[n]=t[n]))}},function(e,t,r){e.exports={Tab:r(5),TabList:r(6),TabPanel:r(7),Wrapper:r(8)}},function(e,t,r){var n=r(0),i=r(1),o=r(2),a=r(3),s={children:i.oneOfType([i.node,i.func]).isRequired,id:i.string.isRequired,tag:i.string,index:i.number,active:i.bool,letterNavigationText:i.string};e.exports=o({displayName:"AriaTabPanel-Tab",propTypes:s,getDefaultProps:function(){return{tag:"div"}},contextTypes:{atpManager:i.object.isRequired},getInitialState:function(){return{isActive:this.context.atpManager.memberStartsActive(this.props.id)||!1}},handleFocus:function(){this.context.atpManager.handleTabFocus(this.props.id)},updateActiveState:function(e){this.setState({isActive:e})},registerWithManager:function(e){this.isRegistered||(this.isRegistered=!0,this.context.atpManager.registerTab({id:this.props.id,node:e,update:this.updateActiveState,index:this.props.index,letterNavigationText:this.props.letterNavigationText}))},render:function(){var e=this.props,t=void 0===e.active?this.state.isActive:e.active,r="function"==typeof e.children?e.children({isActive:t}):e.children,i={id:e.id,tabIndex:t?0:-1,onClick:this.handleClick,onFocus:this.handleFocus,role:"tab","aria-selected":t,"aria-controls":this.context.atpManager.getTabPanelId(e.id),ref:this.registerWithManager};return a(i,e,s),n.createElement(e.tag,i,r)}})},function(e,t,r){var n=r(0),i=r(1),o=r(2),a=r(3),s={children:i.node.isRequired,tag:i.string};e.exports=o({displayName:"AriaTabPanel-TabList",propTypes:s,getDefaultProps:function(){return{tag:"div"}},render:function(){var e=this.props,t={role:"tablist"};return a(t,e,s),n.createElement(e.tag,t,e.children)}})},function(e,t,r){var n=r(0),i=r(1),o=r(2),a=r(3),s={children:i.oneOfType([i.node,i.func]).isRequired,tabId:i.string.isRequired,tag:i.string,active:i.bool};e.exports=o({displayName:"AriaTabPanel-TabPanel",propTypes:s,getDefaultProps:function(){return{tag:"div"}},contextTypes:{atpManager:i.object.isRequired},getInitialState:function(){return{isActive:this.context.atpManager.memberStartsActive(this.props.tabId)||!1}},handleKeyDown:function(e){e.ctrlKey&&"ArrowUp"===e.key&&(e.preventDefault(),this.context.atpManager.focusTab(this.props.tabId))},updateActiveState:function(e){this.setState({isActive:e})},registerWithManager:function(e){this.isRegistered||(this.isRegistered=!0,this.context.atpManager.registerTabPanel({node:e,update:this.updateActiveState,tabId:this.props.tabId}))},render:function(){var e=this.props,t=void 0===e.active?this.state.isActive||!1:e.active,r="function"==typeof e.children?e.children({isActive:t}):e.children,i=e.style||{};t||(i.display="none");var o={className:e.className,id:this.context.atpManager.getTabPanelId(e.tabId),onKeyDown:this.handleKeyDown,role:"tabpanel",style:i,"aria-hidden":!t,"aria-describedby":e.tabId,ref:this.registerWithManager};return a(o,e,s),n.createElement(e.tag,o,r)}})},function(e,t,r){var n=r(0),i=r(1),o=r(2),a=r(9),s=r(3),l={children:i.node.isRequired,activeTabId:i.string,letterNavigation:i.bool,onChange:i.func,tag:i.string};e.exports=o({displayName:"AriaTabPanel-Wrapper",propTypes:l,getDefaultProps:function(){return{tag:"div"}},childContextTypes:{atpManager:i.object.isRequired},getChildContext:function(){return{atpManager:this.manager}},componentWillMount:function(){this.manager=a({onChange:this.props.onChange,activeTabId:this.props.activeTabId,letterNavigation:this.props.letterNavigation})},componentWillUnmount:function(){this.manager.destroy()},componentDidMount:function(){this.manager.activate()},render:function(){var e=this.props,t={};return s(t,e,l),n.createElement(e.tag,t,e.children)}})},function(e,t,r){var n=r(10);function i(e){this.options=e;var t={wrap:!0,forwardArrows:["down","right"],backArrows:["up","left"],stringSearch:e.letterNavigation};this.focusGroup=n(t),this.tabs=[],this.tabPanels=[],this.activeTabId=e.activeTabId}i.prototype.activate=function(){this.focusGroup.activate()},i.prototype.memberStartsActive=function(e){return this.activeTabId===e||void 0===this.activeTabId&&(this.activeTabId=e,!0)},i.prototype.registerTab=function(e){void 0===e.index?this.tabs.push(e):this.tabs.splice(e.index,0,e);var t=e.letterNavigationText?{node:e.node,text:e.letterNavigationText}:e.node;this.focusGroup.addMember(t,e.index),this.activateTab(this.activeTabId||e.id)},i.prototype.registerTabPanel=function(e){this.tabPanels.push(e),this.activateTab(this.activeTabId),this.activateTab(this.activeTabId||e.tabId)},i.prototype.activateTab=function(e){e!==this.activeTabId&&(this.activeTabId=e,this.options.onChange?this.options.onChange(e):(this.tabPanels.forEach((function(t){t.update(e===t.tabId)})),this.tabs.forEach((function(t){t.update(e===t.id)}))))},i.prototype.handleTabFocus=function(e){this.activateTab(e)},i.prototype.focusTab=function(e){var t=this.tabs.find((function(t){return t.id===e}));t&&t.node.focus()},i.prototype.destroy=function(){this.focusGroup.deactivate()},i.prototype.getTabPanelId=function(e){return e+"-panel"},e.exports=function(e){return new i(e)}},function(e,t){function r(e){e=e||{},this._settings={forwardArrows:e.forwardArrows||["down"],backArrows:e.backArrows||["up"],wrap:e.wrap,stringSearch:e.stringSearch,stringSearchDelay:800},this._searchString="",this._members=[],e.members&&this.setMembers(e.members),this._boundHandleKeydownEvent=this._handleKeydownEvent.bind(this)}function n(e){e&&e.focus&&(e.focus(),"input"===e.tagName.toLowerCase()&&e.select())}r.prototype.activate=function(){return document.addEventListener("keydown",this._boundHandleKeydownEvent,!0),this},r.prototype.deactivate=function(){return document.removeEventListener("keydown",this._boundHandleKeydownEvent,!0),this._clearSearchStringRefreshTimer(),this},r.prototype._handleKeydownEvent=function(e){if(-1!==this._getActiveElementIndex()){var t=(function(e){return"ArrowUp"===e.key||38===e.keyCode?"up":"ArrowDown"===e.key||40===e.keyCode?"down":"ArrowLeft"===e.key||37===e.keyCode?"left":"ArrowRight"===e.key||39===e.keyCode?"right":null})(e);if(t)return-1!==this._settings.forwardArrows.indexOf(t)?(e.preventDefault(),void this.moveFocusForward()):-1!==this._settings.backArrows.indexOf(t)?(e.preventDefault(),void this.moveFocusBack()):void 0;this._handleNonArrowKey(e)}},r.prototype.moveFocusForward=function(){var e,t=this._getActiveElementIndex();return e=t<this._members.length-1?t+1:this._settings.wrap?0:t,this.focusNodeAtIndex(e),e},r.prototype.moveFocusBack=function(){var e,t=this._getActiveElementIndex();return e=t>0?t-1:this._settings.wrap?this._members.length-1:t,this.focusNodeAtIndex(e),e},r.prototype._handleNonArrowKey=function(e){if(this._settings.stringSearch){if(""!==this._searchString&&(" "===e.key||32===e.keyCode))return e.preventDefault(),-1;if(!(function(e){return e>=65&&e<=90})(e.keyCode))return-1;if(e.ctrlKey||e.metaKey||e.altKey)return-1;e.preventDefault(),this._addToSearchString(String.fromCharCode(e.keyCode)),this._runStringSearch()}},r.prototype._clearSearchString=function(){this._searchString=""},r.prototype._addToSearchString=function(e){this._searchString+=e.toLowerCase()},r.prototype._startSearchStringRefreshTimer=function(){var e=this;this._clearSearchStringRefreshTimer(),this._stringSearchTimer=setTimeout((function(){e._clearSearchString()}),this._settings.stringSearchDelay)},r.prototype._clearSearchStringRefreshTimer=function(){clearTimeout(this._stringSearchTimer)},r.prototype._runStringSearch=function(){this._startSearchStringRefreshTimer(),this.moveFocusByString(this._searchString)},r.prototype.moveFocusByString=function(e){for(var t,r=0,i=this._members.length;r<i;r++)if((t=this._members[r]).text&&0===t.text.indexOf(e))return n(t.node)},r.prototype._findIndexOfNode=function(e){for(var t=0,r=this._members.length;t<r;t++)if(this._members[t].node===e)return t;return-1},r.prototype._getActiveElementIndex=function(){return this._findIndexOfNode(document.activeElement)},r.prototype.focusNodeAtIndex=function(e){var t=this._members[e];return t&&n(t.node),this},r.prototype.addMember=function(e,t){var r=e.node||e,n=e.text||r.getAttribute("data-focus-group-text")||r.textContent||"";return this._checkNode(r),e={node:r,text:n.replace(/[\W_]/g,"").toLowerCase()},null!=t?this._members.splice(t,0,e):this._members.push(e),this},r.prototype.removeMember=function(e){var t="number"==typeof e?e:this._findIndexOfNode(e);if(-1!==t)return this._members.splice(t,1),this},r.prototype.clearMembers=function(){return this._members=[],this},r.prototype.setMembers=function(e){this.clearMembers();for(var t=0,r=e.length;t<r;t++)this.addMember(e[t]);return this},r.prototype.getMembers=function(){return this._members},r.prototype._checkNode=function(e){if(!e.nodeType||e.nodeType!==window.Node.ELEMENT_NODE)throw new Error("focus-group: only DOM nodes allowed");return e},e.exports=function(e){return new r(e)}}])}));
//# sourceMappingURL=pkg-file_viewer.min.js-vflbJFAML.map